<!DOCTYPE html>
<!-- START: inst/pkgdown/templates/layout.html --><!-- Generated by pkgdown: do not edit by hand --><html lang="ja" data-bs-theme="auto">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<title>Introduction to data analysis with R and Bioconductor: 一つにまとまったページ</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="assets/themetoggle.js"></script><link rel="stylesheet" type="text/css" href="assets/styles.css">
<script src="assets/scripts.js" type="text/javascript"></script><!-- mathjax --><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      config: ["MMLorHTML.js"],
      jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML", "output/PreviewHTML"],
      extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js", "AssistiveMML.js", "a11y/accessibility-menu.js"],
      TeX: {
        extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
      },
      tex2jax: {
        inlineMath: [['\\(', '\\)']],
        displayMath: [ ['$$','$$'], ['\\[', '\\]'] ],
        processEscapes: true
      }
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><!-- Responsive Favicon for The Carpentries --><link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<link rel="manifest" href="site.webmanifest">
<link rel="mask-icon" href="safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" media="(prefers-color-scheme: light)" content="white">
<meta name="theme-color" media="(prefers-color-scheme: dark)" content="black">
</head>
<body>
    <header id="top" class="navbar navbar-expand-md top-nav incubator"><svg xmlns="http://www.w3.org/2000/svg" class="d-none"><symbol id="check2" viewbox="0 0 16 16"><path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"></path></symbol><symbol id="circle-half" viewbox="0 0 16 16"><path d="M8 15A7 7 0 1 0 8 1v14zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16z"></path></symbol><symbol id="moon-stars-fill" viewbox="0 0 16 16"><path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"></path><path d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.734 1.734 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.734 1.734 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.734 1.734 0 0 0 1.097-1.097l.387-1.162zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"></path></symbol><symbol id="sun-fill" viewbox="0 0 16 16"><path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"></path></symbol></svg><a class="visually-hidden-focusable skip-link" href="#main-content">本文へ移動</a>
  <div class="container-fluid top-nav-container">
    <div class="col-md-8">
      <div class="large-logo">
        <img id="incubator-logo" alt="Carpentries Incubator" src="assets/images/incubator-logo.svg">
</div>
    </div>
    <div class="selector-container">
      <div id="theme-selector">
        <li class="nav-item dropdown" id="theme-button-list">
          <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
            <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="bd-theme-text">
<li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                Light
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                Dark
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                Auto
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
          </ul>
</li>
      </div>

      <div class="dropdown" id="instructor-dropdown">
        <button class="btn btn-secondary dropdown-toggle bordered-button" type="button" id="dropdownMenu1" data-bs-toggle="dropdown" aria-expanded="false">
          <i aria-hidden="true" class="icon" data-feather="eye"></i> 学習者表示 <i data-feather="chevron-down"></i>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
<li><button class="dropdown-item" type="button" onclick="window.location.href='instructor/aio.html';">インストラクター表示</button></li>
        </ul>
</div>
    </div>
  </div>
  <hr></header><nav class="navbar navbar-expand-xl bottom-nav incubator" aria-label="メインナビゲーション"><div class="container-fluid nav-container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="ナビゲーションの切り替え">
      <span class="navbar-toggler-icon"></span>
      <span class="menu-title">メニュー</span>
    </button>
    <div class="nav-logo">
      <img class="small-logo" alt="Carpentries Incubator" src="assets/images/incubator-logo-sm.svg">
</div>
    <div class="lesson-title-md">
      Introduction to data analysis with R and Bioconductor
    </div>
    <div class="search-icon-sm">
      <!-- TODO: do not show until we have search
        <i role="img" aria-label="オールインワンページで検索" data-feather="search"></i>
      -->
    </div>
    <div class="desktop-nav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
<li class="nav-item">
          <span class="lesson-title">
            Introduction to data analysis with R and Bioconductor
          </span>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="key-points.html">まとめ</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="reference.html#glossary">用語集</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="profiles.html">学習者プロフィール</a>
        </li>
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" id="navbarDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            その他 <i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
<li><a class="dropdown-item" href="discuss.html">Discussion</a></li>
<li><a class="dropdown-item" href="reference.html"></a></li>
          </ul>
</li>
      </ul>
</div>
    <!--
    <form class="d-flex col-md-2 search-form">
      <fieldset disabled>
      <input class="form-control me-2 searchbox" type="search" placeholder="" aria-label="">
        <button class="btn btn-outline-success tablet-search-button"  type="submit">
          <i class="search-icon" data-feather="search" role="img" aria-label="オールインワンページで検索"></i>
        </button>
      </fieldset>
    </form>
    -->
    <a id="search-button" class="btn btn-primary" href="aio.html" role="button" aria-label="オールインワンページで検索">オールインワンページで検索</a>
  </div>
<!--/div.container-fluid -->
</nav><div class="col-md-12 mobile-title">
  Introduction to data analysis with R and Bioconductor
</div>

<aside class="col-md-12 lesson-progress"><div style="width: %" class="percentage">
    %
  </div>
  <div class="progress incubator">
    <div class="progress-bar incubator" role="progressbar" style="width: %" aria-valuenow="" aria-label="レッスンの進捗状況" aria-valuemin="0" aria-valuemax="100">
    </div>
  </div>
</aside><div class="container">
      <div class="row">
        <!-- START: inst/pkgdown/templates/navbar.html -->
<div id="sidebar-col" class="col-lg-4">
  <div id="sidebar" class="sidebar">
      <nav aria-labelledby="flush-headingEleven"><button role="button" aria-label="メニューを閉じる" alt="メニューを閉じる" aria-expanded="true" aria-controls="sidebar" class="collapse-toggle" data-collapse="折りたたむ " data-episodes="エピソード ">
          <i class="search-icon" data-feather="x" role="img"></i>
        </button>
        <div class="sidebar-inner">
          <div class="row mobile-row" id="theme-row-mobile">
            <div class="col" id="theme-selector">
              <li class="nav-item dropdown" id="theme-button-list">
                <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
                  <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><span class="d-lg-none ms-1" id="bd-theme-text">Toggle Theme</span>
                </button>
                <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="bd-theme-text">
<li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                      Light
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                      Dark
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                      <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                      Auto
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                </ul>
</li>
            </div>
          </div>
          <div class="row mobile-row">
            <div class="col">
              <div class="sidenav-view-selector">
                <div class="accordion accordion-flush" id="accordionFlush9">
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingNine">
                      <button class="accordion-button collapsed" id="instructor" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseNine" aria-expanded="false" aria-controls="flush-collapseNine">
                        <i id="eye" aria-hidden="true" class="icon" data-feather="eye"></i> 学習者表示
                      </button>
                    </h2>
                    <div id="flush-collapseNine" class="accordion-collapse collapse" aria-labelledby="flush-headingNine" data-bs-parent="#accordionFlush2">
                      <div class="accordion-body">
                        <a href="instructor/aio.html">インストラクター表示</a>
                      </div>
                    </div>
                  </div>
<!--/div.accordion-item-->
                </div>
<!--/div.accordion-flush-->
              </div>
<!--div.sidenav-view-selector -->
            </div>
<!--/div.col -->

            <hr>
</div>
<!--/div.mobile-row -->

          <div class="accordion accordion-flush" id="accordionFlush11">
            <div class="accordion-item">

              <button id="chapters" class="accordion-button show" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseEleven" aria-expanded="false" aria-controls="flush-collapseEleven">
                <h2 class="accordion-header chapters" id="flush-headingEleven">
                  エピソード
                </h2>
              </button>
              <div id="flush-collapseEleven" class="accordion-collapse show collapse" aria-labelledby="flush-headingEleven" data-bs-parent="#accordionFlush11">

                <div class="accordion-body">
                  <div class="accordion accordion-flush" id="accordionFlush1">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading1">
        <a href="index.html">概要とセットアップ</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush2">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading2">
        <a href="10-data-organisation.html">1. スプレッドシートを使用したデータ整理</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush3">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading3">
        <a href="20-r-rstudio.html">2. RとRStudio</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush4">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading4">
        <a href="23-starting-with-r.html">3. R の紹介</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush5">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading5">
        <a href="25-starting-with-data.html">4. データから始める</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush6">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading6">
        <a href="30-dplyr.html">5. dplyrによるデータの操作と分析</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush7">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading7">
        <a href="40-visualization.html">6. データの可視化</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush8">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading8">
        <a href="60-next-steps.html">7. 次のステップ</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

                </div>
              </div>
            </div>

            <hr class="half-width">
<div class="accordion accordion-flush resources" id="accordionFlush12">
              <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingTwelve">
                  <button class="accordion-button collapsed" id="resources" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwelve" aria-expanded="false" aria-controls="flush-collapseTwelve">
                    資料
                  </button>
                </h2>
                <div id="flush-collapseTwelve" class="accordion-collapse collapse" aria-labelledby="flush-headingTwelve" data-bs-parent="#accordionFlush12">
                  <div class="accordion-body">
                    <ul>
<li>
                        <a href="key-points.html">まとめ</a>
                      </li>
                      <li>
                        <a href="reference.html#glossary">用語集</a>
                      </li>
                      <li>
                        <a href="profiles.html">学習者プロフィール</a>
                      </li>
                      <li><a href="discuss.html">Discussion</a></li>
<li><a href="reference.html"></a></li>
                    </ul>
</div>
                </div>
              </div>
            </div>
            <hr class="half-width resources">
<a href="aio.html">一つにまとまったページ</a>


            <hr class="d-none d-sm-block d-md-none">
<div class="d-grid gap-1">

            </div>
          </div>
<!-- /div.accordion -->
        </div>
<!-- /div.sidebar-inner -->
      </nav>
</div>
<!-- /div.sidebar -->
  </div>
<!-- /div.sidebar-col -->
<!-- END:   inst/pkgdown/templates/navbar.html-->

        <!-- START: inst/pkgdown/templates/content-extra.html -->
  <div class="col-xl-8 col-lg-12 primary-content">
    <main id="main-content" class="main-content"><div class="container lesson-content">
        
        
<section id="aio-10-data-organisation"><p>Content from <a href="10-data-organisation.html">スプレッドシートを使用したデータ整理</a></p>
<hr>
<p>最終更新日：2024-09-08 |

        <a href="https://github.com/carpentries-incubator/bioc-intro/edit/main/episodes/10-data-organisation.Rmd" class="external-link">ページの編集 <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="回答を全て表示する " data-collapse="回答を全て折りたたむ "> 回答を全て表示する <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">概要</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">質問</h3>
<ul>
<li>表形式のデータを整理するにはどうすればよいですか?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">目的</h3>
<ul>
<li>スプレッドシートとその長所と短所について学びます。</li>
<li>データを効果的に使用するには、スプレッドシート内のデータをどのようにフォーマットすればよいでしょうか?</li>
<li>一般的なスプレッドシートのエラーとその修正方法について説明します。</li>
<li>きちんとしたデータの原則に従ってデータを整理します。</li>
<li>カンマ区切り (CSV) 形式やタブ区切り (TSV)
形式などのテキストベースのスプレッドシート形式について説明します。</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<blockquote>
<p>This episode is based on the Data Carpentries’s <em>Data Analysis and
Visualisation in R for Ecologists</em> lesson.</p>
</blockquote>
<section><h2 class="section-heading" id="表計算プログラム">表計算プログラム<a class="anchor" aria-label="アンカー" href="#%E8%A1%A8%E8%A8%88%E7%AE%97%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%A0"></a>
<a class="anchor" aria-label="anchor" href="#%E8%A1%A8%E8%A8%88%E7%AE%97%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%A0"></a>
</h2>
<hr class="half-width">
<p><strong>質問</strong></p>
<ul>
<li>優れたデータ統合用にスプレッドシートを使用するための基本的な原則は何でしょうか？</li>
</ul>
<p><strong>客観的</strong></p>
<ul>
<li>コンピューターがデータセットを
に活用できるようにデータを整理するためのベスト
プラクティスについて説明します。</li>
</ul>
<p><strong>キーポイント</strong></p>
<ul>
<li>適切なデータ構成は、あらゆる研究プロジェクトの基礎です。</li>
</ul>
<p>適切なデータ構成は、研究 の基礎です。
ほとんどの研究者はデータを持っているか、
シートにデータ入力を行っていません。 スプレッドシート
プログラムは、データ テーブルを設計し、非常に基本的
データ品質管理機能を処理するための非常に便利な インターフェイスです。
<span class="citation">@Broman:2018</span> も参照してください。</p>
<div class="section level3">
<h3 id="スプレッドシートの概要">スプレッドシートの概要<a class="anchor" aria-label="anchor" href="#%E3%82%B9%E3%83%97%E3%83%AC%E3%83%83%E3%83%89%E3%82%B7%E3%83%BC%E3%83%88%E3%81%AE%E6%A6%82%E8%A6%81"></a>
</h3>
<p>スプレッドシートはデータ入力に適しています。
したがって、スプレッドシートにはデータ がたくさんあります。
研究者としての時間の多くは、この「データの検討」段階
費やされることになります。 とても楽しいわけではありませんが、必要性は
です。 データの編成について考える方法と、より効果的なデータ
ラングリングのための かの実践方法を説明します。</p>
</div>
<div class="section level3">
<h3 id="このレッスンで教えられないこと">このレッスンで教えられないこと<a class="anchor" aria-label="anchor" href="#%E3%81%93%E3%81%AE%E3%83%AC%E3%83%83%E3%82%B9%E3%83%B3%E3%81%A7%E6%95%99%E3%81%88%E3%82%89%E3%82%8C%E3%81%AA%E3%81%84%E3%81%93%E3%81%A8"></a>
</h3>
<ul>
<li>スプレッドシートで <em>統計</em> を行う方法</li>
<li>スプレッドシートで <em>プロット</em> を行う方法</li>
<li>スプレッドシート プログラムで _コードを記述する_方法</li>
</ul>
<p>これを実行したい場合は、O 発行の Head First Excel 参考になります。
「ライリー。</p>
</div>
<div class="section level3">
<h3 id="なぜスプレッドシートでのデータ分析を教えないのか">なぜスプレッドシートでのデータ分析を教えないのか<a class="anchor" aria-label="anchor" href="#%E3%81%AA%E3%81%9C%E3%82%B9%E3%83%97%E3%83%AC%E3%83%83%E3%83%89%E3%82%B7%E3%83%BC%E3%83%88%E3%81%A7%E3%81%AE%E3%83%87%E3%83%BC%E3%82%BF%E5%88%86%E6%9E%90%E3%82%92%E6%95%99%E3%81%88%E3%81%AA%E3%81%84%E3%81%AE%E3%81%8B"></a>
</h3>
<ul>
<li><p>スプレッドシートでのデータ分析には通常、多くの 作業が必要です。
パラメーターを変更したり、
データセットを使用して分析を実行したりする場合は、通常、すべてを手動でやり直す必要があります。
(マクロを作成できることはわかりませ
が、次の点を参照してください。)</p></li>
<li><p>また、
の作業に戻りたいときや、誰かが分析の詳細を尋ねたときに、スプレッドシート
プログラムで行われた統計分析やプロット分析を追跡したり再現したりすること
困難です。</p></li>
</ul>
<p>多くの表計算プログラムが利用可能です。
ほとんどの参加者は主なスプレッドシート プログラムとして
を使用するため、このレッスンで Excel の例を使用します。
で使用できる表計算プログラムは LibreOffice です。 コマンドはプログラム間
少し異なる場合がありますが、一般的な考え方は同じです。</p>
<p>スプレッドシート プログラムには、研究者としてできる
にする必要のある多くのことが含まれています。
それらは次の目的で使用できます。</p>
<ul>
<li>データ入力</li>
<li>データの整理</li>
<li>データのサブセット化と並べ替え</li>
<li>統計</li>
<li>プロット</li>
</ul>
<p>スプレッドシート
プログラムはテーブルを使用してデータを表し、表示します。
テーブルとしてフォーマットされたデータ
この章の主要テーマであり、効率的なダウンストリーム分析を
にするために、標準化された方法でデータをテーブルに編成する方法
見ていきます。</p>
<div id="課題-隣人と次の点について話し合ってください" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="課題-隣人と次の点について話し合ってください" class="callout-inner">
<h3 class="callout-title">課題: 隣人と次の点について話し合ってください。<a class="anchor" aria-label="アンカー" href="#%E8%AA%B2%E9%A1%8C-%E9%9A%A3%E4%BA%BA%E3%81%A8%E6%AC%A1%E3%81%AE%E7%82%B9%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6%E8%A9%B1%E3%81%97%E5%90%88%E3%81%A3%E3%81%A6%E3%81%8F%E3%81%A0%E3%81%95%E3%81%84"></a>
</h3>
<div class="callout-content">
<ul>
<li>研究や
、または自宅でスプレッドシートを使用したことがありますか?</li>
<li>スプレッドシートではどのような操作を行っていますか?</li>
<li>スプレッドシートは何に適していると思いますか?</li>
<li>スプレッドシート プログラムで誤ってイライラ
たり悲しくなったりするようなことをしたことがありますか?</li>
</ul>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="スプレッドシートの問題">スプレッドシートの問題<a class="anchor" aria-label="anchor" href="#%E3%82%B9%E3%83%97%E3%83%AC%E3%83%83%E3%83%89%E3%82%B7%E3%83%BC%E3%83%88%E3%81%AE%E5%95%8F%E9%A1%8C"></a>
</h3>
<p>スプレッドシートはデータ入力には適していますが、実際にはデータ入力以外の目的で
シート プログラムを使用する傾向があります。 これら
を使用して、出版物のデータ テーブルを作成し、概要
統計を生成し、図を作成します。</p>
<p>スプレッドシートでパブリケーション用のテーブルを生成することは
ではありません。多くの場合、パブリケーション用にデータ
テーブルをフォーマットするとき、実際にはデータとして読み取ら
ことを意図していない方法で重要な概要統計をレポートすることに
、特殊なフォーマットが必要になることがよくあります。
(セルを結合し、境界線を作成し、美しくする)。
この種の操作は文書編集ソフトウェア内で行う をお勧めします。</p>
<p>統計と数値を生成する後者の 2 つのアプリケーションは、
して使用する必要があります。1 スプレッド
プログラムのグラフィカルなドラッグ アンド ドロップの性質のため、
手順を複製するのが不可能ではないにしても、非常に困難になる可能性があります
(元に戻すことはさらに困難です)。特に
の統計や数値により、より複雑な計算が必要な場合はそうです。
さらに、スプレッドシートで計算を行う場合、 わずかに異なる数式を
の隣接するセルに誤って適用してしまうことがよくあります。 R や SAS
などのコマンドライン
ベースの統計プログラムを使用する場合、意図的に実行しない限り、データセット内の観測値には計算を適用し、別の観測値には計算を適用しないことは事実上不可能です。</p>
</div>
<div class="section level3">
<h3 id="データ入力とクリーニングにスプレッドシートを使用する">データ入力とクリーニングにスプレッドシートを使用する<a class="anchor" aria-label="anchor" href="#%E3%83%87%E3%83%BC%E3%82%BF%E5%85%A5%E5%8A%9B%E3%81%A8%E3%82%AF%E3%83%AA%E3%83%BC%E3%83%8B%E3%83%B3%E3%82%B0%E3%81%AB%E3%82%B9%E3%83%97%E3%83%AC%E3%83%83%E3%83%89%E3%82%B7%E3%83%BC%E3%83%88%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B"></a>
</h3>
<p>このレッスンでは、 なスプレッドシート プログラムとして Excel
を使用している可能性が高いと仮定します。他にも (OpenOffice の
gnumeric、Calc ) があり、機能は似ていますが、Excel が
よく使用されているプログラムであると思われます。生物学者や生物医学の研究者。</p>
<p>このレッスンでは次のことについて話します。</p>
<ol style="list-style-type: decimal">
<li>スプレッドシートでのデータテーブルの書式設定</li>
<li>フォーマットの問題</li>
<li>データのエクスポート</li>
</ol>
</div>
</section><section><h2 class="section-heading" id="スプレッドシートでのデータテーブルの書式設定">スプレッドシートでのデータテーブルの書式設定<a class="anchor" aria-label="アンカー" href="#%E3%82%B9%E3%83%97%E3%83%AC%E3%83%83%E3%83%89%E3%82%B7%E3%83%BC%E3%83%88%E3%81%A7%E3%81%AE%E3%83%87%E3%83%BC%E3%82%BF%E3%83%86%E3%83%BC%E3%83%96%E3%83%AB%E3%81%AE%E6%9B%B8%E5%BC%8F%E8%A8%AD%E5%AE%9A"></a>
<a class="anchor" aria-label="anchor" href="#%E3%82%B9%E3%83%97%E3%83%AC%E3%83%83%E3%83%89%E3%82%B7%E3%83%BC%E3%83%88%E3%81%A7%E3%81%AE%E3%83%87%E3%83%BC%E3%82%BF%E3%83%86%E3%83%BC%E3%83%96%E3%83%AB%E3%81%AE%E6%9B%B8%E5%BC%8F%E8%A8%AD%E5%AE%9A"></a>
</h2>
<hr class="half-width">
<p><strong>質問</strong></p>
<ul>
<li>データを効果的に使用するには、スプレッドシート内のデータをどのようにフォーマットすればよいでしょうか?</li>
</ul>
<p><strong>目的</strong></p>
<ul>
<li><p>シートでのデータ入力と書式設定のベスト
プラクティスについて説明します。</p></li>
<li><p>ベスト プラクティスを適用して、変数と観測値を
シートに配置します。</p></li>
</ul>
<p><strong>キーポイント</strong></p>
<ul>
<li><p>生データは決して変更しないでください。
を加える前に必ずコピーを作成してください。</p></li>
<li><p>データをクリーンアップするために実行したすべての手順を テキスト
ファイルに記録します。</p></li>
<li><p>きちんとしたデータの原則に従ってデータを整理します。</p></li>
</ul>
<p>最もよくある間違いは、スプレッドシート プログラムを研究室の
ブックのように扱うことです。つまり、情報を伝えるためにコンテキスト、余白のメモ、データとフィールドの空間
レイアウトに依存していることです。 人間として、これらのことを (通常は)
解釈できますが、コンピューターは情報
同じようには見ません。そして、すべての
の意味をコンピューターに説明しない限り (それ
難しい場合があります!)、理解できません。
データがどのように組み合わされるかを確認できます。</p>
<p>コンピューターの力を利用すると、
効果的かつ高速な方法でデータを管理および分析できますが、その力を使用するには、コンピューターが理解できるようにデータを
する必要があります ( コンピューターは非常に複雑です)。リテラル）。</p>
<p>このため、
の予備実験からデータの入力を開始する前に、適切にフォーマットされた
をセットアップすることが非常に重要です。
データの整理は研究プロジェクトの です。 分析全体を通じて
の操作が容易になるか困難になる可能性があるため、データ入力を行う
や実験を設定するときに考慮する価値があります。
スプレッドシートではさまざまな方法で設定できますが、これらの
選択の一部によっては、
のプログラムでデータを操作する能力が制限されたり、6
か月後の自分や共同作業者が共同作業したりすることが制限される可能性があります。
データ。</p>
<p><strong>注:</strong> データ入力とデータ分析に最適なレイアウト/形式
(およびソフトウェアと ) は異なる場合があります。
これを考慮し、理想的にはあるものから のものへの変換を自動化することが
です。</p>
<div class="section level3">
<h3 id="分析を追跡する">分析を追跡する<a class="anchor" aria-label="anchor" href="#%E5%88%86%E6%9E%90%E3%82%92%E8%BF%BD%E8%B7%A1%E3%81%99%E3%82%8B"></a>
</h3>
<p>スプレッドシートを使用しているとき、データのクリーンアップ
分析を行っているときに、最初のスプレッドシートとは
異なる外観のスプレッドシートが完成することがよくあります。 分析を
したり、査読者や講師が別の分析を要求したときに何をしたかを把握したりするには、次のこと
行う必要があります。</p>
<ul>
<li><p>クリーンアップまたは分析されたデータを含む新しいファイルを作成します。
元のデータセット
変更しないでください。変更すると、どこから始めたのかわからなくなります。</p></li>
<li><p>クリーンアップまたは分析で実行した手順を記録します。
実験の他のステップと同様に、これらのステップを追跡する必要があり 。
データ ファイルと同じフォルダーに保存された テキスト
ファイルでこれを行うことをお勧め ます。</p></li>
</ul>
<p>これはスプレッドシート設定の例です。</p>
<figure><img src="fig/spreadsheet-setup-updated.png" class="figure mx-auto d-block"></figure><p>今日の演習中にこれらの原則を実践してください。</p>
<p>バージョン管理はこのコースの範囲外ですが、<strong>バージョンを維持
方法については、 <a href="https://swcarpentry.github.io/git-novice/" class="external-link">‘Git’</a> の
Carpentries レッスンを参照してください。データを制御</strong>します。
簡単なチュートリアルについてはこの ブログ 投稿
を、より研究指向のユースケースについては <span class="citation">@Perez-Riverol:2016</span> も参照してください。</p>
</div>
<div class="section level3">
<h3 id="スプレッドシートでのデータの構造化">スプレッドシートでのデータの構造化<a class="anchor" aria-label="anchor" href="#%E3%82%B9%E3%83%97%E3%83%AC%E3%83%83%E3%83%89%E3%82%B7%E3%83%BC%E3%83%88%E3%81%A7%E3%81%AE%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E6%A7%8B%E9%80%A0%E5%8C%96"></a>
</h3>
<p>データにスプレッドシート
プログラムを使用する際の基本ルールは次のとおりです。</p>
<ol style="list-style-type: decimal">
<li>すべての変数を列に入力します。測定対象は「重量」や「温度」
です。</li>
<li>各観測値を独自の行に配置します。</li>
<li>1 つのセルに複数の情報を組み合わせないでください。 場合によっては
それは単なる
つのことのように思えますが、それがそのデータを使用または並べ替えできるようにする唯一の方法であるかどうかを考えてください。</li>
<li>生データはそのままにしておきます。変更しないでください。</li>
<li>クリーンアップされたデータを CSV (カンマ区切り値)
形式などのテキストベースの形式にエクスポートします。 これにより、誰でも
を使用できるようになり、ほとんどのデータ
リポジトリで必要になります。</li>
</ol>
<p>たとえば、ベルギーのブリュッセルにあるいくつか
病院を訪れた患者からのデータがあります。 彼らは、訪問日、
、患者の性別、体重、血液型を記録しました。</p>
<p>次のようにデータを追跡するとします。</p>
<figure><img src="fig/multiple-info.png" class="figure mx-auto d-block"></figure><p>問題は、ABO グループと Rhesus グループが同じ「Blood」
タイプ列にあることです。 したがって、A
グループのすべての観測値を調べたり、ABO
グループごとの重み分布を調べたりしたい場合、このデータ設定を使用してこれを行うのは難しいでしょう
。 代わりに、ABO グループと Rhesus
グループを別の列に配置すると、はるかに簡単になることがわかります。</p>
<figure><img src="fig/single-info.png" class="figure mx-auto d-block"></figure><p>データシートを設定する際の重要なルールは、<strong>列は変数に
され</strong>、<strong>行は観測に使用される</strong>ということです。</p>
<ul>
<li>列は変数です</li>
<li>行は観測結果です</li>
<li>セルは個別の値です</li>
</ul>
<div id="課題-乱雑なデータセットを取り上げそれをクリーンアップする方法を説明します" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="課題-乱雑なデータセットを取り上げそれをクリーンアップする方法を説明します" class="callout-inner">
<h3 class="callout-title">課題: 乱雑なデータセットを取り上げ、それをクリーンアップする方法を説明します。<a class="anchor" aria-label="アンカー" href="#%E8%AA%B2%E9%A1%8C-%E4%B9%B1%E9%9B%91%E3%81%AA%E3%83%87%E3%83%BC%E3%82%BF%E3%82%BB%E3%83%83%E3%83%88%E3%82%92%E5%8F%96%E3%82%8A%E4%B8%8A%E3%81%92%E3%81%9D%E3%82%8C%E3%82%92%E3%82%AF%E3%83%AA%E3%83%BC%E3%83%B3%E3%82%A2%E3%83%83%E3%83%97%E3%81%99%E3%82%8B%E6%96%B9%E6%B3%95%E3%82%92%E8%AA%AC%E6%98%8E%E3%81%97%E3%81%BE%E3%81%99"></a>
</h3>
<div class="callout-content">
<ol style="list-style-type: decimal">
<li><p><a href="https://github.com/UCLouvain-CBIO/WSBIM1207/raw/master/data/messy_covid.xlsx" class="external-link">ここ</a>
をクリックして、乱雑なデータセットをダウンロードします。</p></li>
<li><p>スプレッドシート プログラムでデータを開きます。</p></li>
<li><p>タブが 2 つあることがわかります。 このデータには、2020
年の新型コロナウイルス感染症 (COVID-19) の第 波と第 2
波の間にブリュッセルのさまざまな病院で記録されたさまざま
臨床変数が含まれています。 ご覧のとおり、 データは 3 月と 11 月
の波では異なる方法で記録されています。
あなたはこのプロジェクトの責任者となり、
データの分析を開始できるようにしたいと考えています。</p></li>
<li><p>隣にいる人と一緒に、この
スプレッドシートのどこが間違っているのかを特定してください。
また、最初と 2 番目の Wave タブをクリーンアップし、それらをすべて
つのスプレッドシートにまとめるために必要な手順について
説明します。</p></li>
</ol>
<p><strong>重要:</strong>
最初のアドバイスを忘れないでください。クリーンアップされたデータ用に
ファイル (またはタブ) を作成する場合は、元の (生の)
データを決して変更しないでください。</p>
</div>
</div>
</div>
<p>この演習を終えた後、このデータの
が間違っていたのか、そしてそれをどのように修正するのかをグループで話し合います。</p>
<!-- - Take about 10 minutes to work on this exercise. -->
<!-- - All the mistakes in the *common mistakes* section below are present -->
<!--   in the messy dataset. If the exercise is done during a workshop, ask -->
<!--   people what they saw as wrong with the data. As they bring up -->
<!--   different points, you can refer to the common mistakes or expand a -->
<!--   bit on the point they brought up. -->
<!-- - If you get a response where they've fixed the date, you can pause -->
<!--   and go to the dates lesson. Or you can say you'll come back to dates -->
<!--   at the end. -->
<div id="課題-データを整理したら次の質問に答えてください" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="課題-データを整理したら次の質問に答えてください" class="callout-inner">
<h3 class="callout-title">課題: データを整理したら、次の質問に答えてください。<a class="anchor" aria-label="アンカー" href="#%E8%AA%B2%E9%A1%8C-%E3%83%87%E3%83%BC%E3%82%BF%E3%82%92%E6%95%B4%E7%90%86%E3%81%97%E3%81%9F%E3%82%89%E6%AC%A1%E3%81%AE%E8%B3%AA%E5%95%8F%E3%81%AB%E7%AD%94%E3%81%88%E3%81%A6%E3%81%8F%E3%81%A0%E3%81%95%E3%81%84"></a>
</h3>
<div class="callout-content">
<ul>
<li>何人の男性と女性が研究に参加しましたか?</li>
<li>A、AB、B タイプは何人検査されましたか?</li>
<li>上記と同様ですが、汚染されたサンプルは無視しますか?</li>
<li>アカゲザル + と - は何人検査されましたか?</li>
<li>何人のユニバーサルドナー (O-) が検査されましたか?</li>
<li>AB型男性の平均体重はどれくらい？</li>
<li>さまざまな病院で何件のサンプルが検査されましたか?</li>
</ul>
</div>
</div>
</div>
<p>特に R スクリプト に関する
<strong>優れた参考文献</strong>は、<em>Tidy Data</em> 論文 <span class="citation">@Wickham:2014</span> です。</p>
</div>
</section><section><h2 class="section-heading" id="よくあるスプレッドシートのエラー">よくあるスプレッドシートのエラー<a class="anchor" aria-label="アンカー" href="#%E3%82%88%E3%81%8F%E3%81%82%E3%82%8B%E3%82%B9%E3%83%97%E3%83%AC%E3%83%83%E3%83%89%E3%82%B7%E3%83%BC%E3%83%88%E3%81%AE%E3%82%A8%E3%83%A9%E3%83%BC"></a>
<a class="anchor" aria-label="anchor" href="#%E3%82%88%E3%81%8F%E3%81%82%E3%82%8B%E3%82%B9%E3%83%97%E3%83%AC%E3%83%83%E3%83%89%E3%82%B7%E3%83%BC%E3%83%88%E3%81%AE%E3%82%A8%E3%83%A9%E3%83%BC"></a>
</h2>
<hr class="half-width">
<p><strong>質問</strong></p>
<ul>
<li>スプレッドシート
のデータの書式設定に関する一般的な課題は何ですか?また、それらを回避するにはどうすればよいですか?</li>
</ul>
<p><strong>目的</strong></p>
<ul>
<li>一般的なスプレッドシートの書式設定の問題を認識して解決します。</li>
</ul>
<p><strong>キーポイント</strong></p>
<ul>
<li>1
つのスプレッドシート内で複数のテーブルを使用しないでください。</li>
<li>データが複数のタブに分散しないようにします。</li>
<li>ゼロはゼロとして記録します。</li>
<li>欠落データを記録するには、適切な null 値を使用します。</li>
<li>情報を伝えたり、スプレッドシートを美しく見せるために書式設定を使用しないでください。</li>
<li>コメントは別の列に配置します。</li>
<li>列ヘッダーに単位を記録します。</li>
<li>セルには 1 つの情報のみを含めます。</li>
<li>列ヘッダーにはスペース、数字、特殊文字を使用しないでください。</li>
<li>データ内では特殊文字を避けてください。</li>
<li>メタデータを別のプレーン テキスト ファイルに記録します。</li>
</ul>
<!-- This lesson is meant to be used as a reference for discussion as --><!-- learners identify issues with the messy dataset discussed in the --><!-- previous lesson. Instructors: don't go through this lesson except to --><!-- refer to responses to the exercise in the previous lesson. --><p>自分自身のデータ
でなく、共同作業者やインターネットからのデータにも、注意すべき潜在的なエラーがいくつかあります。
エラーや、下流 データ分析 結果の解釈に悪影響が及ぶ可能性があることを認識
ていれば、自分やプロジェクト
メンバーがエラーを回避しようとする動機になるかもしれません。
スプレッドシートでデータをフォーマットする方法に
変更を加えると、データのクリーニング と分析の効率と信頼性に大きな影響
を与える可能性があります。</p>
<ul>
<li><a href="#tables">複数のテーブルの使用</a></li>
<li><a href="#tabs">複数のタブの使用</a></li>
<li><a href="#zeros">ゼロを埋めない</a></li>
<li><a href="#null">問題のある null 値の使用</a></li>
<li><a href="#formatting">情報を伝えるために書式設定を使用する</a></li>
<li><a href="#formatting_pretty">書式設定を使用してデータシートを美しく見せる</a></li>
<li><a href="#units">セル内にコメントまたはユニットを配置する</a></li>
<li><a href="#info">セルに複数の情報を入力する</a></li>
<li><a href="#field_name">問題のあるフィールド名の使用</a></li>
<li><a href="#special">データ内での特殊文字の使用</a></li>
<li><a href="#metadata">データテーブルへのメタデータの組み込み</a></li>
</ul>
<div class="section level3">
<h3 id="tables">複数のテーブルの使用<a class="anchor" aria-label="anchor" href="#tables"></a>
</h3>
<p>一般的な戦略は、1 つ スプレッドシート内に複数のデータ
テーブルを作成することです。
これはコンピュータを混乱させるので、行わないでください。<br>
1
つのスプレッドシート内に複数のテーブルを作成すると、コンピュータにとっては、各行を観測
として認識するため、物事の間に た関連付けが描画されることになります。
また、同じフィールド名を
の場所で使用している可能性があり、データを使用可能な形式に
アップすることが困難になります。 以下の例は問題を示しています。</p>
<figure><img src="fig/2_datasheet_example.jpg" class="figure mx-auto d-block"></figure><p>上の例では、コンピュータは、(たとえば) 行 4 と 、すべての列 A ～ A F
が同じサンプルを参照しているとみなして表示します。 この行 、実際には 4
つの異なるサンプル (5 月 29 日、6 月 12 日、6 月 19 日、および 6 月 26
日の つの異なる収集日のそれぞれのサンプル 1)
と、計算されたいくつかの概要統計 (平均 (avr) およびこれら
のサンプルのうち 2 つの標準測定誤差 (SEM))。
他の行にも同様に問題があります。</p>
</div>
<div class="section level3">
<h3 id="tabs">複数のタブの使用<a class="anchor" aria-label="anchor" href="#tabs"></a>
</h3>
<p>しかし、ワークブックのタブはどうでしょうか?
データを整理する簡単な方法のように思えますよね? まあ、はい、いいえです。
追加のタブを作成すると、そこにあるデータの接続をコンピュータに認識させることができなく
ます (この接続を確保するには、 スプレッドシート
アプリケーション固有の関数を導入するか、
スクリプトを導入する必要があります)。 たとえば、測定を行う日ごとに
のタブを作成するとします。</p>
<p>これは次の 2 つの理由から良い習慣ではありません。</p>
<ol style="list-style-type: decimal">
<li><p>測定を行うたびに新しいタブでデータ の記録を開始すると、誤って
データに不一致が追加される可能性が高くなります。</p></li>
<li><p>たとえすべての不一致が忍び寄るのを防ぐことができたとしても、
これらのデータを単一 データテーブルに結合する必要があるため、
データを分析する前に余分な手順を追加することになります。 タブ
結合する方法をコンピュータに明示的に指示する必要があります。また、タブの形式が一貫していない場合は、
で結合する必要がある場合もあります。</p></li>
</ol>
<p>次回データを入力するときに、別のタブ
またはテーブルを作成するときは、元のスプレッドシートに別の列を
追加することで、このタブの追加を回避できるかどうか自問してください。
乱雑なデータ ファイルの では複数のタブを使用しましたが、データを
編成してタブ間で統合する方法がわかりました。</p>
<p>の過程でデータシートが非常に長くなる可能性があります。
これにより、スプレッドシートの上部に
ヘッダーが表示されない場合、データの入力が困難になります。
ただし、ヘッダー 行を繰り返さないでください。
これらは簡単にデータに混入し、 的に問題が発生する可能性があります。
代わりに、列 ヘッダーを固定する ことができます。これにより、多くの
行を含むスプレッドシートがある場合でも、それらの行が表示されたままになります。</p>
</div>
<div class="section level3">
<h3 id="zeros">ゼロを埋めない<a class="anchor" aria-label="anchor" href="#zeros"></a>
</h3>
<p>何かを測定するとき、調査でウサギが観察された回数は通常
である可能性があります。 その列にはほとんどゼロがあるのに、なぜわざわざ
という数字のゼロを書き込むのでしょうか?</p>
<p>ただし、 スプレッドシートのゼロと空白のセルには違いがあります。
コンピューターにとって、ゼロは実際にはデータです。 あなたが測ったか、
なかった。 空白のセルは、測定されていないことを意味し、 はそれを未知の値
(ヌル または欠損値とも呼ばれます) として解釈します。</p>
<p>スプレッドシートや統計プログラムでは、ゼロであるつもりの
の空白セルが誤って解釈される可能性があります。 観測値
入力しないことにより、そのデータ を不明または欠落 (null)
として表すようにコンピュータに指示することになります。
これにより、後続の の計算または分析で問題が発生する可能性があります。
たとえば、単一の null 値を含む一連の数値 の平均は常に null です (
は欠落している観測値を推測できないため)。 このうち
であるため、ゼロをゼロとして記録し、真に
欠損データをヌルとして記録することが非常に重要です。</p>
</div>
<div class="section level3">
<h3 id="問題のある-null-値-nullの使用">問題のある null 値 {#null}の使用<a class="anchor" aria-label="anchor" href="#%E5%95%8F%E9%A1%8C%E3%81%AE%E3%81%82%E3%82%8B-null-%E5%80%A4-null%E3%81%AE%E4%BD%BF%E7%94%A8"></a>
</h3>
<p><strong>例</strong>: -999 またはその他の数値 (またはゼロ) を
に使用すると、欠損データを表します。</p>
<p><strong>解決策</strong>:</p>
<p>データセット内で null 値が異なる で表現される理由はいくつかあります。
紛らわしいヌル値が測定装置から自動的に として記録される場合があります。
その場合、できることは ではありませんが、ツール を使用してデータ
クリーニングで対処できます 1 <a href="https://www.datacarpentry.org/OpenRefine-ecology-lesson/" class="external-link">OpenRefine</a>
前分析。 また、データが存在しないさまざまな理由を伝えるために、 な null
値が使用されることもあります。 これは取得すべき重要 情報ですが、実際には
1 つの列を使用して 2 つの情報を取得することになります。
フォーマットを使用して 情報を伝える
と同様に、ここでは「data_missing」のような新しい
列を作成し、その列を使用して
の異なる理由をキャプチャすると良いでしょう。</p>
<p>理由が何であれ、不明または欠落しているデータが として
-999、999、または 0 として記録されている場合は問題です。</p>
<p>多くの統計プログラムは、これらが欠損 (NULL) 値を表す
であることを認識しません。 これらの値
がどのように解釈されるかは、データの分析に使用するソフトウェアによって異なります。
明確に定義された一貫性のある null インジケーターを使用することが
です。</p>
<p>空白 (ほとんどのアプリケーション) と NA (R の場合) が
選択肢として適しています。 <span class="citation">@White:2013</span>
は、記事の中で、さまざまなソフトウェア アプリケーションに対して null 値
を示すための適切な選択肢について説明しています。</p>
<figure><img src="fig/3_white_table_1.jpg" class="figure mx-auto d-block"></figure>
</div>
<div class="section level3">
<h3 id="formatting">フォーマットを使用して情報を伝える<a class="anchor" aria-label="anchor" href="#formatting"></a>
</h3>
<p><strong>例</strong>: 分析から
必要があるセル、行、または列を強調表示し、空白の行を残してデータの
分離を示します。</p>
<figure><img src="fig/formatting.png" class="figure mx-auto d-block"></figure><p><strong>解決策</strong>: 新しいフィールドを作成して、
データをエンコードします。</p>
<figure><img src="fig/good_formatting.png" class="figure mx-auto d-block"></figure>
</div>
<div class="section level3">
<h3 id="書式設定を使用してデータシートを美しく見せる-formatting_pretty">書式設定を使用してデータシートを美しく見せる
{#formatting_pretty}<a class="anchor" aria-label="anchor" href="#%E6%9B%B8%E5%BC%8F%E8%A8%AD%E5%AE%9A%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%97%E3%81%A6%E3%83%87%E3%83%BC%E3%82%BF%E3%82%B7%E3%83%BC%E3%83%88%E3%82%92%E7%BE%8E%E3%81%97%E3%81%8F%E8%A6%8B%E3%81%9B%E3%82%8B-formatting_pretty"></a>
</h3>
<p><strong>例</strong>: セルを結合します。</p>
<p><strong>解決策</strong>: 注意しないと、ワークシートを
より美しく見えるように書式設定すると、データ内の
関連付けを認識するコンピュータの機能が損なわれる可能性があります。
セルを結合すると、統計ソフトウェアで を読み取ることができなくなります。
データを整理する
にセルを結合する必要がないような方法でデータを再構築することを検討してください。</p>
</div>
<div class="section level3">
<h3 id="セル-unitsにコメントまたはユニットを配置する">セル {#units}にコメントまたはユニットを配置する<a class="anchor" aria-label="anchor" href="#%E3%82%BB%E3%83%AB-units%E3%81%AB%E3%82%B3%E3%83%A1%E3%83%B3%E3%83%88%E3%81%BE%E3%81%9F%E3%81%AF%E3%83%A6%E3%83%8B%E3%83%83%E3%83%88%E3%82%92%E9%85%8D%E7%BD%AE%E3%81%99%E3%82%8B"></a>
</h3>
<p>ほとんどの分析ソフトウェアは Excel や LibreOffice
のコメントを表示できないため、 データ
セル内に配置されたコメントによって混乱する可能性があります。
書式設定について で説明したように、セルに
を追加する必要がある場合は、別のフィールドを作成します。
同様に、セルに単位を含めないでください。理想的には、1 つの列に配置する
の測定値が同じ
単位内にある必要がありますが、何らかの理由でそうでない場合は、別のフィールドを作成し、
セルの単位を指定します。で。</p>
</div>
<div class="section level3">
<h3 id="セル-infoに複数の情報を入力する">セル {#info}に複数の情報を入力する<a class="anchor" aria-label="anchor" href="#%E3%82%BB%E3%83%AB-info%E3%81%AB%E8%A4%87%E6%95%B0%E3%81%AE%E6%83%85%E5%A0%B1%E3%82%92%E5%85%A5%E5%8A%9B%E3%81%99%E3%82%8B"></a>
</h3>
<p><strong>例</strong>: A+、 B+、A- などの ABO グループとアカゲザル
グループを 1 つのセルに記録する</p>
<p><strong>解決策</strong>: セルに複数の情報を含めないでください。
これにより、データを分析できる方法が制限されます。<br>
の場合、これらの測定値の両方が必要な場合は、
この情報を含めるようにデータシートを設計します。 たとえば、ABO
グループには 1 つの列を含め、Rhesus グループには つの列を含めます。</p>
</div>
<div class="section level3">
<h3 id="問題のあるフィールド名-field_name-の使用">問題のあるフィールド名 {#field_name} の使用<a class="anchor" aria-label="anchor" href="#%E5%95%8F%E9%A1%8C%E3%81%AE%E3%81%82%E3%82%8B%E3%83%95%E3%82%A3%E3%83%BC%E3%83%AB%E3%83%89%E5%90%8D-field_name-%E3%81%AE%E4%BD%BF%E7%94%A8"></a>
</h3>
<p>説明的なフィールド名を選択しますが、スペース、
数字、またはいかなる種類の特殊文字も含めないように注意してください。
スペースは、空白を区切り文字として使用するパーサーによって
て解釈される可能性があり、一部の プログラムは
数字で始まるテキスト文字列であるフィールド名を好みません。</p>
<p>アンダースコア (<code>_</code>) はスペースの代わりに使用できます。
読みやすさを向上させるために、
名前をキャメルケースで記述することを検討してください (例:
ExampleFileName)。 現時点では意味のある略語 も、6
か月後にはそれほど明確ではなくなる可能性があることに注意してください。ただし、
が長すぎる名前を付けすぎないでください。 フィールド名に
を含めることで混乱が回避され、他の人がフィールドを簡単に解釈できるようになります。</p>
<p><strong>例</strong></p>
<table style="width:100%;" class="table">
<colgroup>
<col width="48%">
<col width="26%">
<col width="25%">
</colgroup>
<thead><tr>
<th>いい名前</th>
<th>良い代替品</th>
<th>避ける</th>
</tr></thead>
<tbody>
<tr>
<td>最高_温度_C</td>
<td>最大温度</td>
<td>最高温度 (°C)</td>
</tr>
<tr>
<td>降水量_mm</td>
<td>降水量</td>
<td>プレcmm</td>
</tr>
<tr>
<td>平均_年_成長</td>
<td>平均年成長</td>
<td>平均成長率/年</td>
</tr>
<tr>
<td>sex</td>
<td>セックス</td>
<td>男/女</td>
</tr>
<tr>
<td>weight</td>
<td>重さ</td>
<td>w。</td>
</tr>
<tr>
<td>セル_タイプ</td>
<td>セルタイプ</td>
<td>細胞の種類</td>
</tr>
<tr>
<td>観察_01</td>
<td>最初の_観察</td>
<td>1回目の観測</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="データ-specialでの特殊文字の使用">データ {#special}での特殊文字の使用<a class="anchor" aria-label="anchor" href="#%E3%83%87%E3%83%BC%E3%82%BF-special%E3%81%A7%E3%81%AE%E7%89%B9%E6%AE%8A%E6%96%87%E5%AD%97%E3%81%AE%E4%BD%BF%E7%94%A8"></a>
</h3>
<p><strong>例</strong>: たとえば、Word または
のアプリケーションからデータを直接コピーするなど、メモを書くときにスプレッドシート
プログラムをワード プロセッサ として扱います。</p>
<p><strong>解決策</strong>: これは一般的な戦略です。 たとえば、セルに
の長いテキストを書き込む場合、スプレッドシートに改行、全角ダッシュ、
などを含めることがよくあります。 また、Word など
アプリケーションからデータをコピーする場合、書式設定や派手な 標準文字
(左揃えと右揃えの引用符など) が含まれます。 このデータをコーディング/
環境またはリレーショナル
データベースにエクスポートすると、行が半分に切断されたり、エンコード
エラーが発生したりする 、危険なことが発生する可能性があります。</p>
<p>一般的なベスト プラクティスは、改行、
タブ、垂直タブなどの文字の追加を避けることです。 言い換えれば、テキスト
セルを、テキストとスペースのみを含めることができる単純な Web フォームで
かのように扱います。</p>
</div>
<div class="section level3">
<h3 id="データテーブル-metadataへのメタデータの組み込み">データテーブル {#metadata}へのメタデータの組み込み<a class="anchor" aria-label="anchor" href="#%E3%83%87%E3%83%BC%E3%82%BF%E3%83%86%E3%83%BC%E3%83%96%E3%83%AB-metadata%E3%81%B8%E3%81%AE%E3%83%A1%E3%82%BF%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E7%B5%84%E3%81%BF%E8%BE%BC%E3%81%BF"></a>
</h3>
<p><strong>例</strong>: データ テーブル
の上部または下部に、列の意味、単位、例外などを説明する凡例を追加します。</p>
<p><strong>解決策</strong>: データに関するデータ (「メタデータ」)
を記録することは ではありません。 データセットを
して分析している間は、データセットと親密な関係にあるかもしれませんが、変数「sglmemgp」がグループの単一のメンバー
(たとえば
を意味すること、または以前に使用した正確なアルゴリズムを意味することをまだ覚えている可能性は
ありません。変数 変換するか、派生変数を作成すると、数か月後、1
年後、またはそれ以上かかります。</p>
<p>また、他の人があなたのデータを調べたり、使用したりする理由はたくさんあります。あなたの発見を理解するため、
を検証するため、
提出された出版物をレビューするため、結果を再現するため、
同様の研究を計画するため、さらには他の人がアクセスしたり
利用できるようにデータをアーカイブします。 デジタルデータは定義上、
可読ではありませんが、その意味を理解することは の仕事です。
研究の収集段階および分析段階でデータを文書化することの重要性は、特に研究が
記録の一部となる場合には 過大評価することはできません 。</p>
<p>ただし、データファイル 自体にはメタデータを含めないでください。
論文や補足ファイルの表とは異なり、メタデータ ( 形式) はデータ
ファイルに含めるべきではありません。この情報はデータではなく、
データを含めるとコンピューター プログラムがデータ ファイルを解釈する
が混乱する可能性があるためです。 むしろ、メタデータは、データ
ファイルと同じディレクトリに別のファイルとして保存する必要があります。できればファイルと明確に関連付けられる名前を付けてプレーン
テキスト形式で保存する必要があります。 メタデータ ファイルはフリー
テキスト形式であるため、コメント、単位、
値のエンコード方法に関する情報などをエンコードすることも
ます。これらの情報は文書化するには重要ですが、データ ファイルの
設定を混乱させる可能性があります。</p>
<p>さらに、ファイルまたはデータベース
レベルのメタデータは、データセットを構成するファイルが相互に
ように関連するかを記述します。どのような形式であるか。
は、以前のファイルに優先されるか、または以前のファイルによって置き換えられるか。
フォルダー レベルの readme.txt ファイルは、プロジェクト内のすべて
ファイルとフォルダーを説明する古典的な方法です。</p>
<p>(メタデータに関するテキストは、EDINA および 大学データ
ライブラリによるオンライン コース Research Data <a href="https://datalib.edina.ac.uk/mantra" class="external-link">MANTRA</a>
から改変されました。 MANTRA は クリエイティブ コモンズ 表示 4.0 国際
ライセンス に基づいてライセンスされています。</p>
</div>
</section><section><h2 class="section-heading" id="データのエクスポート">データのエクスポート<a class="anchor" aria-label="アンカー" href="#%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E3%82%A8%E3%82%AF%E3%82%B9%E3%83%9D%E3%83%BC%E3%83%88"></a>
<a class="anchor" aria-label="anchor" href="#%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E3%82%A8%E3%82%AF%E3%82%B9%E3%83%9D%E3%83%BC%E3%83%88"></a>
</h2>
<hr class="half-width">
<p><strong>質問</strong></p>
<ul>
<li>ストリーム
アプリケーションに役立つ方法でスプレッドシートからデータをエクスポートするにはどうすればよいでしょうか?</li>
</ul>
<p><strong>目的</strong></p>
<ul>
<li>スプレッドシート データをユニバーサル
ファイル形式で保存します。</li>
<li>スプレッドシートから CSV ファイルにデータをエクスポートします。</li>
</ul>
<p><strong>キーポイント</strong></p>
<ul>
<li><p>一般的なスプレッドシート形式で保存されたデータは、データ分析ソフトウェアに
読み込まれないことが多く、 にエラーが生じます。</p></li>
<li><p>スプレッドシートから CSV や TSV
などの形式にデータをエクスポートすると、ほとんどのプログラムで一貫して使用できる形式でデータが
になります。</p></li>
</ul>
<p>分析に使用するデータを Excel 既定のファイル形式 (Excel
バージョンに応じて <code>*.xls</code> または <code>*.xlsx</code>)
で保存することはお勧めできません。 なぜ？</p>
<ul>
<li><p>これは独自の形式であり、 的にはファイルを開くことが不可能では
にしても不便になる技術が存在しなくなる (または十分にまれになる)
可能性があるためです。</p></li>
<li><p>他の表計算ソフトウェアでは、 の Excel
形式で保存されたファイルを開くことができない場合があります。</p></li>
<li><p>Excel のバージョンが異なるとデータの処理方法が異なる場合があり、
整合が発生する可能性があります。 <a href="https://datacarpentry.org/spreadsheet-ecology-lesson/03-dates-as-data/index.html" class="external-link">日付</a>
は、データ ストレージにおける不整合の十分に文書化された例です。</p></li>
<li><p>最後に、データをデータ リポジトリに
することを要求するジャーナルや補助金機関が増えています。また、そのほとんどは
Excel 形式を受け入れ ん。
で説明する形式のいずれかである必要があります。</p></li>
<li><p>上記の点は、LibreOffice / Open Office で使用されるオープン データ
形式などの他の形式にも当てはまります。 これらの形式は ではなく、
ソフトウェア パッケージによって同じ方法で解析されません。</p></li>
</ul>
<p>データを汎用的でオープンな静的形式で保存すると、この問題に
するのに役立ちます。 タブ区切り (タブ区切り値または TSV) または
カンマ区切り (カンマ区切り値または CSV) を試してください。 CSV
ファイルは、列がカンマで区切られたプレーン テキスト
ファイルです。したがって、「カンマ で区切られた値」または CSV
と呼ばれます。 Excel/SPSS/などと した CSV
ファイルの利点ファイルは、TextEdit や などのプレーン テキスト
エディタを含む、ほぼすべてのソフトウェア を使用して CSV
ファイルを開いて読み取ることができるということです。 CSV
ファイル内のデータは、SQLite や R などの他
形式や環境にも簡単にインポートできます。CSV
ファイルを使用する場合、特定の高価なプログラムの
のバージョンに縛られることがないので、最大限の移植性と
性を実現するために使用するフォーマット。 ほとんどのスプレッドシート
プログラムは
などの区切りテキスト形式で簡単に保存できますが、ファイルのエクスポート
に警告が表示される場合があります。</p>
<p>Excel で開いたファイルを CSV 形式で保存するには:</p>
<ol style="list-style-type: decimal">
<li>上部のメニューから「ファイル」と「名前を付けて保存」を選択します。</li>
<li>[形式] フィールドのリストから、[カンマ区切りの 値]
(<code>*.csv</code>) を選択します。</li>
<li>ファイル名と する場所を再確認し、「保存」をクリックします。</li>
</ol>
<p>下位互換性に関する重要な注意: ファイルは Excel
で開くことができます。</p>
<div class="codewrapper">
<h3 class="code-label">エラー<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in loadNamespace(x): there is no package called 'Knitr'</code></pre>
</div>
<p><strong>R と <code>xls</code> に関するメモ</strong>: <code>xls</code>
ファイル (および Google スプレッドシート) を読み取ることができる R
パッケージがあります。 「xls」ドキュメント内の
ワークシートにアクセスすることも可能です。</p>
<p><strong>しかし</strong></p>
<ul>
<li>これらの中には Windows でのみ動作するものもあります。</li>
<li>これは、データ分析 R コードの追加の複雑さ/依存性を
して、(単純だが手動の) <code>csv</code>
へのエクスポートを置き換えることに相当します。</li>
<li>データ形式のベスト プラクティスは引き続き適用されます。</li>
<li>
<code>csv</code> (または類似のもの) が
では不十分である正当な理由は本当にあるのでしょうか?</li>
</ul>
<div class="section level3">
<h3 id="カンマに関する注意事項">カンマに関する注意事項<a class="anchor" aria-label="anchor" href="#%E3%82%AB%E3%83%B3%E3%83%9E%E3%81%AB%E9%96%A2%E3%81%99%E3%82%8B%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A0%85"></a>
</h3>
<p>一部のデータセットでは、データ値自体にカンマ (,)
が含まれる場合があります。 その場合、使用しているソフトウェア (Excel
を含む) により、列内のデータが誤って表示される可能性が ます。
これは、データ値の一部であるカンマの が
区切り文字として解釈されるためです。</p>
<p>たとえば、データは次のようになります。</p>
<pre><code>種 ID、属、種、分類群
AB、Amphispiza、bilineata、鳥類
AH、Ammospermophilus、harrisi、げっ歯類、国勢調査されていない
AS、Ammodramus、savannarum、鳥類
BA、Baiomys、taylori、げっ歯類</code></pre>
<p>レコード「AH,Ammospermophilus,harrisi,Rodent, not
censused」では、「taxa」の値 コンマが含まれています (「Rodent, not
censused」)。 上記を Excel (または他のスプレッドシート プログラム)
に読み込むために を試みると、 のような結果が得られます。</p>
<div class="codewrapper">
<h3 class="code-label">エラー<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in loadNamespace(x): there is no package called 'Knitr'</code></pre>
</div>
<p><code>taxa</code> の値は (1 つの列 <code>D</code> に
を入れる代わりに) 2 つの列に分割されました。 これはさらに多数の
エラーに伝播する可能性があります。
たとえば、追加の列は、欠損値が多数ある (適切なヘッダーがない) 列
として解釈されます。 に加えて、行 3 のレコードの列 <code>D</code> の値
(つまり、‘taxa’ の値にカンマが含まれている の値)
も正しくなくなりました。</p>
<p>データを「csv」形式で保存し、
データ値にカンマが含まれる可能性があることが予想される場合は、値を引用符
(““) で囲むことで、上記 で説明した問題を回避できます。
このルールを適用すると、 データは次のようになります。</p>
<pre><code>種 ID、属、種、分類群
"AB"、"Amphispiza"、"bilineata"、"Bird"
"AH"、"Ammospermophilus"、"harrisi"、"げっ歯類、国勢調査されていない"
"AS"、"Ammodramus" 、"サバンナルム"、"鳥"
"BA"、"バイオミス"、"テイロリ"、"げっ歯類"</code></pre>
<p>Excel では
引用符の外側にあるカンマのみが区切り文字として使用されるため、このファイルを
Excel で「csv」として開いても、余分な 列は生成されません。</p>
<p>あるいは、カンマを含むデータを操作している場合、
シートで作業するときに別の区切り文字を使用する必要がある可能
があります<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>。
この場合、区切り文字としてタブを使用し、TSV ファイルを扱う場合は
使用することを検討してください。 TSV ファイルは、CSV
ファイルと同じ方法でスプレッドシート
プログラムからエクスポートできます。</p>
<p>データ の値が “” に含まれていないものの、区切り文字
とデータ値の一部としてカンマが含まれている既存のデータセットを操作している場合は、データ
クリーニングに関する重大な問題 に直面する可能性があります。
扱っているデータセットに
百または数千のレコードが含まれている場合、それらを手動でクリーンアップする
( データ値からカンマを削除するか、値を 引用符 (““) で囲む)
と、何時間もかかるだけではありません。ただし、誤って
のエラーが発生する可能性があります。</p>
<p>データセットのクリーンアップは、多くの 分野における主要な問題の 1
つです。 このアプローチは、ほとんどの場合、特定
コンテキストに依存します。 ただし、スクリプトを作成して実行するなど、
化された方法でデータをクリーンアップすることをお勧めします。 Python と R
のレッスンは、
するスクリプトを構築するためのスキルを開発するための基礎を提供します。</p>
</div>
</section><section><h2 class="section-heading" id="まとめ">まとめ<a class="anchor" aria-label="アンカー" href="#%E3%81%BE%E3%81%A8%E3%82%81"></a>
<a class="anchor" aria-label="anchor" href="#%E3%81%BE%E3%81%A8%E3%82%81"></a>
</h2>
<hr class="half-width">
<figure style="text-align: center"><img src="fig/analysis.png" alt="A typical data analysis workflow." class="figure mx-auto d-block"><figcaption>
A typical data analysis workflow.
</figcaption></figure><p>典型的なデータ分析ワークフローは、上の図
に示されており、データは繰り返し変換、視覚化、モデル化されます。 この
の繰り返しは、データが理解されるまで複数回繰り返されます。 ただし、
の実際のケースでは、実際にデータを分析して理解すること
ではなく、データのクリーンアップと準備
にほとんどの時間が費やされます。</p>
<p>変換/視覚化/モデルのサイクルを高速で
回繰り返すアジャイルなデータ分析ワークフローは、データが予測可能な方法で
されており、データを調べたり
したりすることなく推論できる場合にのみ実現可能です。それ。</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">まとめ<a class="anchor" aria-label="アンカー" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>適切なデータ構成は、あらゆる研究プロジェクトの基礎です。</li>
</ul>
</div>
</div>
</div>
</section><div class="footnotes footnotes-end-of-document">
<hr>
<ol>
<li id="fn1"><p>これは、カンマが小数点の として使用されるヨーロッパの
諸国に特に関係します。 このような場合、 csv
ファイルのデフォルト値の区切り文字はセミコロン (;)
になるか、値は体系的に引用符で囲まれた になります。<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
</ol>
</div></section><section id="aio-20-r-rstudio"><p>Content from <a href="20-r-rstudio.html">RとRStudio</a></p>
<hr>
<p>最終更新日：2024-09-08 |

        <a href="https://github.com/carpentries-incubator/bioc-intro/edit/main/episodes/20-r-rstudio.Rmd" class="external-link">ページの編集 <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="回答を全て表示する " data-collapse="回答を全て折りたたむ "> 回答を全て表示する <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">概要</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">質問</h3>
<ul>
<li>RとRStudioとは何ですか？</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">目的</h3>
<ul>
<li>RStudio
スクリプト、コンソール、環境、およびプロットペインの目的について説明します。</li>
<li>Rプロジェクトとして一連の分析のためのファイルとディレクトリを整理し、作業ディレクトリの目的を理解する。</li>
<li>RStudio 組み込みのヘルプインターフェイスを使用して、R
関数の詳細情報を検索します。</li>
<li>Rのユーザーコミュニティとトラブルシューティングのために十分な情報を提供する方法を示す。</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<blockquote>
<p>このエピソードは、Data Carpentriesの_Data Analysis and Visualisation
in R for Ecologists_レッスンに基づいています。</p>
</blockquote>
<section><h2 class="section-heading" id="rとは-rstudioとは何ですか">Rとは？ RStudioとは何ですか?<a class="anchor" aria-label="アンカー" href="#r%E3%81%A8%E3%81%AF-rstudio%E3%81%A8%E3%81%AF%E4%BD%95%E3%81%A7%E3%81%99%E3%81%8B"></a>
<a class="anchor" aria-label="anchor" href="#r%E3%81%A8%E3%81%AF-rstudio%E3%81%A8%E3%81%AF%E4%BD%95%E3%81%A7%E3%81%99%E3%81%8B"></a>
</h2>
<hr class="half-width">
<p>R](<a href="https://www.r-project.org/)%E3%81%A8%E3%81%84%E3%81%86%E7%94%A8%E8%AA%9E%E3%81%AF" class="external-link uri">https://www.r-project.org/)という用語は</a>、
<em>プログラミング言語</em>、統計計算_のための_環境
、それを使って書かれたスクリプトを解釈する_ソフトウェア_を指すのに使われる。</p>
<p><a href="https://rstudio.com" class="external-link">RStudio</a>は現在、Rスクリプトを書くだけでなく、R
ソフトウェア<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>と対話するための非常に人気のある方法です。
RStudio を正しく機能させるには、R と が必要です。</p>
<p>RStudio IDE Cheat Sheet](<a href="https://raw.githubusercontent.com/rstudio/cheatsheets/main/rstudio-ide.pdf" class="external-link uri">https://raw.githubusercontent.com/rstudio/cheatsheets/main/rstudio-ide.pdf</a>)
、ここで説明するよりもはるかに多くの情報を提供していますが、キーボードショートカットを学んだり、新しい機能を発見したりするのに便利です。</p>
</section><section><h2 class="section-heading" id="なぜrを学ぶのか">なぜRを学ぶのか？<a class="anchor" aria-label="アンカー" href="#%E3%81%AA%E3%81%9Cr%E3%82%92%E5%AD%A6%E3%81%B6%E3%81%AE%E3%81%8B"></a>
<a class="anchor" aria-label="anchor" href="#%E3%81%AA%E3%81%9Cr%E3%82%92%E5%AD%A6%E3%81%B6%E3%81%AE%E3%81%8B"></a>
</h2>
<hr class="half-width">
<div class="section level3">
<h3 id="rはポインティングやクリックを多用しない">Rはポインティングやクリックを多用しない。<a class="anchor" aria-label="anchor" href="#r%E3%81%AF%E3%83%9D%E3%82%A4%E3%83%B3%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0%E3%82%84%E3%82%AF%E3%83%AA%E3%83%83%E3%82%AF%E3%82%92%E5%A4%9A%E7%94%A8%E3%81%97%E3%81%AA%E3%81%84"></a>
</h3>
<p>学習曲線は他のソフトウェアよりも急かもしれないが、
Rを使えば、分析結果は
のポインティングとクリックの連続を覚えることに依存するのではなく、代わりに
の一連のコマンドを書くことに依存する！
そのため、より多くのデータを収集したため、 分析をやり直したい場合、
結果を得るためにどのボタンをどの順番でクリックしたかを覚えておく必要はない。スクリプトを再度実行するだけでよい。</p>
<p>スクリプトを使用することで、分析で使用したステップが明確になり、
、書いたコードを他の誰かが検査することができ、
フィードバックを与え、間違いを発見することができる。</p>
<p>スクリプトを使って仕事をすることで、自分がやっている
の内容をより深く理解することになり、自分が使っている
メソッドの学習と理解が容易になる。</p>
</div>
<div class="section level3">
<h3 id="rコードは再現性に優れている">Rコードは再現性に優れている<a class="anchor" aria-label="anchor" href="#r%E3%82%B3%E3%83%BC%E3%83%89%E3%81%AF%E5%86%8D%E7%8F%BE%E6%80%A7%E3%81%AB%E5%84%AA%E3%82%8C%E3%81%A6%E3%81%84%E3%82%8B"></a>
</h3>
<p>再現性とは、同じデータセットから同じ解析コード（
）を使ったときに、他の誰か（未来の自分を含む）が
、同じ結果を得られることを意味する。</p>
<p>Rは他のツールと統合し、
のコードから原稿やレポートを作成することができる。
さらにデータを集めたり、データセットの誤りを修正したりすると、原稿や報告書の
図や統計検定が自動的に更新されます。 。</p>
<p>ジャーナルや研究助成機関では、
、再現性のある分析を求めるところが増えている。Rを知っていれば、このような
。</p>
</div>
<div class="section level3">
<h3 id="rは学際的で拡張性がある">Rは学際的で拡張性がある<a class="anchor" aria-label="anchor" href="#r%E3%81%AF%E5%AD%A6%E9%9A%9B%E7%9A%84%E3%81%A7%E6%8B%A1%E5%BC%B5%E6%80%A7%E3%81%8C%E3%81%82%E3%82%8B"></a>
</h3>
<p>機能を拡張するためにインストールできる10000以上のパッケージ<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a>により、Rは、
多くの科学分野からの統計的アプローチを組み合わせることができるフレームワークを提供し、
データの分析に必要な分析フレームワークに最適です。 例えば、
Rには画像分析、GIS、時系列、集団
遺伝学、その他多くのパッケージがある。</p>
<figure style="text-align: center"><img src="fig/cran.png" alt="Exponential increase of the number of packages available on [CRAN](https://cran.r-project.org/), the Comprehensive R Archive Network. From the R Journal, Volume 10/2, December 2018." class="figure mx-auto d-block"><figcaption>
Exponential increase of the number of packages available on <a href="https://cran.r-project.org/" class="external-link">CRAN</a>, the Comprehensive R Archive
Network. From the R Journal, Volume 10/2, December 2018.
</figcaption></figure>
</div>
<div class="section level3">
<h3 id="rはあらゆる形や大きさのデータを扱う">Rはあらゆる形や大きさのデータを扱う<a class="anchor" aria-label="anchor" href="#r%E3%81%AF%E3%81%82%E3%82%89%E3%82%86%E3%82%8B%E5%BD%A2%E3%82%84%E5%A4%A7%E3%81%8D%E3%81%95%E3%81%AE%E3%83%87%E3%83%BC%E3%82%BF%E3%82%92%E6%89%B1%E3%81%86"></a>
</h3>
<p>Rで学ぶスキルは、
データセットの大きさに合わせて簡単にスケールアップできる。
データセットの行数が数百行であろうと数百万行であろうと、
、大差はないだろう。</p>
<p>Rはデータ分析用に設計されている。 欠損データや統計的
因子の取り扱いを便利にする特別なデータ構造
とデータ型が付属している。</p>
<p>Rは、スプレッドシート、データベース、その他多くのデータ形式、
、コンピュータ上またはウェブ上に接続することができます。</p>
</div>
<div class="section level3">
<h3 id="rは高品質のグラフィックを作成する">Rは高品質のグラフィックを作成する<a class="anchor" aria-label="anchor" href="#r%E3%81%AF%E9%AB%98%E5%93%81%E8%B3%AA%E3%81%AE%E3%82%B0%E3%83%A9%E3%83%95%E3%82%A3%E3%83%83%E3%82%AF%E3%82%92%E4%BD%9C%E6%88%90%E3%81%99%E3%82%8B"></a>
</h3>
<p>Rのプロット機能は充実しており、
データからのメッセージを最も効果的に伝えるために、グラフのあらゆる面を調整することができる。</p>
</div>
<div class="section level3">
<h3 id="rは大きく歓迎されるコミュニティ">Rは大きく歓迎されるコミュニティ<a class="anchor" aria-label="anchor" href="#r%E3%81%AF%E5%A4%A7%E3%81%8D%E3%81%8F%E6%AD%93%E8%BF%8E%E3%81%95%E3%82%8C%E3%82%8B%E3%82%B3%E3%83%9F%E3%83%A5%E3%83%8B%E3%83%86%E3%82%A3"></a>
</h3>
<p>何千人もの人々が毎日Rを利用している。
彼らの多くは、メーリングリストやStack
Overflowのようなウェブサイト、またはRStudio communityを通じて、 。
こうした広範なユーザー・コミュニティは、
、バイオインフォマティクスのような専門分野にも広がっている。
Rコミュニティのそのようなサブセットの1つが、<a href="https://bioconductor.org/" class="external-link">Bioconductor</a>である。“現在および将来の生物学的アッセイからのデータの”分析と理解のための科学的プロジェクトである。
このワークショップは、Bioconductor
コミュニティのメンバーによって開発されました。Bioconductor
についての詳細は、関連ワークショップ <a href="https://carpentries-incubator.github.io/bioc-project/" class="external-link">“The
Bioconductor Project”</a> をご覧ください。</p>
</div>
<div class="section level3">
<h3 id="rは無料であるだけでなくオープンソースでクロスプラットフォームである">Rは無料であるだけでなく、オープンソースでクロスプラットフォームである。<a class="anchor" aria-label="anchor" href="#r%E3%81%AF%E7%84%A1%E6%96%99%E3%81%A7%E3%81%82%E3%82%8B%E3%81%A0%E3%81%91%E3%81%A7%E3%81%AA%E3%81%8F%E3%82%AA%E3%83%BC%E3%83%97%E3%83%B3%E3%82%BD%E3%83%BC%E3%82%B9%E3%81%A7%E3%82%AF%E3%83%AD%E3%82%B9%E3%83%97%E3%83%A9%E3%83%83%E3%83%88%E3%83%95%E3%82%A9%E3%83%BC%E3%83%A0%E3%81%A7%E3%81%82%E3%82%8B"></a>
</h3>
<p>Rがどのように動作するかは、誰でもソースコードを調べることができる。
この の透明性により、ミスが発生する可能性は低くなり、もしあなた（または
他の誰か）がミスを発見したら、バグを報告して修正することができる。</p>
</div>
</section><section><h2 class="section-heading" id="rstudioを使いこなす">RStudioを使いこなす<a class="anchor" aria-label="アンカー" href="#rstudio%E3%82%92%E4%BD%BF%E3%81%84%E3%81%93%E3%81%AA%E3%81%99"></a>
<a class="anchor" aria-label="anchor" href="#rstudio%E3%82%92%E4%BD%BF%E3%81%84%E3%81%93%E3%81%AA%E3%81%99"></a>
</h2>
<hr class="half-width">
<p>まずは<a href="https://www.rstudio.com/" class="external-link">RStudio</a>について学んでみよう。 は R
を扱うための統合開発環境(IDE)だ。</p>
<p>RStudio IDE オープンソース製品は、Affero General Public License
(AGPL) v3の下でフリーです。 RStudio IDE は、Posit,
Inc.の商用ライセンスおよび
優先メールサポートでもご利用いただけます。</p>
<p>RStudio IDE を使ってコードを書き、
コンピュータ上のファイルを操作し、これから作成する変数を検査し、
生成するプロットを視覚化する。 RStudioは他にも
（例：バージョン管理、パッケージの開発、Shynyアプリの作成）にも使えます。
ワークショップでは取り上げません。</p>
<figure style="text-align: center"><img src="fig/rstudio-screenshot.png" alt="RStudio interface screenshot. Clockwise from top left: Source, Environment/History, Files/Plots/Packages/Help/Viewer, Console." width="100%" class="figure mx-auto d-block"><figcaption>
RStudio interface screenshot. Clockwise from top left: Source,
Environment/History, Files/Plots/Packages/Help/Viewer, Console.
</figcaption></figure><p>RStudio ウィンドウは 4 つの「ペイン」に分かれています：</p>
<ul>
<li>スクリプトとドキュメントの <strong>ソース</strong> (
のデフォルトレイアウトでは左上)</li>
<li>あなたの<strong>環境/歴史</strong>（右上）、</li>
<li>あなたの<strong>Files/Plots/Packages/Help/Viewer</strong>（右下）、そして</li>
<li>R <strong>コンソール</strong>（左下）。</li>
</ul>
<p>これらのペインの配置とその内容はカスタマイズすることができます（
メニューの <code>Tools -&gt; Global Options -&gt; Pane Layout</code>
を参照してください）。</p>
<p>RStudioを使う利点の1つは、コードを書くために必要なすべての情報（
）が1つのウィンドウで利用できることです。 さらに、
多くのショートカット、<strong>オートコンプリート</strong>、およびRでの開発中に使用する主な
ファイルタイプの<strong>ハイライト</strong>により、RStudioは
の入力を容易にし、エラーを少なくします。</p>
</section><section><h2 class="section-heading" id="セットアップ">セットアップ<a class="anchor" aria-label="アンカー" href="#%E3%82%BB%E3%83%83%E3%83%88%E3%82%A2%E3%83%83%E3%83%97"></a>
<a class="anchor" aria-label="anchor" href="#%E3%82%BB%E3%83%83%E3%83%88%E3%82%A2%E3%83%83%E3%83%97"></a>
</h2>
<hr class="half-width">
<p>関連するデータ、分析、テキスト（ ）のセットは、<strong>working
directory</strong>と呼ばれる1つのフォルダに自己完結させておくのがよい習慣である。
このフォルダー内のすべてのスクリプトは、 <strong>相対パス</strong>
を使用して、
ファイルがプロジェクト内のどこにあるかを示すことができます（
ファイルが特定のコンピューター上のどこにあるかを示す絶対パスとは異なります）。
この方法で作業することで、
、自分のコンピュータ上でプロジェクトを移動したり、
他の人と共有したりすることが、基盤となるスクリプト
がまだ動くかどうかを心配することなく、とても簡単になる。</p>
<p>RStudioは、“Projects”
インターフェイスを通じて、このような作業を行うための便利なツールセットを提供しています。このツールは、作業ディレクトリを作成するだけでなく、
その場所を記憶し（すぐに移動できるようになります）、
カスタム設定や開いているファイルを保存して、
休憩後に作業を再開しやすくすることもできます。 この
チュートリアルのための “Rプロジェクト”の作成手順を以下に示す。</p>
<ol style="list-style-type: decimal">
<li>RStudioを起動します。</li>
<li>File<code>メニューの下にある</code>New
project<code>をクリックする。 新規ディレクトリ</code>を選択し、
<code>新規プロジェクト</code>を選択する。</li>
<li>この新しいフォルダ（または「ディレクトリ」）の名前を入力し、
便利な場所を選択します。 これはこのセッション (またはコース全体) の
<strong>作業ディレクトリ</strong> になります (例
<code>bioc-intro</code>)。</li>
<li>Create project`をクリックする。</li>
<li>(オプション）RStudio でワークスペースを保存しない設定にします。</li>
</ol>
<p>RStudioのデフォルトの環境設定は一般的にうまく機能しますが、ワークスペースを
.RDataに保存するのは、特に大きなデータセットを扱う場合は面倒です。
これをオフにするには、「ツール」→「グローバル・オプション」で、終了時に「ワークスペースを.RDataに保存する」
「決してしない」オプションを選択します。</p>
<figure style="text-align: center"><img src="fig/rstudio-preferences.png" alt="Set 'Save workspace to .RData on exit' to 'Never'" width="70%" class="figure mx-auto d-block"><figcaption>
Set ‘Save workspace to .RData on exit’ to ‘Never’
</figcaption></figure><p>ウィンドウズと他のオペレーティング・システム間の文字エンコーディングの問題](<a href="https://yihui.name/en/2018/11/biggest-regret-knitr/)%E3%82%92%E9%81%BF%E3%81%91%E3%82%8B%E3%81%9F%E3%82%81" class="external-link uri">https://yihui.name/en/2018/11/biggest-regret-knitr/)を避けるため</a>、
、デフォルトでUTF-8を設定します：</p>
<figure style="text-align: center"><img src="fig/utf8.png" alt="Set the default text encoding to UTF-8 to save us headache in the coming future. (Figure from the link above)." width="70%" class="figure mx-auto d-block"><figcaption>
Set the default text encoding to UTF-8 to save us headache in the coming
future. (Figure from the link above).
</figcaption></figure><div class="section level3">
<h3 id="作業ディレクトリの整理">作業ディレクトリの整理<a class="anchor" aria-label="anchor" href="#%E4%BD%9C%E6%A5%AD%E3%83%87%E3%82%A3%E3%83%AC%E3%82%AF%E3%83%88%E3%83%AA%E3%81%AE%E6%95%B4%E7%90%86"></a>
</h3>
<p>プロジェクト全体で一貫性のあるフォルダ構造を使うことで、
、整理整頓がしやすくなり、将来的に探し出したりファイルしたりするのも簡単になります。
この 、複数のプロジェクトを抱えているときには特に役立つ。 一般的に、
、*<strong>スクリプト</strong>、*<strong>データ</strong>、*<strong>ドキュメント</strong>用のディレクトリ（フォルダ）を作成することができます。</p>
<ul>
<li>
<strong>data/</strong>*
このフォルダは、生データと、特定の分析に必要な中間データセット（
）を保存するために使用します。 透明性と <a href="https://en.wikipedia.org/wiki/Provenance" class="external-link">出所</a>のために、
<em>常に</em> 生データのコピーにアクセスできるようにしておき、
データのクリーンアップと前処理をできるだけプログラム的に（つまり、手作業ではなく
スクリプトで）行うべきである。 生データ
、加工データから切り離すのも良いアイデアだ。 例えば、
<code>data/raw/tree_survey.plot1.txt</code>と<code>...plot2.txt</code>のファイルを、
<code>scripts/01.preprocess.tree_survey.R</code>スクリプトによって生成された<code>data/processed/tree.survey.csv</code>ファイルとは別に
。</li>
<li>
<strong><code>documents/</code></strong>
ここは、アウトライン、下書き、
、その他のテキストを保管する場所になります。</li>
<li>**scripts/<code>** (または</code>src`)
この場所には、さまざまな分析やプロット用の R スクリプトを保存し、
関数用の別フォルダを作成することもできます（詳しくは後述します）。</li>
</ul>
<p>あなたのプロジェクトの必要性に応じて、追加のディレクトリやサブディレクトリが必要になるかもしれないが、これらはあなたの作業用
ディレクトリのバックボーンを形成するはずである。</p>
<figure style="text-align: center"><img src="fig/working-directory-structure.png" alt="Example of a working directory structure." width="100%" class="figure mx-auto d-block"><figcaption>
Example of a working directory structure.
</figcaption></figure><p>このコースでは、生データを保存するために <code>data/</code>
フォルダが必要です。 、データを CSV
ファイルとしてエクスポートする方法を学ぶために <code>data_output/</code>
フォルダを使用し、図を保存するために <code>fig_output/</code>
フォルダを使用します。</p>
<div id="課題プロジェクトのディレクトリ構造を作る" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="課題プロジェクトのディレクトリ構造を作る" class="callout-inner">
<h3 class="callout-title">課題：プロジェクトのディレクトリ構造を作る<a class="anchor" aria-label="アンカー" href="#%E8%AA%B2%E9%A1%8C%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%AE%E3%83%87%E3%82%A3%E3%83%AC%E3%82%AF%E3%83%88%E3%83%AA%E6%A7%8B%E9%80%A0%E3%82%92%E4%BD%9C%E3%82%8B"></a>
</h3>
<div class="callout-content">
<p>画面右側の<code>Files</code>タブで、<code>New Folder</code>をクリックし、
、新しく作成した作業ディレクトリー
（例：<code>~/bioc-intro/data</code>）の中に<code>data</code>という名前のフォルダーを作成します。
(あるいは、Rのコンソール で <code>dir.create("data")</code>
とタイプする)。 これらの操作を繰り返して、<code>data_output/</code> と
<code>fig_output</code> フォルダーを作成する。</p>
</div>
</div>
</div>
<p>スクリプトは作業ディレクトリのルート
に置くことにする。使用するのは1つのファイルだけだし、
事が簡単になるからだ。</p>
<p>作業ディレクトリはこのようになっているはずだ：</p>
<figure style="text-align: center"><img src="fig/r-starting-how-it-should-look-like.png" alt="How it should look like at the beginning of this lesson" width="100%" class="figure mx-auto d-block"><figcaption>
How it should look like at the beginning of this lesson
</figcaption></figure><p><strong>プロジェクト管理</strong>は、バイオインフォマティクス・プロジェクトにも適用できる。
<a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a>。
William Noble (<span class="citation">@Noble:2009</span>)は、
以下のディレクトリ構造を提案している：</p>
<blockquote>
<p>ディレクトリ名は大きな書体で、ファイル名は小さな 。
ここに掲載したのは、その一部である。 なお、
の日付は、<year>-<month>-<day><code>というフォーマットになっているので、 時系列順に並べ替えることができる。 ソースコード</code>src/ms-analysis.c<code>がコンパイルされて</code>bin/ms-analysis<code>が作成され、</code>doc/ms-analysis.html<code>に文書化されている。 データ・ディレクトリ にある</code>README<code>ファイルには、誰がどの URL から の日付にデータ・ファイルをダウンロードしたかが明記されている。 ドライバスクリプト</code>results/2009-01-15/runall<code>は自動的に 3つのサブディレクトリ split1、split2、split3 を生成する。 は3つのクロスバリデーション分割に対応する。</code>bin/parse-sqt.py<code>スクリプトは</code>runall`
ドライバ スクリプトの両方から呼び出される。</day></month></year></p>
</blockquote>
<figure style="text-align: center"><img src="fig/noble-bioinfo-project.png" alt="Directory structure for a sample bioinformatics project." width="100%" class="figure mx-auto d-block"><figcaption>
Directory structure for a sample bioinformatics project.
</figcaption></figure><p>よく定義され、よく文書化された
プロジェクトのディレクトリの最も重要な側面は、 プロジェクト<a href="#fn4" class="footnote-ref" id="fnref4"><sup>4</sup></a>をよく知らない人が、次のことをできるようにすることである。</p>
<ol style="list-style-type: decimal">
<li><p>どのようなプロジェクトなのか、どのようなデータが入手可能なのか、どのような
分析が行われ、どのような結果が出たのかを理解すること、そして最も重要なことは、
を理解することである。</p></li>
<li><p>新しいデータで、あるいは
分析パラメーターの一部を変更して、分析を繰り返す。</p></li>
</ol>
</div>
<div class="section level3">
<h3 id="作業ディレクトリ">作業ディレクトリ<a class="anchor" aria-label="anchor" href="#%E4%BD%9C%E6%A5%AD%E3%83%87%E3%82%A3%E3%83%AC%E3%82%AF%E3%83%88%E3%83%AA"></a>
</h3>
<p>作業ディレクトリは理解すべき重要な概念である。
Rがファイルを探して保存する 。
プロジェクトのコードを書くときは、作業ディレクトリのルート
に関連するファイルを参照し、この 構造内のファイルだけが必要です。</p>
<p>RStudioプロジェクトを使用すると、この作業が簡単になり、
ディレクトリが適切に設定されます。 もし確認する必要があれば、
<code>getwd()</code> を使うことができる。
何らかの理由で作業ディレクトリが のようになっていない場合は、RStudio
のインターフェイスで
ファイルブラウザーで作業ディレクトリがあるべき場所に移動し、
青い歯車のアイコン <code>More</code>
をクリックし、<code>Set As Working Directory</code>
を選択して変更することができます。
あるいは、<code>setwd("/path/to/working/directory")</code>を使って、
作業ディレクトリをリセットすることもできる。
しかし、あなたのスクリプトには、
、この行を含めるべきではありません。なぜなら、他の誰かのコンピューターで失敗してしまうからです。</p>
<p>**例</p>
<p>以下のスキーマは作業ディレクトリ <code>bioc-intro</code> と
<code>data</code> と <code>fig_output</code>
のサブディレクトリ、そして後者にある2つのファイルを表しています：</p>
<pre><code>bioc-intro/data/
          /fig_output/fig1.pdf
          /fig_output/fig2.png</code></pre>
<p>もし作業ディレクトリにいれば、相対パス
<code>bioc-intro/fig_output/fig1.pdf</code> か、 絶対パス
<code>/home/user/bioc-intro/fig_output/fig1.pdf</code> を使って
<code>fig1.pdf</code> ファイルを参照することができます。</p>
<p>もし <code>data</code> ディレクトリにいたとしたら、相対パス
<code>../fig_output/fig1.pdf</code> か、同じ絶対パス
<code>/home/user/bioc-intro/fig_output/fig1.pdf</code>
を使うことになる。</p>
</div>
</section><section><h2 class="section-heading" id="rとの対話">Rとの対話<a class="anchor" aria-label="アンカー" href="#r%E3%81%A8%E3%81%AE%E5%AF%BE%E8%A9%B1"></a>
<a class="anchor" aria-label="anchor" href="#r%E3%81%A8%E3%81%AE%E5%AF%BE%E8%A9%B1"></a>
</h2>
<hr class="half-width">
<p>プログラミングの基本は、私たちが
、コンピュータが従うべき命令を書き記し、その
命令に従うようコンピュータに指示することである。
私たちがRで命令を書く、つまり_コード_を書くのは、それが
、コンピューターも私たちも理解できる共通言語だからだ。 私たちは
を_コマンド_と呼び、それらのコマンドを_実行_（_実行_とも呼ぶ）することによって、
の指示に従うようにコンピュータに指示する。</p>
<p>Rと対話する主な方法は2つある：
<strong>コンソール</strong>を使う方法と、<strong>スクリプト</strong>（
あなたのコードを含むプレーンテキストファイル）を使う方法である。
コンソールペイン（RStudioでは左下のパネル）は、
、R言語で書かれたコマンドを入力し、
、コンピュータによって即座に実行される場所です。 また、
、実行されたコマンドの結果が表示される場所でもある。 コンソールに直接
コマンドを入力し、<code>Enter</code>を押すことで、それらの
コマンドを実行することができますが、セッションを閉じると忘れてしまいます。</p>
<p>コードとワークフローを再現できるようにしたいので、
、スクリプトエディターで必要なコマンドを入力し、
スクリプトを保存する方がよい。
こうすることで、私たちがしたことの完全な記録が残る。
、誰にでも（未来の自分も含めて！）。 は、
の結果を自分のコンピューターで簡単に再現できる。 ただし、スクリプトに
、単にコマンドを入力しただけでは自動的に_実行_されないことに注意してほしい。
、コンソールに送信して実行させる必要がある。</p>
<p>RStudio ではスクリプトエディター から <code>Ctrl</code> +
<code>Enter</code> ショートカット（Mac では <code>Cmd</code> +
<code>Return</code> で も可）で直接コマンドを実行できます。
Ctrl<code>+</code>Enter`を押すと、スクリプトの現在の行のコマンド（カーソルで
を示す）、または現在選択されているテキスト
のすべてのコマンドがコンソールに送られ、実行される。
その他のキーボードショートカットはRStudio cheatsheet about RStudio
IDEを参照してください。</p>
<p>分析のある時点で、
変数の内容やオブジェクトの構造をチェックしたくなるかもしれない。必ずしもスクリプトに
の記録を残しておく必要はない。
これらのコマンドを入力し、コンソールで直接 。 RStudio には
<code>Ctrl</code> + <code>1</code> と <code>Ctrl</code> + <code>2</code>
のショートカットがあり、スクリプトと
のコンソールペイン間をジャンプすることができます。</p>
<p>Rがコマンドを受け付ける準備ができたら、Rコンソールに
<code>&gt;</code> プロンプトが表示される。
コマンドを受信すると（タイプ、コピーペースト、またはスクリプト
エディターから <code>Ctrl</code> + <code>Enter</code> を使って送信）、R
はそれを実行しようとします。 準備ができると、結果を表示し、
新しいコマンドを待つために新しい <code>&gt;</code>
プロンプトで戻ってきます。</p>
<p>Rがまだ
、データの入力を待っている場合は、コンソールに<code>+</code>プロンプトが表示されます。
これは、 、完全なコマンドの入力が終わっていないことを意味する。 これは、
、括弧や引用符を「閉じて」いないからです。つまり、
、左括弧と右括弧の数や、 、開閉引用符の数が同じではないからです。
このようなことが起こり、
、コマンドを入力し終わったと思った場合、コンソール
ウィンドウ内をクリックし、<code>Esc</code>を押してください。これにより、不完全なコマンドがキャンセルされ、
<code>&gt;</code>プロンプトに戻ります。</p>
</section><section><h2 class="section-heading" id="コース中やコース終了後にさらに学ぶには">コース中やコース終了後にさらに学ぶには？<a class="anchor" aria-label="アンカー" href="#%E3%82%B3%E3%83%BC%E3%82%B9%E4%B8%AD%E3%82%84%E3%82%B3%E3%83%BC%E3%82%B9%E7%B5%82%E4%BA%86%E5%BE%8C%E3%81%AB%E3%81%95%E3%82%89%E3%81%AB%E5%AD%A6%E3%81%B6%E3%81%AB%E3%81%AF"></a>
<a class="anchor" aria-label="anchor" href="#%E3%82%B3%E3%83%BC%E3%82%B9%E4%B8%AD%E3%82%84%E3%82%B3%E3%83%BC%E3%82%B9%E7%B5%82%E4%BA%86%E5%BE%8C%E3%81%AB%E3%81%95%E3%82%89%E3%81%AB%E5%AD%A6%E3%81%B6%E3%81%AB%E3%81%AF"></a>
</h2>
<hr class="half-width">
<p>このコースで扱う内容は、あなた自身の
研究のためにデータを分析するために R をどのように使うことができるかを、
初めに体験していただくものです。
しかし、データセットのクリーニング、統計的手法の使用、
、美しいグラフィックスの作成<a href="#fn5" class="footnote-ref" id="fnref5"><sup>5</sup></a>など、
の高度な操作を行うには、さらに学ぶ必要がある。
Rに習熟し、効率的に使えるようになるための最良の方法は、他のツールと同様、Rを使って
実際の研究課題に取り組むことである。
初心者の場合、ゼロからスクリプトを書かなければならないのは、
困難に感じるかもしれない。
多くの人が自分のコードをオンラインで公開していることを考えると、
自分の目的に合うように既存のコードを修正することで、簡単に始めることができるかもしれない。</p>
<figure><img src="fig/kitten-try-things.jpg" width="400px" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure></section><section><h2 class="section-heading" id="助けを求める">助けを求める<a class="anchor" aria-label="アンカー" href="#%E5%8A%A9%E3%81%91%E3%82%92%E6%B1%82%E3%82%81%E3%82%8B"></a>
<a class="anchor" aria-label="anchor" href="#%E5%8A%A9%E3%81%91%E3%82%92%E6%B1%82%E3%82%81%E3%82%8B"></a>
</h2>
<hr class="half-width">
<div class="section level3">
<h3 id="rstudio-組み込みのヘルプインターフェイスを使用してr-関数の詳細情報を検索します">RStudio 組み込みのヘルプインターフェイスを使用して、R
関数の詳細情報を検索します。<a class="anchor" aria-label="anchor" href="#rstudio-%E7%B5%84%E3%81%BF%E8%BE%BC%E3%81%BF%E3%81%AE%E3%83%98%E3%83%AB%E3%83%97%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%BC%E3%83%95%E3%82%A7%E3%82%A4%E3%82%B9%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%97%E3%81%A6r-%E9%96%A2%E6%95%B0%E3%81%AE%E8%A9%B3%E7%B4%B0%E6%83%85%E5%A0%B1%E3%82%92%E6%A4%9C%E7%B4%A2%E3%81%97%E3%81%BE%E3%81%99"></a>
</h3>
<figure style="text-align: center"><img src="fig/rstudiohelp.png" alt="RStudio help interface." width="70%" class="figure mx-auto d-block"><figcaption>
RStudio help interface.
</figcaption></figure><p>RStudio ヘルプ
インターフェイスを使用するのが、ヘルプを得る最も早い方法の1つです。
このパネルはデフォルトで RStudio の右下 パネルにあります。
スクリーンショットに見られるように、
“Mean”という単語を入力すると、RStudioは
、あなたが興味を持ちそうな候補もいくつか出そうとする。 説明文は
ウィンドウに表示される。</p>
</div>
<div class="section level3">
<h3 id="使いたい関数の名前はわかっているがその使い方がわからない">使いたい関数の名前はわかっているが、その使い方がわからない。<a class="anchor" aria-label="anchor" href="#%E4%BD%BF%E3%81%84%E3%81%9F%E3%81%84%E9%96%A2%E6%95%B0%E3%81%AE%E5%90%8D%E5%89%8D%E3%81%AF%E3%82%8F%E3%81%8B%E3%81%A3%E3%81%A6%E3%81%84%E3%82%8B%E3%81%8C%E3%81%9D%E3%81%AE%E4%BD%BF%E3%81%84%E6%96%B9%E3%81%8C%E3%82%8F%E3%81%8B%E3%82%89%E3%81%AA%E3%81%84"></a>
</h3>
<p>特定の関数、例えば<code>barplot()</code>のヘルプが必要な場合は、
：</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">バープロット</span></span></code></pre>
</div>
<p>引数の名前を思い出す必要がある場合は、次のようにすればよい：</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">引数</span><span class="op">(</span><span class="va">lm</span><span class="op">)</span></span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="xを行う関数を使いたいそのための関数があるはずだがどれがあるのかわからない">Xを行う関数を使いたい。そのための関数があるはずだが、どれがあるのかわからない…。<a class="anchor" aria-label="anchor" href="#x%E3%82%92%E8%A1%8C%E3%81%86%E9%96%A2%E6%95%B0%E3%82%92%E4%BD%BF%E3%81%84%E3%81%9F%E3%81%84%E3%81%9D%E3%81%AE%E3%81%9F%E3%82%81%E3%81%AE%E9%96%A2%E6%95%B0%E3%81%8C%E3%81%82%E3%82%8B%E3%81%AF%E3%81%9A%E3%81%A0%E3%81%8C%E3%81%A9%E3%82%8C%E3%81%8C%E3%81%82%E3%82%8B%E3%81%AE%E3%81%8B%E3%82%8F%E3%81%8B%E3%82%89%E3%81%AA%E3%81%84"></a>
</h3>
<p>特定のタスクを実行する関数を探している場合は、
<code>help.search()</code>関数を使用することができます。この関数は二重の疑問符
`?
しかし、これはインストールされているパッケージの中から、検索リクエストと
一致するヘルプページを探すだけです。</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">クルスカル</span></span></code></pre>
</div>
<p>探しているものが見つからない場合は、 <a href="https://www.rdocumentation.org" class="external-link">rdocumentation.org</a>のウェブサイトを使うことができます。このウェブサイトは、利用可能なすべてのパッケージのヘルプファイルから
を検索します。</p>
<p>最後に、一般的なグーグルやインターネット検索で “R &lt;task&gt;”
を検索すると、多くの場合、
適切なパッケージ・ドキュメントにたどり着くか、
他の誰かがすでに質問している有益なフォーラムにたどり着く。</p>
</div>
<div class="section level3">
<h3 id="動けないんだ-理解できないエラーメッセージが表示されます">動けないんだ…。 理解できないエラーメッセージが表示されます。<a class="anchor" aria-label="anchor" href="#%E5%8B%95%E3%81%91%E3%81%AA%E3%81%84%E3%82%93%E3%81%A0-%E7%90%86%E8%A7%A3%E3%81%A7%E3%81%8D%E3%81%AA%E3%81%84%E3%82%A8%E3%83%A9%E3%83%BC%E3%83%A1%E3%83%83%E3%82%BB%E3%83%BC%E3%82%B8%E3%81%8C%E8%A1%A8%E7%A4%BA%E3%81%95%E3%82%8C%E3%81%BE%E3%81%99"></a>
</h3>
<p>エラーメッセージをググることから始めよう。
というのも、多くの場合、パッケージ開発者はRが提供するエラー・キャッチに依存しているからである。
、一般的なエラー・メッセージが表示されることになるが、これは
の問題を診断するのにあまり役に立たないかもしれない（例えば、“subscript
out of bounds”）。 メッセージが非常に一般的なものであれば、
、使用している関数やパッケージの名前を クエリに含めることもできる。</p>
<p>しかし、Stack Overflowをチェックする必要がある。
r]`タグを使って検索する。 ほとんどの
の質問にはすでに答えが出されているが、
の答えを見つけるために、検索で適切な の言葉を使うことが課題である：</p>
<p><a href="https://stackoverflow.com/questions/tagged/r" class="external-link">http://stackoverflow.com/questions/tagged/r</a></p>
<p>R言語入門](<a href="https://cran.r-project.org/doc/manuals/R-intro.pdf" class="external-link uri">https://cran.r-project.org/doc/manuals/R-intro.pdf</a>)
も、プログラミング経験の少ない人にとっては内容が濃いかもしれないが、R言語の基礎を理解するには良い
場所である。</p>
<p>R FAQ](<a href="https://cran.r-project.org/doc/FAQ/R-FAQ.html)%E3%81%AF%E5%AF%86%E5%BA%A6%E3%81%8C%E6%BF%83%E3%81%8F%E3%80%81%E6%8A%80%E8%A1%93%E7%9A%84%E3%81%A7%E3%81%82%E3%82%8B" class="external-link uri">https://cran.r-project.org/doc/FAQ/R-FAQ.html)は密度が濃く、技術的である</a>。
、しかし有用な情報が満載である。</p>
</div>
<div class="section level3">
<h3 id="助けを求める-1">助けを求める<a class="anchor" aria-label="anchor" href="#%E5%8A%A9%E3%81%91%E3%82%92%E6%B1%82%E3%82%81%E3%82%8B-1"></a>
</h3>
<p>誰かに助けてもらうために重要なのは、相手があなたの問題（
）を素早く把握することだ。
、どこに問題がありそうかをできるだけ簡単に特定できるようにすべきだ。</p>
<p>あなたの問題を説明するために、正しい言葉を使うようにしてください。
例えば、 パッケージはライブラリとは違う。 ほとんどの人は、
、あなたが言いたかったことを理解するだろうが、意味の違いについて本当に強い感情を持つ人もいる
。 重要なのは、
、あなたを助けようとする人々を混乱させる可能性があるということだ。
できるだけ正確に問題を説明してください。</p>
<p>可能であれば、うまくいかないことを単純な例（再現可能な
）にまで落とし込むようにする。
もし、あなたが50000行10000列のデータではなく、非常に小さなデータ
フレームを使って問題を再現できるのであれば、
その小さなデータを問題の説明とともに提供してください。 適切な場合には、
、あなたのやっていることを一般化して、
分野に関係のない人でも質問を理解できるようにする。 例えば、
実際のデータセットのサブセットを使う代わりに、
小さな（3列、5行）一般的なものを作成する。 再現可能な
例の書き方については、Hadley Wickhamによるこの記事を参照のこと。</p>
<p>オブジェクトを他の人と共有するには、それが比較的小さければ、 、関数
<code>dput()</code> を使うことができる。
、メモリ上のオブジェクトとまったく同じオブジェクトを再作成するために使用できるRコードが出力される：</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## irisはRに付属するデータフレームの例であり、 head()はデータフレームの最初の部分を返す</span></span>
<span><span class="co">## 関数である</span></span>
<span><span class="fu">dput</span><span class="op">(</span><span class="fu">head</span><span class="op">(</span><span class="va">iris</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="fu">structure</span><span class="op">(</span><span class="fu">list</span><span class="op">(</span>Sepal.Length <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="fl">5.1</span>, <span class="fl">4.9</span>, <span class="fl">4.7</span>, <span class="fl">4.6</span>, <span class="fl">5</span>, <span class="fl">5.4</span><span class="op">)</span>,</span>
<span>    Sepal.Width <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="fl">3.5</span>, <span class="fl">3</span>, <span class="fl">3.2</span>, <span class="fl">3.1</span>, <span class="fl">3.6</span>, <span class="fl">3.9</span><span class="op">)</span>, Petal.Length <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="fl">1.4</span>,</span>
<span>    <span class="fl">1.4</span>, <span class="fl">1.3</span>, <span class="fl">1.5</span>, <span class="fl">1.4</span>, <span class="fl">1.7</span><span class="op">)</span>, Petal.Width <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">0.2</span>, <span class="fl">0.2</span>,</span>
<span>    <span class="fl">0.2</span>, <span class="fl">0.2</span>, <span class="fl">0.4</span><span class="op">)</span>, Species <span class="op">=</span> <span class="fu">structure</span><span class="op">(</span><span class="fu">c</span><span class="op">(</span><span class="fl">1L</span>, <span class="fl">1L</span>, <span class="fl">1L</span>, <span class="fl">1L</span>, <span class="fl">1L</span>,</span>
<span>    <span class="fl">1L</span><span class="op">)</span>, levels <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="st">"setosa"</span>, <span class="st">"versicolor"</span>, <span class="st">"virginica"</span><span class="op">)</span>, class <span class="op">=</span> <span class="st">"factor"</span><span class="op">)</span><span class="op">)</span>, row.names <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="cn">NA</span>,</span>
<span><span class="fl">6L</span><span class="op">)</span>, class <span class="op">=</span> <span class="st">"data.frame"</span><span class="op">)</span></span></code></pre>
</div>
<p>オブジェクトのサイズが大きい場合は、生ファイル（つまり、CSV
ファイル）と、エラーが発生した時点までのスクリプト（およびの問題に関係ないものをすべて削除した後のファイル）を提供してください。
あるいは、特にあなたの質問が
データフレームに関連していない場合は、任意のRオブジェクトをファイルに保存することができます[^export]：</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">saveRDS</span><span class="op">(</span><span class="va">iris</span>, file<span class="op">=</span><span class="st">"/tmp/iris.rds"</span><span class="op">)</span></span></code></pre>
</div>
<p>しかし、このファイルの内容は人間が読めるものではないので、 Stack
Overflowに直接投稿することはできません。 その代わりに、
。その人は<code>readRDS()</code>コマンドでそのファイルを読むことができます（ここでは、
、ダウンロードされたファイルは
、そのユーザーのホームディレクトリの<code>Downloads</code>フォルダにあると仮定しています）：</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">some_data</span> <span class="op">&lt;-</span> <span class="fu">readRDS</span><span class="op">(</span>file<span class="op">=</span><span class="st">"~/Downloads/iris.rds"</span><span class="op">)</span></span></code></pre>
</div>
<p>最後になりますが、<strong>必ず<code>sessionInfo()</code></strong>
の出力を含めるようにしてください。プラットフォーム、使用しているRと
パッケージのバージョン、その他問題を理解するのに非常に役立つ情報を提供してくれるからです。</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">sessionInfo</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>R version 4.4.1 (2024-06-14)
Platform: x86_64-pc-linux-gnu
Running under: Ubuntu 22.04.4 LTS

Matrix products: default
BLAS:   /usr/lib/x86_64-linux-gnu/blas/libblas.so.3.10.0
LAPACK: /usr/lib/x86_64-linux-gnu/lapack/liblapack.so.3.10.0

locale:
 [1] LC_CTYPE=C.UTF-8       LC_NUMERIC=C           LC_TIME=C.UTF-8
 [4] LC_COLLATE=C.UTF-8     LC_MONETARY=C.UTF-8    LC_MESSAGES=C.UTF-8
 [7] LC_PAPER=C.UTF-8       LC_NAME=C              LC_ADDRESS=C
[10] LC_TELEPHONE=C         LC_MEASUREMENT=C.UTF-8 LC_IDENTIFICATION=C

time zone: Asia/Tokyo
tzcode source: system (glibc)

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

loaded via a namespace (and not attached):
[1] compiler_4.4.1  tools_4.4.1     highr_0.11      knitr_1.48
[5] xfun_0.47       evaluate_0.24.0</code></pre>
</div>
</div>
<div class="section level3">
<h3 id="どこに助けを求めればいいのか">どこに助けを求めればいいのか？<a class="anchor" aria-label="anchor" href="#%E3%81%A9%E3%81%93%E3%81%AB%E5%8A%A9%E3%81%91%E3%82%92%E6%B1%82%E3%82%81%E3%82%8C%E3%81%B0%E3%81%84%E3%81%84%E3%81%AE%E3%81%8B"></a>
</h3>
<ul>
<li>コース中、あなたの隣に座っている人。
、ワークショップ中に隣の人と話し、自分の答えを比較し、
、助けを求めることをためらわないでください。</li>
<li>友好的な同僚：もしあなたより経験豊富な人を知っていれば、
、あなたを助けてくれるかもしれない。</li>
<li>
<a href="https://stackoverflow.com/questions/tagged/r" class="external-link">Stack
Overflow</a>:
あなたの質問が過去に回答されたことがなく、よく練られたものであれば、
5分以内に回答が得られる可能性があります。 How to ask good
questionのガイドラインに従うことを忘れずに。</li>
<li>R-helpメーリングリスト ](<a href="https://stat.ethz.ch/mailman/listinfo/r-help" class="external-link uri">https://stat.ethz.ch/mailman/listinfo/r-help</a>):
多くの人に読まれていて（Rコアチームのほとんどを含む）、多くの人が
投稿していますが、口調はかなり辛口で、
新しいユーザーを必ずしも歓迎しているとは限りません。
あなたの質問が正当なものであれば、
、すぐに回答が返ってくる可能性が高いが、
、スマイルマーク付きで返ってくるとは思わないこと。
また、ここでは他のどこよりも、
正しい語彙を使うようにしましょう（そうしないと、
の質問に答えるのではなく、
あなたの言葉の誤用を指摘する答えが返ってくるかもしれません）。
また、質問内容が特定のパッケージではなく、
ベースとなる関数に関するものであれば、より成功しやすいでしょう。</li>
<li>質問が特定のパッケージに関するものであれば、そのパッケージのメーリングリスト(
)があるかどうか確認してください。 通常は
<code>packageDescription("name-of-package")</code>
を使ってアクセスできるパッケージのDESCRIPTIONファイル に含まれています。
また、 そのパッケージの作者に直接メールを送ってみたり、
コードリポジトリ（例：GitHub）にissueを開いてみるのもよいだろう。</li>
<li>また、トピックに特化したメーリングリスト（GIS、
系統遺伝学など）もある。全リストは <a href="https://www.r-project.org/mail.html" class="external-link">こちら</a>。</li>
</ul>
</div>
<div class="section level3">
<h3 id="その他のリソース">その他のリソース<a class="anchor" aria-label="anchor" href="#%E3%81%9D%E3%81%AE%E4%BB%96%E3%81%AE%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9"></a>
</h3>
<ul>
<li><p>Rメーリングリストの<a href="https://www.r-project.org/posting-guide.html" class="external-link">投稿ガイド</a>。</p></li>
<li><p>How to ask for R help 役立つガイドライン。</p></li>
<li><p>Jon Skeetによるこのブログ記事
プログラミングの質問の仕方について、かなり包括的なアドバイスがある。</p></li>
<li><p>reprex](<a href="https://cran.rstudio.com/web/packages/reprex/)%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8" class="external-link uri">https://cran.rstudio.com/web/packages/reprex/)パッケージ</a>
は、 ヘルプを求めるときに、再現可能な例を作成するのに非常に役立ちます。
rOpenSciコミュニティコール “How to ask questions so they get answered”
(Github link and video recording) には、
reprexパッケージとその哲学のプレゼンテーションが含まれています。</p></li>
</ul>
</div>
</section><section><h2 class="section-heading" id="rパッケージ">Rパッケージ<a class="anchor" aria-label="アンカー" href="#r%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8"></a>
<a class="anchor" aria-label="anchor" href="#r%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8"></a>
</h2>
<hr class="half-width">
<div class="section level3">
<h3 id="荷物の積み込み">荷物の積み込み<a class="anchor" aria-label="anchor" href="#%E8%8D%B7%E7%89%A9%E3%81%AE%E7%A9%8D%E3%81%BF%E8%BE%BC%E3%81%BF"></a>
</h3>
<p>上で見てきたように、RパッケージはRの基本的な役割を担っている。
、パッケージがインストールされていることを前提に、パッケージの機能を利用する。
、それを利用できるようにするには、まずパッケージをロードする必要がある。
これは <code>library()</code>関数で行う。 以下に <code>ggplot2</code>
をロードする。</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="st">"ggplot2"</span><span class="op">)</span></span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="パッケージのインストール">パッケージのインストール<a class="anchor" aria-label="anchor" href="#%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB"></a>
</h3>
<p>デフォルトのパッケージリポジトリは The <em>Comprehensive R Archive
Network</em> (CRAN) で、CRAN で利用可能なパッケージは
<code>install.packages()</code> 関数で インストールできます。 例えば、
、後で説明する <code>dplyr</code> パッケージをインストールする。</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">install.packages</span><span class="op">(</span><span class="st">"dplyr"</span><span class="op">)</span></span></code></pre>
</div>
<p>このコマンドは、<code>dplyr</code> パッケージと、その
依存パッケージ、つまり、そのパッケージが機能するために依存しているすべてのパッケージをインストールします。</p>
<p>もう一つの主要なRパッケージのリポジトリは、Bioconductorによって管理されている。
<a href="https://bioconductor.org/packages/release/BiocViews.html#___Software" class="external-link">Bioconductorパッケージ</a>
は、専用のパッケージ、 すなわち <code>BiocManager</code>
を使用して管理およびインストールされます。</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">install.packages</span><span class="op">(</span><span class="st">"BiocManager"</span><span class="op">)</span></span></code></pre>
</div>
<p>SummarizedExperiment<code>（後で ）、</code>DESeq2<code>（RNA-Seq解析用）、その他BioconductorやCRANにあるパッケージは、</code>BiocManager::install`で
。</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">BiocManager</span><span class="fu">::</span><span class="fu">install</span><span class="op">(</span><span class="st">"SummarizedExperiment"</span><span class="op">)</span></span>
<span><span class="fu">BiocManager</span><span class="fu">::</span><span class="fu">install</span><span class="op">(</span><span class="st">"DESeq2"</span><span class="op">)</span></span></code></pre>
</div>
<p>デフォルトでは、<code>BiocManager::install()</code>
はインストールされているすべてのパッケージをチェックし、新しいバージョンがあるかどうかも確認します。
もしあれば、それが表示され、「すべて/いくつか/なしを更新しますか？
[a/s/n]:`、そしてあなたの答えを待つ。
パッケージのバージョンは最新のものを用意するよう努力すべきですが、実際には、パッケージがロードされる前の新鮮なRセッションでのみパッケージを更新することをお勧めします。</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">まとめ<a class="anchor" aria-label="アンカー" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>RとRStudioを使い始める</li>
</ul>
</div>
</div>
</div>
</div>
</section><div class="footnotes footnotes-end-of-document">
<hr>
<ol>
<li id="fn1"><p>コマンドライン コンソールから直接Rを使うのとは対照的だ。
、Rとインターフェイスし統合するソフトウェアは他にもあるが、RStudioは非常に高度な機能を数多く備えながら、特に初心者向け
。<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
<li id="fn2"><p>すなわち、バイオインフォマティクスのデータ解析など、Rに新しい機能を付与するアドオンである。
。<a href="#fnref2" class="footnote-back">↩︎</a></p></li>
<li id="fn3"><p>このコースでは、バイオインフォマティクスを、
、生物学的または生物医学的データに適用されるデータサイエンスと考える。<a href="#fnref3" class="footnote-back">↩︎</a></p></li>
<li id="fn4"><p>その誰かとは、
、分析が実行された数カ月後、あるいは数年後に、
、未来のあなた自身である可能性が高い。<a href="#fnref4" class="footnote-back">↩︎</a></p></li>
<li id="fn5"><p>ここでは、これらのほとんど（統計学を除く）
を紹介するが、Rで可能なこと の富の表面をかすめることしかできない。<a href="#fnref5" class="footnote-back">↩︎</a></p></li>
</ol>
</div></section><section id="aio-23-starting-with-r"><p>Content from <a href="23-starting-with-r.html">R の紹介</a></p>
<hr>
<p>最終更新日：2024-09-08 |

        <a href="https://github.com/carpentries-incubator/bioc-intro/edit/main/episodes/23-starting-with-r.Rmd" class="external-link">ページの編集 <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="回答を全て表示する " data-collapse="回答を全て折りたたむ "> 回答を全て表示する <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">概要</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">質問</h3>
<ul>
<li>R の最初のコマンド</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">目的</h3>
<ul>
<li>R に関連する次の用語を定義します:
オブジェクト、代入、呼び出し、関数、引数、オプション。</li>
<li>R のオブジェクトに値を割り当てます。</li>
<li>オブジェクトに _名前を付ける_方法を学ぶ</li>
<li>コメントを使用してスクリプトに情報を与えます。</li>
<li>R で単純な算術演算を解きます。</li>
<li>関数を呼び出し、引数を使用してデフォルトのオプションを変更します。</li>
<li>ベクトルの内容を検査し、その内容を操作します。</li>
<li>ベクトルから値をサブセット化して抽出します。</li>
<li>データが欠落しているベクトルを解析します。</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<blockquote>
<p>This episode is based on the Data Carpentries’s <em>Data Analysis and
Visualisation in R for Ecologists</em> lesson.</p>
</blockquote>
<section><h2 class="section-heading" id="r-でオブジェクトを作成する">R でオブジェクトを作成する<a class="anchor" aria-label="アンカー" href="#r-%E3%81%A7%E3%82%AA%E3%83%96%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%82%92%E4%BD%9C%E6%88%90%E3%81%99%E3%82%8B"></a>
<a class="anchor" aria-label="anchor" href="#r-%E3%81%A7%E3%82%AA%E3%83%96%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%82%92%E4%BD%9C%E6%88%90%E3%81%99%E3%82%8B"></a>
</h2>
<hr class="half-width">
<p>コンソールに math と入力するだけで、R から出力を取得できます。</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fl">3</span> <span class="op">+</span> <span class="fl">5</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 8</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fl">12</span> <span class="op">/</span> <span class="fl">7</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 1.714286</code></pre>
</div>
<p>ただし、便利で興味深いことを行うには、_値_を <em>オブジェクト</em>
に割り当てる必要があります。
オブジェクトを作成するには、オブジェクトに名前を付け、その後に
代入演算子 <code>&lt;-</code>
と、それに付けたい値を付ける必要があります。</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">weight_kg</span> <span class="op">&lt;-</span> <span class="fl">55</span></span></code></pre>
</div>
<p><code>&lt;-</code> は代入演算子です。 右側の値を左側の
個のオブジェクトに割り当てます。 したがって、「x &lt;-
3」を実行すると、「x」の値は <code>3</code> になります。 矢印は 3
<strong>が <code>x</code> に入る</strong> と読むことができます。 歴史的
理由により、代入に <code>=</code> を使用することもできますが、
のコンテキストで使用できるわけではありません。 構文に わずかな違い](<a href="https://blog.revolutionanalytics.com/2008/12/use-equals-or-arrow-for-assignment.html" class="external-link uri">https://blog.revolutionanalytics.com/2008/12/use-equals-or-arrow-for-assignment.html</a>)
があるため、常に <code>&lt; を使用することをお勧めします。 -</code>
割り当て用。</p>
<p>RStudio では、 <kbd>オプション</kbd> を入力しながら、 <kbd>Alt</kbd>
+ <kbd>-</kbd> を入力すると ( <kbd>-</kbd> キーと同時に <kbd>Alt</kbd>
を押すと)、PC で 1 回のキーストロークで <code>&lt;-</code>
が書き込まれます。 + <kbd>-</kbd> ( <kbd>オプション</kbd> <kbd>-</kbd>
キーと同時に押す) は、Mac でも と同じことを行います。</p>
<div class="section level3">
<h3 id="変数に名前を付ける">変数に名前を付ける<a class="anchor" aria-label="anchor" href="#%E5%A4%89%E6%95%B0%E3%81%AB%E5%90%8D%E5%89%8D%E3%82%92%E4%BB%98%E3%81%91%E3%82%8B"></a>
</h3>
<p>オブジェクトには、「x」、「current_temperature」、または「subject_id」などの任意
名前を付けることができます。 オブジェクト名は明示的で、長
ないようにしたいと考えています。 数字で始めることはできません
(「2x」は無効ですが、「x2」 は有効です)。 R
では大文字と小文字が区別されます (たとえば、<code>weight_kg</code> は の
<code>Weight_kg</code> とは異なります)。 R
の基本的な関数の名前であるため、使用でき 名前が かあります (例:
<code>if</code>、<code>else</code>、 <code>for</code>。2 <a href="https://stat.ethz.ch" class="external-link">こちら</a>を参照)完全なリストについては、/R-manual/R-devel/library/base/html/Reserved.html)
)。 一般に、たとえ許可されていても、他の関数名 (例:
<code>c</code>、<code>T</code>、<code>mean</code>、<code>data</code>、<code>df</code>、
<code>weights</code>) は使用しないことが です。
疑問がある場合は、ヘルプを参照して、その名前がすでに
で使用されているかどうかを確認してください。 また
<code>my.dataset</code> のように、オブジェクト名内にドット
(<code>.</code>) を使用しないことも最善です。 R
には歴史的な理由から名前にドットが含まれる関数が多数あります が、R
(メソッド)
や他のプログラミング言語ではドットが特別な意味を持っているため、ドットは避けるのが最善です
。 オブジェクト名には名詞を使用し、関数名には動詞
を使用することもお勧めします。 のスタイル
(スペースを入れる場所、オブジェクトの名前など)
に一貫性を持たせることが重要です。 コーディング スタイルを使用すると、
の自分や共同作業者にとって、コードがより明確に読みやすくなります。 R
では、人気のあるスタイル ガイド には、<a href="https://google.github.io/styleguide/Rguide.xml" class="external-link">Google の</a>、 <a href="https://style.tidyverse.org/" class="external-link">tidyverse の</a>
スタイル、およびBioconductor スタイル ガイド。 Tidyverse
は非常に包括的であり、最初は では圧倒されるように思えるかもしれません。
<a href="https://github.com/jimhester/lintr" class="external-link"><strong><code>lintr</code></strong></a>
パッケージを
にインストールすると、コードのスタイルの問題が自動的にチェックされます。</p>
<blockquote>
<p><strong>オブジェクトと変数</strong>:
「R」で「オブジェクト」として知られているものは、他の多くのプログラミング言語では「変数」として知られて
ます。 に応じて、「オブジェクト」と「変数」は
に異なる意味を持つ可能性があります。 ただし、このレッスンでは、2
つの単語は 的に使用されます。 詳細については、 <a href="https://cran.r-project.org/doc/manuals/r-release/R-lang.html#Objects" class="external-link">ここを参照してください。</a></p>
</blockquote>
<p>オブジェクトに値を割り当てるとき、R は何も出力しません。
かっこを使用するか 名を入力することで、
に値を強制的に出力させることができます。</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">weight_kg</span> <span class="op">&lt;-</span> <span class="fl">55</span>    <span class="co"># 何も出力しません</span></span>
<span><span class="op">(</span><span class="va">weight_kg</span> <span class="op">&lt;-</span> <span class="fl">55</span><span class="op">)</span>  <span class="co">#  しかし、呼び出しを括弧で囲むと `weight_kg` の値が出力され、</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 55</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">weight_kg</span>          <span class="co"># オブジェクトの名前を入力しても同様に出力されます</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 55</code></pre>
</div>
<p>R
のメモリに「weight_kg」があるので、それを使って算術演算を行うことができます。
、この重量をポンドに変換したい場合があります (ポンドでの重量は kg
での重量の 2.2 倍です)。</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fl">2.2</span> <span class="op">*</span> <span class="va">weight_kg</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 121</code></pre>
</div>
<p>オブジェクトに新しい値を割り当てることで、オブジェクトの値を変更することもできます。</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">weight_kg</span> <span class="op">&lt;-</span> <span class="fl">57.5</span></span>
<span><span class="fl">2.2</span> <span class="op">*</span> <span class="va">weight_kg</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 126.5</code></pre>
</div>
<p>これは、
つのオブジェクトに値を割り当てても、他のオブジェクトの値は変更されないことを意味します。たとえば、動物の体重をポンド単位で新しい
オブジェクト <code>weight_lb</code> に保存してみましょう。</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">weight_lb</span> <span class="op">&lt;-</span> <span class="fl">2.2</span> <span class="op">*</span> <span class="va">weight_kg</span></span></code></pre>
</div>
<p>次に「weight_kg」を 100 に変更します。</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">weight_kg</span> <span class="op">&lt;-</span> <span class="fl">100</span></span></code></pre>
</div>
<div id="チャレンジ" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="チャレンジ" class="callout-inner">
<h3 class="callout-title">チャレンジ：<a class="anchor" aria-label="アンカー" href="#%E3%83%81%E3%83%A3%E3%83%AC%E3%83%B3%E3%82%B8"></a>
</h3>
<div class="callout-content">
<p>オブジェクト「weight_lb」の現在の内容は何だと思いますか? 126.5
それとも 220?</p>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="コメント">コメント<a class="anchor" aria-label="アンカー" href="#%E3%82%B3%E3%83%A1%E3%83%B3%E3%83%88"></a>
<a class="anchor" aria-label="anchor" href="#%E3%82%B3%E3%83%A1%E3%83%B3%E3%83%88"></a>
</h2>
<hr class="half-width">
<p>のコメント文字は <code>#</code> です。0 スクリプトの <code>#</code>
の右側にあるものはすべて R によって無視されます。スクリプトにメモ
説明を残すと便利です。</p>
<p>RStudio では、段落のコメントまたはコメント解除が簡単に行えます。
コメントしたい行を選択した後、 キーボード <kbd>Ctrl</kbd> +
<kbd>Shift</kbd> + <kbd>C</kbd>を同時に押します。 の場合、1
行だけをコメントアウトしたい場合は、その行の任意
位置にカーソルを置きます
(つまり、行全体を選択する必要はありません)。その後 Ctrl +
<kbd>Shift</kbd> + <kbd>C</kbd><kbd>押します。</kbd></p>
<div id="チャレンジ-1" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="チャレンジ-1" class="callout-inner">
<h3 class="callout-title">チャレンジ<a class="anchor" aria-label="アンカー" href="#%E3%83%81%E3%83%A3%E3%83%AC%E3%83%B3%E3%82%B8-1"></a>
</h3>
<div class="callout-content">
<p>次の各ステートメントの後の値は何ですか?</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mass</span> <span class="op">&lt;-</span> <span class="fl">47.5</span>            <span class="co"># 質量?</span></span>
<span><span class="va">age</span>  <span class="op">&lt;-</span> <span class="fl">122</span>             <span class="co"># 年齢?</span></span>
<span><span class="va">mass</span> <span class="op">&lt;-</span> <span class="va">mass</span> <span class="op">*</span> <span class="fl">2.0</span>      <span class="co"># 質量?</span></span>
<span><span class="va">age</span>  <span class="op">&lt;-</span> <span class="va">age</span> <span class="op">-</span> <span class="fl">20</span>        <span class="co"># 年齢?</span></span>
<span><span class="va">mass_index</span> <span class="op">&lt;-</span> <span class="va">mass</span><span class="op">/</span><span class="va">age</span>  <span class="co"># 質量指数?</span></span></code></pre>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="関数とその引数">関数とその引数<a class="anchor" aria-label="アンカー" href="#%E9%96%A2%E6%95%B0%E3%81%A8%E3%81%9D%E3%81%AE%E5%BC%95%E6%95%B0"></a>
<a class="anchor" aria-label="anchor" href="#%E9%96%A2%E6%95%B0%E3%81%A8%E3%81%9D%E3%81%AE%E5%BC%95%E6%95%B0"></a>
</h2>
<hr class="half-width">
<p>関数は、操作の割り当て を含む、より複雑なコマンド
セットを自動化する「定型スクリプト」です。
多くの関数は事前定義されているか、R <em>パッケージ</em>
をインポートすることで 可能になります (詳細は後ほど)。 関数
は通常、<em>arguments</em> と呼ばれる 1 つ以上の入力を取得します。
関数は多くの場合 (常に ではありませんが) <em>値</em> を返します。
典型的な例は関数 <code>sqrt()</code> です。 入力 (引数)
は数値でなければならず、戻り値 (実際には 出力) はその数値の平方根です。
関数の実行 (「実行中」) は関数の <em>呼び出し</em> と呼ばれます。
関数呼び出しの例は次のとおりです。</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">b</span> <span class="op">&lt;-</span> <span class="fu">sqrt</span><span class="op">(</span><span class="va">a</span><span class="op">)</span></span></code></pre>
</div>
<p>ここでは、<code>a</code> の値が <code>sqrt()</code>
関数に与えられ、<code>sqrt()</code> 関数は
平方根を計算し、その値をオブジェクト ` に代入して返します。
この関数は引数を 1 つだけ取るため、非常に単純です。</p>
<p>関数の戻り値「値」は数値 (<code>sqrt()</code> のような)
である必要はなく、
である必要もありません。また、単一の項目である必要もありません。一連のものや
、さらにはデータセットでも構いません。 データ ファイルを R
に読み込むと、それがわかります。</p>
<p>引数には、数値やファイル名だけでなく、他の も含めることができます。
各引数の正確な意味は関数ごとに異なるため、ドキュメントで調べて
にする必要があります (下記を参照)。 一部の関数は引数を取ります
はユーザーによって指定されるか、指定されなかった場合は
<em>デフォルト</em> 値を取ります: これらは <em>オプション</em>
と呼ばれます。
オプションは通常、「不正な値」を無視するかどうか、プロットでどのような記号を使用
かなど、 関数の動作方法を変更するために使用されます。
ただし、特定の値が必要な場合は、デフォルトの代わりに使用される値
を選択して指定できます。</p>
<p>複数の引数を取ることができる関数 <code>round()</code>
を試してみましょう。</p>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">round</span><span class="op">(</span><span class="fl">3.14159</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 3</code></pre>
</div>
<p>ここでは、1 つの引数 <code>3.14159</code> を指定して
<code>round()</code> を呼び出しましたが、 が値 <code>3</code>
を返しました。 これは、デフォルトでは最も近い 整数に丸められるためです。
さらに多くの桁が必要な場合は、「round」関数に関する
情報を取得することでその方法がわかります。 <code>args(round)</code>
を使用するか、<code>?round</code> を使用して
関数のヘルプを参照することができます。</p>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">args</span><span class="op">(</span><span class="va">round</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="kw">function</span> <span class="op">(</span><span class="va">x</span>, <span class="va">digits</span> <span class="op">=</span> <span class="fl">0</span>, <span class="va">...</span><span class="op">)</span></span>
<span><span class="cn">NULL</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb22">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">?</span><span class="va">round</span></span></code></pre>
</div>
<p>別の桁数が必要な場合は、<code>digits=2</code> または必要な桁数を入力
ことがわかります。</p>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">round</span><span class="op">(</span><span class="fl">3.14159</span>, digits <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 3.14</code></pre>
</div>
<p>定義されているのとまったく同じ順序で引数を指定する場合は
に名前を付ける必要はありません。</p>
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">round</span><span class="op">(</span><span class="fl">3.14159</span>, <span class="fl">2</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 3.14</code></pre>
</div>
<p>引数に名前を付けた場合は、その順序を入れ替えることができます。</p>
<div class="codewrapper sourceCode" id="cb27">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">round</span><span class="op">(</span>digits <span class="op">=</span> <span class="fl">2</span>, x <span class="op">=</span> <span class="fl">3.14159</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 3.14</code></pre>
</div>
<p>関数呼び出しの最初にオプションではない引数 ( 四捨五入する数値など)
を置き、すべてのオプションの 引数の名前を指定することをお勧めします。
そうしないと、コードを読む人が、
をしているのかを理解するために、なじみのない引数を持つ関数の定義を調べなければなら
可能性があります。
引数の名前を指定することで、関数インターフェースの将来の変更
(既存の引数の間に 引数が追加される可能性) から することもできます。</p>
</section><section><h2 class="section-heading" id="ベクトルとデータ型">ベクトルとデータ型<a class="anchor" aria-label="アンカー" href="#%E3%83%99%E3%82%AF%E3%83%88%E3%83%AB%E3%81%A8%E3%83%87%E3%83%BC%E3%82%BF%E5%9E%8B"></a>
<a class="anchor" aria-label="anchor" href="#%E3%83%99%E3%82%AF%E3%83%88%E3%83%AB%E3%81%A8%E3%83%87%E3%83%BC%E3%82%BF%E5%9E%8B"></a>
</h2>
<hr class="half-width">
<p>ベクトルは R で最も一般的かつ基本的なデータ型であり、ほぼ R
の主力である です。ベクトルは、 数字や文字などの一連の値で構成されます。
の <code>c()</code>
関数を使用して、一連の値をベクトルに割り当てることができます。
たとえば、動物の体重のベクトルを作成し、それを新しいオブジェクト
<code>weight_g</code> に に割り当てることができます。</p>
<div class="codewrapper sourceCode" id="cb29">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">weight_g</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="fl">50</span>, <span class="fl">60</span>, <span class="fl">65</span>, <span class="fl">82</span><span class="op">)</span></span>
<span><span class="va">weight_g</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 50 60 65 82</code></pre>
</div>
<p>ベクトルには文字も含めることができます。</p>
<div class="codewrapper sourceCode" id="cb31">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">molecules</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="st">"dna"</span>, <span class="st">"rna"</span>, <span class="st">"protein"</span><span class="op">)</span></span>
<span><span class="va">molecules</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "dna"     "rna"     "protein"</code></pre>
</div>
<p>ここでは「dna」や「rna」などの引用符が重要です。 引用符 がないと、R
は <code>dna</code>、<code>rna</code>、および <code>protein</code>
と呼ばれるオブジェクトがあると想定します。 これらのオブジェクトは R
のメモリに存在しないため、エラー メッセージが されます。</p>
<p>ベクトルの内容を検査できる関数が多数あります。 <code>length()</code>
は、特定のベクトルに含まれる要素の数を示します。</p>
<div class="codewrapper sourceCode" id="cb33">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">length</span><span class="op">(</span><span class="va">weight_g</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 4</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb35">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">length</span><span class="op">(</span><span class="va">molecules</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 3</code></pre>
</div>
<p>ベクトルの重要な特徴は、すべての要素が タイプのデータであることです。
関数 <code>class()</code> は、オブジェクトのクラス ( 型の要素)
を示します。</p>
<div class="codewrapper sourceCode" id="cb37">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">class</span><span class="op">(</span><span class="va">weight_g</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "numeric"</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb39">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">class</span><span class="op">(</span><span class="va">molecules</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "character"</code></pre>
</div>
<p>関数 <code>str()</code> は、
オブジェクトとその要素の構造の概要を提供します。 これは、
て複雑なオブジェクトを扱う場合に便利な関数です。</p>
<div class="codewrapper sourceCode" id="cb41">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">str</span><span class="op">(</span><span class="va">weight_g</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> num [1:4] 50 60 65 82</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb43">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">str</span><span class="op">(</span><span class="va">molecules</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> chr [1:3] "dna" "rna" "protein"</code></pre>
</div>
<p><code>c()</code>
関数を使用して、ベクトルに他の要素を追加できます。</p>
<div class="codewrapper sourceCode" id="cb45">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">weight_g</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="va">weight_g</span>, <span class="fl">90</span><span class="op">)</span> <span class="co"># ベクトルの最後に追加</span></span>
<span><span class="va">weight_g</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="fl">30</span>, <span class="va">weight_g</span><span class="op">)</span> <span class="co"># ベクトルの先頭に追加</span></span>
<span><span class="va">weight_g</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 30 50 60 65 82 90</code></pre>
</div>
<p>最初の行では、元のベクトル <code>weight_g</code> を取得し、その末尾に
値 <code>90</code> を追加し、結果を <code>weight_g</code> に保存します。
次に、値 <code>30</code> を先頭に追加し、結果を再び として
<code>weight_g</code> に保存します。</p>
<p>これを何度も繰り返してベクトルを成長させたり、
データセットを組み立てたりすることができます。
これは、プログラムするときに、
または計算している結果を追加するのに役立つ場合があります。</p>
<p><strong>アトミック ベクトル</strong>は最も単純な R
<strong>データ型</strong>であり、単一型の線形 ベクトルです。 上では、R
が使用する 6 つの主な <strong>アトミック ベクトル</strong> タイプのうち
2 つ、つまり <code>"character"</code> と <code>"numeric"</code> (または
<code>"double"</code>) を見てきました。 これらは、すべての R
オブジェクト が構築される基本的な構成要素です。 他の 4 つの
<strong>原子ベクトル</strong> タイプは次のとおりです。</p>
<ul>
<li>
<code>TRUE</code> および <code>FALSE</code> の場合は
<code>"logical"</code> (ブール データ型)</li>
<li>整数の場合は <code>"integer"</code>
(たとえば、<code>2L</code>、<code>L</code> は R
にそれが整数であることを示します)</li>
<li>
<code>"complex"</code> は、実数と虚数の 部分を持つ複素数を表します
(例: 1 + 4i)。これについて説明するのはこれですべてです。</li>
<li>ビットストリームの「raw」` (これ以上は説明しません)</li>
</ul>
<p><code>typeof()</code> 関数
を使用し、ベクトルを引数として入力することで、ベクトルの型をチェックできます。</p>
<p>ベクトルは、R が使用する多くの <strong>データ構造</strong> の 1
つです。 その他 重要なものは、リスト (<code>list</code>)、行列
(<code>matrix</code>)、データ フレーム (<code>data.frame</code>)、因子
(<code>factor</code>)、および配列 (<code>array</code>) です。</p>
<div id="チャレンジ-2" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ-2" class="callout-inner">
<h3 class="callout-title">チャレンジ：<a class="anchor" aria-label="アンカー" href="#%E3%83%81%E3%83%A3%E3%83%AC%E3%83%B3%E3%82%B8-2"></a>
</h3>
<div class="callout-content">
<p>アトミック ベクトルの型は、文字、数値 (または
double)、整数、および論理型であることがわかりました。
しかし、これらのタイプを
つのベクトルに混在させようとするとどうなるでしょうか?</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">
  解決
  </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<p>R はそれらをすべて同じ型に暗黙的に変換します。</p>
</div>
</div>
</div>
</div>
<div id="チャレンジ-3" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ-3" class="callout-inner">
<h3 class="callout-title">チャレンジ：<a class="anchor" aria-label="アンカー" href="#%E3%83%81%E3%83%A3%E3%83%AC%E3%83%B3%E3%82%B8-3"></a>
</h3>
<div class="callout-content">
<p>これらのそれぞれの例では何が起こるでしょうか? (ヒント:
<code>class()</code> を使用してオブジェクトのデータ型を確認
、名前を入力して何が起こるかを確認します):</p>
<div class="codewrapper sourceCode" id="cb47">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">num_char</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="st">"a"</span><span class="op">)</span></span>
<span><span class="va">num_logical</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="cn">TRUE</span>, <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">char_logical</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>, <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">tricky</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="st">"4"</span><span class="op">)</span></span></code></pre>
</div>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2">
  解決
  </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" data-bs-parent="#accordionSolution2" aria-labelledby="headingSolution2">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb48">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">class</span><span class="op">(</span><span class="va">num_char</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "character"</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb50">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">num_char</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "1" "2" "3" "a"</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb52">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">class</span><span class="op">(</span><span class="va">num_logical</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "numeric"</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb54">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">num_logical</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 1 2 3 1 0</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb56">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">class</span><span class="op">(</span><span class="va">char_logical</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "character"</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb58">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">char_logical</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "a"    "b"    "c"    "TRUE"</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb60">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">class</span><span class="op">(</span><span class="va">tricky</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "character"</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb62">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tricky</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "1" "2" "3" "4"</code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="チャレンジ-4" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ-4" class="callout-inner">
<h3 class="callout-title">チャレンジ：<a class="anchor" aria-label="アンカー" href="#%E3%83%81%E3%83%A3%E3%83%AC%E3%83%B3%E3%82%B8-4"></a>
</h3>
<div class="callout-content">
<p>なぜそれが起こると思いますか?</p>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3">
  解決
  </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" data-bs-parent="#accordionSolution3" aria-labelledby="headingSolution3">
<div class="accordion-body">
<p>ベクトルのデータ型は 1 つだけです。 R は、 が情報を失わないという
<em>共通分母</em> を見つけるために、このベクトルの内容を に変換 (強制)
しようとします。</p>
</div>
</div>
</div>
</div>
<div id="チャレンジ-5" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ-5" class="callout-inner">
<h3 class="callout-title">チャレンジ：<a class="anchor" aria-label="アンカー" href="#%E3%83%81%E3%83%A3%E3%83%AC%E3%83%B3%E3%82%B8-5"></a>
</h3>
<div class="callout-content">
<p>次の例では、<code>combined_logical</code> 内の <code>"TRUE"</code>
(文字として) となる値はいくつありますか。</p>
<div class="codewrapper sourceCode" id="cb64">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">num_logical</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">char_logical</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>, <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">combined_logical</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="va">num_logical</span>, <span class="va">char_logical</span><span class="op">)</span></span></code></pre>
</div>
</div>
</div>
</div>
<div id="accordionSolution4" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution4" aria-expanded="false" aria-controls="collapseSolution4">
  <h4 class="accordion-header" id="headingSolution4">
  解決
  </h4>
</button>
<div id="collapseSolution4" class="accordion-collapse collapse" data-bs-parent="#accordionSolution4" aria-labelledby="headingSolution4">
<div class="accordion-body">
<p>唯一。
過去のデータ型の記憶はなく、ベクトルが初めて評価されるときに強制
が発生します。 したがって、「num_logical」の「TRUE」
「combined_logical」で 「1」に変換される前に、「1」に変換されます。</p>
<div class="codewrapper sourceCode" id="cb65">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">combined_logical</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "1"    "2"    "3"    "1"    "a"    "b"    "c"    "TRUE"</code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="チャレンジ-6" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ-6" class="callout-inner">
<h3 class="callout-title">チャレンジ：<a class="anchor" aria-label="アンカー" href="#%E3%83%81%E3%83%A3%E3%83%AC%E3%83%B3%E3%82%B8-6"></a>
</h3>
<div class="callout-content">
<p>R では、オブジェクトをあるクラスから別のクラスに変換することを 強制*
と呼びます。 これらの変換は階層
に従って行われ、一部の型が優先的に他の型に強制されます。 これらのデータ
がどのように強制されるかの階層を表す図を描いてもらえます ?</p>
</div>
</div>
</div>
<div id="accordionSolution5" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution5" aria-expanded="false" aria-controls="collapseSolution5">
  <h4 class="accordion-header" id="headingSolution5">
  解決
  </h4>
</button>
<div id="collapseSolution5" class="accordion-collapse collapse" data-bs-parent="#accordionSolution5" aria-labelledby="headingSolution5">
<div class="accordion-body">
<p>論理 → 数値 → 文字 ← 論理</p>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="ベクトルのサブセット化">ベクトルのサブセット化<a class="anchor" aria-label="アンカー" href="#%E3%83%99%E3%82%AF%E3%83%88%E3%83%AB%E3%81%AE%E3%82%B5%E3%83%96%E3%82%BB%E3%83%83%E3%83%88%E5%8C%96"></a>
<a class="anchor" aria-label="anchor" href="#%E3%83%99%E3%82%AF%E3%83%88%E3%83%AB%E3%81%AE%E3%82%B5%E3%83%96%E3%82%BB%E3%83%83%E3%83%88%E5%8C%96"></a>
</h2>
<hr class="half-width">
<p>ベクトルから 1 つまたは複数の値を抽出したい場合は、角括弧内に 1
つまたは複数のインデックスを指定する必要が ます。 例えば：</p>
<div class="codewrapper sourceCode" id="cb67">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">molecules</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="st">"dna"</span>, <span class="st">"rna"</span>, <span class="st">"peptide"</span>, <span class="st">"protein"</span><span class="op">)</span></span>
<span><span class="va">molecules</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "rna"</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb69">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">molecules</span><span class="op">[</span><span class="fu">c</span><span class="op">(</span><span class="fl">3</span>, <span class="fl">2</span><span class="op">)</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "peptide" "rna"    </code></pre>
</div>
<p>インデックスを繰り返して、元のオブジェクトよりも要素
が多いオブジェクトを作成することもできます。</p>
<div class="codewrapper sourceCode" id="cb71">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">more_molecules</span> <span class="op">&lt;-</span> <span class="va">molecules</span><span class="op">[</span><span class="fu">c</span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">4</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">more_molecules</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "dna"     "rna"     "peptide" "rna"     "dna"     "protein"</code></pre>
</div>
<p>R インデックスは 1 から始まります。 Fortran、MATLAB、 Julia、R
などのプログラミング言語は
から数え始めます。これは人間が通常行うことだからです。 C ファミリの言語
(C++、Java、Perl、 、Python を含む) は 0
からカウントします。これは、コンピュータにとってその方が簡単なためです。</p>
<p>最後に、負のインデックスを使用して、指定された一部の要素を除くベクトル
のすべての要素を取得することもできます。</p>
<div class="codewrapper sourceCode" id="cb73">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">分子</span> <span class="co">## すべての分子</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">エラー<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in eval(expr, envir, enclos): object '分子' not found</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb75">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">分子</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span> <span class="co">## 最初の分子を除くすべての分子</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">エラー<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in eval(expr, envir, enclos): object '分子' not found</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb77">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">分子</span><span class="op">[</span><span class="op">-</span><span class="fu">c</span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span><span class="op">]</span> <span class="co">## 1 番目/3 番目の分子を除くすべての分子</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">エラー<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in eval(expr, envir, enclos): object '分子' not found</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb79">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">分子</span><span class="op">[</span><span class="fu">c</span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">3</span><span class="op">)</span><span class="op">]</span> <span class="co"># # 1番目/3番目を除くすべて</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">エラー<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in eval(expr, envir, enclos): object '分子' not found</code></pre>
</div>
</section><section><h2 class="section-heading" id="条件付きサブセット化">条件付きサブセット化<a class="anchor" aria-label="アンカー" href="#%E6%9D%A1%E4%BB%B6%E4%BB%98%E3%81%8D%E3%82%B5%E3%83%96%E3%82%BB%E3%83%83%E3%83%88%E5%8C%96"></a>
<a class="anchor" aria-label="anchor" href="#%E6%9D%A1%E4%BB%B6%E4%BB%98%E3%81%8D%E3%82%B5%E3%83%96%E3%82%BB%E3%83%83%E3%83%88%E5%8C%96"></a>
</h2>
<hr class="half-width">
<p>サブセット化のもう 1
つの一般的な方法は、論理ベクトルを使用することです。 <code>TRUE</code>
は同じインデックスを持つ要素を選択し が、<code>FALSE</code>
は選択しません。</p>
<div class="codewrapper sourceCode" id="cb81">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">weight_g</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="fl">21</span>, <span class="fl">34</span>, <span class="fl">39</span>, <span class="fl">54</span>, <span class="fl">55</span><span class="op">)</span></span>
<span><span class="va">weight_g</span><span class="op">[</span><span class="fu">c</span><span class="op">(</span><span class="cn">TRUE</span>, <span class="cn">FALSE</span>, <span class="cn">TRUE</span>, <span class="cn">TRUE</span>, <span class="cn">FALSE</span><span class="op">)</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 21 39 54</code></pre>
</div>
<p>通常、これらの論理ベクトルは手動で入力されるのではなく、他の関数または論理テストの
出力です。 たとえば、50 を超える値のみを選択したい場合は、
のようにします。</p>
<div class="codewrapper sourceCode" id="cb83">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## will return logicals with TRUE for the indices that meet</span></span>
<span><span class="co">## the condition</span></span>
<span><span class="va">weight_g</span> <span class="op">&gt;</span> <span class="fl">50</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] FALSE FALSE FALSE  TRUE  TRUE</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb85">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## so we can use this to select only the values above 50</span></span>
<span><span class="va">weight_g</span><span class="op">[</span><span class="va">weight_g</span> <span class="op">&gt;</span> <span class="fl">50</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 54 55</code></pre>
</div>
<p><code>&amp;</code> (両方の条件が true、 AND) または <code>|</code>
(少なくとも 1 つの条件が true、OR)
を使用して複数のテストを結合できます。</p>
<div class="codewrapper sourceCode" id="cb87">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">weight_g</span><span class="op">[</span><span class="va">weight_g</span> <span class="op">&lt;</span> <span class="fl">30</span> <span class="op">|</span> <span class="va">weight_g</span> <span class="op">&gt;</span> <span class="fl">50</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 21 54 55</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb89">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">weight_g</span><span class="op">[</span><span class="va">weight_g</span> <span class="op">&gt;=</span> <span class="fl">30</span> <span class="op">&amp;</span> <span class="va">weight_g</span> <span class="op">==</span> <span class="fl">21</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="fu">numeric</span><span class="op">(</span><span class="fl">0</span><span class="op">)</span></span></code></pre>
</div>
<p>ここで、「&lt;」は「より小さい」、「&gt;」は「より大きい」、「&gt;=」は
「以上」、「==」は「等しい」を表します。 2 つの等号 記号「==」は、左側と
の数値が等しいかどうかをテストするものであり、(「&lt;-」と同様に)
変数の代入を する単一の <code>=</code> 記号と混同しないでください。
。</p>
<p>一般的なタスクは、ベクトル内の特定の文字列を検索することです。<br>
「or」演算子 <code>|</code>
を使用して複数の値が等しいかどうかをテストすることもできますが、
これはすぐに面倒になります。 関数 <code>%in%</code>
を使用すると、検索ベクトルの要素が見つかったかどうかを できます。</p>
<div class="codewrapper sourceCode" id="cb91">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode r" tabindex="0"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" tabindex="-1"></a>分子 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"dna"</span>, <span class="st">"rna"</span>, <span class="st">"タンパク質"</span>, <span class="st">"ペプチド"</span>)</span>
<span id="cb91-2"><a href="#cb91-2" tabindex="-1"></a>分子[分子 <span class="sc">==</span> <span class="st">"rna"</span> <span class="sc">|</span>分子 <span class="sc">==</span> <span class="st">"dna"</span>] <span class="co"># rna と dna の両方を返します</span></span>
<span id="cb91-3"><a href="#cb91-3" tabindex="-1"></a>分子 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"rna"</span>, <span class="st">"dna"</span>, <span class="st">"代謝物"</span>, <span class="st">"ペプチド"</span>, <span class="st">"グリセロール"</span>)</span>
<span id="cb91-4"><a href="#cb91-4" tabindex="-1"></a>分子[分子 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"rna"</span>, <span class="st">" 「DNA」、「代謝物」、「ペプチド」、「グリセロール」)]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">エラー<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error: &lt;text&gt;:4:21: unexpected INCOMPLETE_STRING
3: 分子 %in% c("rna", "dna", "代謝物", "ペプチド", "グリセロール")
4: 分子[分子 %in% c("rna", " 「DNA」、「代謝物」、「ペプチド」、「グリセロール」)]
                       ^</code></pre>
</div>
<div id="チャレンジ-7" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ-7" class="callout-inner">
<h3 class="callout-title">チャレンジ：<a class="anchor" aria-label="アンカー" href="#%E3%83%81%E3%83%A3%E3%83%AC%E3%83%B3%E3%82%B8-7"></a>
</h3>
<div class="callout-content">
<p>なぜ <code>"four" &gt; "five"</code> が <code>TRUE</code>
を返すのか理解できますか?</p>
</div>
</div>
</div>
<div id="accordionSolution6" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution6" aria-expanded="false" aria-controls="collapseSolution6">
  <h4 class="accordion-header" id="headingSolution6">
  解決
  </h4>
</button>
<div id="collapseSolution6" class="accordion-collapse collapse" data-bs-parent="#accordionSolution6" aria-labelledby="headingSolution6">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb93">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="st">"four"</span> <span class="op">&gt;</span> <span class="st">"five"</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] TRUE</code></pre>
</div>
<p>文字列で <code>&gt;</code> または <code>&lt;</code> を使用すると、R
はそれらのアルファベット順を比較します。 ここで、<code>"four"</code> は
<code>"five"</code> の後に来るので、それは * より大きい* です。</p>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="名前">名前<a class="anchor" aria-label="アンカー" href="#%E5%90%8D%E5%89%8D"></a>
<a class="anchor" aria-label="anchor" href="#%E5%90%8D%E5%89%8D"></a>
</h2>
<hr class="half-width">
<p>ベクトルの各要素に名前を付けることができます。 より下のコード
チャンクは、名前のない初期ベクトル、名前の設定方法、および
取得される様子を示しています。</p>
<div class="codewrapper sourceCode" id="cb95">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="fl">1</span>, <span class="fl">5</span>, <span class="fl">3</span>, <span class="fl">5</span>, <span class="fl">10</span><span class="op">)</span></span>
<span><span class="fu">names</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="co">## 名前なし</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="cn">NULL</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb97">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">names</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>, <span class="st">"D"</span>, <span class="st">" E"</span><span class="op">)</span></span>
<span><span class="fu">名前</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="co">## これで名前が決まりました</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">エラー<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in 名前(x): could not find function "名前"</code></pre>
</div>
<p>ベクトルに名前がある場合、
に加えて名前によって要素にアクセスすることができます。</p>
<div class="codewrapper sourceCode" id="cb99">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span><span class="op">[</span><span class="fu">c</span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>A C
1 3 </code></pre>
</div>
<div class="codewrapper sourceCode" id="cb101">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span><span class="op">[</span><span class="fu">c</span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"C"</span><span class="op">)</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>A C
1 3 </code></pre>
</div>
</section><section><h2 class="section-heading" id="データが欠落しています">データが欠落しています<a class="anchor" aria-label="アンカー" href="#%E3%83%87%E3%83%BC%E3%82%BF%E3%81%8C%E6%AC%A0%E8%90%BD%E3%81%97%E3%81%A6%E3%81%84%E3%81%BE%E3%81%99"></a>
<a class="anchor" aria-label="anchor" href="#%E3%83%87%E3%83%BC%E3%82%BF%E3%81%8C%E6%AC%A0%E8%90%BD%E3%81%97%E3%81%A6%E3%81%84%E3%81%BE%E3%81%99"></a>
</h2>
<hr class="half-width">
<p>R はデータセットを分析するように設計されているため、欠損データが
であるという概念が含まれています (これは
のプログラミング言語では一般的ではありません)。
欠損データはベクトルで「NA」として表されます。</p>
<p>数値の演算を行う場合、扱っているデータに欠損値が含まれている場合
ほとんどの関数は「NA」を返します。 この機能により、 データを処理し
いるケースを見逃しにくくなります。 引数 <code>na.rm = TRUE</code>
を追加すると、欠損値を無視して結果を として計算できます。</p>
<div class="codewrapper sourceCode" id="cb103">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">heights</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="fl">2</span>, <span class="fl">4</span>, <span class="fl">4</span>, <span class="cn">NA</span>, <span class="fl">6</span><span class="op">)</span></span>
<span><span class="fu">mean</span><span class="op">(</span><span class="va">heights</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] NA</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb105">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">max</span><span class="op">(</span><span class="va">heights</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] NA</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb107">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">mean</span><span class="op">(</span><span class="va">heights</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 4</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb109">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">max</span><span class="op">(</span><span class="va">heights</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 6</code></pre>
</div>
<p>データに欠損値が含まれている場合は、関数
<code>is.na()</code>、<code>na.omit()</code>、および
<code>complete.cases()</code> に ておくとよいでしょう。
例については、以下の を参照してください。</p>
<div class="codewrapper sourceCode" id="cb111">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## 欠損値のない要素を抽出します。</span></span>
<span><span class="va">heights</span><span class="op">[</span><span class="op">!</span><span class="fu">is.na</span><span class="op">(</span><span class="va">heights</span><span class="op">)</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 2 4 4 6</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb113">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## 不完全なケースを削除したオブジェクトを返します。</span></span>
<span><span class="co">## 返されるオブジェクトは、タイプ `"numeric"` の原子ベクトルです。</span></span>
<span><span class="co">## (または `"double"`)。</span></span>
<span><span class="fu">na.omit</span><span class="op">(</span><span class="va">heights</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 2 4 4 6
attr(,"na.action")
[1] 4
attr(,"class")
[1] "omit"</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb115">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## 完全なケースである要素を抽出します。</span></span>
<span><span class="co">## 返されるオブジェクトは、タイプ `"numeric"` の原子ベクトルです。</span></span>
<span><span class="co">## (または `"double"`)。</span></span>
<span><span class="va">の高さ</span><span class="op">[</span><span class="fu">完全なケース</span><span class="op">(</span><span class="va">高さ</span><span class="op">)</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">エラー<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in eval(expr, envir, enclos): object 'の高さ' not found</code></pre>
</div>
<div id="チャレンジ-8" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ-8" class="callout-inner">
<h3 class="callout-title">チャレンジ：<a class="anchor" aria-label="アンカー" href="#%E3%83%81%E3%83%A3%E3%83%AC%E3%83%B3%E3%82%B8-8"></a>
</h3>
<div class="callout-content">
<ol style="list-style-type: decimal">
<li>このインチ単位の高さのベクトルを使用して、NA
を削除した新しいベクトルを作成します。</li>
</ol>
<div class="codewrapper sourceCode" id="cb117">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">高さ</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="fl">63</span>, <span class="fl">69</span>, <span class="fl">60</span>, <span class="fl">65</span>, <span class="cn">NA</span>, <span class="fl">68</span>, <span class="fl">61</span>, <span class="fl">70</span>, <span class="fl">61</span>, <span class="fl">59</span>, <span class="fl">64</span>, <span class="fl">69</span>, <span class="fl">63</span>, <span class="fl">63</span>, <span class="cn">NA</span>, <span class="fl">72</span>, <span class="fl">65</span>, <span class="fl">64</span>, <span class="fl">70</span>, <span class="fl">63</span>, <span class="fl">65</span><span class="op">)</span></span></code></pre>
</div>
<ol start="2" style="list-style-type: decimal">
<li>関数 <code>median()</code> を使用して、<code>heights</code>
ベクトルの中央値を計算します。</li>
<li>R を使用して、セット内の身長が 67
インチを超える人が何人いるかを計算します。</li>
</ol>
</div>
</div>
</div>
<div id="accordionSolution7" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution7" aria-expanded="false" aria-controls="collapseSolution7">
  <h4 class="accordion-header" id="headingSolution7">
  解決
  </h4>
</button>
<div id="collapseSolution7" class="accordion-collapse collapse" data-bs-parent="#accordionSolution7" aria-labelledby="headingSolution7">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb118">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">heights_no_na</span> <span class="op">&lt;-</span> <span class="va">heights</span><span class="op">[</span><span class="op">!</span><span class="fu">is.na</span><span class="op">(</span><span class="va">heights</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">## または</span></span>
<span><span class="va">heights_no_na</span> <span class="op">&lt;-</span> <span class="fu">na.omit</span><span class="op">(</span><span class="va">heights</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb119">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">median</span><span class="op">(</span><span class="va">heights</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 4</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb121">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">height_above_67</span> <span class="op">&lt;-</span> <span class="va">height_no_na</span><span class="op">[</span><span class="va">heights_no_na</span> <span class="op">&gt;</span> <span class="fl">67</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">エラー<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in eval(expr, envir, enclos): object 'height_no_na' not found</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb123">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">長さ</span><span class="op">(</span><span class="va">heights_above_67</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">エラー<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in 長さ(heights_above_67): could not find function "長さ"</code></pre>
</div>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="ベクトル-secgenvecの生成">ベクトル {#sec:genvec}の生成<a class="anchor" aria-label="アンカー" href="#%E3%83%99%E3%82%AF%E3%83%88%E3%83%AB-secgenvec%E3%81%AE%E7%94%9F%E6%88%90"></a>
<a class="anchor" aria-label="anchor" href="#%E3%83%99%E3%82%AF%E3%83%88%E3%83%AB-secgenvec%E3%81%AE%E7%94%9F%E6%88%90"></a>
</h2>
<hr class="half-width">
<div class="section level3">
<h3 id="コンストラクター">コンストラクター<a class="anchor" aria-label="anchor" href="#%E3%82%B3%E3%83%B3%E3%82%B9%E3%83%88%E3%83%A9%E3%82%AF%E3%82%BF%E3%83%BC"></a>
</h3>
<p>異なるタイプのベクトルを生成する関数がいくつか存在します。
数値のベクトルを生成 には、<code>numeric()</code>
コンストラクターを使用し、出力ベクトルの長さを
パラメーターとして指定します。 値は 0 で初期化されます。</p>
<div class="codewrapper sourceCode" id="cb125">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">数値</span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">エラー<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in 数値(3): could not find function "数値"</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb127">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">数値</span><span class="op">(</span><span class="fl">10</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">エラー<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in 数値(10): could not find function "数値"</code></pre>
</div>
<p>長さ 0 の数値ベクトルを要求すると、次のように
が得られることに注意してください。</p>
<div class="codewrapper sourceCode" id="cb129">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">数値</span><span class="op">(</span><span class="fl">0</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">エラー<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in 数値(0): could not find function "数値"</code></pre>
</div>
<p>文字と論理に対しても同様のコンストラクターがあり、
<code>character()</code> と <code>logical()</code>
という名前が付けられます。</p>
<div id="チャレンジ-9" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ-9" class="callout-inner">
<h3 class="callout-title">チャレンジ：<a class="anchor" aria-label="アンカー" href="#%E3%83%81%E3%83%A3%E3%83%AC%E3%83%B3%E3%82%B8-9"></a>
</h3>
<div class="callout-content">
<p>文字ベクトルと論理ベクトルのデフォルトは何ですか?</p>
</div>
</div>
</div>
<div id="accordionSolution8" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution8" aria-expanded="false" aria-controls="collapseSolution8">
  <h4 class="accordion-header" id="headingSolution8">
  解決
  </h4>
</button>
<div id="collapseSolution8" class="accordion-collapse collapse" data-bs-parent="#accordionSolution8" aria-labelledby="headingSolution8">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb131">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">文字</span><span class="op">(</span><span class="fl">2</span><span class="op">)</span> <span class="co">## 空の文字</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">エラー<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in 文字(2): could not find function "文字"</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb133">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">論理的</span><span class="op">(</span><span class="fl">2</span><span class="op">)</span> <span class="co">## FALSE</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">エラー<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in 論理的(2): could not find function "論理的"</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="要素を複製する">要素を複製する<a class="anchor" aria-label="anchor" href="#%E8%A6%81%E7%B4%A0%E3%82%92%E8%A4%87%E8%A3%BD%E3%81%99%E3%82%8B"></a>
</h3>
<p><code>rep</code> 関数を使用すると、値を特定の回数 ( 回)
繰り返すことができます。 たとえば、長さ 5 の数値ベクトルを から値 -1
で開始したい場合は、次のようにすることができます。</p>
<div class="codewrapper sourceCode" id="cb135">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">担当者</span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">5</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">エラー<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in 担当者(-1, 5): could not find function "担当者"</code></pre>
</div>
<p>同様に、収集されるデータ
に仮定を設定せずに、欠損値が入力されたベクトルを生成するには
(多くの場合、 から始めるのが良い方法です):</p>
<div class="codewrapper sourceCode" id="cb137">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">担当者</span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">5</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">エラー<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in 担当者(NA, 5): could not find function "担当者"</code></pre>
</div>
<p><code>rep</code> は、入力として任意の長さのベクトル (上記では長さ 1
のベクトル を使用しました) および任意のタイプを受け取ることができます。
たとえば、 値 1、2、3 を 5 回繰り返す場合は、次のようにします。</p>
<div class="codewrapper sourceCode" id="cb139">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">rep</span><span class="op">(</span><span class="fu">c</span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span>, <span class="fl">5</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> [1] 1 2 3 1 2 3 1 2 3 1 2 3 1 2 3</code></pre>
</div>
<div id="チャレンジ-10" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ-10" class="callout-inner">
<h3 class="callout-title">チャレンジ：<a class="anchor" aria-label="アンカー" href="#%E3%83%81%E3%83%A3%E3%83%AC%E3%83%B3%E3%82%B8-10"></a>
</h3>
<div class="callout-content">
<p>値 1、2、3 を 5 回繰り返したいのに、 1 を 5 つ、2 を 5 つ、3 を 5
つこの順序で取得した場合はどうなるでしょうか。 可能性は 2
つあります。ヘルプについては <code>?rep</code> または <code>?sort</code>
を参照してください。</p>
</div>
</div>
</div>
<div id="accordionSolution9" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution9" aria-expanded="false" aria-controls="collapseSolution9">
  <h4 class="accordion-header" id="headingSolution9">
  解決
  </h4>
</button>
<div id="collapseSolution9" class="accordion-collapse collapse" data-bs-parent="#accordionSolution9" aria-labelledby="headingSolution9">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb141">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">rep</span><span class="op">(</span><span class="fu">c</span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span>, each <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> [1] 1 1 1 1 1 2 2 2 2 2 3 3 3 3 3</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb143">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">sort</span><span class="op">(</span><span class="fu">rep</span><span class="op">(</span><span class="fu">c</span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> [1] 1 1 1 1 1 2 2 2 2 2 3 3 3 3 3</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="シーケンスの生成">シーケンスの生成<a class="anchor" aria-label="anchor" href="#%E3%82%B7%E3%83%BC%E3%82%B1%E3%83%B3%E3%82%B9%E3%81%AE%E7%94%9F%E6%88%90"></a>
</h3>
<p>もう 1 つの非常に便利な関数は、 の数値シーケンスを生成する
<code>seq</code> です。 たとえば、1 から 20 までの整数のシーケンスを 2
ずつ生成するには、次のコマンドを使用します。</p>
<div class="codewrapper sourceCode" id="cb145">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">seq</span><span class="op">(</span>from <span class="op">=</span> <span class="fl">1</span>, to <span class="op">=</span> <span class="fl">20</span>, by <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> [1]  1  3  5  7  9 11 13 15 17 19</code></pre>
</div>
<p><code>by</code> のデフォルト値は 1 で、1 のステップで 1
つの値から別の値への シーケンスの生成が頻繁に使用されることを考えると、
というショートカットがあります。</p>
<div class="codewrapper sourceCode" id="cb147">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">seq</span><span class="op">(</span><span class="fl">1</span>, <span class="fl">5</span>, <span class="fl">1</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 1 2 3 4 5</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb149">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">seq</span><span class="op">(</span><span class="fl">1</span>, <span class="fl">5</span><span class="op">)</span> <span class="co">## default by</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 1 2 3 4 5</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb151">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 1 2 3 4 5</code></pre>
</div>
<p>最終長さが の 1 から 20
までの一連の数値を生成するには、次のコマンドを使用します。</p>
<div class="codewrapper sourceCode" id="cb153">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">seq</span><span class="op">(</span>from <span class="op">=</span> <span class="fl">1</span>, to <span class="op">=</span> <span class="fl">20</span>, length.out <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1]  1.0 10.5 20.0</code></pre>
</div>
</div>
<div class="section level3">
<h3 id="ランダムなサンプルと順列">ランダムなサンプルと順列<a class="anchor" aria-label="anchor" href="#%E3%83%A9%E3%83%B3%E3%83%80%E3%83%A0%E3%81%AA%E3%82%B5%E3%83%B3%E3%83%97%E3%83%AB%E3%81%A8%E9%A0%86%E5%88%97"></a>
</h3>
<p>有用な関数の最後のグループは、ランダムな データを生成する関数です。
最初の <code>sample</code> は、 のベクトルのランダムな置換を生成します。
たとえば、口頭試験を行わない 人の生徒にランダムな順序を付けるには
まず各生徒に 1 から 10 までの番号を割り当てます
(たとえば、名前のアルファベット順に基づきます)。次に次のようにします。</p>
<div class="codewrapper sourceCode" id="cb155">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">sample</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> [1]  9  4  7  1  2  5  3 10  6  8</code></pre>
</div>
<p>さらなる引数がなければ、<code>sample</code> はベクトルのすべての
要素の順列を返します。 特定のサイズのランダムなサンプルが必要な場合、I
はこの値を 2 番目の引数として設定します。 以下では、事前定義された
<code>letters</code> ベクトルに含まれるアルファベットから 5
つのランダムな 文字をサンプリングします。</p>
<div class="codewrapper sourceCode" id="cb157">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">sample</span><span class="op">(</span><span class="va">letters</span>, <span class="fl">5</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "s" "a" "u" "x" "j"</code></pre>
</div>
<p>入力ベクトルよりも大きな出力が必要な場合、または一部の要素を複数回
できるようにしたい場合は、引数 <code>replace</code> を <code>TRUE</code>
に設定する必要があります。</p>
<div class="codewrapper sourceCode" id="cb159">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">sample</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="fl">10</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> [1] 2 1 5 5 1 1 5 5 2 2</code></pre>
</div>
<div id="チャレンジ-11" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ-11" class="callout-inner">
<h3 class="callout-title">チャレンジ：<a class="anchor" aria-label="アンカー" href="#%E3%83%81%E3%83%A3%E3%83%AC%E3%83%B3%E3%82%B8-11"></a>
</h3>
<div class="callout-content">
<p>上記の関数を試してみると、 サンプルは実際にランダムであり、同じ
順列が 2 回発生することはないことがわかるでしょう。
これらのランダムな描画を再現できるようにするには、ランダム
サンプルを描画する前に <code>set.seed()</code> を使用
て乱数生成シードを手動で設定します。</p>
<p>近所の人と一緒にこの機能をテストしてください。
まず、「1:10」のランダムな 順列を 2 つ個別に描画し、
の異なる結果が得られることを観察します。</p>
<p>次に、たとえば <code>set.seed(123)</code> でシードを設定し、
ランダムな描画を繰り返します。
同じランダムな抽選が行われることに注目してください。</p>
<p>別のシードを設定して繰り返します。</p>
</div>
</div>
</div>
<div id="accordionSolution10" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution10" aria-expanded="false" aria-controls="collapseSolution10">
  <h4 class="accordion-header" id="headingSolution10">
  解決
  </h4>
</button>
<div id="collapseSolution10" class="accordion-collapse collapse" data-bs-parent="#accordionSolution10" aria-labelledby="headingSolution10">
<div class="accordion-body">
<p>さまざまな順列</p>
<div class="codewrapper sourceCode" id="cb161">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">sample</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> [1]  9  1  4  3  6  2  5  8 10  7</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb163">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">sample</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> [1]  4  9  7  6  1 10  8  3  2  5</code></pre>
</div>
<p>シード 123 と同じ順列</p>
<div class="codewrapper sourceCode" id="cb165">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">set.seed</span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="fu">sample</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> [1]  3 10  2  8  6  9  1  7  5  4</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb167">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">set.seed</span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="fu">sample</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> [1]  3 10  2  8  6  9  1  7  5  4</code></pre>
</div>
<p>違う種</p>
<div class="codewrapper sourceCode" id="cb169">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">set.seed</span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu">sample</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> [1]  9  4  7  1  2  5  3 10  6  8</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb171">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">set.seed</span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu">sample</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> [1]  9  4  7  1  2  5  3 10  6  8</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="正規分布からサンプルを抽出する">正規分布からサンプルを抽出する<a class="anchor" aria-label="anchor" href="#%E6%AD%A3%E8%A6%8F%E5%88%86%E5%B8%83%E3%81%8B%E3%82%89%E3%82%B5%E3%83%B3%E3%83%97%E3%83%AB%E3%82%92%E6%8A%BD%E5%87%BA%E3%81%99%E3%82%8B"></a>
</h3>
<p>最後に説明する関数は <code>rnorm</code> で、正規分布からランダムな
サンプルを抽出します。 平均 および 100、標準偏差 1 および 5 の 2
つの正規分布 (<em>N(0, 1)</em> および <em>N(100, 5)</em> と表記)
を以下に示します。</p>
<figure style="text-align: center"><img src="fig/23-starting-with-r-rendered-unnamed-chunk-61-1.png" alt="Two normal distributions: *N(0, 1)* on the left and *N(100, 5)* on the right." class="figure mx-auto d-block"><figcaption>
Two normal distributions: <em>N(0, 1)</em> on the left and <em>N(100,
5)</em> on the right.
</figcaption></figure><p>3 つの引数「n」、「mean」、「sd」は、サンプル
のサイズと、正規分布のパラメーター、つまり平均
とその標準偏差を定義します。 後者のデフォルトは 0 と 1 です。</p>
<div class="codewrapper sourceCode" id="cb173">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">rnorm</span><span class="op">(</span><span class="fl">5</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1]  0.69641761  0.05351568 -1.31028350 -2.12306606 -0.20807859</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb175">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">rnorm</span><span class="op">(</span><span class="fl">5</span>, <span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1]  1.3744268 -0.1164714  2.8344472  1.3690969  3.6510983</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb177">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">rnorm</span><span class="op">(</span><span class="fl">5</span>, <span class="fl">100</span>, <span class="fl">5</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 106.45636  96.87448  95.62427 100.71678 107.12595</code></pre>
</div>
<p>スクリプトの書き方と
のデータ構造の基本を学習したので、より大きなデータの操作を開始する準備が整い、データ
フレームについて します。</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">まとめ<a class="anchor" aria-label="アンカー" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>Rと対話する方法</li>
</ul>
</div>
</div>
</div>
</div>
</section></section><section id="aio-25-starting-with-data"><p>Content from <a href="25-starting-with-data.html">データから始める</a></p>
<hr>
<p>最終更新日：2024-09-08 |

        <a href="https://github.com/carpentries-incubator/bioc-intro/edit/main/episodes/25-starting-with-data.Rmd" class="external-link">ページの編集 <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="回答を全て表示する " data-collapse="回答を全て折りたたむ "> 回答を全て表示する <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">概要</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">質問</h3>
<ul>
<li>Rによる最初のデータ分析</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">目的</h3>
<ul>
<li>
<code>data.frame</code> が何なのか説明してみましょう。</li>
<li>.csv ファイルからデータ
フレームに外部データを読み込みましょう。</li>
<li>データフレームの内容を要約してみましょう。</li>
<li>ファクターとは何か？</li>
<li>string と factor を変換してみましょう。</li>
<li>factor の並び替えとリネームを行ってみましょう。</li>
<li>日付をフォーマットしてみましょう。</li>
<li>データをエクスポートして保存してみましょう。</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<blockquote>
<p>このエピソードは、Data Carpentriesの_Data Analysis and Visualisation
in R for Ecologists_レッスンに基づいています。</p>
</blockquote>
<section><h2 class="section-heading" id="遺伝子発現データのプレゼンテーション">遺伝子発現データのプレゼンテーション<a class="anchor" aria-label="アンカー" href="#%E9%81%BA%E4%BC%9D%E5%AD%90%E7%99%BA%E7%8F%BE%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E3%83%97%E3%83%AC%E3%82%BC%E3%83%B3%E3%83%86%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3"></a>
<a class="anchor" aria-label="anchor" href="#%E9%81%BA%E4%BC%9D%E5%AD%90%E7%99%BA%E7%8F%BE%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E3%83%97%E3%83%AC%E3%82%BC%E3%83%B3%E3%83%86%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3"></a>
</h2>
<hr class="half-width">
<p>Blackmore <em>et al.</em> (2017)](<a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC5544260/" class="external-link uri">https://www.ncbi.nlm.nih.gov/pmc/articles/PMC5544260/</a>),
<em>The effect of upper-respiratory infection on transcriptomic changes
in CNS</em> によって発表されたデータの一部を使用する予定である。
研究の目的は、 上部呼吸器感染症が、感染後の小脳と脊髄で
起こるRNA転写の変化に及ぼす影響を調べることであった。
性別を一致させた8匹の 週齢のC57BL/6マウスに、生理食塩水または
鼻腔内経路でインフルエンザAを接種し、0日目
（非感染）、4日目、8日目に小脳と
脊髄組織におけるトランスクリプトーム変化をRNA-seqで評価した。</p>
<p>データセットは、カンマ区切りの値（CSV）ファイルとして保存される。
各行 は1つのRNA発現測定の情報を持ち、最初の11列 はそれを表している：</p>
<table class="table">
<colgroup>
<col width="9%">
<col width="90%">
</colgroup>
<thead><tr>
<th>コラム</th>
<th>説明</th>
</tr></thead>
<tbody>
<tr>
<td>遺伝子</td>
<td>測定された遺伝子名</td>
</tr>
<tr>
<td>サンプル</td>
<td>遺伝子発現を測定したサンプル名</td>
</tr>
<tr>
<td>表現</td>
<td>遺伝子発現の値</td>
</tr>
<tr>
<td>有機体</td>
<td>生物／種 - ここではすべてのデータはマウスに由来する</td>
</tr>
<tr>
<td>年齢</td>
<td>マウスの年齢（ここではすべてのマウスが8週齢であった）</td>
</tr>
<tr>
<td>セックス</td>
<td>マウスの性別</td>
</tr>
<tr>
<td>感染症</td>
<td>マウスの感染状態、すなわちA型インフルエンザに感染しているか、感染していないか。</td>
</tr>
<tr>
<td>緊張</td>
<td>インフルエンザA型。</td>
</tr>
<tr>
<td>時間</td>
<td>感染期間（日単位）。</td>
</tr>
<tr>
<td>組織</td>
<td>遺伝子発現実験に使用した組織、すなわち小脳または脊髄。</td>
</tr>
<tr>
<td>マウス</td>
<td>マウス固有の識別子。</td>
</tr>
</tbody>
</table>
<p>R関数の<code>download.file()</code>を使って遺伝子発現データを含む
CSVファイルをダウンロードし、 <code>read.csv()</code>
を使ってCSVファイルの内容を
<code>data.frame</code>クラスのオブジェクトとしてメモリにロードする。
download.file<code>コマンドの内部では、 の最初のエントリーは、ソースURLの文字列である。 このソースURL はGitHubリポジトリからCSVファイルをダウンロードします。  、カンマ（</code>“data/rnaseq.csv”<code>）の後のテキストは、 、ローカルマシン上のファイルの保存先です。 あなたのマシンに</code>“data”<code>というフォルダを用意し、そこにファイルをダウンロードする必要があります。 そこで、このコマンドは リモートファイルをダウンロードし、</code>“rnaseq.csv”<code>という名前を付けて、</code>“data”`
という名前の フォルダに追加する。</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">download.file</span><span class="op">(</span>url <span class="op">=</span> <span class="st">"https://github.com/carpentries-incubator/bioc-intro/raw/main/episodes/data/rnaseq.csv"</span>,</span>
<span>              destfile <span class="op">=</span> <span class="st">"data/rnaseq.csv"</span><span class="op">)</span></span></code></pre>
</div>
<p>これでデータをロードする準備ができた：</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rna</span> <span class="op">&lt;-</span> <span class="fu">read.csv</span><span class="op">(</span><span class="st">"data/rnaseq.csv"</span><span class="op">)</span></span></code></pre>
</div>
<p>、代入は何も表示しないからだ。
、データがロードされたことを確認したい場合は、
、その名前をタイプすることでデータフレームの中身を見ることができる：</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">RNA</span></span></code></pre>
</div>
<p>うわぁ…。 多くのアウトプットがあった。 少なくとも、 。 関数
<code>head()</code> を使って、このデータ・フレーム
の先頭（最初の6行）をチェックしてみよう：</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">head</span><span class="op">(</span><span class="va">rna</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>     gene     sample expression     organism age    sex  infection  strain time
1     Asl GSM2545336       1170 Mus musculus   8 Female InfluenzaA C57BL/6    8
2    Apod GSM2545336      36194 Mus musculus   8 Female InfluenzaA C57BL/6    8
3 Cyp2d22 GSM2545336       4060 Mus musculus   8 Female InfluenzaA C57BL/6    8
4    Klk6 GSM2545336        287 Mus musculus   8 Female InfluenzaA C57BL/6    8
5   Fcrls GSM2545336         85 Mus musculus   8 Female InfluenzaA C57BL/6    8
6  Slc2a4 GSM2545336        782 Mus musculus   8 Female InfluenzaA C57BL/6    8
      tissue mouse ENTREZID
1 Cerebellum    14   109900
2 Cerebellum    14    11815
3 Cerebellum    14    56448
4 Cerebellum    14    19144
5 Cerebellum    14    80891
6 Cerebellum    14    20528
                                                                       product
1                               argininosuccinate lyase, transcript variant X1
2                                       apolipoprotein D, transcript variant 3
3 cytochrome P450, family 2, subfamily d, polypeptide 22, transcript variant 2
4                         kallikrein related-peptidase 6, transcript variant 2
5                Fc receptor-like S, scavenger receptor, transcript variant X1
6          solute carrier family 2 (facilitated glucose transporter), member 4
     ensembl_gene_id external_synonym chromosome_name   gene_biotype
1 ENSMUSG00000025533    2510006M18Rik               5 protein_coding
2 ENSMUSG00000022548             &lt;NA&gt;              16 protein_coding
3 ENSMUSG00000061740             2D22              15 protein_coding
4 ENSMUSG00000050063             Bssp               7 protein_coding
5 ENSMUSG00000015852    2810439C17Rik               3 protein_coding
6 ENSMUSG00000018566           Glut-4              11 protein_coding
                            phenotype_description
1           abnormal circulating amino acid level
2                      abnormal lipid homeostasis
3                        abnormal skin morphology
4                         abnormal cytokine level
5 decreased CD8-positive alpha-beta T cell number
6              abnormal circulating glucose level
  hsapiens_homolog_associated_gene_name
1                                   ASL
2                                  APOD
3                                CYP2D6
4                                  KLK6
5                                 FCRL2
6                                SLC2A4</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##</span></span>
<span><span class="co">## View(rna)も試してみる。</span></span></code></pre>
</div>
<p><strong>注</strong>*。</p>
<p>read.csv()<code>は、フィールドがカンマで区切られていると仮定しているが、 いくつかの国では、カンマは小数の区切り文字として使用され、 セミコロン（;）はフィールドの区切り文字として使用される。 Rでこの種のファイルを 、</code>read.csv2()<code>関数を使うことができる。</code>read.csv()<code>と全く同じ動作をするが、 小数とフィールドのセパレーターに異なるパラメーターを使用する。 別の フォーマットを使用している場合は、ユーザーが両方指定することができます。 詳しくは、</code>read.csv()<code>のヘルプを</code>?read.csv<code>と入力して確認してください。 また、</code>read.delim()<code>関数があり、タブ区切りのデータファイルを読み込むことができる。  重要なことは、これらの関数はすべて、 メインの</code>read.table()<code>関数に異なる引数を指定するためのラッパー関数であるということです。  そのため、 上のデータは、</code>read.table()<code>、区切りの引数を</code>,`
にしてロードすることもできた。 コードは以下の通り：</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rna</span> <span class="op">&lt;-</span> <span class="fu">read.table</span><span class="op">(</span>file <span class="op">=</span> <span class="st">"data/rnaseq.csv"</span>,</span>
<span>                  sep <span class="op">=</span> <span class="st">","</span>,</span>
<span>                  header <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre>
</div>
<p>デフォルトでは <code>read.table()</code> の header 引数は FALSE
に設定されているので、 のヘッダーを読むためには header 引数を TRUE
に設定しなければならない。</p>
</section><section><h2 class="section-heading" id="データフレームとは">データフレームとは？<a class="anchor" aria-label="アンカー" href="#%E3%83%87%E3%83%BC%E3%82%BF%E3%83%95%E3%83%AC%E3%83%BC%E3%83%A0%E3%81%A8%E3%81%AF"></a>
<a class="anchor" aria-label="anchor" href="#%E3%83%87%E3%83%BC%E3%82%BF%E3%83%95%E3%83%AC%E3%83%BC%E3%83%A0%E3%81%A8%E3%81%AF"></a>
</h2>
<hr class="half-width">
<p>データ・フレームは、ほとんどの表データ、
、統計やプロットに使われる_事実上の_データ構造である。</p>
<p>データフレームは手作業で作成することもできますが、最も一般的なのは、関数
<code>read.csv()</code> や <code>read.table()</code> によって生成される
データフレームです。</p>
<p>データフレームとは、
、列がすべて同じ長さのベクトルである表の形式でデータを表現したものである。
、列はベクトルであるため、各列は1種類のデータ
（文字、整数、因子など）を含まなければならない。 例えば、 、数値、文字、
論理ベクトルからなるデータフレームを示す図である。</p>
<figure><img src="./fig/data-frame.svg" class="figure mx-auto d-block"></figure><p>str()`という関数で ：</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">str</span><span class="op">(</span><span class="va">rna</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>'data.frame':	32428 obs. of  19 variables:
 $ gene                                 : chr  "Asl" "Apod" "Cyp2d22" "Klk6" ...
 $ sample                               : chr  "GSM2545336" "GSM2545336" "GSM2545336" "GSM2545336" ...
 $ expression                           : int  1170 36194 4060 287 85 782 1619 288 43217 1071 ...
 $ organism                             : chr  "Mus musculus" "Mus musculus" "Mus musculus" "Mus musculus" ...
 $ age                                  : int  8 8 8 8 8 8 8 8 8 8 ...
 $ sex                                  : chr  "Female" "Female" "Female" "Female" ...
 $ infection                            : chr  "InfluenzaA" "InfluenzaA" "InfluenzaA" "InfluenzaA" ...
 $ strain                               : chr  "C57BL/6" "C57BL/6" "C57BL/6" "C57BL/6" ...
 $ time                                 : int  8 8 8 8 8 8 8 8 8 8 ...
 $ tissue                               : chr  "Cerebellum" "Cerebellum" "Cerebellum" "Cerebellum" ...
 $ mouse                                : int  14 14 14 14 14 14 14 14 14 14 ...
 $ ENTREZID                             : int  109900 11815 56448 19144 80891 20528 97827 118454 18823 14696 ...
 $ product                              : chr  "argininosuccinate lyase, transcript variant X1" "apolipoprotein D, transcript variant 3" "cytochrome P450, family 2, subfamily d, polypeptide 22, transcript variant 2" "kallikrein related-peptidase 6, transcript variant 2" ...
 $ ensembl_gene_id                      : chr  "ENSMUSG00000025533" "ENSMUSG00000022548" "ENSMUSG00000061740" "ENSMUSG00000050063" ...
 $ external_synonym                     : chr  "2510006M18Rik" NA "2D22" "Bssp" ...
 $ chromosome_name                      : chr  "5" "16" "15" "7" ...
 $ gene_biotype                         : chr  "protein_coding" "protein_coding" "protein_coding" "protein_coding" ...
 $ phenotype_description                : chr  "abnormal circulating amino acid level" "abnormal lipid homeostasis" "abnormal skin morphology" "abnormal cytokine level" ...
 $ hsapiens_homolog_associated_gene_name: chr  "ASL" "APOD" "CYP2D6" "KLK6" ...</code></pre>
</div>
</section><section><h2 class="section-heading" id="data-frame-オブジェクトの検査">data.frame` オブジェクトの検査<a class="anchor" aria-label="アンカー" href="#data.frame-%E3%82%AA%E3%83%96%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%AE%E6%A4%9C%E6%9F%BB"></a>
<a class="anchor" aria-label="anchor" href="#data-frame-%E3%82%AA%E3%83%96%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%AE%E6%A4%9C%E6%9F%BB"></a>
</h2>
<hr class="half-width">
<p>関数 <code>head()</code> と <code>str()</code> が、
データフレームの内容と構造をチェックするのに便利であることは、すでに説明した。
以下は、 データの内容／構造を知るための、 非網羅的な機能のリストである。
試してみよう！</p>
<p>**サイズ</p>
<ul>
<li>dim(rna)` - 行数を最初の 要素とし、列数を2番目の要素（オブジェクトの
<strong>dim</strong>ensions ）とするベクトルを返す。</li>
<li>nrow(rna)` - 行の数を返す。</li>
<li>ncol(rna)` - 列数を返す。</li>
</ul>
<p>**内容</p>
<ul>
<li>head(rna)` - 最初の6行を表示する。</li>
<li>tail(rna)` - 最後の6行を表示する。</li>
</ul>
<p><strong>名前</strong>：</p>
<ul>
<li>names(rna)<code>- 列名を返す（</code>data.frame<code>オブジェクトの</code>colnames()`
と同義）。</li>
<li>rownames(rna)` - 行の名前を返す。</li>
</ul>
<p><strong>要約</strong>：</p>
<ul>
<li>str(rna)` - オブジェクトの構造と、
クラス、各カラムの長さと内容に関する情報。</li>
<li>
<code>summary(rna)</code> - 各カラムの要約統計量。</li>
</ul>
<p>注：これらの関数のほとんどは
“ジェネリック”であり、<code>data.frame</code>以外の
オブジェクトにも使用できます。</p>
<div id="チャレンジだ" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジだ" class="callout-inner">
<h3 class="callout-title">チャレンジだ：<a class="anchor" aria-label="アンカー" href="#%E3%83%81%E3%83%A3%E3%83%AC%E3%83%B3%E3%82%B8%E3%81%A0"></a>
</h3>
<div class="callout-content">
<p>str(rna)`の出力に基づいて、以下の の質問に答えられるか？</p>
<ul>
<li>オブジェクト <code>rna</code> のクラスは何ですか？</li>
<li>このオブジェクトにはいくつの行といくつの列がありますか？</li>
</ul>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">
  ソリューション
  </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<ul>
<li>クラス: データ・フレーム</li>
<li>行数：66465、列数：11：11</li>
</ul>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="データフレームのインデックス化とサブセット化">データフレームのインデックス化とサブセット化<a class="anchor" aria-label="アンカー" href="#%E3%83%87%E3%83%BC%E3%82%BF%E3%83%95%E3%83%AC%E3%83%BC%E3%83%A0%E3%81%AE%E3%82%A4%E3%83%B3%E3%83%87%E3%83%83%E3%82%AF%E3%82%B9%E5%8C%96%E3%81%A8%E3%82%B5%E3%83%96%E3%82%BB%E3%83%83%E3%83%88%E5%8C%96"></a>
<a class="anchor" aria-label="anchor" href="#%E3%83%87%E3%83%BC%E3%82%BF%E3%83%95%E3%83%AC%E3%83%BC%E3%83%A0%E3%81%AE%E3%82%A4%E3%83%B3%E3%83%87%E3%83%83%E3%82%AF%E3%82%B9%E5%8C%96%E3%81%A8%E3%82%B5%E3%83%96%E3%82%BB%E3%83%83%E3%83%88%E5%8C%96"></a>
</h2>
<hr class="half-width">
<p>rna`データフレームには行と列がある（2次元ある）。
、そこから特定のデータを抽出したい場合は、
「座標」を指定する必要がある。 行番号が最初に来て、 列番号がそれに続く。
しかし、これらの
座標を指定する方法が異なれば、異なるクラスの結果が得られることに注意されたい。</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># データフレームの1列目の最初の要素（ベクトルとして）</span></span>
<span><span class="va">rna</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">]</span></span>
<span><span class="co"># 6列目の最初の要素（ベクトルとして）</span></span>
<span><span class="va">rna</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">6</span><span class="op">]</span></span>
<span><span class="co"># データフレームの1列目の要素（ベクトルとして）</span></span>
<span><span class="va">rna</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span></span>
<span><span class="co"># データフレームの1列目の要素（data.フレームとして）</span></span>
<span><span class="va">rna</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="co"># 7列目の最初の3要素（ベクトルとして）</span></span>
<span><span class="va">rna</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="fl">7</span><span class="op">]</span></span>
<span><span class="co"># データフレームの3行目（data.frameとして）</span></span>
<span><span class="va">rna</span><span class="op">[</span><span class="fl">3</span>, <span class="op">]</span></span>
<span><span class="co"># head_rna &lt;- head(rna)</span></span>
<span><span class="va">head_rna</span> <span class="op">&lt;-</span> <span class="va">rna</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span>, <span class="op">]</span></span>
<span><span class="va">head_rna</span></span></code></pre>
</div>
<p>1:10<code>と</code>10:1`は の例で、
の増加または減少の順序で整数の数値ベクトルを作成する特別な関数である。
<a href="mailto:%E8%A9%B3%E3%81%97%E3%81%8F%E3%81%AF@ref" class="email">詳しくは@ref</a>(sec:genvec)を参照のこと。</p>
<p>また、「<code>-</code>」記号を使ってデータフレームの特定のインデックスを除外することもできる：</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rna</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span> <span class="co">## 最初の列を除いたデータフレーム全体</span></span>
<span><span class="va">rna</span><span class="op">[</span><span class="op">-</span><span class="fu">c</span><span class="op">(</span><span class="fl">7</span><span class="op">:</span><span class="fl">66465</span><span class="op">)</span>, <span class="op">]</span> <span class="co">## head(rna)と等価</span></span></code></pre>
</div>
<p>データフレームは、インデックス（前に示したように）や
、列名を直接呼び出してサブセットすることもできる：</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode r" tabindex="0"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a>rna[<span class="st">"gene"</span>] <span class="co"># Result is a data.frame</span></span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a>rna[, <span class="st">"gene"</span>] <span class="co"># Result is a vector</span></span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a>rna[[<span class="st">"gene"</span>]].     <span class="co"># 結果はベクトル</span></span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a>rna<span class="sc">$</span>gene          <span class="co"># 結果はベクトル</span></span></code></pre>
</div>
<p>RStudio では、オートコンプリート機能を使用して、列の完全で
正しい名前を取得できます。</p>
<div id="チャレンジ" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ" class="callout-inner">
<h3 class="callout-title">チャレンジ<a class="anchor" aria-label="アンカー" href="#%E3%83%81%E3%83%A3%E3%83%AC%E3%83%B3%E3%82%B8"></a>
</h3>
<div class="callout-content">
<ol style="list-style-type: decimal">
<li><p>データセット <code>rna</code> の 行 200 番目のデータのみを含む
<code>data.frame</code> (<code>rna_200</code>) を作成する。</p></li>
<li><p>nrow()<code>が</code>data.frame`の行数を示していることに気づいただろうか？</p></li>
</ol>
<ul>
<li><p>この数字を使って、最初の
<code>rna</code>データフレームの最後の行だけを取り出す。</p></li>
<li><p>tail()`を使った最後の行と比較し、
、期待に応えていることを確認する。</p></li>
<li><p>行番号の代わりに <code>nrow()</code>
を使って最後の行を取り出す。</p></li>
<li><p>最後の行から新しいデータフレーム（<code>rna_last</code>）を作成する。</p></li>
</ul>
<ol start="3" style="list-style-type: decimal">
<li><p><code>rna</code> データフレームの中央にある行を抽出するには
<code>nrow()</code> を使用する。 この行の内容をオブジェクト
<code>rna_middle</code> に格納する。</p></li>
<li><p>nrow()<code>と上記の</code>-<code>表記を組み合わせると、rnaデータセットの1行目から6行目までの      行だけを保持し、</code>head(rna)`の
挙動を再現することができる。</p></li>
</ol>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2">
  ソリューション
  </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## 1.</span></span>
<span><span class="va">rna_200</span> <span class="op">&lt;-</span> <span class="va">rna</span><span class="op">[</span><span class="fl">200</span>, <span class="op">]</span></span>
<span><span class="co">## 2.</span></span>
<span><span class="co">## Saving `n_rows` to improve readability and reduce duplication</span></span>
<span><span class="va">n_rows</span> <span class="op">&lt;-</span> <span class="fu">nrow</span><span class="op">(</span><span class="va">rna</span><span class="op">)</span></span>
<span><span class="va">rna_last</span> <span class="op">&lt;-</span> <span class="va">rna</span><span class="op">[</span><span class="va">n_rows</span>, <span class="op">]</span></span>
<span><span class="co">## 3.</span></span>
<span><span class="va">rna_middle</span> <span class="op">&lt;-</span> <span class="va">rna</span><span class="op">[</span><span class="va">n_rows</span> <span class="op">/</span> <span class="fl">2</span>, <span class="op">]</span></span>
<span><span class="co">## 4.</span></span>
<span><span class="va">rna_head</span> <span class="op">&lt;-</span> <span class="va">rna</span><span class="op">[</span><span class="op">-</span><span class="op">(</span><span class="fl">7</span><span class="op">:</span><span class="va">n_rows</span><span class="op">)</span>, <span class="op">]</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="要因">要因<a class="anchor" aria-label="アンカー" href="#%E8%A6%81%E5%9B%A0"></a>
<a class="anchor" aria-label="anchor" href="#%E8%A6%81%E5%9B%A0"></a>
</h2>
<hr class="half-width">
<p>要因は<strong>カテゴリーデータ</strong>を表す。 これらは、
ラベルに関連付けられた整数として格納され、順序付けされたものであっても、順序付けされていないものであってもよい。
因子は文字ベクトルのように見える（そしてしばしば振舞う）が、
、実際にはRでは整数ベクトルとして扱われる。そのため、文字列として扱う場合は非常に
注意する必要がある。</p>
<p>いったん作成されたファクターは、あらかじめ定義された値のセット（
、_レベル_として知られている）しか含むことができない。
デフォルトでは、Rは常にレベルをアルファベット順（ ）でソートする。
例えば、2つのレベルを持つ因子があるとする：</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">セックス</span> <span class="op">&lt;-</span> <span class="fu">factor</span><span class="op">(</span><span class="fu">c</span><span class="op">(</span><span class="st">"male"</span>, <span class="st">"female"</span>, <span class="st">"female"</span>, <span class="st">"male"</span>, <span class="st">"female"</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<p>Rは<code>1</code>をレベル<code>"female"</code>に、<code>2</code>をレベル
<code>"male"</code>に割り当てる（このベクトルの最初の要素
が<code>"male"</code>であるにもかかわらず、<code>f</code>が<code>m</code>の前に来るため）。
これは、 <code>levels()</code>
という関数を使うことで見ることができ、<code>nlevels()</code>
を使えばレベル数を知ることができる：</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">levels</span><span class="op">(</span><span class="va">sex</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">エラー<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in eval(expr, envir, enclos): object 'sex' not found</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">nlevels</span><span class="op">(</span><span class="va">sex</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">エラー<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in eval(expr, envir, enclos): object 'sex' not found</code></pre>
</div>
<p>要因の順番が重要でない場合もあるが、 、意味がある（例えば、“low”、
“medium”、“high”）、視覚化が向上する、または特定のタイプの分析で必要である（
）ため、順番を指定したい場合もある。 ここで、
<code>sex</code>ベクトルでレベルを並べ替える一つの方法は次のようになる：</p>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sex</span> <span class="co">## current order</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">エラー<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in eval(expr, envir, enclos): object 'sex' not found</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sex</span> <span class="op">&lt;-</span> <span class="fu">factor</span><span class="op">(</span><span class="va">sex</span>, levels <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="st">"male"</span>, <span class="st">"female"</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">エラー<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in eval(expr, envir, enclos): object 'sex' not found</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sex</span> <span class="co">## after re-ordering</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">エラー<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in eval(expr, envir, enclos): object 'sex' not found</code></pre>
</div>
<p>Rの記憶では、これらの因子は整数(1, 2, 3)、 で表現されるが、因子は自己
を記述するため、整数よりも情報量が多い。<code>"女性"</code>、<code>"男性"</code>は<code>1</code>、
<code>2</code>よりも説明的である。 どちらが “男性”ですか？<br>
の整数データだけではわからないだろう。
一方、ファクターはこの情報を内蔵している。
特に、レベルが多い場合（例のデータセットの
遺伝子バイオタイプのような）に便利である。</p>
<p>データが因子として格納されているとき、各因子レベルによって表現されるオブザベーションの数
を素早く見るために、 <code>plot()</code> 関数を使うことができます。
データ中の男性 、女性の数を見てみよう。</p>
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">プロット</span><span class="op">(</span><span class="va">性</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">エラー<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in プロット(性): could not find function "プロット"</code></pre>
</div>
<div class="section level3">
<h3 id="文字への変換">文字への変換<a class="anchor" aria-label="anchor" href="#%E6%96%87%E5%AD%97%E3%81%B8%E3%81%AE%E5%A4%89%E6%8F%9B"></a>
</h3>
<p>因数を文字ベクトルに変換する必要がある場合は、
<code>as.character(x)</code>.</p>
<div class="codewrapper sourceCode" id="cb27">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">as.character</span><span class="op">(</span><span class="va">性</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">エラー<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in eval(expr, envir, enclos): object '性' not found</code></pre>
</div>
<!-- ### Numeric factors -->
<!-- Converting factors where the levels appear as numbers (such as -->
<!-- concentration levels, or years) to a numeric vector is a little -->
<!-- trickier. The `as.numeric()` function returns the index values of the -->
<!-- factor, not its levels, so it will result in an entirely new (and -->
<!-- unwanted in this case) set of numbers.  One method to avoid this is to -->
<!-- convert factors to characters, and then to numbers.  Another method is -->
<!-- to use the `levels()` function. Compare: -->
<!-- ```{r} -->
<!-- year_fct <- factor(c(1990, 1983, 1977, 1998, 1990)) -->
<!-- as.numeric(year_fct)  ## Wrong! And there is no warning... -->
<!-- as.numeric(as.character(year_fct)) ## Works... -->
<!-- as.numeric(levels(year_fct))[year_fct] ## The recommended way. -->
<!-- ```

<!-- Notice that in the `levels()` approach, three important steps occur: -->
<!-- * We obtain all the factor levels using `levels(year_fct)` -->
<!-- * We convert these levels to numeric values using `as.numeric(levels(year_fct))` -->
<!-- * We then access these numeric values using the underlying integers of the -->
<!--   vector `year_fct` inside the square brackets -->
</div>
<div class="section level3">
<h3 id="要因の名称変更">要因の名称変更<a class="anchor" aria-label="anchor" href="#%E8%A6%81%E5%9B%A0%E3%81%AE%E5%90%8D%E7%A7%B0%E5%A4%89%E6%9B%B4"></a>
</h3>
<p>これらのファクターの名前を変えたい場合は、 ：</p>
<div class="codewrapper sourceCode" id="cb29">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">levels</span><span class="op">(</span><span class="va">sex</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">エラー<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in eval(expr, envir, enclos): object 'sex' not found</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb31">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">levels</span><span class="op">(</span><span class="va">sex</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="st">"M"</span>, <span class="st">"F"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">エラー<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error: object 'sex' not found</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb33">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sex</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">エラー<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in eval(expr, envir, enclos): object 'sex' not found</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb35">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">plot</span><span class="op">(</span><span class="va">sex</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">エラー<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in eval(expr, envir, enclos): object 'sex' not found</code></pre>
</div>
<div id="チャレンジだ-1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジだ-1" class="callout-inner">
<h3 class="callout-title">チャレンジだ：<a class="anchor" aria-label="アンカー" href="#%E3%83%81%E3%83%A3%E3%83%AC%E3%83%B3%E3%82%B8%E3%81%A0-1"></a>
</h3>
<div class="callout-content">
<ul>
<li>F “と”M “の名前をそれぞれ”Female “と”Male “に変更する。</li>
</ul>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3">
  ソリューション
  </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" aria-labelledby="headingSolution3" data-bs-parent="#accordionSolution3">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb37">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">levels</span><span class="op">(</span><span class="va">sex</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">エラー<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in eval(expr, envir, enclos): object 'sex' not found</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb39">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">levels</span><span class="op">(</span><span class="va">sex</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="st">"Male"</span>, <span class="st">"Female"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">エラー<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error: object 'sex' not found</code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="チャレンジだ-2" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジだ-2" class="callout-inner">
<h3 class="callout-title">チャレンジだ：<a class="anchor" aria-label="アンカー" href="#%E3%83%81%E3%83%A3%E3%83%AC%E3%83%B3%E3%82%B8%E3%81%A0-2"></a>
</h3>
<div class="callout-content">
<p>read.csv()<code>を使ってデータフレームを作成する方法を見てきましたが、</code>data.frame()<code>関数を使って手作業で作成することもできます。 この手作りの</code>data.frame`にはいくつか間違いがある。
、それを見つけて修正することはできますか？
実験することをためらってはいけない！</p>
<div class="codewrapper sourceCode" id="cb41">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode r" tabindex="0"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" tabindex="-1"></a>animal_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb41-2"><a href="#cb41-2" tabindex="-1"></a>       <span class="at">animal =</span> <span class="fu">c</span>(dog, cat, sea cucumber, sea nurchin),</span>
<span id="cb41-3"><a href="#cb41-3" tabindex="-1"></a>       <span class="at">feel =</span> <span class="fu">c</span>(<span class="st">"furry"</span>, <span class="st">"squishy"</span>, <span class="st">"spiny"</span>),</span>
<span id="cb41-4"><a href="#cb41-4" tabindex="-1"></a>       <span class="at">weight =</span> <span class="fu">c</span>(<span class="dv">45</span>, <span class="dv">8</span> <span class="fl">1.1</span>, <span class="fl">0.8</span>))</span></code></pre>
</div>
</div>
</div>
</div>
<div id="accordionSolution4" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution4" aria-expanded="false" aria-controls="collapseSolution4">
  <h4 class="accordion-header" id="headingSolution4">
  ソリューション
  </h4>
</button>
<div id="collapseSolution4" class="accordion-collapse collapse" aria-labelledby="headingSolution4" data-bs-parent="#accordionSolution4">
<div class="accordion-body">
<ul>
<li>動物の名前の周りに引用符がない</li>
<li>“feel”欄に1つ記入がない（おそらく毛皮の動物の1つ）。</li>
<li>体重欄のコンマが1つ足りない</li>
</ul>
</div>
</div>
</div>
</div>
<div id="チャレンジだ-3" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジだ-3" class="callout-inner">
<h3 class="callout-title">チャレンジだ：<a class="anchor" aria-label="アンカー" href="#%E3%83%81%E3%83%A3%E3%83%AC%E3%83%B3%E3%82%B8%E3%81%A0-3"></a>
</h3>
<div class="callout-content">
<p>次の の例で、各列のクラスを予測できますか？</p>
<p>str(country_climate)`を使って推測をチェックする：</p>
<ul>
<li><p>期待通りですか？ なぜですか？ なぜだ？</p></li>
<li><p>データフレームを作成する際に、最後の 変数の後に
<code>stringsAsFactors = TRUE</code>
を追加してもう一度試してみてください。 今、何が起きているのか？
stringsAsFactors<code>は、</code>read.csv()`を使ってテキストベースの
のスプレッドシートをRに読み込むときにも設定できる。</p></li>
</ul>
<div class="codewrapper sourceCode" id="cb42">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode r" tabindex="0"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" tabindex="-1"></a>country_climate <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb42-2"><a href="#cb42-2" tabindex="-1"></a>       <span class="at">country =</span> <span class="fu">c</span>(<span class="st">"Canada"</span>, <span class="st">"Panama"</span>, <span class="st">"South Africa"</span>, <span class="st">"Australia"</span>),</span>
<span id="cb42-3"><a href="#cb42-3" tabindex="-1"></a>       <span class="at">climate =</span> <span class="fu">c</span>(<span class="st">"cold"</span>, <span class="st">"hot"</span>, <span class="st">"temperate"</span>, <span class="st">"hot/temperate"</span>)、</span>
<span id="cb42-4"><a href="#cb42-4" tabindex="-1"></a>       <span class="at">temperature =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">30</span>, <span class="dv">18</span>, <span class="st">"15"</span>),</span>
<span id="cb42-5"><a href="#cb42-5" tabindex="-1"></a>       <span class="at">northern_hemisphere =</span> <span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="cn">TRUE</span>, <span class="cn">FALSE</span>, <span class="st">"FALSE"</span>),</span>
<span id="cb42-6"><a href="#cb42-6" tabindex="-1"></a>       <span class="at">has_kangaroo =</span> <span class="fu">c</span>(<span class="cn">FALSE</span>, <span class="cn">FALSE</span>, <span class="cn">FALSE</span>, <span class="dv">1</span>)</span>
<span id="cb42-7"><a href="#cb42-7" tabindex="-1"></a>)</span></code></pre>
</div>
</div>
</div>
</div>
<div id="accordionSolution5" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution5" aria-expanded="false" aria-controls="collapseSolution5">
  <h4 class="accordion-header" id="headingSolution5">
  ソリューション
  </h4>
</button>
<div id="collapseSolution5" class="accordion-collapse collapse" aria-labelledby="headingSolution5" data-bs-parent="#accordionSolution5">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb43">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">country_climate</span> <span class="op">&lt;-</span> <span class="fu">data.frame</span><span class="op">(</span></span>
<span>       country <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="st">"Canada"</span>, <span class="st">"Panama"</span>, <span class="st">"South Africa"</span>, <span class="st">"Australia"</span><span class="op">)</span>,</span>
<span>       climate <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="st">"cold"</span>, <span class="st">"hot"</span>, <span class="st">"temperate"</span>, <span class="st">"hot/temperate"</span><span class="op">)</span>,</span>
<span>       temperature <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="fl">10</span>, <span class="fl">30</span>, <span class="fl">18</span>, <span class="st">"15"</span><span class="op">)</span>,</span>
<span>       northern_hemisphere <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="cn">TRUE</span>, <span class="cn">TRUE</span>, <span class="cn">FALSE</span>, <span class="st">"FALSE"</span><span class="op">)</span>,</span>
<span>       has_kangaroo <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="cn">FALSE</span>, <span class="cn">FALSE</span>, <span class="cn">FALSE</span>, <span class="fl">1</span><span class="op">)</span></span>
<span>       <span class="op">)</span></span>
<span><span class="fu">str</span><span class="op">(</span><span class="va">country_climate</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>'data.frame':	4 obs. of  5 variables:
 $ country            : chr  "Canada" "Panama" "South Africa" "Australia"
 $ climate            : chr  "cold" "hot" "temperate" "hot/temperate"
 $ temperature        : chr  "10" "30" "18" "15"
 $ northern_hemisphere: chr  "TRUE" "TRUE" "FALSE" "FALSE"
 $ has_kangaroo       : num  0 0 0 1</code></pre>
</div>
</div>
</div>
</div>
</div>
<p>データ型の自動変換は、時に恵みであり、時に 迷惑である。
その存在を認識し、ルールを学び、Rでインポートするデータ
がデータフレーム内で正しい型であることを再確認すること。
そうでない場合は、
データ入力中に生じたかもしれないミス（例えば、数字しか入っていないはずの列に文字が入っている）を検出するために、
を活用する。</p>
<p>詳しくはRStudio チュートリアルをご覧ください。</p>
</div>
</section><section><h2 class="section-heading" id="マトリックス">マトリックス<a class="anchor" aria-label="アンカー" href="#%E3%83%9E%E3%83%88%E3%83%AA%E3%83%83%E3%82%AF%E3%82%B9"></a>
<a class="anchor" aria-label="anchor" href="#%E3%83%9E%E3%83%88%E3%83%AA%E3%83%83%E3%82%AF%E3%82%B9"></a>
</h2>
<hr class="half-width">
<p>先に進む前に、データ・フレームについて学んだので、
パッケージのインストールを復習し、新しいデータ型、すなわち
<code>matrix</code> について学んでみよう。
data.frame<code>のように、行列は行と 列の2つの次元を持つ。 しかし大きな違いは、</code>行列<code>のすべてのセルは 同じ型でなければならないということである：numeric</code>、<code>character</code>、<code>logical</code>、…
その点で、行列は <code>data.frame</code> よりも <code>vector</code>
に近い。</p>
<p>行列のデフォルトコンストラクタは <code>matrix</code> である。
行列を構成するための の値のベクトルと、行および/または の列数<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>を取る。
下の図（ ）のように、値は列に沿ってソートされる。</p>
<div class="codewrapper sourceCode" id="cb45">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu">matrix</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">9</span>, ncol <span class="op">=</span> <span class="fl">3</span>, nrow <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">m</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>     [,1] [,2] [,3]
[1,]    1    4    7
[2,]    2    5    8
[3,]    3    6    9</code></pre>
</div>
<div id="チャレンジだ-4" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジだ-4" class="callout-inner">
<h3 class="callout-title">チャレンジだ：<a class="anchor" aria-label="アンカー" href="#%E3%83%81%E3%83%A3%E3%83%AC%E3%83%B3%E3%82%B8%E3%81%A0-4"></a>
</h3>
<div class="callout-content">
<p>installed.packages()<code>という関数を使って、 あなたのコンピューターに現在インストールされているすべてのパッケージの情報を含む</code>文字`行列
を作成します。 探検してみよう。</p>
</div>
</div>
</div>
<div id="accordionSolution6" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution6" aria-expanded="false" aria-controls="collapseSolution6">
  <h4 class="accordion-header" id="headingSolution6">
  解決策
  </h4>
</button>
<div id="collapseSolution6" class="accordion-collapse collapse" aria-labelledby="headingSolution6" data-bs-parent="#accordionSolution6">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb47">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##</span></span>
<span><span class="va">ip</span> <span class="op">&lt;-</span> <span class="fu">installed.packages</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu">head</span><span class="op">(</span><span class="va">ip</span><span class="op">)</span></span>
<span><span class="co">## View(ip)</span></span>
<span><span class="co">## パッケージの数</span></span>
<span><span class="fu">nrow</span><span class="op">(</span><span class="va">ip</span><span class="op">)</span></span>
<span><span class="co">## インストールされている全てのパッケージの名前</span></span>
<span><span class="fu">rownames</span><span class="op">(</span><span class="va">ip</span><span class="op">)</span></span>
<span><span class="co">## 各パッケージに関する情報の種類</span></span>
<span><span class="fu">colnames</span><span class="op">(</span><span class="va">ip</span><span class="op">)</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<p>テストデータとして、大規模なランダムデータ行列を作成することはしばしば有用である。
以下の練習問題は、平均0、標準偏差 1の正規分布から無作為に
データを抽出して、そのような行列を作成するものです。これは
<code>rnorm()</code> 関数で行うことができます。</p>
<div id="チャレンジだ-5" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジだ-5" class="callout-inner">
<h3 class="callout-title">チャレンジだ：<a class="anchor" aria-label="アンカー" href="#%E3%83%81%E3%83%A3%E3%83%AC%E3%83%B3%E3%82%B8%E3%81%A0-5"></a>
</h3>
<div class="callout-content">
<p>正規分布データ （平均0、標準偏差1）の次元1000×3の行列を作る。</p>
</div>
</div>
</div>
<div id="accordionSolution7" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution7" aria-expanded="false" aria-controls="collapseSolution7">
  <h4 class="accordion-header" id="headingSolution7">
  ソリューション
  </h4>
</button>
<div id="collapseSolution7" class="accordion-collapse collapse" aria-labelledby="headingSolution7" data-bs-parent="#accordionSolution7">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb48">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">set.seed</span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu">matrix</span><span class="op">(</span><span class="fu">rnorm</span><span class="op">(</span><span class="fl">3000</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="fu">dim</span><span class="op">(</span><span class="va">m</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 1000    3</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb50">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">head</span><span class="op">(</span><span class="va">m</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>            [,1]        [,2]       [,3]
[1,] -0.56047565 -0.99579872 -0.5116037
[2,] -0.23017749 -1.03995504  0.2369379
[3,]  1.55870831 -0.01798024 -0.5415892
[4,]  0.07050839 -0.13217513  1.2192276
[5,]  0.12928774 -2.54934277  0.1741359
[6,]  1.71506499  1.04057346 -0.6152683</code></pre>
</div>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="日付の書式設定">日付の書式設定<a class="anchor" aria-label="アンカー" href="#%E6%97%A5%E4%BB%98%E3%81%AE%E6%9B%B8%E5%BC%8F%E8%A8%AD%E5%AE%9A"></a>
<a class="anchor" aria-label="anchor" href="#%E6%97%A5%E4%BB%98%E3%81%AE%E6%9B%B8%E5%BC%8F%E8%A8%AD%E5%AE%9A"></a>
</h2>
<hr class="half-width">
<p>新人（そしてベテラン！）が抱える最も一般的な問題の1つである。
Rユーザーは、 、日付と時刻の情報を、
適切で分析中に使用可能な変数に変換している。</p>
<div class="section level3">
<h3 id="表計算ソフトの日付に関する注意">表計算ソフトの日付に関する注意<a class="anchor" aria-label="anchor" href="#%E8%A1%A8%E8%A8%88%E7%AE%97%E3%82%BD%E3%83%95%E3%83%88%E3%81%AE%E6%97%A5%E4%BB%98%E3%81%AB%E9%96%A2%E3%81%99%E3%82%8B%E6%B3%A8%E6%84%8F"></a>
</h3>
<p>スプレッドシートの日付は通常、1つの列に格納される。
これが日付を記録する最も自然な方法のように思えるが、実際には
ベストプラクティスではない。 スプレッドシート・アプリケーションは、
一見正しい方法で日付を表示する（人間の観察者には）。しかし、実際に
どのように日付を処理し、保存するかには問題があるかもしれない。
YEAR、MONTH、DAYを別々のカラムに、または
、YEARとDAY-OF-YEARを別々のカラムに保存した方が、
より安全な場合が多い。</p>
<p>LibreOffice、Microsoft Excel、OpenOffice、
Gnumericなどの表計算プログラム。 は、
日付のエンコード方法が異なる（そしてしばしば互換性がない）（同じプログラムであっても、バージョンやオペレーティング
システム間で）。 さらに、エクセルは日付でないものを 日付に変える (<span class="citation">@Zeeberg:2004</span>)ことができる。例えば、MAR1、DEC1、
OCT4のような名前や識別子である。
そのため、全体的に日付フォーマットを避けているのであれば、
、こうした問題を特定しやすくなる。</p>
<p>Data CarpentryレッスンのDates as data
セクションでは、スプレッドシートを使った日付の落とし穴について、さらなる洞察
を提供しています。</p>
<p><strong>lubridate<code>** パッケージの</code>ymd()<code>関数を使用します (**tidyverse</code></strong>
に属します。詳しくは <a href="https://www.tidyverse.org/" class="external-link">こちら</a>)。
. **lubridate<code>**は**tidyverse</code>**のインストールの一部として 。
<strong><code>tidyverse</code></strong>
(<code><a href="https://tidyverse.tidyverse.org" class="external-link">library(tidyverse)</a></code>) をロードすると、コアパッケージ
(ほとんどのデータ分析で使用される パッケージ) がロードされます。
<strong><code>lubridate</code></strong>
しかし、コアTidyverseには属さないので、
<code><a href="https://lubridate.tidyverse.org" class="external-link">library(lubridate)</a></code>で明示的にロードする必要があります。</p>
<p>必要なパッケージをロードすることから始める：</p>
<div class="codewrapper sourceCode" id="cb52">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="st">"lubridate"</span><span class="op">)</span></span></code></pre>
</div>
<p>ymd()<code>は年、月、日を表すベクトルを受け取り、</code>Date<code>ベクトルに変換する。 Date</code>はRが
、日付であると認識するデータのクラスであり、そのように操作することができる。
関数が必要とする引数は柔軟であるが、ベストプラクティスとしては、“YYYY-MM-DD”としてフォーマットされた文字
ベクトルである。</p>
<p>日付オブジェクトを作成し、構造を調べてみよう：</p>
<div class="codewrapper sourceCode" id="cb53">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_date</span> <span class="op">&lt;-</span> <span class="fu">ymd</span><span class="op">(</span><span class="st">"2015-01-01"</span><span class="op">)</span></span>
<span><span class="fu">str</span><span class="op">(</span><span class="va">my_date</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> Date[1:1], format: "2015-01-01"</code></pre>
</div>
<p>では、年、月、日を別々に貼り付けてみよう：</p>
<div class="codewrapper sourceCode" id="cb55">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># sep は各コンポーネントを区切るために使う文字を示す</span></span>
<span><span class="va">my_date</span> <span class="op">&lt;-</span> <span class="fu">ymd</span><span class="op">(</span><span class="fu">paste</span><span class="op">(</span><span class="st">"2015"</span>, <span class="st">"1"</span>, <span class="st">"1"</span>, sep <span class="op">=</span> <span class="st">"-"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">str</span><span class="op">(</span><span class="va">my_date</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> Date[1:1], format: "2015-01-01"</code></pre>
</div>
<p>それでは、典型的な日付操作 のパイプラインに慣れておこう。
以下の小さなデータには、異なる <code>year</code>、
<code>month</code>、<code>day</code> 列に日付が格納されている。</p>
<div class="codewrapper sourceCode" id="cb57">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">data.frame</span><span class="op">(</span>year <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="fl">1996</span>, <span class="fl">1992</span>, <span class="fl">1987</span>, <span class="fl">1986</span>, <span class="fl">2000</span>, <span class="fl">1990</span>, <span class="fl">2002</span>, <span class="fl">1994</span>, <span class="fl">1997</span>, <span class="fl">1985</span><span class="op">)</span>,</span>
<span>                month <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">10</span>, <span class="fl">1</span>, <span class="fl">8</span>, <span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">5</span>, <span class="fl">5</span><span class="op">)</span>,</span>
<span>                day <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="fl">24</span>, <span class="fl">8</span>, <span class="fl">1</span>, <span class="fl">5</span>, <span class="fl">8</span>, <span class="fl">17</span>, <span class="fl">13</span>, <span class="fl">10</span>, <span class="fl">11</span>, <span class="fl">24</span><span class="op">)</span>,</span>
<span>                value <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="fl">4</span>, <span class="fl">5</span>, <span class="fl">1</span>, <span class="fl">9</span>, <span class="fl">3</span>, <span class="fl">8</span>, <span class="fl">10</span>, <span class="fl">2</span>, <span class="fl">6</span>, <span class="fl">7</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">エラー<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in data.frame(year = c(1996, 1992, 1987, 1986, 2000, 1990, 2002, : arguments imply differing number of rows: 10, 9</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb59">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">エラー<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in eval(expr, envir, enclos): object 'x' not found</code></pre>
</div>
<p>次に、この関数を <code>x</code> データセットに適用する。
まず、<code>paste()</code> を使って、<code>x</code> の
<code>year</code>、<code>month</code>、<code>day</code> 列から
の文字ベクトルを作る：</p>
<div class="codewrapper sourceCode" id="cb61">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">paste</span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">year</span>, <span class="va">x</span><span class="op">$</span><span class="va">month</span>, <span class="va">x</span><span class="op">$</span><span class="va">day</span>, sep <span class="op">=</span> <span class="st">"-"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">エラー<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in eval(expr, envir, enclos): object 'x' not found</code></pre>
</div>
<p>この文字ベクトルは <code>ymd()</code>
の引数として使うことができる：</p>
<div class="codewrapper sourceCode" id="cb63">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ymd</span><span class="op">(</span><span class="fu">paste</span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">year</span>, <span class="va">x</span><span class="op">$</span><span class="va">month</span>, <span class="va">x</span><span class="op">$</span><span class="va">day</span>, sep <span class="op">=</span> <span class="st">"-"</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">エラー<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in eval(expr, envir, enclos): object 'x' not found</code></pre>
</div>
<p>出来上がった <code>Date</code> ベクトルは <code>x</code> に
<code>date</code> という新しいカラムとして追加することができる：</p>
<div class="codewrapper sourceCode" id="cb65">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span><span class="op">$</span><span class="va">date</span> <span class="op">&lt;-</span> <span class="fu">ymd</span><span class="op">(</span><span class="fu">paste</span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">year</span>, <span class="va">x</span><span class="op">$</span><span class="va">month</span>, <span class="va">x</span><span class="op">$</span><span class="va">day</span>, sep <span class="op">=</span> <span class="st">"-"</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">エラー<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in eval(expr, envir, enclos): object 'x' not found</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb67">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">str</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="co"># '日付'をクラスとする新しいカラムに注目。</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">エラー<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in eval(expr, envir, enclos): object 'x' not found</code></pre>
</div>
<p>すべてが正しく機能していることを確認しよう。
新しいカラムを検査する一つの方法は、<code>summary()</code>を使うことである：</p>
<div class="codewrapper sourceCode" id="cb69">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">summary</span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">date</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">エラー<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in eval(expr, envir, enclos): object 'x' not found</code></pre>
</div>
<p>ymd()<code>は、年、月、日を の順番で持つことを期待している。 例えば、日、月、年があれば、</code>dmy()`
が必要になる。</p>
<div class="codewrapper sourceCode" id="cb71">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">dmy</span><span class="op">(</span><span class="fu">paste</span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">day</span>, <span class="va">x</span><span class="op">$</span><span class="va">month</span>, <span class="va">x</span><span class="op">$</span><span class="va">year</span>, sep <span class="op">=</span> <span class="st">"-"</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">エラー<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in eval(expr, envir, enclos): object 'x' not found</code></pre>
</div>
<p>lubdridate`は、あらゆる日付のバリエーションに対応する多くの関数を持っている。</p>
</div>
</section><section><h2 class="section-heading" id="rオブジェクトの概要">Rオブジェクトの概要<a class="anchor" aria-label="アンカー" href="#r%E3%82%AA%E3%83%96%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%AE%E6%A6%82%E8%A6%81"></a>
<a class="anchor" aria-label="anchor" href="#r%E3%82%AA%E3%83%96%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%AE%E6%A6%82%E8%A6%81"></a>
</h2>
<hr class="half-width">
<p>これまで、次元数（ ）、格納できるデータの種類（
）が単一か複数かによって異なる、いくつかのタイプのRオブジェクトを見てきた：</p>
<ul>
<li>
<strong>vector`</strong>：1次元（長さがある）、1種類のデータ。</li>
<li>
<strong>マトリックス`</strong>：2次元、単一データ型。</li>
<li>
<strong>data.frame`</strong>：2次元、1列1型。</li>
</ul></section><section><h2 class="section-heading" id="リスト">リスト<a class="anchor" aria-label="アンカー" href="#%E3%83%AA%E3%82%B9%E3%83%88"></a>
<a class="anchor" aria-label="anchor" href="#%E3%83%AA%E3%82%B9%E3%83%88"></a>
</h2>
<hr class="half-width">
<p>まだ見ていないが、知っておくと便利なデータ型がリストだ。
、先ほどのまとめから続く：</p>
<ul>
<li>
<strong><code>list</code></strong>:
1つの次元で、各項目は異なるデータ 型にすることができる。</li>
</ul>
<p>以下では、数値、文字、
行列、データフレーム、別のリストのベクトルを含むリストを作ってみよう：</p>
<div class="codewrapper sourceCode" id="cb73">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">l</span> <span class="op">&lt;-</span> <span class="fu">list</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="co">## numeric</span></span>
<span>          <span class="va">letters</span>, <span class="co">## character</span></span>
<span>          <span class="fu">installed.packages</span><span class="op">(</span><span class="op">)</span>, <span class="co">## a matrix</span></span>
<span>          <span class="va">cars</span>, <span class="co">## a data.frame</span></span>
<span>          <span class="fu">list</span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span> <span class="co">## a list</span></span>
<span><span class="fu">length</span><span class="op">(</span><span class="va">l</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 5</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb75">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">str</span><span class="op">(</span><span class="va">l</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>List of 5
 $ : int [1:10] 1 2 3 4 5 6 7 8 9 10
 $ : chr [1:26] "a" "b" "c" "d" ...
 $ : chr [1:187, 1:16] "askpass" "assertthat" "backports" "base64enc" ...
  ..- attr(*, "dimnames")=List of 2
  .. ..$ : chr [1:187] "askpass" "assertthat" "backports" "base64enc" ...
  .. ..$ : chr [1:16] "Package" "LibPath" "Version" "Priority" ...
 $ :'data.frame':	50 obs. of  2 variables:
  ..$ speed: num [1:50] 4 4 7 7 8 9 10 10 10 11 ...
  ..$ dist : num [1:50] 2 10 4 22 16 10 18 26 34 17 ...
 $ :List of 3
  ..$ : num 1
  ..$ : num 2
  ..$ : num 3</code></pre>
</div>
<p>リストのサブセットは <code>[]</code>
を使って新しいサブリストをサブセットするか、<code>[]]</code>
を使ってそのリストの単一要素を取り出す（
リストに名前がついている場合は、インデックスか名前を使う）。</p>
<div class="codewrapper sourceCode" id="cb77">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">l</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="co">##</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> [1]  1  2  3  4  5  6  7  8  9 10</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb79">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">l</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span> <span class="co">## 長さ 2 のリスト</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[[1]]
 [1]  1  2  3  4  5  6  7  8  9 10

[[2]]
 [1] "a" "b" "c" "d" "e" "f" "g" "h" "i" "j" "k" "l" "m" "n" "o" "p" "q" "r" "s"
[20] "t" "u" "v" "w" "x" "y" "z"</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb81">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">l</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="co">## 長さ 1 のリスト</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[[1]]
 [1]  1  2  3  4  5  6  7  8  9 10</code></pre>
</div>
</section><section><h2 class="section-heading" id="sec:exportandsave">表形式データのエクスポートと保存<a class="anchor" aria-label="アンカー" href="#sec:exportandsave"></a>
<a class="anchor" aria-label="anchor" href="#sec:exportandsave"></a>
</h2>
<hr class="half-width">
<p><code>read.table</code>
ファミリーの関数を使って、テキストベースのスプレッドシートをRに読み込む方法を見てきた。
data.frame<code>を テキストベースのスプレッドシートにエクスポートするには、 関数の</code>write.table<code>セット（</code>write.csv<code>,</code>write.delim<code>, ...）を使用します。 これらはすべて、 エクスポートする変数と、エクスポートするファイルを指定する。 例えば、</code>rna<code>のデータを</code>data_output<code>ディレクトリの</code>my_rna.csv`
ファイルにエクスポートするには、次のように実行する：</p>
<div class="codewrapper sourceCode" id="cb83">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">write.csv</span><span class="op">(</span><span class="va">rna</span>, file <span class="op">=</span> <span class="st">"data_output/my_rna.csv"</span><span class="op">)</span></span></code></pre>
</div>
<p>この新しいcsvファイルは、
、Rに精通していない他の共同研究者と共有することができます。<code>data.frame</code>のフィールドの一部（例えば、“product”列を参照）にカンマがあるにもかかわらず、Rはデフォルトで
、各フィールドを引用符で囲みます。したがって、
、列の区切り文字としてカンマを使用しているにもかかわらず、
、Rに正しく読み込むことができます。</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">まとめ<a class="anchor" aria-label="アンカー" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>Rでの表形式データ</li>
</ul>
</div>
</div>
</div>
</section><div class="footnotes footnotes-end-of-document">
<hr>
<ol>
<li id="fn1"><p>行数か列数のどちらかだけで十分で、もう一方は値の長さから推測できる。
値と行／列の数が合わない場合に何が起こるか試してみてください。<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
</ol>
</div></section><section id="aio-30-dplyr"><p>Content from <a href="30-dplyr.html">dplyrによるデータの操作と分析</a></p>
<hr>
<p>最終更新日：2024-09-08 |

        <a href="https://github.com/carpentries-incubator/bioc-intro/edit/main/episodes/30-dplyr.Rmd" class="external-link">ページの編集 <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="回答を全て表示する " data-collapse="回答を全て折りたたむ "> 回答を全て表示する <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">概要</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">質問</h3>
<ul>
<li>tidyverseメタパッケージを用いたRでのデータ分析</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">目的</h3>
<ul>
<li>dplyr<code>** と **tidyr</code>** パッケージの目的を説明する。</li>
<li>データを操作するのに非常に便利な関数をいくつか説明する。</li>
<li>ワイド表形式とロング表形式の概念を説明し、
、データ・フレームを一方の形式から他方の形式に変更する方法を見る。</li>
<li>テーブルの結合方法を示す。</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<blockquote>
<p>このエピソードは、Data Carpentriesの_Data Analysis and Visualisation
in R for Ecologists_レッスンに基づいています。</p>
</blockquote>
<section><h2 class="section-heading" id="dplyrとtidyrを使ったデータ操作">dplyr<code>**と**tidyr</code>**を使ったデータ操作<a class="anchor" aria-label="アンカー" href="#dplyr%E3%81%A8tidyr%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%9F%E3%83%87%E3%83%BC%E3%82%BF%E6%93%8D%E4%BD%9C"></a>
<a class="anchor" aria-label="anchor" href="#dplyr%E3%81%A8tidyr%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%9F%E3%83%87%E3%83%BC%E3%82%BF%E6%93%8D%E4%BD%9C"></a>
</h2>
<hr class="half-width">
<p>ブラケット・サブセットは便利だが、煩雑で
、特に複雑な操作では読みにくい。</p>
<p>いくつかのパッケージは、データを操作する際に私たちの作業を大いに助けてくれる。
Rのパッケージは基本的に、
、より多くのことができるようにする追加関数のセットである。
いくつかのパッケージは、データを操作する際に私たちの作業を大いに助けてくれる。
Rのパッケージは基本的に、
、より多くのことができるようにする追加関数のセットである。
これまで使ってきた <code>str()</code> や <code>data.frame()</code>
などの関数は、Rに組み込まれています。パッケージをロードすることで、その他の
固有の関数にアクセスできるようになります。
初めてパッケージを使用する前に、
をマシンにインストールする必要がある。その後、 R
セッションでパッケージが必要になったら、毎回インポートする必要がある。
初めてパッケージを使用する前に、
をマシンにインストールする必要がある。その後、 R
セッションでパッケージが必要になったら、毎回インポートする必要がある。</p>
<ul>
<li><p>dplyr\`**
パッケージは、データ操作タスクのための強力なツールを提供します。
データフレームを直接操作できるように構築されており、多くの操作タスクが
に最適化されている。
データフレームを直接操作できるように構築されており、多くの操作タスクが
に最適化されている。</p></li>
<li><p>後述するように、
、特定の分析や視覚化を行うために、データフレームの形を変えたいことがある。
tidyr`**パッケージは、
、データの形を変えるというこの一般的な問題に対処し、
データを整然と操作するためのツールを提供する。</p></li>
</ul>
<p>ワークショップの後、**dplyr<code>**と**tidyr</code>**についてもっと知りたい方は、
、こちらのhandy data transformation with をご覧ください。</p>
<ul>
<li>tidyverse<code>**パッケージは "umbrella-package "であり、       、データ解析のためのいくつかの便利なパッケージがインストールされます。       には、**tidyr</code>**,
<strong>dplyr<code>**, **ggplot2</code></strong>,
**tibble\`**などがあります。
これらのパッケージは、データを操作したり対話したりするのに役立ちます。
サブセット化、変換、
ビジュアライズなど、データを使ってさまざまなことができる。
サブセット化、変換、
ビジュアライズなど、データを使ってさまざまなことができる。</li>
</ul>
<p>セットアップを行ったのであれば、すでにtidyverseパッケージがインストールされているはずです。
ライブラリから読み込んでみて、それがあるかどうか確認してください：
ライブラリから読み込んでみて、それがあるかどうか確認してください：</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## dplyr を含む tidyverse パッケージをロード</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="st">"tidyverse"</span><span class="op">)</span></span></code></pre>
</div>
<p>tidyverse\`**
パッケージをインストールするには、以下のようにタイプしてください：</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">BiocManager</span><span class="fu">::</span><span class="fu">install</span><span class="op">(</span><span class="st">"tidyverse"</span><span class="op">)</span></span></code></pre>
</div>
<p>もし、**tidyverse<code>**パッケージをインストールしなければならなかったなら、上記の</code>library()\`コマンドを使って、このRセッションでロードすることを忘れないでください！</p>
</section><section><h2 class="section-heading" id="tidyverseでデータをロードする">tidyverseでデータをロードする<a class="anchor" aria-label="アンカー" href="#tidyverse%E3%81%A7%E3%83%87%E3%83%BC%E3%82%BF%E3%82%92%E3%83%AD%E3%83%BC%E3%83%89%E3%81%99%E3%82%8B"></a>
<a class="anchor" aria-label="anchor" href="#tidyverse%E3%81%A7%E3%83%87%E3%83%BC%E3%82%BF%E3%82%92%E3%83%AD%E3%83%BC%E3%83%89%E3%81%99%E3%82%8B"></a>
</h2>
<hr class="half-width">
<p>read.csv()<code>の代わりに、tidyverseパッケージ **readr</code>**の
<code>read_csv()</code>
関数（<code>.</code>の代わりに<code>_</code>があることに注意）を使ってデータを読み込みます。</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rna</span> <span class="op">&lt;-</span> <span class="fu">read_csv</span><span class="op">(</span><span class="st">"data/rnaseq.csv"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## データを見る</span></span>
<span><span class="va">rna</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 32,428 × 19
   gene    sample  expression organism   age sex   infection strain  time tissue
   &lt;chr&gt;   &lt;chr&gt;        &lt;dbl&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;     &lt;chr&gt;  &lt;dbl&gt; &lt;chr&gt;
 1 Asl     GSM254…       1170 Mus mus…     8 Fema… Influenz… C57BL…     8 Cereb…
 2 Apod    GSM254…      36194 Mus mus…     8 Fema… Influenz… C57BL…     8 Cereb…
 3 Cyp2d22 GSM254…       4060 Mus mus…     8 Fema… Influenz… C57BL…     8 Cereb…
 4 Klk6    GSM254…        287 Mus mus…     8 Fema… Influenz… C57BL…     8 Cereb…
 5 Fcrls   GSM254…         85 Mus mus…     8 Fema… Influenz… C57BL…     8 Cereb…
 6 Slc2a4  GSM254…        782 Mus mus…     8 Fema… Influenz… C57BL…     8 Cereb…
 7 Exd2    GSM254…       1619 Mus mus…     8 Fema… Influenz… C57BL…     8 Cereb…
 8 Gjc2    GSM254…        288 Mus mus…     8 Fema… Influenz… C57BL…     8 Cereb…
 9 Plp1    GSM254…      43217 Mus mus…     8 Fema… Influenz… C57BL…     8 Cereb…
10 Gnb4    GSM254…       1071 Mus mus…     8 Fema… Influenz… C57BL…     8 Cereb…
# ℹ 32,418 more rows
# ℹ 9 more variables: mouse &lt;dbl&gt;, ENTREZID &lt;dbl&gt;, product &lt;chr&gt;,
#   ensembl_gene_id &lt;chr&gt;, external_synonym &lt;chr&gt;, chromosome_name &lt;chr&gt;,
#   gene_biotype &lt;chr&gt;, phenotype_description &lt;chr&gt;,
#   hsapiens_homolog_associated_gene_name &lt;chr&gt;</code></pre>
</div>
<p>データのクラスが “tibble”と呼ばれていることに注目してほしい。</p>
<p>Tibblesは、以前
で紹介したデータ・フレーム・オブジェクトの動作の一部を微調整している。
データ構造はデータフレームによく似ている。
我々の目的にとって、唯一の違いはそれだ：</p>
<ol style="list-style-type: decimal">
<li><p>各列のデータ型が列名の下に表示される。 &lt;<code>dbl</code>&gt;
は の小数点を持つ数値を保持するために定義されたデータ型である。
データで作業するとき、我々はしばしば、各因子または因子の組み合わせについて
見つかったオブザベーションの数を知りたい。
このタスクのために、**dplyr<code>** は</code>count()\` を提供している。
例えば、感染したサンプルと感染していないサンプルそれぞれについて、
、データの行数をカウントしたい場合、次のようにする：</p></li>
<li><p>これは、データの最初の数行と、
1画面に収まるだけの列数だけを印刷する。</p></li>
</ol>
<p>これから、最も一般的な <strong>dplyr\`</strong>
関数のいくつかを学びます：</p>
<ul>
<li>select()\`: カラムのサブセット</li>
<li>
<code>filter()</code>: 条件で行をサブセットする。</li>
<li>mutate()\`: 他のカラムの情報を使って新しいカラムを作成する。</li>
<li>group_by()<code>と</code>summarise()\`:
グループ化されたデータの要約統計量を作成する。</li>
<li>arrange()\`：結果の並べ替え</li>
<li>count()\`: 離散値を数える</li>
</ul></section><section><h2 class="section-heading" id="列の選択と行のフィルタリング">列の選択と行のフィルタリング<a class="anchor" aria-label="アンカー" href="#%E5%88%97%E3%81%AE%E9%81%B8%E6%8A%9E%E3%81%A8%E8%A1%8C%E3%81%AE%E3%83%95%E3%82%A3%E3%83%AB%E3%82%BF%E3%83%AA%E3%83%B3%E3%82%B0"></a>
<a class="anchor" aria-label="anchor" href="#%E5%88%97%E3%81%AE%E9%81%B8%E6%8A%9E%E3%81%A8%E8%A1%8C%E3%81%AE%E3%83%95%E3%82%A3%E3%83%AB%E3%82%BF%E3%83%AA%E3%83%B3%E3%82%B0"></a>
</h2>
<hr class="half-width">
<p>データフレームの列を選択するには <code>select()</code> を使う。
この関数の最初の引数 はデータフレーム (<code>rna</code>) で、続く
の引数は保持する列です。 Tibblesは、以前
で紹介したデータ・フレーム・オブジェクトの動作の一部を微調整している。
データ構造はデータフレームによく似ている。
我々の目的にとって、唯一の違いはそれだ：</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">select</span><span class="op">(</span><span class="va">rna</span>, <span class="va">gene</span>, <span class="va">sample</span>, <span class="va">tissue</span>, <span class="va">expression</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 32,428 × 4
   gene    sample     tissue     expression
   &lt;chr&gt;   &lt;chr&gt;      &lt;chr&gt;           &lt;dbl&gt;
 1 Asl     GSM2545336 Cerebellum       1170
 2 Apod    GSM2545336 Cerebellum      36194
 3 Cyp2d22 GSM2545336 Cerebellum       4060
 4 Klk6    GSM2545336 Cerebellum        287
 5 Fcrls   GSM2545336 Cerebellum         85
 6 Slc2a4  GSM2545336 Cerebellum        782
 7 Exd2    GSM2545336 Cerebellum       1619
 8 Gjc2    GSM2545336 Cerebellum        288
 9 Plp1    GSM2545336 Cerebellum      43217
10 Gnb4    GSM2545336 Cerebellum       1071
# ℹ 32,418 more rows</code></pre>
</div>
<p>特定の列を除く*すべての列を選択するには、
その変数の前に”-“を付けて除外する。</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">select</span><span class="op">(</span><span class="va">rna</span>, <span class="op">-</span><span class="va">tissue</span>, <span class="op">-</span><span class="va">organism</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 32,428 × 17
   gene    sample   expression   age sex   infection strain  time mouse ENTREZID
   &lt;chr&gt;   &lt;chr&gt;         &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;     &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;
 1 Asl     GSM2545…       1170     8 Fema… Influenz… C57BL…     8    14   109900
 2 Apod    GSM2545…      36194     8 Fema… Influenz… C57BL…     8    14    11815
 3 Cyp2d22 GSM2545…       4060     8 Fema… Influenz… C57BL…     8    14    56448
 4 Klk6    GSM2545…        287     8 Fema… Influenz… C57BL…     8    14    19144
 5 Fcrls   GSM2545…         85     8 Fema… Influenz… C57BL…     8    14    80891
 6 Slc2a4  GSM2545…        782     8 Fema… Influenz… C57BL…     8    14    20528
 7 Exd2    GSM2545…       1619     8 Fema… Influenz… C57BL…     8    14    97827
 8 Gjc2    GSM2545…        288     8 Fema… Influenz… C57BL…     8    14   118454
 9 Plp1    GSM2545…      43217     8 Fema… Influenz… C57BL…     8    14    18823
10 Gnb4    GSM2545…       1071     8 Fema… Influenz… C57BL…     8    14    14696
# ℹ 32,418 more rows
# ℹ 7 more variables: product &lt;chr&gt;, ensembl_gene_id &lt;chr&gt;,
#   external_synonym &lt;chr&gt;, chromosome_name &lt;chr&gt;, gene_biotype &lt;chr&gt;,
#   phenotype_description &lt;chr&gt;, hsapiens_homolog_associated_gene_name &lt;chr&gt;</code></pre>
</div>
<p>これは <code>rna</code> の中の、 <code>tissue</code> と
<code>organism</code> 以外のすべての変数を選択する。</p>
<p>特定の条件に基づいて行を選択するには、<code>filter()</code>
を使用する：</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">filter</span><span class="op">(</span><span class="va">rna</span>, <span class="va">sex</span> <span class="op">==</span> <span class="st">"Male"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 14,740 × 19
   gene    sample  expression organism   age sex   infection strain  time tissue
   &lt;chr&gt;   &lt;chr&gt;        &lt;dbl&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;     &lt;chr&gt;  &lt;dbl&gt; &lt;chr&gt;
 1 Asl     GSM254…        626 Mus mus…     8 Male  Influenz… C57BL…     4 Cereb…
 2 Apod    GSM254…      13021 Mus mus…     8 Male  Influenz… C57BL…     4 Cereb…
 3 Cyp2d22 GSM254…       2171 Mus mus…     8 Male  Influenz… C57BL…     4 Cereb…
 4 Klk6    GSM254…        448 Mus mus…     8 Male  Influenz… C57BL…     4 Cereb…
 5 Fcrls   GSM254…        180 Mus mus…     8 Male  Influenz… C57BL…     4 Cereb…
 6 Slc2a4  GSM254…        313 Mus mus…     8 Male  Influenz… C57BL…     4 Cereb…
 7 Exd2    GSM254…       2366 Mus mus…     8 Male  Influenz… C57BL…     4 Cereb…
 8 Gjc2    GSM254…        310 Mus mus…     8 Male  Influenz… C57BL…     4 Cereb…
 9 Plp1    GSM254…      53126 Mus mus…     8 Male  Influenz… C57BL…     4 Cereb…
10 Gnb4    GSM254…       1355 Mus mus…     8 Male  Influenz… C57BL…     4 Cereb…
# ℹ 14,730 more rows
# ℹ 9 more variables: mouse &lt;dbl&gt;, ENTREZID &lt;dbl&gt;, product &lt;chr&gt;,
#   ensembl_gene_id &lt;chr&gt;, external_synonym &lt;chr&gt;, chromosome_name &lt;chr&gt;,
#   gene_biotype &lt;chr&gt;, phenotype_description &lt;chr&gt;,
#   hsapiens_homolog_associated_gene_name &lt;chr&gt;</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">filter</span><span class="op">(</span><span class="va">rna</span>, <span class="va">sex</span> <span class="op">==</span> <span class="st">"Male"</span> <span class="op">&amp;</span> <span class="va">infection</span> <span class="op">==</span> <span class="st">"NonInfected"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 4,422 × 19
   gene    sample  expression organism   age sex   infection strain  time tissue
   &lt;chr&gt;   &lt;chr&gt;        &lt;dbl&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;     &lt;chr&gt;  &lt;dbl&gt; &lt;chr&gt;
 1 Asl     GSM254…        535 Mus mus…     8 Male  NonInfec… C57BL…     0 Cereb…
 2 Apod    GSM254…      13668 Mus mus…     8 Male  NonInfec… C57BL…     0 Cereb…
 3 Cyp2d22 GSM254…       2008 Mus mus…     8 Male  NonInfec… C57BL…     0 Cereb…
 4 Klk6    GSM254…       1101 Mus mus…     8 Male  NonInfec… C57BL…     0 Cereb…
 5 Fcrls   GSM254…        375 Mus mus…     8 Male  NonInfec… C57BL…     0 Cereb…
 6 Slc2a4  GSM254…        249 Mus mus…     8 Male  NonInfec… C57BL…     0 Cereb…
 7 Exd2    GSM254…       3126 Mus mus…     8 Male  NonInfec… C57BL…     0 Cereb…
 8 Gjc2    GSM254…        791 Mus mus…     8 Male  NonInfec… C57BL…     0 Cereb…
 9 Plp1    GSM254…      98658 Mus mus…     8 Male  NonInfec… C57BL…     0 Cereb…
10 Gnb4    GSM254…       2437 Mus mus…     8 Male  NonInfec… C57BL…     0 Cereb…
# ℹ 4,412 more rows
# ℹ 9 more variables: mouse &lt;dbl&gt;, ENTREZID &lt;dbl&gt;, product &lt;chr&gt;,
#   ensembl_gene_id &lt;chr&gt;, external_synonym &lt;chr&gt;, chromosome_name &lt;chr&gt;,
#   gene_biotype &lt;chr&gt;, phenotype_description &lt;chr&gt;,
#   hsapiens_homolog_associated_gene_name &lt;chr&gt;</code></pre>
</div>
<p>ここで、このデータセットで解析されたマウス
遺伝子のヒトホモログに興味があるとしよう。 この情報は、
<code>hsapiens_homolog_associated_gene_name</code> という名前の
<code>rna</code> tibbleの 最後のカラムにある。
ここで、このデータセットで解析されたマウス
遺伝子のヒトホモログに興味があるとしよう。 この情報は、
<code>hsapiens_homolog_associated_gene_name</code> という名前の
<code>rna</code> tibbleの 最後のカラムにある。 簡単に視覚化するために、
、2つの列<code>gene</code>と
<code>hsapiens_homolog_associated_gene_name</code>だけを含む新しいテーブルを作成する。</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">genes</span> <span class="op">&lt;-</span> <span class="fu">select</span><span class="op">(</span><span class="va">rna</span>, <span class="va">gene</span>, <span class="va">hsapiens_homolog_associated_gene_name</span><span class="op">)</span></span>
<span><span class="va">genes</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 32,428 × 2
   gene    hsapiens_homolog_associated_gene_name
   &lt;chr&gt;   &lt;chr&gt;
 1 Asl     ASL
 2 Apod    APOD
 3 Cyp2d22 CYP2D6
 4 Klk6    KLK6
 5 Fcrls   FCRL2
 6 Slc2a4  SLC2A4
 7 Exd2    EXD2
 8 Gjc2    GJC2
 9 Plp1    PLP1
10 Gnb4    GNB4
# ℹ 32,418 more rows</code></pre>
</div>
<p>マウス遺伝子の中にはヒトにホモログがないものもある。 これらは、
<code>filter()</code> と、 何かが <code>NA</code> かどうかを判定する
<code>is.na()</code> 関数を使って取得することができる。</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">filter</span><span class="op">(</span><span class="va">genes</span>, <span class="fu">is.na</span><span class="op">(</span><span class="va">hsapiens_homolog_associated_gene_name</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 4,290 × 2
   gene     hsapiens_homolog_associated_gene_name
   &lt;chr&gt;    &lt;chr&gt;
 1 Prodh    &lt;NA&gt;
 2 Tssk5    &lt;NA&gt;
 3 Vmn2r1   &lt;NA&gt;
 4 Gm10654  &lt;NA&gt;
 5 Hexa     &lt;NA&gt;
 6 Sult1a1  &lt;NA&gt;
 7 Gm6277   &lt;NA&gt;
 8 Tmem198b &lt;NA&gt;
 9 Adam1a   &lt;NA&gt;
10 Ebp      &lt;NA&gt;
# ℹ 4,280 more rows</code></pre>
</div>
<p>ヒトのホモログを持つマウス遺伝子だけを保持したい場合、
、結果を否定する”!“記号を挿入することができる。したがって、
、hsapiens_homolog_associated_gene_name <em>is not</em> an
<code>NA</code> となるすべての行を求めることになる。</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">filter</span><span class="op">(</span><span class="va">genes</span>, <span class="op">!</span><span class="fu">is.na</span><span class="op">(</span><span class="va">hsapiens_homolog_associated_gene_name</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 28,138 × 2
   gene    hsapiens_homolog_associated_gene_name
   &lt;chr&gt;   &lt;chr&gt;
 1 Asl     ASL
 2 Apod    APOD
 3 Cyp2d22 CYP2D6
 4 Klk6    KLK6
 5 Fcrls   FCRL2
 6 Slc2a4  SLC2A4
 7 Exd2    EXD2
 8 Gjc2    GJC2
 9 Plp1    PLP1
10 Gnb4    GNB4
# ℹ 28,128 more rows</code></pre>
</div>
</section><section><h2 class="section-heading" id="パイプ">パイプ<a class="anchor" aria-label="アンカー" href="#%E3%83%91%E3%82%A4%E3%83%97"></a>
<a class="anchor" aria-label="anchor" href="#%E3%83%91%E3%82%A4%E3%83%97"></a>
</h2>
<hr class="half-width">
<p>選択とフィルタを同時に行いたい場合は？ これを行うには、
、中間ステップ、ネストされた関数、パイプの3つの方法がある。
これを行うには、
、中間ステップ、ネストされた関数、パイプの3つの方法がある。</p>
<p>中間ステップでは、一時的なデータフレームを作成し、
、次の関数の入力として使用する：</p>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rna2</span> <span class="op">&lt;-</span> <span class="fu">filter</span><span class="op">(</span><span class="va">rna</span>, <span class="va">sex</span> <span class="op">==</span> <span class="st">"Male"</span><span class="op">)</span></span>
<span><span class="va">rna3</span> <span class="op">&lt;-</span> <span class="fu">select</span><span class="op">(</span><span class="va">rna2</span>, <span class="va">gene</span>, <span class="va">sample</span>, <span class="va">tissue</span>, <span class="va">expression</span><span class="op">)</span></span>
<span><span class="va">rna3</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 14,740 × 4
   gene    sample     tissue     expression
   &lt;chr&gt;   &lt;chr&gt;      &lt;chr&gt;           &lt;dbl&gt;
 1 Asl     GSM2545340 Cerebellum        626
 2 Apod    GSM2545340 Cerebellum      13021
 3 Cyp2d22 GSM2545340 Cerebellum       2171
 4 Klk6    GSM2545340 Cerebellum        448
 5 Fcrls   GSM2545340 Cerebellum        180
 6 Slc2a4  GSM2545340 Cerebellum        313
 7 Exd2    GSM2545340 Cerebellum       2366
 8 Gjc2    GSM2545340 Cerebellum        310
 9 Plp1    GSM2545340 Cerebellum      53126
10 Gnb4    GSM2545340 Cerebellum       1355
# ℹ 14,730 more rows</code></pre>
</div>
<p>これは読みやすいが、
、個別に名前を付けなければならない中間オブジェクトがたくさんあるため、ワークスペースが散らかる可能性がある。
複数の 、それを把握するのは難しいかもしれない。 複数の
、それを把握するのは難しいかもしれない。</p>
<p>、関数を入れ子にすることもできる：</p>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rna3</span> <span class="op">&lt;-</span> <span class="fu">select</span><span class="op">(</span><span class="fu">filter</span><span class="op">(</span><span class="va">rna</span>, <span class="va">sex</span> <span class="op">==</span> <span class="st">"Male"</span>, <span class="va">gene</span>, <span class="va">sample</span>, <span class="va">tissue</span>, <span class="va">expression</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">エラー<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in `filter()`:
ℹ In argument: `gene`.
Caused by error:
! `..2` must be a logical vector, not a character vector.</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rna3</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 14,740 × 4
   gene    sample     tissue     expression
   &lt;chr&gt;   &lt;chr&gt;      &lt;chr&gt;           &lt;dbl&gt;
 1 Asl     GSM2545340 Cerebellum        626
 2 Apod    GSM2545340 Cerebellum      13021
 3 Cyp2d22 GSM2545340 Cerebellum       2171
 4 Klk6    GSM2545340 Cerebellum        448
 5 Fcrls   GSM2545340 Cerebellum        180
 6 Slc2a4  GSM2545340 Cerebellum        313
 7 Exd2    GSM2545340 Cerebellum       2366
 8 Gjc2    GSM2545340 Cerebellum        310
 9 Plp1    GSM2545340 Cerebellum      53126
10 Gnb4    GSM2545340 Cerebellum       1355
# ℹ 14,730 more rows</code></pre>
</div>
<p>これは便利だが、
Rは式を内側から外側へと評価する（この場合、フィルタリングしてから選択する）ため、関数が入れ子になりすぎると読みにくくなることがある。</p>
<p>最後のオプションである_パイプ_は、Rに最近追加されたものである。パイプを使うと、ある関数の出力を
、次の関数に直接送ることができる。これは、同じデータセットに対して多くの処理を行う必要がある場合に便利である
。</p>
<p>ミューテート R のパイプは <code>%&gt;%</code>
(<strong><code>magrittr</code></strong> パッケージで利用可能) または
<code>|&gt;</code> (ベース R で利用可能) のように見えます。
RStudioを使用する場合は、
PCをお持ちの場合は<kbd>Ctrl</kbd>+<kbd>Shift</kbd>+<kbd>M</kbd>、
Macをお持ちの場合は<kbd>Cmd</kbd>+<kbd>Shift</kbd>+<kbd>Mで</kbd>パイプを
。</p>
<p>上記のコードでは、パイプを使って <code>rna</code> データセットをまず
<code>filter()</code> を通して <code>sex</code> が Male
である行を残し、次に <code>select()</code> を通して <code>gene</code>,
<code>sample</code>, <code>tissue</code>, <code>expression</code>columns
だけを残すように送っている。</p>
<p>パイプ <code>%&gt;%</code> はその左側にあるオブジェクトを受け取り、
その右側にある関数の最初の引数として直接渡します。 <code>filter()</code>
と <code>select()</code>
関数の引数として明示的にデータフレームを含める必要はもうありません。</p>
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rna</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">sex</span> <span class="op">==</span> <span class="st">"Male"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">gene</span>, <span class="va">sample</span>, <span class="va">tissue</span>, <span class="va">expression</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 14,740 × 4
   gene    sample     tissue     expression
   &lt;chr&gt;   &lt;chr&gt;      &lt;chr&gt;           &lt;dbl&gt;
 1 Asl     GSM2545340 Cerebellum        626
 2 Apod    GSM2545340 Cerebellum      13021
 3 Cyp2d22 GSM2545340 Cerebellum       2171
 4 Klk6    GSM2545340 Cerebellum        448
 5 Fcrls   GSM2545340 Cerebellum        180
 6 Slc2a4  GSM2545340 Cerebellum        313
 7 Exd2    GSM2545340 Cerebellum       2366
 8 Gjc2    GSM2545340 Cerebellum        310
 9 Plp1    GSM2545340 Cerebellum      53126
10 Gnb4    GSM2545340 Cerebellum       1355
# ℹ 14,730 more rows</code></pre>
</div>
<p>パイプを “then”のように読むことが役に立つと思う人もいるだろう。
パイプを “then”のように読むことが役に立つと思う人もいるだろう。 例えば、
上の例では、データフレーム <code>rna</code>
を取得し、<code>sex=="Male"</code> の行を で
<code>フィルター</code>し、<code>gene</code>, <code>sample</code>,
<code>tissue</code>, <code>expression</code> の列を <code>選択</code>
した。</p>
<p>dplyr\`**関数はそれ自体ではやや単純だが、
、パイプを使った線形ワークフローに組み合わせることで、
、データフレームのより複雑な操作を行うことができる。</p>
<p>この小さいバージョンのデータで新しいオブジェクトを作りたい場合、
、新しい名前を割り当てることができる：</p>
<div class="codewrapper sourceCode" id="cb27">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rna3</span><span class="op">&lt;-</span> <span class="va">rna</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">sex</span> <span class="op">==</span> <span class="st">"Male"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">gene</span>, <span class="va">sample</span>, <span class="va">tissue</span>, <span class="va">expression</span><span class="op">)</span></span>
<span></span>
<span><span class="va">rna3</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 14,740 × 4
   gene    sample     tissue     expression
   &lt;chr&gt;   &lt;chr&gt;      &lt;chr&gt;           &lt;dbl&gt;
 1 Asl     GSM2545340 Cerebellum        626
 2 Apod    GSM2545340 Cerebellum      13021
 3 Cyp2d22 GSM2545340 Cerebellum       2171
 4 Klk6    GSM2545340 Cerebellum        448
 5 Fcrls   GSM2545340 Cerebellum        180
 6 Slc2a4  GSM2545340 Cerebellum        313
 7 Exd2    GSM2545340 Cerebellum       2366
 8 Gjc2    GSM2545340 Cerebellum        310
 9 Plp1    GSM2545340 Cerebellum      53126
10 Gnb4    GSM2545340 Cerebellum       1355
# ℹ 14,730 more rows</code></pre>
</div>
<div id="チャレンジだ" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジだ" class="callout-inner">
<h3 class="callout-title">チャレンジだ：<a class="anchor" aria-label="アンカー" href="#%E3%83%81%E3%83%A3%E3%83%AC%E3%83%B3%E3%82%B8%E3%81%A0"></a>
</h3>
<div class="callout-content">
<p>パイプを使用して、時間0、
、遺伝子の発現が50000より高い雌マウスのオブザベーションを保持するように<code>rna</code>データをサブセットし、
<code>gene</code>、<code>sample</code>、<code>time</code>、<code>expression</code>、<code>age</code>の列のみを保持する。</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">
  ソリューション
  </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb29">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rna</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">expression</span> <span class="op">&gt;</span> <span class="fl">50000</span>,</span>
<span>         <span class="va">sex</span> <span class="op">==</span> <span class="st">"Female"</span>,</span>
<span>         <span class="va">time</span> <span class="op">==</span> <span class="fl">0</span> <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">gene</span>, <span class="va">sample</span>, <span class="va">time</span>, <span class="va">expression</span>, <span class="va">age</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 9 × 5
  gene   sample      time expression   age
  &lt;chr&gt;  &lt;chr&gt;      &lt;dbl&gt;      &lt;dbl&gt; &lt;dbl&gt;
1 Plp1   GSM2545337     0     101241     8
2 Atp1b1 GSM2545337     0      53260     8
3 Plp1   GSM2545338     0      96534     8
4 Atp1b1 GSM2545338     0      50614     8
5 Plp1   GSM2545348     0     102790     8
6 Atp1b1 GSM2545348     0      59544     8
7 Plp1   GSM2545353     0      71237     8
8 Glul   GSM2545353     0      52451     8
9 Atp1b1 GSM2545353     0      61451     8</code></pre>
</div>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="ミューテート">ミューテート<a class="anchor" aria-label="アンカー" href="#%E3%83%9F%E3%83%A5%E3%83%BC%E3%83%86%E3%83%BC%E3%83%88"></a>
<a class="anchor" aria-label="anchor" href="#%E3%83%9F%E3%83%A5%E3%83%BC%E3%83%86%E3%83%BC%E3%83%88"></a>
</h2>
<hr class="half-width">
<p>例えば、単位変換をしたり、2つの
列の値の比率を求めたりするために、既存の
列の値に基づいて新しい列を作成したいことがよくあります。 これには
<code>mutate()</code> を使う。 これには <code>mutate()</code>
を使う。</p>
<p>時間単位の新しい列を作成する：</p>
<div class="codewrapper sourceCode" id="cb31">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rna</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>time_hours <span class="op">=</span> <span class="va">time</span> <span class="op">*</span> <span class="fl">24</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">time</span>, <span class="va">time_hours</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 32,428 × 2
    time time_hours
   &lt;dbl&gt;      &lt;dbl&gt;
 1     8        192
 2     8        192
 3     8        192
 4     8        192
 5     8        192
 6     8        192
 7     8        192
 8     8        192
 9     8        192
10     8        192
# ℹ 32,418 more rows</code></pre>
</div>
<p>また、<code>mutate()</code>の同じ呼び出しの中で、最初の新しいカラムに基づいて2番目の新しいカラムを作成することもできる：</p>
<div class="codewrapper sourceCode" id="cb33">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rna</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>time_hours <span class="op">=</span> <span class="va">time</span> <span class="op">*</span> <span class="fl">24</span>,</span>
<span>         time_mn <span class="op">=</span> <span class="va">time_hours</span> <span class="op">*</span> <span class="fl">60</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">time</span>, <span class="va">time_hours</span>, <span class="va">time_mn</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 32,428 × 3
    time time_hours time_mn
   &lt;dbl&gt;      &lt;dbl&gt;   &lt;dbl&gt;
 1     8        192   11520
 2     8        192   11520
 3     8        192   11520
 4     8        192   11520
 5     8        192   11520
 6     8        192   11520
 7     8        192   11520
 8     8        192   11520
 9     8        192   11520
10     8        192   11520
# ℹ 32,418 more rows</code></pre>
</div>
<div id="チャレンジ" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ" class="callout-inner">
<h3 class="callout-title">チャレンジ<a class="anchor" aria-label="アンカー" href="#%E3%83%81%E3%83%A3%E3%83%AC%E3%83%B3%E3%82%B8"></a>
</h3>
<div class="callout-content">
<p>後述するように、
、特定の分析や視覚化を行うために、データフレームの形を変えたいことがある。
tidyr`**パッケージは、
、データの形を変えるというこの一般的な問題に対処し、
データを整然と操作するためのツールを提供する。 の値は対数変換する。
以下の 条件を満たす
<code>rna</code>データから新しいデータフレームを作成する：<code>gene</code>、<code>chromosome_name</code>、
<code>phenotype_description</code>、<code>sample</code>、<code>expression\</code>
列のみを含む。 の値は対数変換する。 このデータフレームは、
、性染色体に位置し、 phenotype_descriptionに関連し、log
expressionが5より高い遺伝子のみを含んでいなければならない。</p>
<p><strong>ヒント</strong>：このデータフレームを
、どのようにコマンドを並べるべきか考えてみよう！</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2">
  ソリューション
  </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" data-bs-parent="#accordionSolution2" aria-labelledby="headingSolution2">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb35">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rna</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>expression <span class="op">=</span> <span class="fu">log</span><span class="op">(</span><span class="va">expression</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">gene</span>, <span class="va">chromosome_name</span>, <span class="va">phenotype_description</span>, <span class="va">sample</span>, <span class="va">expression</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">chromosome_name</span> <span class="op">==</span> <span class="st">"X"</span> <span class="op">|</span> <span class="va">chromosome_name</span> <span class="op">==</span> <span class="st">"Y"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="op">!</span><span class="fu">is.na</span><span class="op">(</span><span class="va">phenotype_description</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">expression</span> <span class="op">&gt;</span> <span class="fl">5</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 649 × 5
   gene   chromosome_name phenotype_description                sample expression
   &lt;chr&gt;  &lt;chr&gt;           &lt;chr&gt;                                &lt;chr&gt;       &lt;dbl&gt;
 1 Plp1   X               abnormal CNS glial cell morphology   GSM25…      10.7
 2 Slc7a3 X               decreased body length                GSM25…       5.46
 3 Plxnb3 X               abnormal coat appearance             GSM25…       6.58
 4 Rbm3   X               abnormal liver morphology            GSM25…       9.32
 5 Cfp    X               abnormal cardiovascular system phys… GSM25…       6.18
 6 Ebp    X               abnormal embryonic erythrocyte morp… GSM25…       6.68
 7 Cd99l2 X               abnormal cellular extravasation      GSM25…       8.04
 8 Piga   X               abnormal brain development           GSM25…       6.06
 9 Pim2   X               decreased T cell proliferation       GSM25…       7.11
10 Itm2a  X               no abnormal phenotype detected       GSM25…       7.48
# ℹ 639 more rows</code></pre>
</div>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="分割-適用-結合データ分析">分割-適用-結合データ分析<a class="anchor" aria-label="アンカー" href="#%E5%88%86%E5%89%B2-%E9%81%A9%E7%94%A8-%E7%B5%90%E5%90%88%E3%83%87%E3%83%BC%E3%82%BF%E5%88%86%E6%9E%90"></a>
<a class="anchor" aria-label="anchor" href="#%E5%88%86%E5%89%B2-%E9%81%A9%E7%94%A8-%E7%B5%90%E5%90%88%E3%83%87%E3%83%BC%E3%82%BF%E5%88%86%E6%9E%90"></a>
</h2>
<hr class="half-width">
<p>多くのデータ分析タスクは、
_split-apply-combine_パラダイムを使ってアプローチすることができる：データをグループに分割し、各グループにいくつかの
分析を適用し、その結果を組み合わせる。
**dplyr<code>** は</code>group_by()`
関数を使って、これを非常に簡単にしている。
**dplyr<code>\*\* は</code>group_by()`
関数を使って、これを非常に簡単にしている。</p>
<div class="codewrapper sourceCode" id="cb37">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rna</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">gene</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 32,428 × 19
# Groups:   gene [1,474]
   gene    sample  expression organism   age sex   infection strain  time tissue
   &lt;chr&gt;   &lt;chr&gt;        &lt;dbl&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;     &lt;chr&gt;  &lt;dbl&gt; &lt;chr&gt;
 1 Asl     GSM254…       1170 Mus mus…     8 Fema… Influenz… C57BL…     8 Cereb…
 2 Apod    GSM254…      36194 Mus mus…     8 Fema… Influenz… C57BL…     8 Cereb…
 3 Cyp2d22 GSM254…       4060 Mus mus…     8 Fema… Influenz… C57BL…     8 Cereb…
 4 Klk6    GSM254…        287 Mus mus…     8 Fema… Influenz… C57BL…     8 Cereb…
 5 Fcrls   GSM254…         85 Mus mus…     8 Fema… Influenz… C57BL…     8 Cereb…
 6 Slc2a4  GSM254…        782 Mus mus…     8 Fema… Influenz… C57BL…     8 Cereb…
 7 Exd2    GSM254…       1619 Mus mus…     8 Fema… Influenz… C57BL…     8 Cereb…
 8 Gjc2    GSM254…        288 Mus mus…     8 Fema… Influenz… C57BL…     8 Cereb…
 9 Plp1    GSM254…      43217 Mus mus…     8 Fema… Influenz… C57BL…     8 Cereb…
10 Gnb4    GSM254…       1071 Mus mus…     8 Fema… Influenz… C57BL…     8 Cereb…
# ℹ 32,418 more rows
# ℹ 9 more variables: mouse &lt;dbl&gt;, ENTREZID &lt;dbl&gt;, product &lt;chr&gt;,
#   ensembl_gene_id &lt;chr&gt;, external_synonym &lt;chr&gt;, chromosome_name &lt;chr&gt;,
#   gene_biotype &lt;chr&gt;, phenotype_description &lt;chr&gt;,
#   hsapiens_homolog_associated_gene_name &lt;chr&gt;</code></pre>
</div>
<p>group_by()<code>関数はデータ処理を行わず、 データをサブセットにグループ化する。上の例では、 32428オブザベーションの最初の</code>tibble<code>は、1474グループに</code>gene\`
変数に基づいて分割される。</p>
<p>同様に、ティブルをサンプルごとにグループ分けすることもできる：</p>
<div class="codewrapper sourceCode" id="cb39">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rna</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">sample</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 32,428 × 19
# Groups:   sample [22]
   gene    sample  expression organism   age sex   infection strain  time tissue
   &lt;chr&gt;   &lt;chr&gt;        &lt;dbl&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;     &lt;chr&gt;  &lt;dbl&gt; &lt;chr&gt;
 1 Asl     GSM254…       1170 Mus mus…     8 Fema… Influenz… C57BL…     8 Cereb…
 2 Apod    GSM254…      36194 Mus mus…     8 Fema… Influenz… C57BL…     8 Cereb…
 3 Cyp2d22 GSM254…       4060 Mus mus…     8 Fema… Influenz… C57BL…     8 Cereb…
 4 Klk6    GSM254…        287 Mus mus…     8 Fema… Influenz… C57BL…     8 Cereb…
 5 Fcrls   GSM254…         85 Mus mus…     8 Fema… Influenz… C57BL…     8 Cereb…
 6 Slc2a4  GSM254…        782 Mus mus…     8 Fema… Influenz… C57BL…     8 Cereb…
 7 Exd2    GSM254…       1619 Mus mus…     8 Fema… Influenz… C57BL…     8 Cereb…
 8 Gjc2    GSM254…        288 Mus mus…     8 Fema… Influenz… C57BL…     8 Cereb…
 9 Plp1    GSM254…      43217 Mus mus…     8 Fema… Influenz… C57BL…     8 Cereb…
10 Gnb4    GSM254…       1071 Mus mus…     8 Fema… Influenz… C57BL…     8 Cereb…
# ℹ 32,418 more rows
# ℹ 9 more variables: mouse &lt;dbl&gt;, ENTREZID &lt;dbl&gt;, product &lt;chr&gt;,
#   ensembl_gene_id &lt;chr&gt;, external_synonym &lt;chr&gt;, chromosome_name &lt;chr&gt;,
#   gene_biotype &lt;chr&gt;, phenotype_description &lt;chr&gt;,
#   hsapiens_homolog_associated_gene_name &lt;chr&gt;</code></pre>
</div>
<p>ここで、最初の 32428 オブザベーションの <code>tibble</code>
は、<code>sample</code> 変数に基づいて、 22 グループに分割される。</p>
<p>いったんデータがグループ化されると、その後の操作は各グループに独立して
。</p>
<div class="section level3">
<h3 id="summarise関数">summarise()`関数<a class="anchor" aria-label="anchor" href="#summarise%E9%96%A2%E6%95%B0"></a>
</h3>
<p>group_by()<code>は</code>summarise()\` と一緒に使われることが多く、
は各グループを1行の要約に折りたたむ。</p>
<p>group_by()<code>は、 **カテゴリー** 変数を含むカラム名を引数として取り、 統計のサマリーを計算します。 group_by()\</code>
は、 <strong>カテゴリー</strong> 変数を含むカラム名を引数として取り、
統計のサマリーを計算します。
そこで、遺伝子ごとの平均「発現」を計算する：</p>
<div class="codewrapper sourceCode" id="cb41">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode r" tabindex="0"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" tabindex="-1"></a>rna <span class="sc">%&gt;%</span></span>
<span id="cb41-2"><a href="#cb41-2" tabindex="-1"></a>  <span class="fu">group_by</span>(gene <span class="sc">%&gt;%</span></span>
<span id="cb41-3"><a href="#cb41-3" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_expression =</span> <span class="fu">mean</span>(expression))</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">エラー<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error: &lt;text&gt;:4:0: unexpected end of input
2:   group_by(gene %&gt;%
3:   summarise(mean_expression = mean(expression))
  ^</code></pre>
</div>
<p>また、各サンプルの全遺伝子の平均発現量を計算することもできる：</p>
<div class="codewrapper sourceCode" id="cb43">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode r" tabindex="0"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" tabindex="-1"></a>rna <span class="sc">%&gt;%</span></span>
<span id="cb43-2"><a href="#cb43-2" tabindex="-1"></a>  <span class="fu">group_by</span>(sample <span class="sc">%&gt;%</span></span>
<span id="cb43-3"><a href="#cb43-3" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_expression =</span> <span class="fu">mean</span>(expression))</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">エラー<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error: &lt;text&gt;:4:0: unexpected end of input
2:   group_by(sample %&gt;%
3:   summarise(mean_expression = mean(expression))
  ^</code></pre>
</div>
<p>しかし、複数の列でグループ化することもできる：</p>
<div class="codewrapper sourceCode" id="cb45">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rna</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">gene</span>, <span class="va">infection</span>, <span class="va">time</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">summarise</span><span class="op">(</span>mean_expression <span class="op">=</span> <span class="fu">mean</span><span class="op">(</span><span class="va">expression</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>`summarise()` has grouped output by 'gene', 'infection'. You can override using
the `.groups` argument.</code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 4,422 × 4
# Groups:   gene, infection [2,948]
   gene     infection    time mean_expression
   &lt;chr&gt;    &lt;chr&gt;       &lt;dbl&gt;           &lt;dbl&gt;
 1 AI504432 InfluenzaA      4           1104.
 2 AI504432 InfluenzaA      8           1014
 3 AI504432 NonInfected     0           1034.
 4 AW046200 InfluenzaA      4            152.
 5 AW046200 InfluenzaA      8             81
 6 AW046200 NonInfected     0            155.
 7 AW551984 InfluenzaA      4            302.
 8 AW551984 InfluenzaA      8            342.
 9 AW551984 NonInfected     0            238
10 Aamp     InfluenzaA      4           4870
# ℹ 4,412 more rows</code></pre>
</div>
<p>いったんデータがグループ化されると、同じ
（必ずしも同じ変数でなくてもよい）時間に複数の変数を要約することもできる。
例えば、遺伝子別、条件別の「発現」の中央値を示す
列を追加することができる：
例えば、遺伝子別、条件別の「発現」の中央値を示す
列を追加することができる：</p>
<div class="codewrapper sourceCode" id="cb48">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rna</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">gene</span>, <span class="va">infection</span>, <span class="va">time</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">summarise</span><span class="op">(</span>mean_expression <span class="op">=</span> <span class="fu">mean</span><span class="op">(</span><span class="va">expression</span><span class="op">)</span>,</span>
<span>            median_expression <span class="op">=</span> <span class="fu">median</span><span class="op">(</span><span class="va">expression</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>`summarise()` has grouped output by 'gene', 'infection'. You can override using
the `.groups` argument.</code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 4,422 × 5
# Groups:   gene, infection [2,948]
   gene     infection    time mean_expression median_expression
   &lt;chr&gt;    &lt;chr&gt;       &lt;dbl&gt;           &lt;dbl&gt;             &lt;dbl&gt;
 1 AI504432 InfluenzaA      4           1104.             1094.
 2 AI504432 InfluenzaA      8           1014               985
 3 AI504432 NonInfected     0           1034.             1016
 4 AW046200 InfluenzaA      4            152.              144.
 5 AW046200 InfluenzaA      8             81                82
 6 AW046200 NonInfected     0            155.              163
 7 AW551984 InfluenzaA      4            302.              245
 8 AW551984 InfluenzaA      8            342.              287
 9 AW551984 NonInfected     0            238               265
10 Aamp     InfluenzaA      4           4870              4708
# ℹ 4,412 more rows</code></pre>
</div>
<div id="チャレンジ-1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ-1" class="callout-inner">
<h3 class="callout-title">チャレンジ<a class="anchor" aria-label="アンカー" href="#%E3%83%81%E3%83%A3%E3%83%AC%E3%83%B3%E3%82%B8-1"></a>
</h3>
<div class="callout-content">
<p>遺伝子 “Dok3”のタイムポイントごとの平均発現量を計算する。</p>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3">
  ソリューション
  </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" data-bs-parent="#accordionSolution3" aria-labelledby="headingSolution3">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb51">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rna</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">gene</span> <span class="op">==</span> <span class="st">"Dok3"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">time</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">summarise</span><span class="op">(</span>mean <span class="op">=</span> <span class="fu">mean</span><span class="op">(</span><span class="va">expression</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 3 × 2
   time  mean
  &lt;dbl&gt; &lt;dbl&gt;
1     0  169
2     4  156.
3     8   61 </code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="カウント">カウント<a class="anchor" aria-label="anchor" href="#%E3%82%AB%E3%82%A6%E3%83%B3%E3%83%88"></a>
</h3>
<p>データで作業するとき、我々はしばしば、各因子または因子の組み合わせについて
見つかったオブザベーションの数を知りたい。
このタスクのために、**dplyr<code>** は</code>count()` を提供している。
例えば、感染したサンプルと感染していないサンプルそれぞれについて、
、データの行数をカウントしたい場合、次のようにする：</p>
<div class="codewrapper sourceCode" id="cb53">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rna</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">count</span><span class="op">(</span><span class="va">infection</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 2 × 2
  infection       n
  &lt;chr&gt;       &lt;int&gt;
1 InfluenzaA  22110
2 NonInfected 10318</code></pre>
</div>
<p>count()<code>関数は、すでに見たことのある、変数でグループ化し、そのグループ内のオブザベーションの数をカウントして要約する、ということの省略記法です。 言い換えれば、</code>rna
%&gt;% count(infection)`は次のものと等価である：
言い換えれば、<code>rna %&gt;% count(infection)\</code>は次のものと等価である：</p>
<div class="codewrapper sourceCode" id="cb55">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rna</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">group_by</span><span class="op">(</span><span class="va">infection</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">summarise</span><span class="op">(</span>n <span class="op">=</span> <span class="fu">n</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 2 × 2
  infection       n
  &lt;chr&gt;       &lt;int&gt;
1 InfluenzaA  22110
2 NonInfected 10318</code></pre>
</div>
<p>先ほどの例では、<code>count()</code>
を使って、_1つの_要因（つまり<code>感染</code>）について
、行数/観察数を数えている。 先ほどの例では、<code>count()</code>
を使って、_1つの_要因（つまり<code>感染</code>）について
、行数/観察数を数えている。
もし、<code>感染</code>と<code>時間</code>のような_要因の組み合わせ_をカウントしたいのであれば、
、<code>count()</code>の引数として1つ目と2つ目の要因を指定することになる：</p>
<div class="codewrapper sourceCode" id="cb57">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rna</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">count</span><span class="op">(</span><span class="va">infection</span>, <span class="va">time</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 3 × 3
  infection    time     n
  &lt;chr&gt;       &lt;dbl&gt; &lt;int&gt;
1 InfluenzaA      4 11792
2 InfluenzaA      8 10318
3 NonInfected     0 10318</code></pre>
</div>
<p>これと等価である：</p>
<div class="codewrapper sourceCode" id="cb59">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rna</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">infection</span>, <span class="va">time</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">summarise</span><span class="op">(</span>n <span class="op">=</span> <span class="fu">n</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>`summarise()` has grouped output by 'infection'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 3 × 3
# Groups:   infection [2]
  infection    time     n
  &lt;chr&gt;       &lt;dbl&gt; &lt;int&gt;
1 InfluenzaA      4 11792
2 InfluenzaA      8 10318
3 NonInfected     0 10318</code></pre>
</div>
<p>比較を容易にするために、結果を並べ替えると便利なことがある。
arrange()`を使って表を並べ替えることができる。
例えば、上の表を時間順に並べたいとする：</p>
<div class="codewrapper sourceCode" id="cb62">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rna</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">count</span><span class="op">(</span><span class="va">infection</span>, <span class="va">time</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">arrange</span><span class="op">(</span><span class="va">time</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 3 × 3
  infection    time     n
  &lt;chr&gt;       &lt;dbl&gt; &lt;int&gt;
1 NonInfected     0 10318
2 InfluenzaA      4 11792
3 InfluenzaA      8 10318</code></pre>
</div>
<p>あるいは回数で：</p>
<div class="codewrapper sourceCode" id="cb64">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rna</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">count</span><span class="op">(</span><span class="va">infection</span>, <span class="va">time</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">arrange</span><span class="op">(</span><span class="va">n</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 3 × 3
  infection    time     n
  &lt;chr&gt;       &lt;dbl&gt; &lt;int&gt;
1 InfluenzaA      8 10318
2 NonInfected     0 10318
3 InfluenzaA      4 11792</code></pre>
</div>
<p>降順にソートするには、<code>desc()</code>関数を追加する必要がある：</p>
<div class="codewrapper sourceCode" id="cb66">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rna</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">count</span><span class="op">(</span><span class="va">infection</span>, <span class="va">time</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">arrange</span><span class="op">(</span><span class="fu">desc</span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 3 × 3
  infection    time     n
  &lt;chr&gt;       &lt;dbl&gt; &lt;int&gt;
1 InfluenzaA      4 11792
2 InfluenzaA      8 10318
3 NonInfected     0 10318</code></pre>
</div>
<div id="チャレンジ-2" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ-2" class="callout-inner">
<h3 class="callout-title">チャレンジ<a class="anchor" aria-label="アンカー" href="#%E3%83%81%E3%83%A3%E3%83%AC%E3%83%B3%E3%82%B8-2"></a>
</h3>
<div class="callout-content">
<ol style="list-style-type: decimal">
<li>各サンプルで分析された遺伝子の数は？</li>
<li>group_by()<code>と</code>summarise()\`を使用して、各サンプルのシーケンス深度（全カウントの合計）を評価する。
シーケンス深度が最も深いサンプルはどれですか？
シーケンス深度が最も深いサンプルはどれですか？</li>
<li>サンプルを1つ選び、バイオタイプ別に遺伝子数を評価する。</li>
<li>DNAメチル化異常」という表現型に関連する遺伝子を特定し、時間0、時間4、時間8における平均発現量（対数）を計算する。</li>
</ol>
</div>
</div>
</div>
<div id="accordionSolution4" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution4" aria-expanded="false" aria-controls="collapseSolution4">
  <h4 class="accordion-header" id="headingSolution4">
  ソリューション
  </h4>
</button>
<div id="collapseSolution4" class="accordion-collapse collapse" data-bs-parent="#accordionSolution4" aria-labelledby="headingSolution4">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb68">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode r" tabindex="0"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" tabindex="-1"></a><span class="do">##</span></span>
<span id="cb68-2"><a href="#cb68-2" tabindex="-1"></a>rna <span class="sc">%&gt;%</span></span>
<span id="cb68-3"><a href="#cb68-3" tabindex="-1"></a>  <span class="fu">count</span>(sample)</span>
<span id="cb68-4"><a href="#cb68-4" tabindex="-1"></a><span class="do">## 2.</span></span>
<span id="cb68-5"><a href="#cb68-5" tabindex="-1"></a>rna <span class="sc">%&gt;%</span></span>
<span id="cb68-6"><a href="#cb68-6" tabindex="-1"></a>  <span class="fu">group_by</span>(sample) <span class="sc">%&gt;%</span></span>
<span id="cb68-7"><a href="#cb68-7" tabindex="-1"></a>  <span class="fu">summary</span>(<span class="at">seq_depth =</span> <span class="fu">sum</span>(expression)) <span class="sc">%&gt;%</span></span>
<span id="cb68-8"><a href="#cb68-8" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(seq_depth))</span>
<span id="cb68-9"><a href="#cb68-9" tabindex="-1"></a><span class="do">## 3.</span></span>
<span id="cb68-10"><a href="#cb68-10" tabindex="-1"></a>rna <span class="sc">%&gt;%</span></span>
<span id="cb68-11"><a href="#cb68-11" tabindex="-1"></a>  <span class="fu">filter</span>(sample <span class="sc">==</span> <span class="st">"GSM2545336"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb68-12"><a href="#cb68-12" tabindex="-1"></a>  <span class="fu">count</span>(gene_biotype) <span class="sc">%&gt;%</span></span>
<span id="cb68-13"><a href="#cb68-13" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(n))</span>
<span id="cb68-14"><a href="#cb68-14" tabindex="-1"></a><span class="do">## 4.</span></span>
<span id="cb68-15"><a href="#cb68-15" tabindex="-1"></a>rna <span class="sc">%&gt;%</span></span>
<span id="cb68-16"><a href="#cb68-16" tabindex="-1"></a>  <span class="fu">filter</span>(phenotype_description <span class="sc">==</span> <span class="st">"abnormal DNA methylation"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb68-17"><a href="#cb68-17" tabindex="-1"></a>  <span class="fu">group_by</span>(gene, time) <span class="sc">%&gt;%</span></span>
<span id="cb68-18"><a href="#cb68-18" tabindex="-1"></a>  <span class="fu">summary</span>(<span class="at">mean_expression =</span> <span class="fu">mean</span>(<span class="fu">log</span>(expression)) <span class="sc">%&gt;%</span></span>
<span id="cb68-19"><a href="#cb68-19" tabindex="-1"></a>  <span class="fu">arrange</span>()</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">エラー<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error: &lt;text&gt;:20:0: unexpected end of input
18:   summary(mean_expression = mean(log(expression)) %&gt;%
19:   arrange()
   ^</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="データの再構築">データの再構築<a class="anchor" aria-label="アンカー" href="#%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E5%86%8D%E6%A7%8B%E7%AF%89"></a>
<a class="anchor" aria-label="anchor" href="#%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E5%86%8D%E6%A7%8B%E7%AF%89"></a>
</h2>
<hr class="half-width">
<p>rna<code>tibble の行には、</code>gene<code>と</code>sample\`
という2つの変数の組み合わせに関連付けられた発現値（単位）が格納されている。</p>
<p>比較を容易にするために、結果を並べ替えると便利なことがある。
arrange()\`を使って表を並べ替えることができる。
例えば、上の表を時間順に並べたいとする： または遺伝子(gene_biotype,
ENTREZ_ID, product, …)。 その他の列はすべて、
（生物、年齢、性別、…）のいずれかを記述する変数に対応している。
または遺伝子(gene_biotype, ENTREZ_ID, product, …)。
遺伝子やサンプルによって変化しない変数は、すべての行で同じ値を持つ。</p>
<div class="codewrapper sourceCode" id="cb70">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rna</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">arrange</span><span class="op">(</span><span class="va">gene</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 32,428 × 19
   gene     sample expression organism   age sex   infection strain  time tissue
   &lt;chr&gt;    &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;     &lt;chr&gt;  &lt;dbl&gt; &lt;chr&gt;
 1 AI504432 GSM25…       1230 Mus mus…     8 Fema… Influenz… C57BL…     8 Cereb…
 2 AI504432 GSM25…       1085 Mus mus…     8 Fema… NonInfec… C57BL…     0 Cereb…
 3 AI504432 GSM25…        969 Mus mus…     8 Fema… NonInfec… C57BL…     0 Cereb…
 4 AI504432 GSM25…       1284 Mus mus…     8 Fema… Influenz… C57BL…     4 Cereb…
 5 AI504432 GSM25…        966 Mus mus…     8 Male  Influenz… C57BL…     4 Cereb…
 6 AI504432 GSM25…        918 Mus mus…     8 Male  Influenz… C57BL…     8 Cereb…
 7 AI504432 GSM25…        985 Mus mus…     8 Fema… Influenz… C57BL…     8 Cereb…
 8 AI504432 GSM25…        972 Mus mus…     8 Male  NonInfec… C57BL…     0 Cereb…
 9 AI504432 GSM25…       1000 Mus mus…     8 Fema… Influenz… C57BL…     4 Cereb…
10 AI504432 GSM25…        816 Mus mus…     8 Male  Influenz… C57BL…     4 Cereb…
# ℹ 32,418 more rows
# ℹ 9 more variables: mouse &lt;dbl&gt;, ENTREZID &lt;dbl&gt;, product &lt;chr&gt;,
#   ensembl_gene_id &lt;chr&gt;, external_synonym &lt;chr&gt;, chromosome_name &lt;chr&gt;,
#   gene_biotype &lt;chr&gt;, phenotype_description &lt;chr&gt;,
#   hsapiens_homolog_associated_gene_name &lt;chr&gt;</code></pre>
</div>
<p>この構造は<code>long-format</code>と呼ばれ、1つのカラムにはすべての値、
、もう1つのカラムには値のコンテキストが列挙されている。</p>
<p>場合によっては、<code>long-format</code>は実際には
“human-readable”ではなく、別のフォーマット、
<code>wide-format</code>がよりコンパクトにデータを表現する方法として好まれる。
これは通常、科学者が
、行が遺伝子、列がサンプルを表す行列として見るのに慣れている遺伝子発現値の場合である。
これは通常、科学者が
、行が遺伝子、列がサンプルを表す行列として見るのに慣れている遺伝子発現値の場合である。</p>
<p>このフォーマットでは、
、サンプル内の遺伝子発現レベルとサンプル間の遺伝子発現レベル
の関係を調べることができる。</p>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 1,474 × 23
   gene    GSM2545336 GSM2545337 GSM2545338 GSM2545339 GSM2545340 GSM2545341
   &lt;chr&gt;        &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;
 1 Asl           1170        361        400        586        626        988
 2 Apod         36194      10347       9173      10620      13021      29594
 3 Cyp2d22       4060       1616       1603       1901       2171       3349
 4 Klk6           287        629        641        578        448        195
 5 Fcrls           85        233        244        237        180         38
 6 Slc2a4         782        231        248        265        313        786
 7 Exd2          1619       2288       2235       2513       2366       1359
 8 Gjc2           288        595        568        551        310        146
 9 Plp1         43217     101241      96534      58354      53126      27173
10 Gnb4          1071       1791       1867       1430       1355        798
# ℹ 1,464 more rows
# ℹ 16 more variables: GSM2545342 &lt;dbl&gt;, GSM2545343 &lt;dbl&gt;, GSM2545344 &lt;dbl&gt;,
#   GSM2545345 &lt;dbl&gt;, GSM2545346 &lt;dbl&gt;, GSM2545347 &lt;dbl&gt;, GSM2545348 &lt;dbl&gt;,
#   GSM2545349 &lt;dbl&gt;, GSM2545350 &lt;dbl&gt;, GSM2545351 &lt;dbl&gt;, GSM2545352 &lt;dbl&gt;,
#   GSM2545353 &lt;dbl&gt;, GSM2545354 &lt;dbl&gt;, GSM2545362 &lt;dbl&gt;, GSM2545363 &lt;dbl&gt;,
#   GSM2545380 &lt;dbl&gt;</code></pre>
</div>
<p>rna<code>の遺伝子発現値をワイドフォーマットに変換するには、 、</code>sample\`カラムの値が
、カラム変数の名前になる新しいテーブルを作成する必要がある。</p>
<p>ここでの重要なポイントは、我々はまだ
、整然としたデータ構造に従っているが、
、興味のある観察に従ってデータを<strong>整形</strong>したということである：遺伝子ごと、サンプルごとに記録する代わりに、遺伝子ごとの発現レベル
。</p>
<p>逆の変換は、列名を新しい変数の値（ ）に変換することである。</p>
<p><code>pivot_longer()</code> と <code>pivot_wider()</code> の2つの
<code>tidyr</code> 関数を使って、これらの変換を行うことができます（ <a href="https://tidyr.tidyverse.org/dev/articles/pivot.html" class="external-link">こちら</a>
を参照してください）( )。</p>
<div class="section level3">
<h3 id="より広いフォーマットへのデータのピボット">より広いフォーマットへのデータのピボット<a class="anchor" aria-label="anchor" href="#%E3%82%88%E3%82%8A%E5%BA%83%E3%81%84%E3%83%95%E3%82%A9%E3%83%BC%E3%83%9E%E3%83%83%E3%83%88%E3%81%B8%E3%81%AE%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E3%83%94%E3%83%9C%E3%83%83%E3%83%88"></a>
</h3>
<p>rna<code>の最初の3列を選択し、</code>pivot_wider()\`
を使ってデータをワイドフォーマットに変換してみよう。</p>
<div class="codewrapper sourceCode" id="cb73">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rna_exp</span> <span class="op">&lt;-</span> <span class="va">rna</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">gene</span>, <span class="va">sample</span>, <span class="va">expression</span><span class="op">)</span></span>
<span><span class="va">rna_exp</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 32,428 × 3
   gene    sample     expression
   &lt;chr&gt;   &lt;chr&gt;           &lt;dbl&gt;
 1 Asl     GSM2545336       1170
 2 Apod    GSM2545336      36194
 3 Cyp2d22 GSM2545336       4060
 4 Klk6    GSM2545336        287
 5 Fcrls   GSM2545336         85
 6 Slc2a4  GSM2545336        782
 7 Exd2    GSM2545336       1619
 8 Gjc2    GSM2545336        288
 9 Plp1    GSM2545336      43217
10 Gnb4    GSM2545336       1071
# ℹ 32,418 more rows</code></pre>
</div>
<p>pivot_wider\`は主に3つの引数を取る：</p>
<ol style="list-style-type: decimal">
<li>変換されるデータ；</li>
<li>the <code>names_from</code> : その値が新しいカラム
の名前になるカラム；</li>
<li>value_from\`: 新しいカラム を埋める値。</li>
</ol>
<figure style="text-align: center"><img src="fig/pivot_wider.png" alt="Wide pivot of the `rna` data." class="figure mx-auto d-block"><figcaption>
Wide pivot of the <code>rna</code> data.
</figcaption></figure><div class="codewrapper sourceCode" id="cb75">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rna_wide</span> <span class="op">&lt;-</span> <span class="va">rna_exp</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">pivot_wider</span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">sample</span>,</span>
<span>              values_from <span class="op">=</span> <span class="va">expression</span><span class="op">)</span></span>
<span><span class="va">rna_wide</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 1,474 × 23
   gene    GSM2545336 GSM2545337 GSM2545338 GSM2545339 GSM2545340 GSM2545341
   &lt;chr&gt;        &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;
 1 Asl           1170        361        400        586        626        988
 2 Apod         36194      10347       9173      10620      13021      29594
 3 Cyp2d22       4060       1616       1603       1901       2171       3349
 4 Klk6           287        629        641        578        448        195
 5 Fcrls           85        233        244        237        180         38
 6 Slc2a4         782        231        248        265        313        786
 7 Exd2          1619       2288       2235       2513       2366       1359
 8 Gjc2           288        595        568        551        310        146
 9 Plp1         43217     101241      96534      58354      53126      27173
10 Gnb4          1071       1791       1867       1430       1355        798
# ℹ 1,464 more rows
# ℹ 16 more variables: GSM2545342 &lt;dbl&gt;, GSM2545343 &lt;dbl&gt;, GSM2545344 &lt;dbl&gt;,
#   GSM2545345 &lt;dbl&gt;, GSM2545346 &lt;dbl&gt;, GSM2545347 &lt;dbl&gt;, GSM2545348 &lt;dbl&gt;,
#   GSM2545349 &lt;dbl&gt;, GSM2545350 &lt;dbl&gt;, GSM2545351 &lt;dbl&gt;, GSM2545352 &lt;dbl&gt;,
#   GSM2545353 &lt;dbl&gt;, GSM2545354 &lt;dbl&gt;, GSM2545362 &lt;dbl&gt;, GSM2545363 &lt;dbl&gt;,
#   GSM2545380 &lt;dbl&gt;</code></pre>
</div>
<p>デフォルトでは、<code>pivot_wider()</code> 関数は欠損値に対して
<code>NA</code> を追加することに注意してください。</p>
<p>何らかの理由で、あるサンプルで
、いくつかの遺伝子の発現値が欠落していたとしよう。
何らかの理由で、あるサンプルで
、いくつかの遺伝子の発現値が欠落していたとしよう。
以下の架空の例では、遺伝子Cyp2d22の発現値はGSM2545338サンプルの 。</p>
<div class="codewrapper sourceCode" id="cb77">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rna_with_missing_values</span> <span class="op">&lt;-</span> <span class="va">rna</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">gene</span>, <span class="va">sample</span>, <span class="va">expression</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">gene</span> <span class="op">%in%</span> <span class="fu">c</span><span class="op">(</span><span class="st">"Asl"</span>, <span class="st">"Apod"</span>, <span class="st">"Cyp2d22"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">sample</span> <span class="op">%in%</span> <span class="fu">c</span><span class="op">(</span><span class="st">"GSM2545336"</span>, <span class="st">"GSM2545337"</span>, <span class="st">"GSM2545338"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">arrange</span><span class="op">(</span><span class="va">sample</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="op">!</span><span class="op">(</span><span class="va">gene</span> <span class="op">==</span> <span class="st">"Cyp2d22"</span> <span class="op">&amp;</span> <span class="va">sample</span> <span class="op">!=</span> <span class="st">"GSM2545338"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">rna_with_missing_values</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 7 × 3
  gene    sample     expression
  &lt;chr&gt;   &lt;chr&gt;           &lt;dbl&gt;
1 Asl     GSM2545336       1170
2 Apod    GSM2545336      36194
3 Asl     GSM2545337        361
4 Apod    GSM2545337      10347
5 Asl     GSM2545338        400
6 Apod    GSM2545338       9173
7 Cyp2d22 GSM2545338       1603</code></pre>
</div>
<p>デフォルトでは、<code>pivot_wider()</code>関数は、
の値が見つからない場合に <code>NA</code> を追加する。 これは、
<code>pivot_wider()</code> 関数の <code>values_fill</code>
引数でパラメータ化できる。 summarise()\`関数</p>
<div class="codewrapper sourceCode" id="cb79">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rna_with_missing_values</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">pivot_wider</span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">sample</span>,</span>
<span>              values_from <span class="op">=</span> <span class="va">expression</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 3 × 4
  gene    GSM2545336 GSM2545337 GSM2545338
  &lt;chr&gt;        &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;
1 Asl           1170        361        400
2 Apod         36194      10347       9173
3 Cyp2d22         NA         NA       1603</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb81">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rna_with_missing_values</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">pivot_wider</span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">sample</span>,</span>
<span>              values_from <span class="op">=</span> <span class="va">expression</span>,</span>
<span>              values_fill <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 3 × 4
  gene    GSM2545336 GSM2545337 GSM2545338
  &lt;chr&gt;        &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;
1 Asl           1170        361        400
2 Apod         36194      10347       9173
3 Cyp2d22          0          0       1603</code></pre>
</div>
</div>
<div class="section level3">
<h3 id="データを長いフォーマットにピボットする">データを長いフォーマットにピボットする<a class="anchor" aria-label="anchor" href="#%E3%83%87%E3%83%BC%E3%82%BF%E3%82%92%E9%95%B7%E3%81%84%E3%83%95%E3%82%A9%E3%83%BC%E3%83%9E%E3%83%83%E3%83%88%E3%81%AB%E3%83%94%E3%83%9C%E3%83%83%E3%83%88%E3%81%99%E3%82%8B"></a>
</h3>
<p>逆の状況では、カラム名を使い、 、新しい変数のペアに変えている。
一方の変数はカラム名を
の値で表し、もう一方の変数にはカラム名に関連付けられている以前の値
が格納されている。 一方の変数はカラム名を
の値で表し、もう一方の変数にはカラム名に関連付けられている以前の値
が格納されている。</p>
<p>pivot_longer()\`は主に4つの引数を取る：</p>
<ol style="list-style-type: decimal">
<li>変換されるデータ；</li>
<li>names_to\`: の現在のカラム名で作成したい新しいカラム名；</li>
<li>value_to\`: 作成したい新しいカラム名で、 の現在の値を格納する；</li>
<li>変数 <code>names_to</code> と <code>values_to</code>
に格納する（または削除する）列の名前。</li>
</ol>
<figure style="text-align: center"><img src="fig/pivot_longer.png" alt="`rna`データのロングピボット。" class="figure mx-auto d-block"><figcaption><code>rna</code>データのロングピボット。
</figcaption></figure><p>rna_wide<code>から</code>rna_long<code>を再作成するには、</code>sample<code>というキーと</code>expression<code>という値を作成し、</code>gene<code>以外のすべてのカラム 。ここでは、</code>gene`カラム
をマイナス記号で削除する。</p>
<p>ここで、新しい変数名がどのように引用されるかに注目してください。</p>
<div class="codewrapper sourceCode" id="cb83">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rna_long</span><span class="op">&lt;-</span> <span class="va">rna_wide</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">pivot_longer</span><span class="op">(</span>names_to <span class="op">=</span> <span class="st">"sample"</span>,</span>
<span>                 values_to <span class="op">=</span> <span class="st">"expression"</span>,</span>
<span>                 <span class="op">-</span><span class="va">gene</span><span class="op">)</span></span>
<span><span class="va">rna_long</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 32,428 × 3
   gene  sample     expression
   &lt;chr&gt; &lt;chr&gt;           &lt;dbl&gt;
 1 Asl   GSM2545336       1170
 2 Asl   GSM2545337        361
 3 Asl   GSM2545338        400
 4 Asl   GSM2545339        586
 5 Asl   GSM2545340        626
 6 Asl   GSM2545341        988
 7 Asl   GSM2545342        836
 8 Asl   GSM2545343        535
 9 Asl   GSM2545344        586
10 Asl   GSM2545345        597
# ℹ 32,418 more rows</code></pre>
</div>
<p>また、 、どのようなカラムを含めるかという指定も使えたはずだ。
これは、 のカラムが多数あり、
のままにしておくよりも、何を集めるかを指定する方が簡単な場合に便利である。
また、 、どのようなカラムを含めるかという指定も使えたはずだ。 これは、
のカラムが多数あり、
のままにしておくよりも、何を集めるかを指定する方が簡単な場合に便利である。
ここで、<code>starts_with()</code>関数を使えば、
のサンプル名をすべてリストアップすることなく取得することができる！
もう一つの可能性は <code>:</code> 演算子を使うことである！
もう一つの可能性は <code>:</code> 演算子を使うことである！</p>
<div class="codewrapper sourceCode" id="cb85">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rna_wide</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">pivot_longer</span><span class="op">(</span>names_to <span class="op">=</span> <span class="st">"sample"</span>,</span>
<span>                 values_to <span class="op">=</span> <span class="st">"expression"</span>,</span>
<span>                 cols <span class="op">=</span> <span class="fu">starts_with</span><span class="op">(</span><span class="st">"GSM"</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 32,428 × 3
   gene  sample     expression
   &lt;chr&gt; &lt;chr&gt;           &lt;dbl&gt;
 1 Asl   GSM2545336       1170
 2 Asl   GSM2545337        361
 3 Asl   GSM2545338        400
 4 Asl   GSM2545339        586
 5 Asl   GSM2545340        626
 6 Asl   GSM2545341        988
 7 Asl   GSM2545342        836
 8 Asl   GSM2545343        535
 9 Asl   GSM2545344        586
10 Asl   GSM2545345        597
# ℹ 32,418 more rows</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb87">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rna_wide</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">pivot_longer</span><span class="op">(</span>names_to <span class="op">=</span> <span class="st">"sample"</span>,</span>
<span>                 values_to <span class="op">=</span> <span class="st">"expression"</span>,</span>
<span>                 <span class="va">GSM2545336</span><span class="op">:</span><span class="va">GSM2545380</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 32,428 × 3
   gene  sample     expression
   &lt;chr&gt; &lt;chr&gt;           &lt;dbl&gt;
 1 Asl   GSM2545336       1170
 2 Asl   GSM2545337        361
 3 Asl   GSM2545338        400
 4 Asl   GSM2545339        586
 5 Asl   GSM2545340        626
 6 Asl   GSM2545341        988
 7 Asl   GSM2545342        836
 8 Asl   GSM2545343        535
 9 Asl   GSM2545344        586
10 Asl   GSM2545345        597
# ℹ 32,418 more rows</code></pre>
</div>
<p>ワイドフォーマットで欠損値があった場合、新しいロングフォーマットでは<code>NA</code>が
。</p>
<p>前回の欠損値を含む架空のティブルを思い出してほしい：</p>
<div class="codewrapper sourceCode" id="cb89">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rna_with_missing_values</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 7 × 3
  gene    sample     expression
  &lt;chr&gt;   &lt;chr&gt;           &lt;dbl&gt;
1 Asl     GSM2545336       1170
2 Apod    GSM2545336      36194
3 Asl     GSM2545337        361
4 Apod    GSM2545337      10347
5 Asl     GSM2545338        400
6 Apod    GSM2545338       9173
7 Cyp2d22 GSM2545338       1603</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb91">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wide_with_NA</span><span class="op">&lt;-</span> <span class="va">rna_with_missing_values</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">pivot_wider</span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">sample</span>,</span>
<span>              values_from <span class="op">=</span> <span class="va">expression</span><span class="op">)</span></span>
<span><span class="va">wide_with_NA</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 3 × 4
  gene    GSM2545336 GSM2545337 GSM2545338
  &lt;chr&gt;        &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;
1 Asl           1170        361        400
2 Apod         36194      10347       9173
3 Cyp2d22         NA         NA       1603</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb93">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wide_with_NA</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">pivot_longer</span><span class="op">(</span>names_to <span class="op">=</span> <span class="st">"sample"</span>,</span>
<span>                 values_to <span class="op">=</span> <span class="st">"expression"</span>,</span>
<span>                 <span class="op">-</span><span class="va">gene</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 9 × 3
  gene    sample     expression
  &lt;chr&gt;   &lt;chr&gt;           &lt;dbl&gt;
1 Asl     GSM2545336       1170
2 Asl     GSM2545337        361
3 Asl     GSM2545338        400
4 Apod    GSM2545336      36194
5 Apod    GSM2545337      10347
6 Apod    GSM2545338       9173
7 Cyp2d22 GSM2545336         NA
8 Cyp2d22 GSM2545337         NA
9 Cyp2d22 GSM2545338       1603</code></pre>
</div>
<p>より幅の広い、より長いフォーマットへの移行は、データセットのバランスをとるのに有効な方法である。
、どの複製も同じ構成になる。</p>
<div id="質問" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="質問" class="callout-inner">
<h3 class="callout-title">質問<a class="anchor" aria-label="アンカー" href="#%E8%B3%AA%E5%95%8F"></a>
</h3>
<div class="callout-content">
<p>マウス遺伝子の中にはヒトにホモログがないものもある。 これらは、
<code>filter()</code> と、 何かが <code>NA</code> かどうかを判定する
<code>is.na()</code> 関数を使って取得することができる。
rnaテーブルから始めて、<code>pivot_wider()</code>関数を使用して、
、各マウスの遺伝子発現レベルを示すワイドフォーマットのテーブルを作成する。
そして、<code>pivot_longer()</code>関数を使って、ロングフォーマットの表を復元する。</p>
</div>
</div>
</div>
<div id="accordionSolution5" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution5" aria-expanded="false" aria-controls="collapseSolution5">
  <h4 class="accordion-header" id="headingSolution5">
  ソリューション
  </h4>
</button>
<div id="collapseSolution5" class="accordion-collapse collapse" data-bs-parent="#accordionSolution5" aria-labelledby="headingSolution5">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb95">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rna1</span><span class="op">&lt;-</span> <span class="va">rna</span> <span class="op">%&gt;%</span></span>
<span><span class="fu">select</span><span class="op">(</span><span class="va">gene</span>, <span class="va">mouse</span>, <span class="va">expression</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span><span class="fu">pivot_wider</span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">mouse</span>, values_from <span class="op">=</span> <span class="va">expression</span><span class="op">)</span></span>
<span><span class="va">rna1</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 1,474 × 23
   gene     `14`    `9`  `10`  `15`  `18`   `6`   `5`  `11`  `22`  `13`  `23`
   &lt;chr&gt;   &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
 1 Asl      1170    361   400   586   626   988   836   535   586   597   938
 2 Apod    36194  10347  9173 10620 13021 29594 24959 13668 13230 15868 27769
 3 Cyp2d22  4060   1616  1603  1901  2171  3349  3122  2008  2254  2277  2985
 4 Klk6      287    629   641   578   448   195   186  1101   537   567   327
 5 Fcrls      85    233   244   237   180    38    68   375   199   177    89
 6 Slc2a4    782    231   248   265   313   786   528   249   266   357   654
 7 Exd2     1619   2288  2235  2513  2366  1359  1474  3126  2379  2173  1531
 8 Gjc2      288    595   568   551   310   146   186   791   454   370   240
 9 Plp1    43217 101241 96534 58354 53126 27173 28728 98658 61356 61647 38019
10 Gnb4     1071   1791  1867  1430  1355   798   806  2437  1394  1554   960
# ℹ 1,464 more rows
# ℹ 11 more variables: `24` &lt;dbl&gt;, `8` &lt;dbl&gt;, `7` &lt;dbl&gt;, `1` &lt;dbl&gt;, `16` &lt;dbl&gt;,
#   `21` &lt;dbl&gt;, `4` &lt;dbl&gt;, `2` &lt;dbl&gt;, `20` &lt;dbl&gt;, `12` &lt;dbl&gt;, `19` &lt;dbl&gt;</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb97">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rna1</span> <span class="op">%&gt;%</span></span>
<span><span class="fu">pivot_longer</span><span class="op">(</span>names_to <span class="op">=</span> <span class="st">"mouse_id"</span>, values_to <span class="op">=</span> <span class="st">"counts"</span>, <span class="op">-</span><span class="va">gene</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 32,428 × 3
   gene  mouse_id counts
   &lt;chr&gt; &lt;chr&gt;     &lt;dbl&gt;
 1 Asl   14         1170
 2 Asl   9           361
 3 Asl   10          400
 4 Asl   15          586
 5 Asl   18          626
 6 Asl   6           988
 7 Asl   5           836
 8 Asl   11          535
 9 Asl   22          586
10 Asl   13          597
# ℹ 32,418 more rows</code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="質問-1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="質問-1" class="callout-inner">
<h3 class="callout-title">質問<a class="anchor" aria-label="アンカー" href="#%E8%B3%AA%E5%95%8F-1"></a>
</h3>
<div class="callout-content">
<p><code>rna</code>データフレームから X 染色体と Y
染色体に位置する遺伝子をサブセットし、<code>sex</code>
を列、<code>chromosome_name\\</code> を
行、各染色体に位置する遺伝子の平均発現量を値として、
以下のようにデータフレームを広げる：</p>
<figure><img src="fig/Exercise_pivot_W.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>整形する前にまとめる必要がある！</p>
</div>
</div>
</div>
<div id="accordionSolution6" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution6" aria-expanded="false" aria-controls="collapseSolution6">
  <h4 class="accordion-header" id="headingSolution6">
  ソリューション
  </h4>
</button>
<div id="collapseSolution6" class="accordion-collapse collapse" data-bs-parent="#accordionSolution6" aria-labelledby="headingSolution6">
<div class="accordion-body">
<p>まず、
男性と女性のサンプルから、XとYの連鎖遺伝子の平均発現量を計算してみよう…</p>
<div class="codewrapper sourceCode" id="cb99">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span> <span class="va">rna</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">chromosome_name</span> <span class="op">==</span> <span class="st">"Y"</span> <span class="op">|</span> <span class="va">chromosome_name</span> <span class="op">==</span> <span class="st">"X"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">sex</span>, <span class="va">chromosome_name</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">summise</span><span class="op">(</span>mean <span class="op">=</span> <span class="fu">mean</span><span class="op">(</span><span class="va">expression</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">エラー<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in summise(., mean = mean(expression)): could not find function "summise"</code></pre>
</div>
<p>そして、表をワイドフォーマットにピボットする</p>
<div class="codewrapper sourceCode" id="cb101">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rna_1</span><span class="op">&lt;-</span> <span class="va">rna</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">chromosome_name</span> <span class="op">==</span> <span class="st">"Y"</span> <span class="op">|</span> <span class="va">chromosome_name</span> <span class="op">==</span> <span class="st">"X"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">sex</span>, <span class="va">chromosome_name</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">summise</span><span class="op">(</span>mean <span class="op">=</span> <span class="fu">mean</span><span class="op">(</span><span class="va">expression</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">pivot_wider</span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">sex</span>,</span>
<span>              values_from <span class="op">=</span> <span class="va">mean</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">エラー<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in summise(., mean = mean(expression)): could not find function "summise"</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb103">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rna_1</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">エラー<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in eval(expr, envir, enclos): object 'rna_1' not found</code></pre>
</div>
<p>各行が一意な <code>chromosome_name</code> と <code>gender</code>
の組み合わせになるように、このデータフレームを
<code>pivot_longer()</code> で変換する。</p>
<div class="codewrapper sourceCode" id="cb105">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rna_1</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">pivot_longer</span><span class="op">(</span>names_to <span class="op">=</span> <span class="st">"gender"</span>,</span>
<span>               values_to <span class="op">=</span> <span class="st">"mean"</span>,</span>
<span>               <span class="op">-</span><span class="va">chromosome_name</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">エラー<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in eval(expr, envir, enclos): object 'rna_1' not found</code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="質問-2" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="質問-2" class="callout-inner">
<h3 class="callout-title">質問<a class="anchor" aria-label="アンカー" href="#%E8%B3%AA%E5%95%8F-2"></a>
</h3>
<div class="callout-content">
<p>rna\`データセットを使って、 各行が遺伝子の平均発現量を表し、
各列が異なるタイムポイントを表す発現行列を作成する。</p>
</div>
</div>
</div>
<div id="accordionSolution7" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution7" aria-expanded="false" aria-controls="collapseSolution7">
  <h4 class="accordion-header" id="headingSolution7">
  ソリューション
  </h4>
</button>
<div id="collapseSolution7" class="accordion-collapse collapse" data-bs-parent="#accordionSolution7" aria-labelledby="headingSolution7">
<div class="accordion-body">
<p>まず、遺伝子別、時間別の平均発現量を計算してみよう。</p>
<div class="codewrapper sourceCode" id="cb107">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rna</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">gene</span>, <span class="va">time</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">summarise</span><span class="op">(</span>mean_exp <span class="op">=</span> <span class="fu">mean</span><span class="op">(</span><span class="va">expression</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>`summarise()` has grouped output by 'gene'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 4,422 × 3
# Groups:   gene [1,474]
   gene      time mean_exp
   &lt;chr&gt;    &lt;dbl&gt;    &lt;dbl&gt;
 1 AI504432     0    1034.
 2 AI504432     4    1104.
 3 AI504432     8    1014
 4 AW046200     0     155.
 5 AW046200     4     152.
 6 AW046200     8      81
 7 AW551984     0     238
 8 AW551984     4     302.
 9 AW551984     8     342.
10 Aamp         0    4603.
# ℹ 4,412 more rows</code></pre>
</div>
<p>pivot_wider()関数を使用する前に</p>
<div class="codewrapper sourceCode" id="cb110">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rna_time</span><span class="op">&lt;-</span> <span class="va">rna</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">gene</span>, <span class="va">time</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">summarise</span><span class="op">(</span>mean_exp <span class="op">=</span> <span class="fu">mean</span><span class="op">(</span><span class="va">expression</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">pivot_wider</span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">time</span>,</span>
<span>              values_from <span class="op">=</span> <span class="va">mean_exp</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>`summarise()` has grouped output by 'gene'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb112">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rna_time</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 1,474 × 4
# Groups:   gene [1,474]
   gene         `0`     `4`     `8`
   &lt;chr&gt;      &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
 1 AI504432 1034.   1104.   1014
 2 AW046200  155.    152.     81
 3 AW551984  238     302.    342.
 4 Aamp     4603.   4870    4763.
 5 Abca12      5.29    4.25    4.14
 6 Abcc8    2576.   2609.   2292.
 7 Abhd14a   591.    547.    432.
 8 Abi2     4881.   4903.   4945.
 9 Abi3bp   1175.   1061.    762.
10 Abl2     2170.   2078.   2131.
# ℹ 1,464 more rows</code></pre>
</div>
<p>これにより、数字で始まるカラム名を持つティブルが生成されることに注意。
これにより、数字で始まるカラム名を持つティブルが生成されることに注意。
タイムポイントに対応するカラムを選択したい場合、
、カラム名を直接使うことはできない。 列4を選択するとどうなるか？
列4を選択するとどうなるか？</p>
<div class="codewrapper sourceCode" id="cb114">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rna</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">gene</span>, <span class="va">time</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">summary</span><span class="op">(</span>mean_exp <span class="op">=</span> <span class="fu">mean</span><span class="op">(</span><span class="va">expression</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">pivot_wider</span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">time</span>,</span>
<span>              values_from <span class="op">=</span> <span class="va">mean_exp</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">gene</span>, <span class="fl">4</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">エラー<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in UseMethod("pivot_wider"): no applicable method for 'pivot_wider' applied to an object of class "table"</code></pre>
</div>
<p>タイムポイント4を選択するには、“˶\`”
というバックスティックを付けたカラム名を引用しなければならない。</p>
<div class="codewrapper sourceCode" id="cb116">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rna</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">gene</span>, <span class="va">time</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">summarise</span><span class="op">(</span>mean_exp <span class="op">=</span> <span class="fu">mean</span><span class="op">(</span><span class="va">expression</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">pivot_wider</span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">time</span>,</span>
<span>              values_from <span class="op">=</span> <span class="va">mean_exp</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">gene</span>, <span class="va">`4`</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>`summarise()` has grouped output by 'gene'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 1,474 × 2
# Groups:   gene [1,474]
   gene         `4`
   &lt;chr&gt;      &lt;dbl&gt;
 1 AI504432 1104.
 2 AW046200  152.
 3 AW551984  302.
 4 Aamp     4870
 5 Abca12      4.25
 6 Abcc8    2609.
 7 Abhd14a   547.
 8 Abi2     4903.
 9 Abi3bp   1061.
10 Abl2     2078.
# ℹ 1,464 more rows</code></pre>
</div>
<p>、数字で始まらない名前を選択する：</p>
<div class="codewrapper sourceCode" id="cb119">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rna</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">gene</span>, <span class="va">time</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">summary</span><span class="op">(</span>mean_exp <span class="op">=</span> <span class="fu">mean</span><span class="op">(</span><span class="va">expression</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">pivot_wider</span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">time</span>,</span>
<span>              values_from <span class="op">=</span> <span class="va">mean_exp</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">rename</span><span class="op">(</span><span class="st">"time0"</span> <span class="op">=</span> <span class="va">`0`</span>, <span class="st">"time4"</span> <span class="op">=</span> <span class="va">`4`</span>, <span class="st">"time8"</span> <span class="op">=</span> <span class="va">`8`</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">gene</span>, <span class="va">time4</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">エラー<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in UseMethod("pivot_wider"): no applicable method for 'pivot_wider' applied to an object of class "table"</code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="質問-3" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="質問-3" class="callout-inner">
<h3 class="callout-title">質問<a class="anchor" aria-label="アンカー" href="#%E8%B3%AA%E5%95%8F-3"></a>
</h3>
<div class="callout-content">
<p>タイムポイントごとの平均発現レベルを含む前のデータフレームを使用し、
、タイムポイント8とタイムポイント0の間のfold-changes、およびタイムポイント8とタイムポイント4の間のfold-changes
を含む新しい列を作成する。
この表を、計算されたフォールド・チェンジを集めたロングフォーマットの表に変換する。
この表を、計算されたフォールド・チェンジを集めたロングフォーマットの表に変換する。</p>
</div>
</div>
</div>
<div id="accordionSolution8" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution8" aria-expanded="false" aria-controls="collapseSolution8">
  <h4 class="accordion-header" id="headingSolution8">
  ソリューション
  </h4>
</button>
<div id="collapseSolution8" class="accordion-collapse collapse" data-bs-parent="#accordionSolution8" aria-labelledby="headingSolution8">
<div class="accordion-body">
<p>rna_time tibbleから開始する：</p>
<div class="codewrapper sourceCode" id="cb121">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rna_time</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 1,474 × 4
# Groups:   gene [1,474]
   gene         `0`     `4`     `8`
   &lt;chr&gt;      &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
 1 AI504432 1034.   1104.   1014
 2 AW046200  155.    152.     81
 3 AW551984  238     302.    342.
 4 Aamp     4603.   4870    4763.
 5 Abca12      5.29    4.25    4.14
 6 Abcc8    2576.   2609.   2292.
 7 Abhd14a   591.    547.    432.
 8 Abi2     4881.   4903.   4945.
 9 Abi3bp   1175.   1061.    762.
10 Abl2     2170.   2078.   2131.
# ℹ 1,464 more rows</code></pre>
</div>
<p>フォールドチェンジを計算する：</p>
<div class="codewrapper sourceCode" id="cb123">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rna_time</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>time_8_vs_0 <span class="op">=</span> <span class="va">`8`</span> <span class="op">/</span> <span class="va">`0`</span>, time_8_vs_4 <span class="op">=</span> <span class="va">`8`</span> <span class="op">/</span> <span class="va">`4`</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 1,474 × 6
# Groups:   gene [1,474]
   gene         `0`     `4`     `8` time_8_vs_0 time_8_vs_4
   &lt;chr&gt;      &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;
 1 AI504432 1034.   1104.   1014          0.981       0.918
 2 AW046200  155.    152.     81          0.522       0.532
 3 AW551984  238     302.    342.         1.44        1.13
 4 Aamp     4603.   4870    4763.         1.03        0.978
 5 Abca12      5.29    4.25    4.14       0.784       0.975
 6 Abcc8    2576.   2609.   2292.         0.889       0.878
 7 Abhd14a   591.    547.    432.         0.731       0.791
 8 Abi2     4881.   4903.   4945.         1.01        1.01
 9 Abi3bp   1175.   1061.    762.         0.649       0.719
10 Abl2     2170.   2078.   2131.         0.982       1.03
# ℹ 1,464 more rows</code></pre>
</div>
<p>そして、pivot_longer()関数を使用する：</p>
<div class="codewrapper sourceCode" id="cb125">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rna_time</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>time_8_vs_0 <span class="op">=</span> <span class="va">`8`</span> <span class="op">/</span> <span class="va">`0`</span>, time_8_vs_4 <span class="op">=</span> <span class="va">`8`</span> <span class="op">/</span> <span class="va">`4`</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">pivot_longer</span><span class="op">(</span>names_to <span class="op">=</span> <span class="st">"comparisons"</span>,</span>
<span>               values_to <span class="op">=</span> <span class="st">"Fold_changes"</span>,</span>
<span>               <span class="va">time_8_vs_0</span><span class="op">:</span><span class="va">time_8_vs_4</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 2,948 × 6
# Groups:   gene [1,474]
   gene         `0`     `4`     `8` comparisons Fold_changes
   &lt;chr&gt;      &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;              &lt;dbl&gt;
 1 AI504432 1034.   1104.   1014    time_8_vs_0        0.981
 2 AI504432 1034.   1104.   1014    time_8_vs_4        0.918
 3 AW046200  155.    152.     81    time_8_vs_0        0.522
 4 AW046200  155.    152.     81    time_8_vs_4        0.532
 5 AW551984  238     302.    342.   time_8_vs_0        1.44
 6 AW551984  238     302.    342.   time_8_vs_4        1.13
 7 Aamp     4603.   4870    4763.   time_8_vs_0        1.03
 8 Aamp     4603.   4870    4763.   time_8_vs_4        0.978
 9 Abca12      5.29    4.25    4.14 time_8_vs_0        0.784
10 Abca12      5.29    4.25    4.14 time_8_vs_4        0.975
# ℹ 2,938 more rows</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="テーブルの結合">テーブルの結合<a class="anchor" aria-label="アンカー" href="#%E3%83%86%E3%83%BC%E3%83%96%E3%83%AB%E3%81%AE%E7%B5%90%E5%90%88"></a>
<a class="anchor" aria-label="anchor" href="#%E3%83%86%E3%83%BC%E3%83%96%E3%83%AB%E3%81%AE%E7%B5%90%E5%90%88"></a>
</h2>
<hr class="half-width">
<p>実生活の多くの場面で、データは複数のテーブルにまたがっている。
通常このようなことが起こるのは、異なる情報源から異なるタイプの情報が
収集されるからである。
通常このようなことが起こるのは、異なる情報源から異なるタイプの情報が
収集されるからである。</p>
<p>分析によっては、2つ以上のテーブル（
）のデータを、すべてのテーブルに共通するカラム（
）に基づいて1つのデータフレームにまとめることが望ましい場合がある。</p>
<p>dplyr\` パッケージは、指定されたカラム内のマッチに基づいて、2つの
データフレームを結合するための結合関数のセットを提供する。 ここでは、
、結合について簡単に紹介する。 詳しくは、 テーブル
ジョインの章を参照されたい。 データ変換チート シート
、テーブル結合に関する簡単な概要も提供している。 ここでは、
、結合について簡単に紹介する。 詳しくは、 テーブル
ジョインの章を参照されたい。 データ変換チート シート
、テーブル結合に関する簡単な概要も提供している。</p>
<p>、元の<code>rna</code>テーブルをサブセットして作成し、
、3つのカラムと10行だけを残す。</p>
<div class="codewrapper sourceCode" id="cb127">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rna_mini</span><span class="op">&lt;-</span> <span class="va">rna</span> <span class="op">%&gt;%</span></span>
<span>   <span class="fu">select</span><span class="op">(</span><span class="va">gene</span>, <span class="va">sample</span>, <span class="va">expression</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>   <span class="fu">head</span><span class="op">(</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">rna_mini</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 10 × 3
   gene    sample     expression
   &lt;chr&gt;   &lt;chr&gt;           &lt;dbl&gt;
 1 Asl     GSM2545336       1170
 2 Apod    GSM2545336      36194
 3 Cyp2d22 GSM2545336       4060
 4 Klk6    GSM2545336        287
 5 Fcrls   GSM2545336         85
 6 Slc2a4  GSM2545336        782
 7 Exd2    GSM2545336       1619
 8 Gjc2    GSM2545336        288
 9 Plp1    GSM2545336      43217
10 Gnb4    GSM2545336       1071</code></pre>
</div>
<p>2番目のテーブル<code>annot1</code>には、遺伝子と
gene_descriptionの2つのカラムがある。
2番目のテーブル<code>annot1</code>には、遺伝子と
gene_descriptionの2つのカラムがある。 <a href="https://carpentries-incubator.github.io/bioc-intro/data/annot1.csv" class="external-link">download
annot1.csv</a>
リンクをクリックして<code>data/</code>フォルダに移動するか、
以下のRコードを使って直接フォルダにダウンロードすることができる。</p>
<div class="codewrapper sourceCode" id="cb129">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">download.file</span><span class="op">(</span>url <span class="op">=</span> <span class="st">"https://carpentries-incubator.github.io/bioc-intro/data/annot1.csv"</span>,</span>
<span>              destfile <span class="op">=</span> <span class="st">"data/annot1.csv"</span><span class="op">)</span></span>
<span><span class="va">annot1</span> <span class="op">&lt;-</span> <span class="fu">read_csv</span><span class="op">(</span>file <span class="op">=</span> <span class="st">"data/annot1.csv"</span><span class="op">)</span></span>
<span><span class="va">annot1</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 10 × 2
   gene    gene_description
   &lt;chr&gt;   &lt;chr&gt;
 1 Cyp2d22 cytochrome P450, family 2, subfamily d, polypeptide 22 [Source:MGI S…
 2 Klk6    kallikrein related-peptidase 6 [Source:MGI Symbol;Acc:MGI:1343166]
 3 Fcrls   Fc receptor-like S, scavenger receptor [Source:MGI Symbol;Acc:MGI:19…
 4 Plp1    proteolipid protein (myelin) 1 [Source:MGI Symbol;Acc:MGI:97623]
 5 Exd2    exonuclease 3'-5' domain containing 2 [Source:MGI Symbol;Acc:MGI:192…
 6 Apod    apolipoprotein D [Source:MGI Symbol;Acc:MGI:88056]
 7 Gnb4    guanine nucleotide binding protein (G protein), beta 4 [Source:MGI S…
 8 Slc2a4  solute carrier family 2 (facilitated glucose transporter), member 4 …
 9 Asl     argininosuccinate lyase [Source:MGI Symbol;Acc:MGI:88084]
10 Gjc2    gap junction protein, gamma 2 [Source:MGI Symbol;Acc:MGI:2153060]    </code></pre>
</div>
<p>ここで、<code>dplyr</code> パッケージの <code>full_join()</code>
関数を使用して、これら2つのテーブルを、すべての
変数を含む1つのテーブルに結合したいと思います。
関数は、最初のテーブルと2番目のテーブルの列
に一致する共通変数を自動的に見つける。
この場合、<code>gene</code>は共通の 。 このような変数をキーと呼ぶ。
キーは、
オブザベーションを異なるテーブル間でマッチさせるために使用される。
関数は、最初のテーブルと2番目のテーブルの列
に一致する共通変数を自動的に見つける。
この場合、<code>gene</code>は共通の 。 このような変数をキーと呼ぶ。
キーは、
オブザベーションを異なるテーブル間でマッチさせるために使用される。</p>
<div class="codewrapper sourceCode" id="cb131">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">full_join</span><span class="op">(</span><span class="va">rna_mini</span>, <span class="va">annot1</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Joining with `by = join_by(gene)`</code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 10 × 4
   gene    sample     expression gene_description
   &lt;chr&gt;   &lt;chr&gt;           &lt;dbl&gt; &lt;chr&gt;
 1 Asl     GSM2545336       1170 argininosuccinate lyase [Source:MGI Symbol;Acc…
 2 Apod    GSM2545336      36194 apolipoprotein D [Source:MGI Symbol;Acc:MGI:88…
 3 Cyp2d22 GSM2545336       4060 cytochrome P450, family 2, subfamily d, polype…
 4 Klk6    GSM2545336        287 kallikrein related-peptidase 6 [Source:MGI Sym…
 5 Fcrls   GSM2545336         85 Fc receptor-like S, scavenger receptor [Source…
 6 Slc2a4  GSM2545336        782 solute carrier family 2 (facilitated glucose t…
 7 Exd2    GSM2545336       1619 exonuclease 3'-5' domain containing 2 [Source:…
 8 Gjc2    GSM2545336        288 gap junction protein, gamma 2 [Source:MGI Symb…
 9 Plp1    GSM2545336      43217 proteolipid protein (myelin) 1 [Source:MGI Sym…
10 Gnb4    GSM2545336       1071 guanine nucleotide binding protein (G protein)…</code></pre>
</div>
<p>実生活では、遺伝子アノテーションのラベルが異なることがある。</p>
<p>annot2<code>テーブルは、遺伝子名を含む 変数のラベルが異なる以外は、</code>annot1<code>と全く同じである。 この場合も、 [download annot2.csv](https://carpentries-incubator.github.io/bioc-intro/data/annot2.csv) 、自分で</code>data/`に移動するか、以下のRコードを使う。
この場合も、 <a href="https://carpentries-incubator.github.io/bioc-intro/data/annot2.csv" class="external-link">download
annot2.csv</a>
、自分で<code>data/\</code>に移動するか、以下のRコードを使う。</p>
<div class="codewrapper sourceCode" id="cb134">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">download.file</span><span class="op">(</span>url <span class="op">=</span> <span class="st">"https://carpentries-incubator.github.io/bioc-intro/data/annot2.csv"</span>,</span>
<span>              destfile <span class="op">=</span> <span class="st">"data/annot2.csv"</span><span class="op">)</span></span>
<span><span class="va">annot2</span> <span class="op">&lt;-</span> <span class="fu">read_csv</span><span class="op">(</span>file <span class="op">=</span> <span class="st">"data/annot2.csv"</span><span class="op">)</span></span>
<span><span class="va">annot2</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 10 × 2
   external_gene_name description
   &lt;chr&gt;              &lt;chr&gt;
 1 Cyp2d22            cytochrome P450, family 2, subfamily d, polypeptide 22 [S…
 2 Klk6               kallikrein related-peptidase 6 [Source:MGI Symbol;Acc:MGI…
 3 Fcrls              Fc receptor-like S, scavenger receptor [Source:MGI Symbol…
 4 Plp1               proteolipid protein (myelin) 1 [Source:MGI Symbol;Acc:MGI…
 5 Exd2               exonuclease 3'-5' domain containing 2 [Source:MGI Symbol;…
 6 Apod               apolipoprotein D [Source:MGI Symbol;Acc:MGI:88056]
 7 Gnb4               guanine nucleotide binding protein (G protein), beta 4 [S…
 8 Slc2a4             solute carrier family 2 (facilitated glucose transporter)…
 9 Asl                argininosuccinate lyase [Source:MGI Symbol;Acc:MGI:88084]
10 Gjc2               gap junction protein, gamma 2 [Source:MGI Symbol;Acc:MGI:…</code></pre>
</div>
<p>どの変数名も一致しない場合、マッチングに使用する
変数を手動で設定することができる。
どの変数名も一致しない場合、マッチングに使用する
変数を手動で設定することができる。 これらの変数は、<code>rna_mini</code>
と <code>annot2</code> テーブルを使用して以下に示すように、
<code>by</code> 引数を使用して設定することができる。</p>
<div class="codewrapper sourceCode" id="cb136">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">full_join</span><span class="op">(</span><span class="va">rna_mini</span>, <span class="va">annot2</span>, by <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="st">"gene"</span> <span class="op">=</span> <span class="st">"external_gene_name"</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 10 × 4
   gene    sample     expression description
   &lt;chr&gt;   &lt;chr&gt;           &lt;dbl&gt; &lt;chr&gt;
 1 Asl     GSM2545336       1170 argininosuccinate lyase [Source:MGI Symbol;Acc…
 2 Apod    GSM2545336      36194 apolipoprotein D [Source:MGI Symbol;Acc:MGI:88…
 3 Cyp2d22 GSM2545336       4060 cytochrome P450, family 2, subfamily d, polype…
 4 Klk6    GSM2545336        287 kallikrein related-peptidase 6 [Source:MGI Sym…
 5 Fcrls   GSM2545336         85 Fc receptor-like S, scavenger receptor [Source…
 6 Slc2a4  GSM2545336        782 solute carrier family 2 (facilitated glucose t…
 7 Exd2    GSM2545336       1619 exonuclease 3'-5' domain containing 2 [Source:…
 8 Gjc2    GSM2545336        288 gap junction protein, gamma 2 [Source:MGI Symb…
 9 Plp1    GSM2545336      43217 proteolipid protein (myelin) 1 [Source:MGI Sym…
10 Gnb4    GSM2545336       1071 guanine nucleotide binding protein (G protein)…</code></pre>
</div>
<p>上で見たように、最初のテーブルの変数名は、結合されたテーブルでも
。</p>
<div id="チャレンジだ-1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジだ-1" class="callout-inner">
<h3 class="callout-title">チャレンジだ：<a class="anchor" aria-label="アンカー" href="#%E3%83%81%E3%83%A3%E3%83%AC%E3%83%B3%E3%82%B8%E3%81%A0-1"></a>
</h3>
<div class="callout-content">
<p><a href="https://carpentries-incubator.github.io/bioc-intro/data/annot3.csv" class="external-link">こちら</a>
をクリックして <code>annot3</code>
テーブルをダウンロードし、そのテーブルをあなたの data/
リポジトリに置いてください。
full_join()<code>関数を使用して、テーブル</code>rna_mini<code>と</code>annot3`
を結合する。
、遺伝子_Klk6_、<em>mt-Tf</em>、<em>mt-Rnr1</em>、<em>mt-Tv</em>、<em>mt-Rnr2</em>、<em>mt-Tl1_はどうなったのか？
full_join()<code>関数を使用して、テーブル</code>rna_mini<code>と</code>annot3`
を結合する。
、遺伝子_Klk6</em>、<em>mt-Tf</em>、<em>mt-Rnr1</em>、<em>mt-Tv</em>、<em>mt-Rnr2</em>、_mt-Tl1_はどうなったのか？</p>
</div>
</div>
</div>
<div id="accordionSolution9" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution9" aria-expanded="false" aria-controls="collapseSolution9">
  <h4 class="accordion-header" id="headingSolution9">
  ソリューション
  </h4>
</button>
<div id="collapseSolution9" class="accordion-collapse collapse" data-bs-parent="#accordionSolution9" aria-labelledby="headingSolution9">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb138">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">annot3</span> <span class="op">&lt;-</span> <span class="fu">read_csv</span><span class="op">(</span><span class="st">"data/annot3.csv"</span><span class="op">)</span></span>
<span><span class="fu">full_join</span><span class="op">(</span><span class="va">rna_mini</span>, <span class="va">annot3</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 15 × 4
   gene    sample     expression gene_description
   &lt;chr&gt;   &lt;chr&gt;           &lt;dbl&gt; &lt;chr&gt;
 1 Asl     GSM2545336       1170 argininosuccinate lyase [Source:MGI Symbol;Acc…
 2 Apod    GSM2545336      36194 apolipoprotein D [Source:MGI Symbol;Acc:MGI:88…
 3 Cyp2d22 GSM2545336       4060 cytochrome P450, family 2, subfamily d, polype…
 4 Klk6    GSM2545336        287 &lt;NA&gt;
 5 Fcrls   GSM2545336         85 Fc receptor-like S, scavenger receptor [Source…
 6 Slc2a4  GSM2545336        782 solute carrier family 2 (facilitated glucose t…
 7 Exd2    GSM2545336       1619 exonuclease 3'-5' domain containing 2 [Source:…
 8 Gjc2    GSM2545336        288 gap junction protein, gamma 2 [Source:MGI Symb…
 9 Plp1    GSM2545336      43217 proteolipid protein (myelin) 1 [Source:MGI Sym…
10 Gnb4    GSM2545336       1071 guanine nucleotide binding protein (G protein)…
11 mt-Tf   &lt;NA&gt;               NA mitochondrially encoded tRNA phenylalanine [So…
12 mt-Rnr1 &lt;NA&gt;               NA mitochondrially encoded 12S rRNA [Source:MGI S…
13 mt-Tv   &lt;NA&gt;               NA mitochondrially encoded tRNA valine [Source:MG…
14 mt-Rnr2 &lt;NA&gt;               NA mitochondrially encoded 16S rRNA [Source:MGI S…
15 mt-Tl1  &lt;NA&gt;               NA mitochondrially encoded tRNA leucine 1 [Source…</code></pre>
</div>
<p>遺伝子_Klk6_は<code>rna_mini</code>にのみ存在し、遺伝子_mt-Tf_、<em>mt-Rnr1</em>、<em>mt-Tv</em>、
<em>mt-Rnr2</em>、_mt-Tl1_は<code>annot3</code>テーブルにのみ存在する。
表の 変数のそれぞれの値は、欠損として符号化されている。 表の
変数のそれぞれの値は、欠損として符号化されている。</p>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="データのエクスポート">データのエクスポート<a class="anchor" aria-label="アンカー" href="#%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E3%82%A8%E3%82%AF%E3%82%B9%E3%83%9D%E3%83%BC%E3%83%88"></a>
<a class="anchor" aria-label="anchor" href="#%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E3%82%A8%E3%82%AF%E3%82%B9%E3%83%9D%E3%83%BC%E3%83%88"></a>
</h2>
<hr class="half-width">
<p>dplyr\`を使って、
から情報を抽出したり、生データを要約したりする方法を学んだので、これらの新しいデータセットをエクスポートして、
を共同研究者と共有したり、アーカイブしたりしたいと思うかもしれない。</p>
<p>RにCSVファイルを読み込むために使用される <code>read_csv()</code>
関数と同様に、 、データフレームからCSVファイルを生成する
<code>write_csv()</code> 関数があります。</p>
<p>write_csv()<code>を使う前に、生成されたデータセットを格納する新しいフォルダ</code>data_output<code>を作業ディレクトリに作成する。  、生成されたデータセットを生データと同じディレクトリに書き込みたくない。 別々にするのは良い習慣だ。 data</code>フォルダーには、
、変更されていない生のデータだけを入れておく。
、削除したり変更したりしないように、そのままにしておく。
対照的に、このスクリプトは<code>data_output</code>
ディレクトリの内容を生成するので、そこに含まれるファイルが削除されても、
再生成することができる。
、生成されたデータセットを生データと同じディレクトリに書き込みたくない。
別々にするのは良い習慣だ。
data<code>フォルダーには、 、変更されていない生のデータだけを入れておく。 、削除したり変更したりしないように、そのままにしておく。 対照的に、このスクリプトは</code>data_output`
ディレクトリの内容を生成するので、そこに含まれるファイルが削除されても、
再生成することができる。</p>
<p>write_csv()\`を使用して、以前に作成したrna_wideテーブルを保存しよう。</p>
<div class="codewrapper sourceCode" id="cb140">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">write_csv</span><span class="op">(</span><span class="va">rna_wide</span>, file <span class="op">=</span> <span class="st">"data_output/rna_wide.csv"</span><span class="op">)</span></span></code></pre>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">まとめ<a class="anchor" aria-label="アンカー" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>tidyverseメタパッケージを使用したRでの表形式データ</li>
</ul>
</div>
</div>
</div>
</section></section><section id="aio-40-visualization"><p>Content from <a href="40-visualization.html">データの可視化</a></p>
<hr>
<p>最終更新日：2024-09-08 |

        <a href="https://github.com/carpentries-incubator/bioc-intro/edit/main/episodes/40-visualization.Rmd" class="external-link">ページの編集 <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="回答を全て表示する " data-collapse="回答を全て折りたたむ "> 回答を全て表示する <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">概要</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">質問</h3>
<ul>
<li>Rによる可視化</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">目的</h3>
<ul>
<li>ggplotを使って散布図、箱ひげ図、折れ線グラフなどを作成する。</li>
<li>ユニバーサルプロット設定を行う。</li>
<li>ファセットとは何かを説明し、ggplotでファセットを適用する。</li>
<li>既存のggplotプロットの美学（軸ラベルや色を含む）を修正する。</li>
<li>データフレーム内のデータから複雑でカスタマイズされたプロットを作成。</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<blockquote>
<p>このエピソードは、Data Carpentriesの_Data Analysis and Visualisation
in R for Ecologists_レッスンに基づいています。</p>
</blockquote>
<section><h2 class="section-heading" id="データの可視化">データの可視化<a class="anchor" aria-label="アンカー" href="#%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E5%8F%AF%E8%A6%96%E5%8C%96"></a>
<a class="anchor" aria-label="anchor" href="#%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E5%8F%AF%E8%A6%96%E5%8C%96"></a>
</h2>
<hr class="half-width">
<p>必要なパッケージをロードすることから始める。
**ggplot2<code>**は、 **tidyverse</code>**パッケージに含まれています。</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="st">"tidyverse"</span><span class="op">)</span></span></code></pre>
</div>
<p>ワークスペースにまだない場合は、前回の
レッスンで保存したデータをロードします。</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rna</span> <span class="op">&lt;-</span> <span class="fu">read.csv</span><span class="op">(</span><span class="st">"data/rnaseq.csv"</span><span class="op">)</span></span></code></pre>
</div>
<p>Data Visualization Cheat Sheet](<a href="https://raw.githubusercontent.com/rstudio/cheatsheets/main/data-visualization.pdf" class="external-link uri">https://raw.githubusercontent.com/rstudio/cheatsheets/main/data-visualization.pdf</a>)
は <code>ggplot2</code> の基本からより高度な機能までをカバーし、
パッケージで利用可能な多くのデータ表現
の概要を理解するためのリマインダとしてだけでなく、手助けになるでしょう。
Thomas Lin Pedersen氏による以下のビデオ チュートリアル（<a href="https://www.youtube.com/watch?v=h29g21z0a68" class="external-link">パート1</a>と <a href="https://www.youtube.com/watch?v=0m4yywqNPVY" class="external-link">2</a>）
も非常に参考になる。</p>
</section><section><h2 class="section-heading" id="ggplot2によるプロット">ggplot2`によるプロット<a class="anchor" aria-label="アンカー" href="#ggplot2%E3%81%AB%E3%82%88%E3%82%8B%E3%83%97%E3%83%AD%E3%83%83%E3%83%88"></a>
<a class="anchor" aria-label="anchor" href="#ggplot2%E3%81%AB%E3%82%88%E3%82%8B%E3%83%97%E3%83%AD%E3%83%83%E3%83%88"></a>
</h2>
<hr class="half-width">
<p>ggplot2<code>は、データフレーム内のデータから複雑な プロットを簡単に作成できるプロットパッケージである。 どの変数をプロットするか、どのように表示するか、 、一般的なビジュアル・プロパティを指定するための、よりプログラム的な 。</code>ggplot2`を支える理論的基盤は、<em>Grammar
of Graphics</em> (<span class="citation">@Wilkinson:2005</span>)である。
この
アプローチを使用すると、基礎となるデータが変更された場合、または棒グラフから散布図に変更することを決めた場合に
、最小限の変更で済む。 これは、
、最小限の調整で出版品質のプロットを作成するのに役立ちます
、微調整。</p>
<p>ggplot2<code>に関する本（@ggplot2book）があり、 。 第3版は現在準備中で、 [オンラインで自由に利用できる](https://ggplot2-book.org/)。  の</code>ggplot2`
ウェブページ(<a href="https://ggplot2.tidyverse.org" class="external-link">https://ggplot2.tidyverse.org</a>)に十分なドキュメントがあります。</p>
<p>ggplot2<code>の関数は、'long'形式のデータ、つまり、 すべての次元を表す列と、すべてのオブザベーションを表す行を持つ。 よく構造化されたデータ 、</code>ggplot2`で図を作成する時間を大幅に節約できる。</p>
<p>ggplotグラフィックスは、新しい要素を追加することによって段階的に構築される。
この方法で レイヤーを追加すると、プロットの広範な柔軟性と
カスタマイズが可能になる。</p>
<blockquote>
<p>Grammar of
Graphicsの背後にある考え方は、同じ3つのコンポーネントからすべての
グラフを構築できるということである：(1)データセット、(2)座標系、
、(3)ジオム、つまりデータ点を表す視覚的マーク <a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a> である。</p>
</blockquote>
<p>ggplotを構築するために、
、さまざまなタイプのプロットに使用できる以下の基本テンプレートを使用する：</p>
<pre><code>ggplot(data =&lt;DATA&gt;, mapping = aes(&lt;MAPPINGS&gt;)) +&lt;GEOM_FUNCTION&gt;()</code></pre>
<ul>
<li>ggplot()<code>関数を使用し、</code>data`引数を使用して特定の<strong>data
frame</strong>にプロットをバインドする。</li>
</ul>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">rna</span><span class="op">)</span></span></code></pre>
</div>
<ul>
<li>(<code>aes</code>)関数を使用して)<strong>マッピング</strong>を定義する。
、プロットする変数を選択し、 、x/yの位置や、
、サイズ、形、色などの特徴として、グラフでどのように表示するかを指定する。</li>
</ul>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">rna</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">expression</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<ul>
<li>
<p>追加 ‘<strong>geoms</strong>’ - ジオメトリ、つまりプロット内の
データのグラフ表現（点、線、棒）。 ggplot2`は多くの
、様々なジオムを提供している：</p>
<pre><code>* 散布図やドットプロットなどには `geom_point()` を使用する。
*
* `geom_boxplot()` ボックスプロット！
* トレンドライン、時系列など。</code></pre>
</li>
</ul>
<p>プロットにgeom(etry)を追加するには <code>+</code> 演算子を使います。
<code>geom_histogram()</code> をまず使ってみよう：</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">rna</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">expression</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_histogram</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
</div>
<figure><img src="fig/40-visualization-rendered-first-ggplot-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>ggplot2<code>パッケージの</code>+<code>は特に便利で、 、既存の</code>ggplot`オブジェクトを修正することができる。
つまり、 、プロット・テンプレートを簡単に設定し、
、さまざまなタイプのプロットを便利に調べることができる：</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Assign plot to a variable</span></span>
<span><span class="va">rna_plot</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">rna</span>,</span>
<span>                   mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">expression</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Draw the plot</span></span>
<span><span class="va">rna_plot</span> <span class="op">+</span> <span class="fu">geom_histogram</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div id="チャレンジ" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ" class="callout-inner">
<h3 class="callout-title">チャレンジ<a class="anchor" aria-label="アンカー" href="#%E3%83%81%E3%83%A3%E3%83%AC%E3%83%B3%E3%82%B8"></a>
</h3>
<div class="callout-content">
<p>ヒストグラムを描画するときに表示される自動メッセージにお気づきでしょう：</p>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
</div>
<p>geom_histogram()<code>の引数</code>bins<code>または</code>binwidth`
を変更して、 ビンの数または幅を変更する。</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">
  ソリューション
  </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># change bins</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">rna</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">expression</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_histogram</span><span class="op">(</span>bins <span class="op">=</span> <span class="fl">15</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/40-visualization-rendered-unnamed-chunk-5-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># change binwidth</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">rna</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">expression</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_histogram</span><span class="op">(</span>binwidth <span class="op">=</span> <span class="fl">2000</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/40-visualization-rendered-unnamed-chunk-5-2.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
</div>
<p>データが右に偏っていることがわかる。 より対称的な分布にするために、
log2変換を適用することができる。 ここでは、
、0に等しい式の値に対して返される<code>-Inf</code>値
を避けるために、小さな定数値（<code>+1</code>）を追加していることに注意してください。</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rna</span><span class="op">&lt;-</span> <span class="va">rna</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>expression_log <span class="op">=</span> <span class="fu">log2</span><span class="op">(</span><span class="va">expression</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<p>ここで対数変換した式のヒストグラムを描いてみると、
の分布は確かに正規分布に近くなっている。</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="va">rna</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">expression_log</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_histogram</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
</div>
<figure><img src="fig/40-visualization-rendered-second-ggplot-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>これからは対数変換した発現値を扱うことにする。</p>
<div id="チャレンジ-1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ-1" class="callout-inner">
<h3 class="callout-title">チャレンジ<a class="anchor" aria-label="アンカー" href="#%E3%83%81%E3%83%A3%E3%83%AC%E3%83%B3%E3%82%B8-1"></a>
</h3>
<div class="callout-content">
<p>この変換を視覚化するもう1つの方法は、オブザベーションのスケール
を考えることである。 たとえば、
プロットの空間でオブザベーションをよりよく分布させるために、軸のスケール
を変更する価値があるかもしれません。 軸のスケールの変更は、
他のコンポーネントの追加/変更と同様に（すなわち、
コマンドをインクリメンタルに追加することによって）行われます。
このように変更してみてほしい：</p>
<ul>
<li>
<code>scale_x_log10()</code> を参照。 前のグラフと比較してみよう。
、警告メッセージが表示されるようになったのはなぜですか？</li>
</ul>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2">
  ソリューション
  </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" data-bs-parent="#accordionSolution2" aria-labelledby="headingSolution2">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">rna</span>,mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">expression</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">geom_histogram</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_x_log10</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">警告<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="warning" tabindex="0"><code>Warning in scale_x_log10(): log-10 transformation introduced infinite values.</code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">警告<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="warning" tabindex="0"><code>Warning: Removed 507 rows containing non-finite outside the scale range
(`stat_bin()`).</code></pre>
</div>
<figure><img src="fig/40-visualization-rendered-unnamed-chunk-6-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
</div>
<p><strong>注</strong>*。</p>
<ul>
<li>ggplot()<code>関数で設定したものはすべて、あなたが追加したgeom     レイヤーで見ることができます（つまり、これらはグローバルなプロット設定です）。 この     には、</code>aes()`で設定したx軸とy軸のマッピングが含まれる。</li>
<li>また、<code>ggplot()</code>関数でグローバルに定義された
マッピングとは別に、与えられたジオムに対するマッピングを指定することもできます。</li>
<li>新しいレイヤーを追加するために使われる<code>+</code>記号は、_前の_レイヤーを含む
行の最後に置かなければなりません。 その代わりに、<code>+</code>記号が
新しいレイヤーを含む行の先頭に追加された場合、 <code>ggplot2</code>
は新しいレイヤーを追加せず、エラー メッセージを返す。</li>
</ul>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># これはレイヤーを追加するための正しい構文です</span></span>
<span><span class="va">rna_plot</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_histogram</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># これは新しいレイヤーを追加せず、エラーメッセージを返します</span></span>
<span><span class="va">rna_plot</span></span>
<span>  <span class="op">+</span> <span class="fu">geom_histogram</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
</section><section><h2 class="section-heading" id="反復的にプロットを構築する">反復的にプロットを構築する<a class="anchor" aria-label="アンカー" href="#%E5%8F%8D%E5%BE%A9%E7%9A%84%E3%81%AB%E3%83%97%E3%83%AD%E3%83%83%E3%83%88%E3%82%92%E6%A7%8B%E7%AF%89%E3%81%99%E3%82%8B"></a>
<a class="anchor" aria-label="anchor" href="#%E5%8F%8D%E5%BE%A9%E7%9A%84%E3%81%AB%E3%83%97%E3%83%AD%E3%83%83%E3%83%88%E3%82%92%E6%A7%8B%E7%AF%89%E3%81%99%E3%82%8B"></a>
</h2>
<hr class="half-width">
<p>ここでは、2つの連続変数と
<code>geom_point()</code>関数を使って散布図を描きます。
このグラフは、時間8と時間0、時間4と時間0を比較した発現のlog2倍変化 。
この目的のために、まず対数変換した
発現値の平均値を遺伝子ごと、時間ごとに計算する必要がある。次に、
、時間8と時間0の間の平均対数発現と、
、時間4と時間0の間の平均対数発現を差し引くことにより、対数倍変化を計算する。
ここでは、後で遺伝子を表現するために使用する遺伝子
バイオタイプも含めていることに注意されたい。 フォールドの変化を
<code>rna_fc.</code> という新しいデータフレームに保存する。</p>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rna_fc</span> <span class="op">&lt;-</span> <span class="va">rna</span> <span class="op">%&gt;%</span> <span class="fu">select</span><span class="op">(</span><span class="va">gene</span>, <span class="va">time</span>,</span>
<span>                         <span class="va">gene_biotype</span>, <span class="va">expression_log</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">gene</span>, <span class="va">time</span>, <span class="va">gene_biotype</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">summarize</span><span class="op">(</span>mean_exp <span class="op">=</span> <span class="fu">mean</span><span class="op">(</span><span class="va">expression_log</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">pivot_wider</span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">time</span>,</span>
<span>              values_from <span class="op">=</span> <span class="va">mean_exp</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>time_8_vs_0 <span class="op">=</span> <span class="va">`8`</span> <span class="op">-</span> <span class="va">`0`</span>, time_4_vs_0 <span class="op">=</span> <span class="va">`4`</span> <span class="op">-</span> <span class="va">`0`</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>`summarise()` has grouped output by 'gene', 'time'. You can override using the
`.groups` argument.</code></pre>
</div>
<p>新しく作成されたデータセット <code>rna_fc</code> を使って ggplot
を作成することができる。
ggplot2`でプロットを作成するのは、通常、反復的なプロセスである。
まず、使用するデータセットを定義し、軸を配置し、 ジオムを選択する：</p>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">rna_fc</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">time_4_vs_0</span>, y <span class="op">=</span> <span class="va">time_8_vs_0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/40-visualization-rendered-create-ggplot-object-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>次に、このプロットからより多くの情報を抽出するために、プロットを修正し始める。
例えば、オーバープロットを避けるために透明度（<code>α</code>）を加えることができる：</p>
<div class="codewrapper sourceCode" id="cb24">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">rna_fc</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">time_4_vs_0</span>, y <span class="op">=</span> <span class="va">time_8_vs_0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/40-visualization-rendered-adding-transparency-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>また、すべてのポイントに色を付けることもできる：</p>
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">rna_fc</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">time_4_vs_0</span>, y <span class="op">=</span> <span class="va">time_8_vs_0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.3</span>, color <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/40-visualization-rendered-adding-colors-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>あるいは、プロット中の各遺伝子を異なる色にするために、
、引数<strong>color</strong>の入力としてベクトルを使うこともできる。
ggplot2<code>は、ベクトルの異なる値に対応する異なる 。 以下は、</code>gene_biotype`を使った例である：</p>
<div class="codewrapper sourceCode" id="cb26">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">rna_fc</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">time_4_vs_0</span>, y <span class="op">=</span> <span class="va">time_8_vs_0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.3</span>, <span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="va">gene_biotype</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/40-visualization-rendered-color-by-gene_biotype1-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>また、
<code>ggplot()</code>関数で提供されるマッピングの中で直接色を指定することもできる。
これはどのジオムレイヤーでも見ることができ、 のマッピングは
<code>aes()</code> で設定したx軸とy軸によって決定される。</p>
<div class="codewrapper sourceCode" id="cb27">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">rna_fc</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">time_4_vs_0</span>, y <span class="op">=</span> <span class="va">time_8_vs_0</span>,</span>
<span>                                color <span class="op">=</span> <span class="va">gene_biotype</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/40-visualization-rendered-color-by-gene_biotype2-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>最後に、<code>geom_abline()</code> ：</p>
<div class="codewrapper sourceCode" id="cb28">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">rna_fc</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">time_4_vs_0</span>, y <span class="op">=</span> <span class="va">time_8_vs_0</span>,</span>
<span>                                color <span class="op">=</span> <span class="va">gene_biotype</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_abline</span><span class="op">(</span>intercept <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/40-visualization-rendered-adding-diag-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>ジオムレイヤーを <code>geom_point</code> から
<code>geom_jitter</code> に変更しても、色は <code>gene_biotype</code>
によって決定されることに注意してください。</p>
<div class="codewrapper sourceCode" id="cb29">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">rna_fc</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">time_4_vs_0</span>, y <span class="op">=</span> <span class="va">time_8_vs_0</span>,</span>
<span>                                color <span class="op">=</span> <span class="va">gene_biotype</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_jitter</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_abline</span><span class="op">(</span>intercept <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/40-visualization-rendered-color-by-gene_biotype3-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><div class="codewrapper">
<h3 class="code-label">エラー<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in library("hexbin"): there is no package called 'hexbin'</code></pre>
</div>
<div id="チャレンジ-2" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ-2" class="callout-inner">
<h3 class="callout-title">チャレンジ<a class="anchor" aria-label="アンカー" href="#%E3%83%81%E3%83%A3%E3%83%AC%E3%83%B3%E3%82%B8-2"></a>
</h3>
<div class="callout-content">
<p>散布図は、小規模なデータセットの探索に役立つツールである。 rna_fc`
データセットのような多数のオブザベーションを持つ
データセットの場合、点のオーバープロットは散布図の制限となりうる。
このような設定を扱うための1つの戦略は、
の観測値を六角形にビニングすることである。
プロット空間は六角形にテッセレーションされている。 それぞれの 六角形は、
その境界内に入るオブザベーションの数に基づいて色が割り当てられる。</p>
<ul>
<li><p>ggplot2<code>で六角ビニングを使用するには、まずRパッケージ</code>hexbin`をCRANからインストールしてロードする。</p></li>
<li><p>そして、<code>geom_hex()</code>関数を使ってhexbin図を作成する。</p></li>
<li><p>散布図と比較して、六角形のビン
プロットの相対的な長所と短所は何か？ 上記の散布図（
）を調べ、作成した六角形のビンプロットと比較する。</p></li>
</ul>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3">
  ソリューション
  </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" data-bs-parent="#accordionSolution3" aria-labelledby="headingSolution3">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb31">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">install.packages</span><span class="op">(</span><span class="st">"hexbin"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb32">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="st">"hexbin"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">エラー<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in library("hexbin"): there is no package called 'hexbin'</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb34">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">rna_fc</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">time_4_vs_0</span>, y <span class="op">=</span> <span class="va">time_8_vs_0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_hex</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_abline</span><span class="op">(</span>intercept <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">警告<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="warning" tabindex="0"><code>Warning: Computation failed in `stat_binhex()`.
Caused by error in `compute_group()`:
! The package "hexbin" is required for `stat_bin_hex()`.</code></pre>
</div>
<figure><img src="fig/40-visualization-rendered-unnamed-chunk-10-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
</div>
<div id="チャレンジ-3" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ-3" class="callout-inner">
<h3 class="callout-title">チャレンジ<a class="anchor" aria-label="アンカー" href="#%E3%83%81%E3%83%A3%E3%83%AC%E3%83%B3%E3%82%B8-3"></a>
</h3>
<div class="callout-content">
<p>今学んだことを使って、<code>rna</code>データセットから<code>sample</code>に対する<code>expression_log</code>
の散布図を作成し、 異なる色で時間を表示する。
このようなデータを表示するのは良い方法ですか？</p>
</div>
</div>
</div>
<div id="accordionSolution4" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution4" aria-expanded="false" aria-controls="collapseSolution4">
  <h4 class="accordion-header" id="headingSolution4">
  ソリューション
  </h4>
</button>
<div id="collapseSolution4" class="accordion-collapse collapse" data-bs-parent="#accordionSolution4" aria-labelledby="headingSolution4">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb36">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">rna</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>y <span class="op">=</span> <span class="va">expression_log</span>, x <span class="op">=</span> <span class="va">sample</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="va">time</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/40-visualization-rendered-unnamed-chunk-11-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="ボックスプロット">ボックスプロット<a class="anchor" aria-label="アンカー" href="#%E3%83%9C%E3%83%83%E3%82%AF%E3%82%B9%E3%83%97%E3%83%AD%E3%83%83%E3%83%88"></a>
<a class="anchor" aria-label="anchor" href="#%E3%83%9C%E3%83%83%E3%82%AF%E3%82%B9%E3%83%97%E3%83%AD%E3%83%83%E3%83%88"></a>
</h2>
<hr class="half-width">
<p>ボックスプロットを使って、各サンプル内の遺伝子発現の分布（
）を可視化することができる：</p>
<div class="codewrapper sourceCode" id="cb37">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">rna</span>,</span>
<span>         mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>y <span class="op">=</span> <span class="va">expression_log</span>, x <span class="op">=</span> <span class="va">sample</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_boxplot</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/40-visualization-rendered-boxplot-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>boxplotにポイントを追加することで、
の測定数とその分布をよりよく知ることができる：</p>
<div class="codewrapper sourceCode" id="cb38">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">rna</span>,</span>
<span>         mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>y <span class="op">=</span> <span class="va">expression_log</span>, x <span class="op">=</span> <span class="va">sample</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_jitter</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.2</span>, color <span class="op">=</span> <span class="st">"tomato"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_boxplot</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/40-visualization-rendered-boxplot-with-points-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><div id="チャレンジ-4" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ-4" class="callout-inner">
<h3 class="callout-title">チャレンジ<a class="anchor" aria-label="アンカー" href="#%E3%83%81%E3%83%A3%E3%83%AC%E3%83%B3%E3%82%B8-4"></a>
</h3>
<div class="callout-content">
<p>ボックスプロットレイヤーがジッターレイヤーの前にあることに注目してほしい。
、ボックスプロットをポイントの下に配置するために、コードのどこを変更する必要がありますか？</p>
</div>
</div>
</div>
<div id="accordionSolution5" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution5" aria-expanded="false" aria-controls="collapseSolution5">
  <h4 class="accordion-header" id="headingSolution5">
  ソリューション
  </h4>
</button>
<div id="collapseSolution5" class="accordion-collapse collapse" data-bs-parent="#accordionSolution5" aria-labelledby="headingSolution5">
<div class="accordion-body">
<p>この2つのジオムの順番を入れ替えるべきだ：</p>
<div class="codewrapper sourceCode" id="cb39">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">rna</span>,</span>
<span>         mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>y <span class="op">=</span> <span class="va">expression_log</span>, x <span class="op">=</span> <span class="va">sample</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">geom_boxplot</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_jitter</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.2</span>, color <span class="op">=</span> <span class="st">"tomato"</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/40-visualization-rendered-boxplot-with-points2-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
</div>
<p>X軸の値がまだ正しく 読めないことにお気づきかもしれない。
ラベルの向きを変え、 縦と横に重ならないように調整しよう。
90度の角度を使ってもいいし、
斜め向きのラベルに適切な角度を見つけるために実験してもいい：</p>
<div class="codewrapper sourceCode" id="cb40">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">rna</span>,</span>
<span>         mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>y <span class="op">=</span> <span class="va">expression_log</span>, x <span class="op">=</span> <span class="va">sample</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">geom_jitter</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.2</span>, color <span class="op">=</span> <span class="st">"tomato"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_boxplot</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">90</span>, hjust <span class="op">=</span> <span class="fl">0.5</span>, vjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/40-visualization-rendered-boxplot-xaxis-rotated-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><div id="チャレンジ-5" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ-5" class="callout-inner">
<h3 class="callout-title">チャレンジ<a class="anchor" aria-label="アンカー" href="#%E3%83%81%E3%83%A3%E3%83%AC%E3%83%B3%E3%82%B8-5"></a>
</h3>
<div class="callout-content">
<p>感染期間（
）に応じて、箱ひげ図上のデータ点に色を付ける（<code>time</code>）。</p>
<p><em>ヒント:</em> <code>time</code>のクラスをチェックする。
<code>time</code>
のクラスをggplotマッピングで整数から因数に直接変更することを検討する。
、Rのグラフの作り方が変わるのはなぜですか？</p>
</div>
</div>
</div>
<div id="accordionSolution6" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution6" aria-expanded="false" aria-controls="collapseSolution6">
  <h4 class="accordion-header" id="headingSolution6">
  ソリューション
  </h4>
</button>
<div id="collapseSolution6" class="accordion-collapse collapse" data-bs-parent="#accordionSolution6" aria-labelledby="headingSolution6">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb41">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># time as integer</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">rna</span>,</span>
<span>         mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>y <span class="op">=</span> <span class="va">expression_log</span>,</span>
<span>                       x <span class="op">=</span> <span class="va">sample</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">geom_jitter</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.2</span>, <span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="va">time</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">geom_boxplot</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">90</span>, hjust <span class="op">=</span> <span class="fl">0.5</span>, vjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/40-visualization-rendered-boxplot-color-time-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><div class="codewrapper sourceCode" id="cb42">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># time as factor</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">rna</span>,</span>
<span>         mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>y <span class="op">=</span> <span class="va">expression_log</span>,</span>
<span>                       x <span class="op">=</span> <span class="va">sample</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">geom_jitter</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.2</span>, <span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="fu">as.factor</span><span class="op">(</span><span class="va">time</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">geom_boxplot</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">90</span>, hjust <span class="op">=</span> <span class="fl">0.5</span>, vjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/40-visualization-rendered-boxplot-color-time-2.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
</div>
<div id="チャレンジ-6" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ-6" class="callout-inner">
<h3 class="callout-title">チャレンジ<a class="anchor" aria-label="アンカー" href="#%E3%83%81%E3%83%A3%E3%83%AC%E3%83%B3%E3%82%B8-6"></a>
</h3>
<div class="callout-content">
<p>箱ひげ図は便利な要約だが、 分布の_形_を隠してしまう。
例えば、分布が二峰性であれば、
、ボックスプロットではそれを見ることはできない。
箱ひげ図に代わるものとして、（点の密度の）形状を描くバイオリン
プロットがある。</p>
<ul>
<li>geom_violin()<code>を参照してください。      引数</code>fill`
の時間に従ってヴァイオリンにフィルを入れる。</li>
</ul>
</div>
</div>
</div>
<div id="accordionSolution7" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution7" aria-expanded="false" aria-controls="collapseSolution7">
  <h4 class="accordion-header" id="headingSolution7">
  ソリューション
  </h4>
</button>
<div id="collapseSolution7" class="accordion-collapse collapse" data-bs-parent="#accordionSolution7" aria-labelledby="headingSolution7">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb43">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">rna</span>,</span>
<span>         mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>y <span class="op">=</span> <span class="va">expression_log</span>, x <span class="op">=</span> <span class="va">sample</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">geom_violin</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>fill <span class="op">=</span> <span class="fu">as.factor</span><span class="op">(</span><span class="va">time</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">90</span>, hjust <span class="op">=</span> <span class="fl">0.5</span>, vjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/40-visualization-rendered-unnamed-chunk-12-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
</div>
<div id="チャレンジ-7" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ-7" class="callout-inner">
<h3 class="callout-title">チャレンジ<a class="anchor" aria-label="アンカー" href="#%E3%83%81%E3%83%A3%E3%83%AC%E3%83%B3%E3%82%B8-7"></a>
</h3>
<div class="callout-content">
<ul>
<li>ヴァイオリンのプロットを修正し、ヴァイオリンを <code>sex</code>
で埋める。</li>
</ul>
</div>
</div>
</div>
<div id="accordionSolution8" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution8" aria-expanded="false" aria-controls="collapseSolution8">
  <h4 class="accordion-header" id="headingSolution8">
  ソリューション
  </h4>
</button>
<div id="collapseSolution8" class="accordion-collapse collapse" data-bs-parent="#accordionSolution8" aria-labelledby="headingSolution8">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb44">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">rna</span>,</span>
<span>         mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>y <span class="op">=</span> <span class="va">expression_log</span>, x <span class="op">=</span> <span class="va">sample</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">geom_violin</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">sex</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">90</span>, hjust <span class="op">=</span> <span class="fl">0.5</span>, vjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/40-visualization-rendered-unnamed-chunk-13-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="線プロット">線プロット<a class="anchor" aria-label="アンカー" href="#%E7%B7%9A%E3%83%97%E3%83%AD%E3%83%83%E3%83%88"></a>
<a class="anchor" aria-label="anchor" href="#%E7%B7%9A%E3%83%97%E3%83%AD%E3%83%83%E3%83%88"></a>
</h2>
<hr class="half-width">
<p>時刻8と 時刻0を比較し、log
fold変化が最も大きかった10の遺伝子について、感染期間ごとの平均発現量を計算してみよう。
まず、遺伝子を選択し、選択した10遺伝子を含む<code>sub_rna</code>と呼ばれる<code>rna</code>
のサブセットを作成する必要がある。次に、
データをグループ化し、各グループ内の平均遺伝子発現を計算する必要がある：</p>
<div class="codewrapper sourceCode" id="cb45">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rna_fc</span><span class="op">&lt;-</span> <span class="va">rna_fc</span> <span class="op">%&gt;%</span> <span class="fu">arrange</span><span class="op">(</span><span class="fu">desc</span><span class="op">(</span><span class="va">time_8_vs_0</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">genes_selected</span> <span class="op">&lt;-</span> <span class="va">rna_fc</span><span class="op">$</span><span class="va">gene</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span></span>
<span></span>
<span><span class="va">sub_rna</span><span class="op">&lt;-</span> <span class="va">rna</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">filter</span><span class="op">(</span><span class="va">gene</span> <span class="op">%in%</span> <span class="va">genes_selected</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mean_exp_by_time</span><span class="op">&lt;-</span> <span class="va">sub_rna</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">gene</span>,<span class="va">time</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">summarize</span><span class="op">(</span>mean_exp <span class="op">=</span> <span class="fu">mean</span><span class="op">(</span><span class="va">expression_log</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>`summarise()` has grouped output by 'gene'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb47">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mean_exp_by_time</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 30 × 3
# Groups:   gene [10]
   gene   time mean_exp
   &lt;chr&gt; &lt;int&gt;    &lt;dbl&gt;
 1 Acr       0     5.07
 2 Acr       4     5.54
 3 Acr       8     7.31
 4 Aipl1     0     3.70
 5 Aipl1     4     3.89
 6 Aipl1     8     6.56
 7 Bst1      0     3.20
 8 Bst1      4     3.77
 9 Bst1      8     5.22
10 Chil3     0     4.00
# ℹ 20 more rows</code></pre>
</div>
<p>X軸に感染期間（
）、Y軸に平均発現をとって折れ線グラフを作成することができる：</p>
<div class="codewrapper sourceCode" id="cb49">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">mean_exp_by_time</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">mean_exp</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/40-visualization-rendered-first-time-series-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>残念なことに、これはうまくいかない。というのも、
の全遺伝子のデータをまとめてプロットしたからである。
各遺伝子に対して線を引くようにggplotに指示する必要がある。
、<code>group = gene</code>を含むようにesthetic関数を修正する：</p>
<div class="codewrapper sourceCode" id="cb50">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">mean_exp_by_time</span>,</span>
<span>       mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">mean_exp</span>, group <span class="op">=</span> <span class="va">gene</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/40-visualization-rendered-time-series-by-gene-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>色をつければ、プロットの中で遺伝子を区別できるようになる（
<code>color</code>を使えば、自動的にデータをグループ化することもできる）：</p>
<div class="codewrapper sourceCode" id="cb51">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">mean_exp_by_time</span>,</span>
<span>       mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">mean_exp</span>, color <span class="op">=</span> <span class="va">gene</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/40-visualization-rendered-time-series-with-colors-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure></section><section><h2 class="section-heading" id="ファセット">ファセット<a class="anchor" aria-label="アンカー" href="#%E3%83%95%E3%82%A1%E3%82%BB%E3%83%83%E3%83%88"></a>
<a class="anchor" aria-label="anchor" href="#%E3%83%95%E3%82%A1%E3%82%BB%E3%83%83%E3%83%88"></a>
</h2>
<hr class="half-width">
<p>ggplot2`には_faceting_と呼ばれる特別なテクニックがあり、
、データセットに含まれる
、1つのプロットを複数の(サブ)プロットに分割することができる。 こ れ ら
の異な る サブプ ロ ッ ト は、 同 じ プ ロ パテ ィ を継承 し ます
（軸の限界、目盛り、 …）。 直接比較しやすくするためだ。
、これを用いて各遺伝子について時間軸に沿った折れ線グラフを作成する：</p>
<div class="codewrapper sourceCode" id="cb52">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">mean_exp_by_time</span>,</span>
<span>       mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">mean_exp</span><span class="op">)</span><span class="op">)</span><span class="op">+</span> <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span> <span class="va">gene</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/40-visualization-rendered-first-facet-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>ここでは、X軸とY軸はすべてのサブプロットで同じスケールになっている。、Y軸のスケールを自由に設定できるように<code>scales</code>を修正することで、このデフォルトの動作を変更することができる：</p>
<div class="codewrapper sourceCode" id="cb53">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">mean_exp_by_time</span>,</span>
<span>       mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">mean_exp</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span> <span class="va">gene</span>, scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/40-visualization-rendered-first-facet-scales-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>ここで、各プロットの線をマウスの性別で分けたい。 そのためには、
、遺伝子、時間、性別でグループ化したデータフレームの平均発現を計算する必要がある：</p>
<div class="codewrapper sourceCode" id="cb54">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mean_exp_by_time_sex</span><span class="op">&lt;-</span> <span class="va">sub_rna</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">gene</span>, <span class="va">time</span>, <span class="va">sex</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">summarize</span><span class="op">(</span>mean_exp <span class="op">=</span> <span class="fu">mean</span><span class="op">(</span><span class="va">expression_log</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>`summarise()` has grouped output by 'gene', 'time'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb56">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mean_exp_by_time_sex</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 60 × 4
# Groups:   gene, time [30]
   gene   time sex    mean_exp
   &lt;chr&gt; &lt;int&gt; &lt;chr&gt;     &lt;dbl&gt;
 1 Acr       0 Female     5.13
 2 Acr       0 Male       5.00
 3 Acr       4 Female     5.93
 4 Acr       4 Male       5.15
 5 Acr       8 Female     7.27
 6 Acr       8 Male       7.36
 7 Aipl1     0 Female     3.67
 8 Aipl1     0 Male       3.73
 9 Aipl1     4 Female     4.07
10 Aipl1     4 Male       3.72
# ℹ 50 more rows</code></pre>
</div>
<p><code>color</code>
を使ってさらに分割することで、ファセット化されたプロットを作ることができる（1つのプロット内で）：</p>
<div class="codewrapper sourceCode" id="cb58">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">mean_exp_by_time_sex</span>,</span>
<span>       mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">mean_exp</span>, color <span class="op">=</span> <span class="va">sex</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span> <span class="va">gene</span>, scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/40-visualization-rendered-facet-by-gene-and-sex-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>通常、背景が白いプロットは印刷したときに読みやすくなる。 、関数
<code>theme_bw()</code> を使って背景を白に設定することができる。
さらに、グリッドを削除することもできる：</p>
<div class="codewrapper sourceCode" id="cb59">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">mean_exp_by_time_sex</span>,</span>
<span>       mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">mean_exp</span>, color <span class="op">=</span> <span class="va">sex</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span> <span class="va">gene</span>, scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>panel.grid <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/40-visualization-rendered-facet-by-gene-and-sex-white-bg-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><div id="チャレンジ-8" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ-8" class="callout-inner">
<h3 class="callout-title">チャレンジ<a class="anchor" aria-label="アンカー" href="#%E3%83%81%E3%83%A3%E3%83%AC%E3%83%B3%E3%82%B8-8"></a>
</h3>
<div class="callout-content">
<p>、各染色体の
平均発現量が感染期間を通じてどのように変化するかをプロットする。</p>
</div>
</div>
</div>
<div id="accordionSolution9" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution9" aria-expanded="false" aria-controls="collapseSolution9">
  <h4 class="accordion-header" id="headingSolution9">
  ソリューション
  </h4>
</button>
<div id="collapseSolution9" class="accordion-collapse collapse" data-bs-parent="#accordionSolution9" aria-labelledby="headingSolution9">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb60">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mean_exp_by_chromosome</span><span class="op">&lt;-</span> <span class="va">rna</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">chromosome_name</span>, <span class="va">time</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">summary</span><span class="op">(</span>mean_exp <span class="op">=</span> <span class="fu">mean</span><span class="op">(</span><span class="va">expression_log</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">mean_exp_by_chromosome</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>,</span>
<span>                                y <span class="op">=</span> <span class="va">mean_exp</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span> <span class="va">chromosome_name</span>, scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">エラー<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in `fortify()`:
! `data` must be a &lt;data.frame&gt;, or an object coercible by `fortify()`,
  or a valid &lt;data.frame&gt;-like object coercible by `as.data.frame()`.
Caused by error in `.postvalidate_data_frame_like_object()`:
! `as.data.frame(data)` must preserve dimensions.</code></pre>
</div>
</div>
</div>
</div>
</div>
<p>facet_wrap<code>ジオメトリは、1ページにきれいに収まるように、プロットを任意の数の 次元に抽出する。 一方、</code>facet_grid<code>ジオメトリでは、 数式表記（</code>rows
~ columns<code>;</code>.`
は、1つの行または列のみを示すプレースホルダとして使用できます）によって、プロットの配置方法を明示的に指定することができます。</p>
<p>先ほどのプロットを修正し、男性と女性の平均遺伝子発現
が経時的にどのように変化したかを比較してみよう：</p>
<div class="codewrapper sourceCode" id="cb62">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 1列、行ごとのファセット</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">mean_exp_by_time_sex</span>,</span>
<span>       mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">mean_exp</span>, color <span class="op">=</span> <span class="va">gene</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_grid</span><span class="op">(</span><span class="va">sex</span> <span class="op">~</span> <span class="va">.</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/40-visualization-rendered-mean-exp-time-facet-sex-rows-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><div class="codewrapper sourceCode" id="cb63">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 1行、列ごとのファセット</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">mean_exp_by_time_sex</span>,</span>
<span>       mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">mean_exp</span>, color <span class="op">=</span> <span class="va">gene</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_grid</span><span class="op">(</span><span class="va">.</span> <span class="op">~</span> <span class="va">sex</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/40-visualization-rendered-mean-exp-time-facet-sex-columns-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure></section><section><h2 class="section-heading" id="ggplot2テーマ">ggplot2`テーマ<a class="anchor" aria-label="アンカー" href="#ggplot2%E3%83%86%E3%83%BC%E3%83%9E"></a>
<a class="anchor" aria-label="anchor" href="#ggplot2%E3%83%86%E3%83%BC%E3%83%9E"></a>
</h2>
<hr class="half-width">
<p><code>ggplot2</code> には、プロットの背景を白に変更する
<code>theme_bw()</code> に加えて、
手早く視覚化の見た目を変更するのに便利なテーマがいくつか用意されている。
テーマの全リストは<a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">https://ggplot2.tidyverse.org/reference/ggtheme.html</a>で入手できる。
theme_minimal()<code>や</code>theme_light()<code>は人気があり、</code>theme_void()`
は新しい手作りのテーマを作る出発点として役に立つ。</p>
<p>ggthemes](<a href="https://jrnold.github.io/ggthemes/reference/index.html" class="external-link uri">https://jrnold.github.io/ggthemes/reference/index.html</a>)
パッケージは様々なオプション（Excel 2003 テーマを含む）を提供します。
<code>ggplot2</code> extensions website](<a href="https://exts.ggplot2.tidyverse.org/" class="external-link uri">https://exts.ggplot2.tidyverse.org/</a>) は、追加の
テーマを含む <code>ggplot2</code> の機能を拡張する
パッケージのリストを提供しています。</p>
</section><section><h2 class="section-heading" id="カスタマイズ">カスタマイズ<a class="anchor" aria-label="アンカー" href="#%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%9E%E3%82%A4%E3%82%BA"></a>
<a class="anchor" aria-label="anchor" href="#%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%9E%E3%82%A4%E3%82%BA"></a>
</h2>
<hr class="half-width">
<p>時間別、遺伝子別の平均発現のファセット・プロットに戻ろう。
性別に色分けされている。</p>
<p>ggplot2`のカンニング シート](<a href="https://raw.githubusercontent.com/rstudio/cheatsheets/main/data-visualization.pdf" class="external-link uri">https://raw.githubusercontent.com/rstudio/cheatsheets/main/data-visualization.pdf</a>),
を見て、プロットを改善する方法を考えてみてください。</p>
<p>ここで、軸の名前を ‘time’ や ‘mean_exp’
よりも情報量の多いものに変更し、図にタイトルを追加する：</p>
<div class="codewrapper sourceCode" id="cb64">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">mean_exp_by_time_sex</span>,</span>
<span>       mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">mean_exp</span>, color <span class="op">=</span> <span class="va">sex</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span> <span class="va">gene</span>, scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>panel.grid <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"感染期間別の平均遺伝子発現"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"感染期間（日単位）"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"平均遺伝子発現"</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/40-visualization-rendered-mean_exp-time-with-right-labels-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>軸にはより情報量の多い名前が付けられているが、フォントサイズを大きくすることで読みやすさは
：</p>
<div class="codewrapper sourceCode" id="cb65">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">mean_exp_by_time_sex</span>,</span>
<span>       mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">mean_exp</span>, color <span class="op">=</span> <span class="va">sex</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span> <span class="va">gene</span>, scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>panel.grid <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"感染期間別の平均遺伝子発現"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"感染期間（日単位）"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"平均遺伝子発現"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>text <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">16</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/40-visualization-rendered-mean_exp-time-with-right-labels-xfont-size-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>プロットのフォントを変更することも可能です。
Windowsをお使いの場合は、
をインストールする必要があるかもしれません。</p>
<p>さらに、X軸とY軸のテキストの色、
グリッドの色などをカスタマイズできる。 例えば、
<code>legend.position</code>を<code>"top"</code>に設定することで、凡例を一番上に移動させることもできる。</p>
<div class="codewrapper sourceCode" id="cb66">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">mean_exp_by_time_sex</span>,</span>
<span>       mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">mean_exp</span>, color <span class="op">=</span> <span class="va">sex</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span> <span class="va">gene</span>, scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>panel.grid <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"感染期間別の平均遺伝子発現"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"感染期間（日単位）"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"平均遺伝子発現"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>text <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">16</span><span class="op">)</span>,</span>
<span>        axis.text.x <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"royalblue4"</span>, size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span>,</span>
<span>        axis.text.y <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"royalblue4"</span>, size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span>,</span>
<span>        panel.grid <span class="op">=</span> <span class="fu">element_line</span><span class="op">(</span>color<span class="op">=</span><span class="st">"lightsteelblue1"</span><span class="op">)</span>,</span>
<span>        legend.position <span class="op">=</span> <span class="st">"top"</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/40-visualization-rendered-mean_exp-time-with-theme-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>作成した変更がデフォルトのテーマよりも気に入った場合は、
、オブジェクトとして保存して、作成した他の
プロットに簡単に適用することができます。 以下は、
以前に作成したヒストグラムを使った例です。</p>
<div class="codewrapper sourceCode" id="cb67">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">blue_theme</span> <span class="op">&lt;-</span> <span class="fu">theme</span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"royalblue4"</span>,</span>
<span>                                               size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span>,</span>
<span>                    axis.text.y <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"royalblue4"</span>,</span>
<span>                                               size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span>,</span>
<span>                    text <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">16</span><span class="op">)</span>,</span>
<span>                    panel.grid <span class="op">=</span> <span class="fu">element_line</span><span class="op">(</span>colour<span class="op">=</span><span class="st">"lightsteelblue1"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">rna</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">expression_log</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_histogram</span><span class="op">(</span>bins <span class="op">=</span> <span class="fl">20</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="va">blue_theme</span></span></code></pre>
</div>
<figure><img src="fig/40-visualization-rendered-mean_exp-time-with-right-labels-xfont-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><div id="チャレンジ-9" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ-9" class="callout-inner">
<h3 class="callout-title">チャレンジ<a class="anchor" aria-label="アンカー" href="#%E3%83%81%E3%83%A3%E3%83%AC%E3%83%B3%E3%82%B8-9"></a>
</h3>
<div class="callout-content">
<p>これらの情報を手に入れたら、
、この練習で作成したプロットのいずれかを改良するか、
、あなた自身の美しいグラフを作成してください。 RStudio ggplot2
を参考にしてください。 いくつかアイデアを挙げてみよう：</p>
<ul>
<li>線の太さを変えてみてください。</li>
<li>伝説の名前を変える方法はありますか？
そのラベルについてはどうだろう？ (ヒント: <code>scale_</code> で始まる
ggplot 関数を探す)</li>
<li>別のカラーパレットを使用するか、線の
カラーを手動で指定してみてください（ <a href="https://www.cookbook-r.com/Graphs/Colors_(ggplot2)/" class="external-link">http://www.cookbook-r.com/Graphs/Colors_(ggplot2)/</a>
参照）。</li>
</ul>
</div>
</div>
</div>
<div id="accordionSolution10" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution10" aria-expanded="false" aria-controls="collapseSolution10">
  <h4 class="accordion-header" id="headingSolution10">
  ソリューション
  </h4>
</button>
<div id="collapseSolution10" class="accordion-collapse collapse" data-bs-parent="#accordionSolution10" aria-labelledby="headingSolution10">
<div class="accordion-body">
<p>例えば、このプロットに基づくと</p>
<div class="codewrapper sourceCode" id="cb68">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">mean_exp_by_time_sex</span>,</span>
<span>       mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">mean_exp</span>, color <span class="op">=</span> <span class="va">sex</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span> <span class="va">gene</span>, scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>panel.grid <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/40-visualization-rendered-unnamed-chunk-15-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>以下のようなカスタマイズが可能です：</p>
<div class="codewrapper sourceCode" id="cb69">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># change the thickness of the lines</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">mean_exp_by_time_sex</span>,</span>
<span>       mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">mean_exp</span>, color <span class="op">=</span> <span class="va">sex</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span>size<span class="op">=</span><span class="fl">1.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span> <span class="va">gene</span>, scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>panel.grid <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">警告<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="warning" tabindex="0"><code>Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.
ℹ Please use `linewidth` instead.
This warning is displayed once every 8 hours.
Call `lifecycle::last_lifecycle_warnings()` to see where this warning was
generated.</code></pre>
</div>
<figure><img src="fig/40-visualization-rendered-unnamed-chunk-16-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><div class="codewrapper sourceCode" id="cb71">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># change the name of the legend and the labels</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">mean_exp_by_time_sex</span>,</span>
<span>       mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">mean_exp</span>, color <span class="op">=</span> <span class="va">sex</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span> <span class="va">gene</span>, scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>panel.grid <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_discrete</span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Gender"</span>, labels <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="st">"F"</span>, <span class="st">"M"</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/40-visualization-rendered-unnamed-chunk-16-2.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><div class="codewrapper sourceCode" id="cb72">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># using a different color palette</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">mean_exp_by_time_sex</span>,</span>
<span>       mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">mean_exp</span>, color <span class="op">=</span> <span class="va">sex</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span> <span class="va">gene</span>, scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>panel.grid <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_brewer</span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Gender"</span>, labels <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="st">"F"</span>, <span class="st">"M"</span><span class="op">)</span>, palette <span class="op">=</span> <span class="st">"Dark2"</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/40-visualization-rendered-unnamed-chunk-16-3.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><div class="codewrapper sourceCode" id="cb73">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># manually specifying the colors</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">mean_exp_by_time_sex</span>,</span>
<span>       mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">mean_exp</span>, color <span class="op">=</span> <span class="va">sex</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span> <span class="va">gene</span>, scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>panel.grid <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_manual</span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Gender"</span>,  labels <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="st">"F"</span>, <span class="st">"M"</span><span class="op">)</span>,</span>
<span>                     values <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="st">"royalblue"</span>, <span class="st">"deeppink"</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/40-visualization-rendered-unnamed-chunk-16-4.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="プロットの構成">プロットの構成<a class="anchor" aria-label="アンカー" href="#%E3%83%97%E3%83%AD%E3%83%83%E3%83%88%E3%81%AE%E6%A7%8B%E6%88%90"></a>
<a class="anchor" aria-label="anchor" href="#%E3%83%97%E3%83%AD%E3%83%83%E3%83%88%E3%81%AE%E6%A7%8B%E6%88%90"></a>
</h2>
<hr class="half-width">
<p>ファセッティングは、1つのプロットを複数のサブプロットに分割するのに最適なツールです。
しかし、 複数の独立したプロット、すなわち異なる
変数、あるいは異なるデータフレームに基づくプロットを含む1つの図を作成したい場合があります。</p>
<p>、まず2つのプロットを作成する：</p>
<p>最初のグラフは、染色体ごとにユニークな遺伝子の数を数えている。
、まず<code>chromosome_name</code>のレベルを並べ替え、
、染色体ごとにユニークな遺伝子をフィルタリングする必要がある。
また、読みやすくするために、Y軸のスケールを
log10スケールに変更した。</p>
<div class="codewrapper sourceCode" id="cb74">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rna</span><span class="op">$</span><span class="va">chromosome_name</span> <span class="op">&lt;-</span> <span class="fu">factor</span><span class="op">(</span><span class="va">rna</span><span class="op">$</span><span class="va">chromosome_name</span>,</span>
<span>                               levels <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">19</span>,<span class="st">"X"</span>,<span class="st">"Y"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">count_gene_chromosome</span> <span class="op">&lt;-</span> <span class="va">rna</span> <span class="op">%&gt;%</span> <span class="fu">select</span><span class="op">(</span><span class="va">chromosome_name</span>, <span class="va">gene</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">distinct</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_bar</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">chromosome_name</span><span class="op">)</span>, fill <span class="op">=</span> <span class="st">"seagreen"</span>,</span>
<span>           position <span class="op">=</span> <span class="st">"dodge"</span>, stat <span class="op">=</span> <span class="st">"count"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>y <span class="op">=</span> <span class="st">"log10(n genes)"</span>, x <span class="op">=</span> <span class="st">"chromosome"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_log10</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">count_gene_chromosome</span></span></code></pre>
</div>
<figure><img src="fig/40-visualization-rendered-sub1-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>以下では、 <code>legend.position</code> を <code>"none"</code>
に設定することで、凡例を完全に削除することもできる。</p>
<div class="codewrapper sourceCode" id="cb75">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">exp_boxplot_sex</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">rna</span>, <span class="fu">aes</span><span class="op">(</span>y<span class="op">=</span><span class="va">expression_log</span>, x <span class="op">=</span> <span class="fu">as.factor</span><span class="op">(</span><span class="va">time</span><span class="op">)</span>,</span>
<span>                 color<span class="op">=</span><span class="va">sex</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>   <span class="fu">geom_boxplot</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>y <span class="op">=</span> <span class="st">"Mean gene exp"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"time"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">exp_boxplot_sex</span></span></code></pre>
</div>
<figure><img src="fig/40-visualization-rendered-sub2-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>patchwork**](<a href="https://github.com/thomasp85/patchwork)%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8" class="external-link uri">https://github.com/thomasp85/patchwork)パッケージ</a>
は、<code>+</code>
を使って図形を組み合わせるエレガントなアプローチを提供し、
図形を（通常は横に並べて）並べます。 より具体的には、<code>|</code>
は明示的に横に並べ、<code>/</code>は 上に重ねる。</p>
<div class="codewrapper sourceCode" id="cb76">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">install.packages</span><span class="op">(</span><span class="st">"patchwork"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb77">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="st">"patchwork"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">エラー<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in library("patchwork"): there is no package called 'patchwork'</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb79">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">count_gene_chromosome</span> <span class="op">+</span> <span class="va">exp_boxplot_sex</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">エラー<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in `ggplot_add()`:
! Can't add `exp_boxplot_sex` to a &lt;ggplot&gt; object.</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb81">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## or count_gene_chromosome | exp_boxplot_sex</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb82">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">count_gene_chromosome</span> <span class="op">/</span> <span class="va">exp_boxplot_sex</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">エラー<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in count_gene_chromosome/exp_boxplot_sex: non-numeric argument to binary operator</code></pre>
</div>
<p><code>plot_layout</code>
と組み合わせることで、最終的なコンポジションのレイアウトをさらにコントロールし、より複雑なレイアウトを作成することができる：</p>
<div class="codewrapper sourceCode" id="cb84">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">count_gene_chromosome</span> <span class="op">+</span> <span class="va">exp_boxplot_sex</span> <span class="op">+</span> <span class="fu">plot_layout</span><span class="op">(</span>ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">エラー<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in `ggplot_add()`:
! Can't add `exp_boxplot_sex` to a &lt;ggplot&gt; object.</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb86">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">count_gene_chromosome</span> <span class="op">+</span></span>
<span> <span class="op">(</span><span class="va">count_gene_chromosome</span> <span class="op">+</span> <span class="va">exp_boxplot_sex</span><span class="op">)</span> <span class="op">+</span></span>
<span> <span class="va">exp_boxplot_sex</span> <span class="op">+</span></span>
<span> <span class="fu">plot_layout</span><span class="op">(</span>ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">エラー<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in `ggplot_add()`:
! Can't add `exp_boxplot_sex` to a &lt;ggplot&gt; object.</code></pre>
</div>
<p>最後のプロットは <code>|</code> と <code>/</code>
のコンポーザーを使っても作成できる：</p>
<div class="codewrapper sourceCode" id="cb88">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">count_gene_chromosome</span> <span class="op">/</span></span>
<span> <span class="op">(</span><span class="va">count_gene_chromosome</span> <span class="op">|</span> <span class="va">exp_boxplot_sex</span><span class="op">)</span> <span class="op">/</span></span>
<span> <span class="va">exp_boxplot_sex</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">エラー<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in count_gene_chromosome | exp_boxplot_sex: operations are possible only for numeric, logical or complex types</code></pre>
</div>
<p>パッチワークの詳細については、 <a href="https://patchwork.data-imaginist.com/" class="external-link">ウェブページ</a>、またはこちらの
<a href="https://www.youtube.com/watch?v=0m4yywqNPVY" class="external-link">ビデオ</a>をご覧ください。</p>
<p>もう一つのオプションは
**gridExtra<code>** パッケージで、 の別々の ggplot を</code>grid.arrange()`
を使って一つの図にまとめることができます：</p>
<div class="codewrapper sourceCode" id="cb90">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">install.packages</span><span class="op">(</span><span class="st">"gridExtra"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb91">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="st">"gridExtra"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">エラー<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in library("gridExtra"): there is no package called 'gridExtra'</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb93">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">grid.arrange</span><span class="op">(</span><span class="va">count_gene_chromosome</span>, <span class="va">exp_boxplot_sex</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">エラー<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in grid.arrange(count_gene_chromosome, exp_boxplot_sex, ncol = 2): could not find function "grid.arrange"</code></pre>
</div>
<p>引数 <code>ncol</code> と <code>nrow</code> は単純な
の配置を作るのに使われるが、それに加えて、より複雑な のレイアウトを作る
ためのツールもある。</p>
</section><section><h2 class="section-heading" id="プロットのエクスポート">プロットのエクスポート<a class="anchor" aria-label="アンカー" href="#%E3%83%97%E3%83%AD%E3%83%83%E3%83%88%E3%81%AE%E3%82%A8%E3%82%AF%E3%82%B9%E3%83%9D%E3%83%BC%E3%83%88"></a>
<a class="anchor" aria-label="anchor" href="#%E3%83%97%E3%83%AD%E3%83%83%E3%83%88%E3%81%AE%E3%82%A8%E3%82%AF%E3%82%B9%E3%83%9D%E3%83%BC%E3%83%88"></a>
</h2>
<hr class="half-width">
<p>プロットを作成したら、お好きな 形式でファイルに保存できます。
RStudioの<strong>Plot</strong>ペインのExportタブでは、
のプロットが低解像度で保存されます。これは多くのジャーナルでは受け入れられませんし、
ではポスター用にうまく拡大縮小できません。</p>
<p>代わりに <code>ggsave()</code> 関数を使います。この関数を使うと、
の適切な引数（<code>width</code>, <code>height</code>,
<code>dpi</code>）を調整することで、プロットの
次元と解像度を簡単に変更することができます。</p>
<p>作業ディレクトリに <code>fig_output/</code>
フォルダがあることを確認してください。</p>
<div class="codewrapper sourceCode" id="cb95">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_plot</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">mean_exp_by_time_sex</span>,</span>
<span>       mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">mean_exp</span>, color <span class="op">=</span> <span class="va">sex</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span> <span class="va">gene</span>, scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Mean gene expression by duration of the infection"</span>,</span>
<span>         x <span class="op">=</span> <span class="st">"Duration of the infection (in days)"</span>,</span>
<span>         y <span class="op">=</span> <span class="st">"Mean gene expression"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">guides</span><span class="op">(</span>color<span class="op">=</span><span class="fu">guide_legend</span><span class="op">(</span>title<span class="op">=</span><span class="st">"Gender"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"royalblue4"</span>, size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span>,</span>
<span>        axis.text.y <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"royalblue4"</span>, size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span>,</span>
<span>        text <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">16</span><span class="op">)</span>,</span>
<span>        panel.grid <span class="op">=</span> <span class="fu">element_line</span><span class="op">(</span>colour<span class="op">=</span><span class="st">"lightsteelblue1"</span><span class="op">)</span>,</span>
<span>        legend.position <span class="op">=</span> <span class="st">"top"</span><span class="op">)</span></span>
<span><span class="fu">ggsave</span><span class="op">(</span><span class="st">"fig_output/mean_exp_by_time_sex.png"</span>, <span class="va">my_plot</span>, width <span class="op">=</span> <span class="fl">15</span>,</span>
<span>       height <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># This also works for grid.arrange() plots</span></span>
<span><span class="va">combo_plot</span> <span class="op">&lt;-</span> <span class="fu">grid.arrange</span><span class="op">(</span><span class="va">count_gene_chromosome</span>, <span class="va">exp_boxplot_sex</span>,</span>
<span>                           ncol <span class="op">=</span> <span class="fl">2</span>, widths <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="fl">4</span>, <span class="fl">6</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">ggsave</span><span class="op">(</span><span class="st">"fig_output/combo_plot_chromosome_sex.png"</span>, <span class="va">combo_plot</span>,</span>
<span>       width <span class="op">=</span> <span class="fl">10</span>, dpi <span class="op">=</span> <span class="fl">300</span><span class="op">)</span></span></code></pre>
</div>
<p>注意: パラメータ <code>width</code> と <code>height</code>
は、保存されたプロットのフォントサイズ も決定します。</p>
</section><section><h2 class="section-heading" id="その他のビジュアライゼーション用パッケージ">その他のビジュアライゼーション用パッケージ<a class="anchor" aria-label="アンカー" href="#%E3%81%9D%E3%81%AE%E4%BB%96%E3%81%AE%E3%83%93%E3%82%B8%E3%83%A5%E3%82%A2%E3%83%A9%E3%82%A4%E3%82%BC%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E7%94%A8%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8"></a>
<a class="anchor" aria-label="anchor" href="#%E3%81%9D%E3%81%AE%E4%BB%96%E3%81%AE%E3%83%93%E3%82%B8%E3%83%A5%E3%82%A2%E3%83%A9%E3%82%A4%E3%82%BC%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E7%94%A8%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8"></a>
</h2>
<hr class="half-width">
<p>ggplot2`は非常に強力なパッケージで、我々の_tidy data_と_tidy
tools_パイプラインにうまくフィットする。
Rには他にも無視できない可視化パッケージ がある。</p>
<div class="section level3">
<h3 id="ベースグラフィック">ベースグラフィック<a class="anchor" aria-label="anchor" href="#%E3%83%99%E3%83%BC%E3%82%B9%E3%82%B0%E3%83%A9%E3%83%95%E3%82%A3%E3%83%83%E3%82%AF"></a>
</h3>
<p>Rに付属するデフォルトのグラフィックス・システムは、しばしば_ベースR
グラフィックス_と呼ばれ、シンプルで高速である。
これは_画家またはキャンバスの
モデル_に基づいており、異なる出力がそれぞれ 互いに直接重ね合わされる（<a href="mailto:%E5%9B%B3@ref" class="email">図@ref</a>(fig:paintermodel)を参照）。
これは<code>ggplot2</code>（および後述する<code>lattice</code>）との基本的な
の違いである。
は専用のオブジェクトを返し、それは画面上またはファイル上にレンダリングされ、
は更新することさえできる。</p>
<div class="codewrapper sourceCode" id="cb96">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">par</span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">plot</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">20</span>, main <span class="op">=</span> <span class="st">"First layer, produced with plot(1:20)"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">plot</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">20</span>, main <span class="op">=</span> <span class="st">"A horizontal red line, added with abline(h = 10)"</span><span class="op">)</span></span>
<span><span class="fu">abline</span><span class="op">(</span>h <span class="op">=</span> <span class="fl">10</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">plot</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">20</span>, main <span class="op">=</span> <span class="st">"A rectangle, added with rect(5, 5, 15, 15)"</span><span class="op">)</span></span>
<span><span class="fu">abline</span><span class="op">(</span>h <span class="op">=</span> <span class="fl">10</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span>
<span><span class="fu">rect</span><span class="op">(</span><span class="fl">5</span>, <span class="fl">5</span>, <span class="fl">15</span>, <span class="fl">15</span>, lwd <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre>
</div>
<figure style="text-align: center"><img src="fig/40-visualization-rendered-paintermodel-1.png" alt="Successive layers added on top of each other." class="figure mx-auto d-block"><figcaption>
Successive layers added on top of each other.
</figcaption></figure><p>もうひとつの主な違いは、ベース・グラフィックスのプロット関数は、入力タイプに基づいて、
、_正しい_ことをしようとする。 これは、
データフレームしか入力として受け付けない<code>ggplot2</code>で、プロットをビットごとに構築する必要があるのとは、
異なる。</p>
<div class="codewrapper sourceCode" id="cb97">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">par</span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">boxplot</span><span class="op">(</span><span class="fu">rnorm</span><span class="op">(</span><span class="fl">100</span><span class="op">)</span>,</span>
<span>        main <span class="op">=</span> <span class="st">"rnorm(100) の Boxplot"</span><span class="op">)</span></span>
<span><span class="fu">boxplot</span><span class="op">(</span><span class="fu">matrix</span><span class="op">(</span><span class="fu">rnorm</span><span class="op">(</span><span class="fl">100</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>,</span>
<span>        main <span class="op">=</span> <span class="st">"matrix(rnorm(100), ncol = 10) の Boxplot"</span><span class="op">)</span></span>
<span><span class="fu">hist</span><span class="op">(</span><span class="fu">rnorm</span><span class="op">(</span><span class="fl">100</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">hist</span><span class="op">(</span><span class="fu">matrix</span><span class="op">(</span><span class="fu">rnorm</span><span class="op">(</span><span class="fl">100</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure style="text-align: center"><img src="fig/40-visualization-rendered-plotmethod-1.png" alt="Plotting boxplots (top) and histograms (bottom) vectors (left) or a matrices (right)." class="figure mx-auto d-block"><figcaption>
Plotting boxplots (top) and histograms (bottom) vectors (left) or a
matrices (right).
</figcaption></figure><p>、<code>plot</code>、<code>hist</code>、
<code>boxplot</code>、…のような1行のコードと1つの関数で非常に素早く作成できる。
しかし、デフォルトは必ずしも最も魅力的なものではありません。
、図形のチューニングは、特に複雑になると（例えばファセットを生成するために
）、時間がかかり面倒になります。</p>
</div>
<div class="section level3">
<h3 id="格子パッケージ">格子パッケージ<a class="anchor" aria-label="anchor" href="#%E6%A0%BC%E5%AD%90%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8"></a>
</h3>
<p>lattice<code>** パッケージは</code>ggplot2<code>と似ているが、 データフレームを入力として使い、グラフィカルオブジェクトを返し、ファセットをサポートする。 しかし、</code>lattice`はグラフィックの文法に基づいておらず、
より複雑なインターフェイスを持っている。</p>
<p>lattice`<a href="mailto:%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8%E3%81%AE%E8%89%AF%E3%81%84%E3%83%AA%E3%83%95%E3%82%A1%E3%83%AC%E3%83%B3%E3%82%B9%E3%81%AF@latticebook%E3%81%A0" class="email">パッケージの良いリファレンスは@latticebookだ</a>。</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">まとめ<a class="anchor" aria-label="アンカー" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>Rによる可視化</li>
</ul>
</div>
</div>
</div>
</div>
</section><div class="footnotes footnotes-end-of-document">
<hr>
<ol>
<li id="fn1"><p>出典<a href="https://raw.githubusercontent.com/rstudio/cheatsheets/main/data-visualization.pdf" class="external-link">データ可視化チートシート</a>.<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
</ol>
</div></section><section id="aio-60-next-steps"><p>Content from <a href="60-next-steps.html">次のステップ</a></p>
<hr>
<p>最終更新日：2024-09-08 |

        <a href="https://github.com/carpentries-incubator/bioc-intro/edit/main/episodes/60-next-steps.Rmd" class="external-link">ページの編集 <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="回答を全て表示する " data-collapse="回答を全て折りたたむ "> 回答を全て表示する <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">概要</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">質問</h3>
<ul>
<li>
<code>SummarizedExperiment</code> とは何でしょうか？</li>
<li>Bioconductor と何でしょうか？</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">目的</h3>
<ul>
<li>Bioconductorプロジェクトを紹介してみましょう。</li>
<li>データコンテナの概念を紹介してみましょう。</li>
<li>オミックス解析で多用される <code>SummarizedExperiment</code>
の概要を説明する。</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="次のステップ">次のステップ<a class="anchor" aria-label="アンカー" href="#%E6%AC%A1%E3%81%AE%E3%82%B9%E3%83%86%E3%83%83%E3%83%97"></a>
<a class="anchor" aria-label="anchor" href="#%E6%AC%A1%E3%81%AE%E3%82%B9%E3%83%86%E3%83%83%E3%83%97"></a>
</h2>
<hr class="half-width">
<p>バイオインフォマティクスのデータはしばしば複雑です。
これに対処するため、 開発者は、扱う必要のあるデータのプロパティに
マッチする、特別なデータコンテナ（クラスと呼ばれる）を定義する。</p>
<p>この側面は、パッケージ間で同じ<strong>コア・データ・インフラ</strong>を使用する<strong>バイオコンダクター</strong>[^バイオコンダクター]プロジェクト
。 この 、Bioconductorの成功に貢献したことは間違いない。 Bioconductor
パッケージ 開発者は、
プロジェクト全体に一貫性、相互運用性、安定性を提供するために、既存のインフラストラクチャを利用することをお勧めします
。</p>
<p>このようなオミックス・データ・コンテナを説明するために、
<code>SummarizedExperiment</code>クラスを紹介する。</p>
</section><section><h2 class="section-heading" id="実験概要">実験概要<a class="anchor" aria-label="アンカー" href="#%E5%AE%9F%E9%A8%93%E6%A6%82%E8%A6%81"></a>
<a class="anchor" aria-label="anchor" href="#%E5%AE%9F%E9%A8%93%E6%A6%82%E8%A6%81"></a>
</h2>
<hr class="half-width">
<p>下図は、SummarizedExperimentクラスの構造を表しています。</p>
<figure><img src="https://uclouvain-cbio.github.io/WSBIM1322/figs/SE.svg" width="80%" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>SummarizedExperimentクラスのオブジェクトには、：</p>
<ul>
<li><p>**定量的オミックスデータ
（発現データ）を含む1つ（または複数）のアッセイ
**、マトリックス状のオブジェクトとして格納されている。 特徴（遺伝子、
転写物、タンパク質、…） は行に沿って定義され、
は列に沿って定義される。</p></li>
<li><p>データフレームとして格納された、サンプルの共変量を含む
<strong>sample metadata</strong> スロット。
この表の行はサンプルを表す（行は発現データの
列と正確に一致する）。</p></li>
<li><p>データフレームとして格納される、特徴共変量を含む
<strong>特徴メタデータ</strong> スロット。 このデータフレームの行は、
式データの行と完全に一致する。</p></li>
</ul>
<p>SummarizedExperiment`の調整された性質は、データ操作中に
、異なるスロットの次元が
、常に一致することを保証する（すなわち、発現データの列と
サンプルメタデータの行、および発現データと 特徴メタデータの行）。
例えば、
、アッセイから1つのサンプルを除外しなければならない場合、同じ操作でサンプルメタデータから
、自動的に除外される。</p>
<p>メタデータ・スロットは、他の構造に影響を与えることなく、
（カラム）の共変数を追加で増やすことができる。</p>
<div class="section level3">
<h3 id="summarizedexperimentの作成">SummarizedExperimentの作成<a class="anchor" aria-label="anchor" href="#summarizedexperiment%E3%81%AE%E4%BD%9C%E6%88%90"></a>
</h3>
<p>SummarizedExperiment`を作成するために、
の各コンポーネント、すなわちカウントマトリックス、サンプル、遺伝子
のメタデータをcsvファイルから作成する。 これらは通常、RNA-Seqデータが
（生データが処理された後）提供される方法である。</p>
<ul>
<li>
<strong>An expression matrix</strong>: カウント行列をロードし、
最初の列が行/遺伝子名を含むことを指定し、 <code>data.frame</code> を
<code>matrix</code> に変換する。 ダウンロードは <a href="https://carpentries-incubator.github.io/bioc-intro/data/count_matrix.csv" class="external-link">こちら</a>。</li>
</ul>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">count_matrix</span> <span class="op">&lt;-</span> <span class="fu">read.csv</span><span class="op">(</span><span class="st">"data/count_matrix.csv"</span>,</span>
<span>                         row.names <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">as.matrix</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">count_matrix</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>        GSM2545336 GSM2545337 GSM2545338 GSM2545339 GSM2545340 GSM2545341
Asl           1170        361        400        586        626        988
Apod         36194      10347       9173      10620      13021      29594
Cyp2d22       4060       1616       1603       1901       2171       3349
Klk6           287        629        641        578        448        195
Fcrls           85        233        244        237        180         38
        GSM2545342 GSM2545343 GSM2545344 GSM2545345 GSM2545346 GSM2545347
Asl            836        535        586        597        938       1035
Apod         24959      13668      13230      15868      27769      34301
Cyp2d22       3122       2008       2254       2277       2985       3452
Klk6           186       1101        537        567        327        233
Fcrls           68        375        199        177         89         67
        GSM2545348 GSM2545349 GSM2545350 GSM2545351 GSM2545352 GSM2545353
Asl            494        481        666        937        803        541
Apod         11258      11812      15816      29242      20415      13682
Cyp2d22       1883       2014       2417       3678       2920       2216
Klk6           742        881        828        250        798        710
Fcrls          300        233        231         81        303        285
        GSM2545354 GSM2545362 GSM2545363 GSM2545380
Asl            473        748        576       1192
Apod         11088      15916      11166      38148
Cyp2d22       1821       2842       2011       4019
Klk6           894        501        598        259
Fcrls          248        179        184         68</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">dim</span><span class="op">(</span><span class="va">count_matrix</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 1474   22</code></pre>
</div>
<ul>
<li>
<strong>サンプルを説明する表</strong>、 <a href="https://carpentries-incubator.github.io/bioc-intro/data/sample_metadata.csv" class="external-link">こちら</a>。</li>
</ul>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sample_metadata</span> <span class="op">&lt;-</span> <span class="fu">read.csv</span><span class="op">(</span><span class="st">"data/sample_metadata.csv"</span><span class="op">)</span></span>
<span><span class="va">sample_metadata</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>       sample     organism age    sex   infection  strain time     tissue mouse
1  GSM2545336 Mus musculus   8 Female  InfluenzaA C57BL/6    8 Cerebellum    14
2  GSM2545337 Mus musculus   8 Female NonInfected C57BL/6    0 Cerebellum     9
3  GSM2545338 Mus musculus   8 Female NonInfected C57BL/6    0 Cerebellum    10
4  GSM2545339 Mus musculus   8 Female  InfluenzaA C57BL/6    4 Cerebellum    15
5  GSM2545340 Mus musculus   8   Male  InfluenzaA C57BL/6    4 Cerebellum    18
6  GSM2545341 Mus musculus   8   Male  InfluenzaA C57BL/6    8 Cerebellum     6
7  GSM2545342 Mus musculus   8 Female  InfluenzaA C57BL/6    8 Cerebellum     5
8  GSM2545343 Mus musculus   8   Male NonInfected C57BL/6    0 Cerebellum    11
9  GSM2545344 Mus musculus   8 Female  InfluenzaA C57BL/6    4 Cerebellum    22
10 GSM2545345 Mus musculus   8   Male  InfluenzaA C57BL/6    4 Cerebellum    13
11 GSM2545346 Mus musculus   8   Male  InfluenzaA C57BL/6    8 Cerebellum    23
12 GSM2545347 Mus musculus   8   Male  InfluenzaA C57BL/6    8 Cerebellum    24
13 GSM2545348 Mus musculus   8 Female NonInfected C57BL/6    0 Cerebellum     8
14 GSM2545349 Mus musculus   8   Male NonInfected C57BL/6    0 Cerebellum     7
15 GSM2545350 Mus musculus   8   Male  InfluenzaA C57BL/6    4 Cerebellum     1
16 GSM2545351 Mus musculus   8 Female  InfluenzaA C57BL/6    8 Cerebellum    16
17 GSM2545352 Mus musculus   8 Female  InfluenzaA C57BL/6    4 Cerebellum    21
18 GSM2545353 Mus musculus   8 Female NonInfected C57BL/6    0 Cerebellum     4
19 GSM2545354 Mus musculus   8   Male NonInfected C57BL/6    0 Cerebellum     2
20 GSM2545362 Mus musculus   8 Female  InfluenzaA C57BL/6    4 Cerebellum    20
21 GSM2545363 Mus musculus   8   Male  InfluenzaA C57BL/6    4 Cerebellum    12
22 GSM2545380 Mus musculus   8 Female  InfluenzaA C57BL/6    8 Cerebellum    19</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">dim</span><span class="op">(</span><span class="va">sample_metadata</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 22  9</code></pre>
</div>
<ul>
<li>
<strong>遺伝子を説明する表</strong>、 <a href="https://carpentries-incubator.github.io/bioc-intro/data/gene_metadata.csv" class="external-link">こちら</a>。</li>
</ul>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gene_metadata</span> <span class="op">&lt;-</span> <span class="fu">read.csv</span><span class="op">(</span><span class="st">"data/gene_metadata.csv"</span><span class="op">)</span></span>
<span><span class="va">gene_metadata</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>      gene ENTREZID
1      Asl   109900
2     Apod    11815
3  Cyp2d22    56448
4     Klk6    19144
5    Fcrls    80891
6   Slc2a4    20528
7     Exd2    97827
8     Gjc2   118454
9     Plp1    18823
10    Gnb4    14696
                                                                         product
1                                 argininosuccinate lyase, transcript variant X1
2                                         apolipoprotein D, transcript variant 3
3   cytochrome P450, family 2, subfamily d, polypeptide 22, transcript variant 2
4                           kallikrein related-peptidase 6, transcript variant 2
5                  Fc receptor-like S, scavenger receptor, transcript variant X1
6            solute carrier family 2 (facilitated glucose transporter), member 4
7                                          exonuclease 3'-5' domain containing 2
8                            gap junction protein, gamma 2, transcript variant 1
9                           proteolipid protein (myelin) 1, transcript variant 1
10 guanine nucleotide binding protein (G protein), beta 4, transcript variant X2
      ensembl_gene_id
1  ENSMUSG00000025533
2  ENSMUSG00000022548
3  ENSMUSG00000061740
4  ENSMUSG00000050063
5  ENSMUSG00000015852
6  ENSMUSG00000018566
7  ENSMUSG00000032705
8  ENSMUSG00000043448
9  ENSMUSG00000031425
10 ENSMUSG00000027669</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">dim</span><span class="op">(</span><span class="va">gene_metadata</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 1474    9</code></pre>
</div>
<p>これらのテーブルから <code>SummarizedExperiment</code>
を作成する：</p>
<ul>
<li><p>として使用されるカウント行列。</p></li>
<li><p>サンプルを記述したテーブルは、<strong>サンプル
メタデータ</strong>スロットとして使用される。</p></li>
<li><p>遺伝子を記述したテーブルは、<strong>features
メタデータ</strong>スロットとして使用される。</p></li>
</ul>
<p>これを行うには、 <code>SummarizedExperiment</code>
コンストラクタを使って、異なるパーツをまとめることができる：</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## BiocManager::install("SummarizedExperiment")</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="st">"SummarizedExperiment"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">エラー<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in library("SummarizedExperiment"): there is no package called 'SummarizedExperiment'</code></pre>
</div>
<p>まず、
カウントマトリックスとサンプルアノテーションにおいて、サンプルの順番が同じであることを確認する。また、
カウントマトリックスと遺伝子アノテーションにおいて、遺伝子の順番が同じであることを確認する。</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">stopifnot</span><span class="op">(</span><span class="fu">rownames</span><span class="op">(</span><span class="va">count_matrix</span><span class="op">)</span> <span class="op">==</span> <span class="va">gene_metadata</span><span class="op">$</span><span class="va">gene</span><span class="op">)</span></span>
<span><span class="fu">stopifnot</span><span class="op">(</span><span class="fu">colnames</span><span class="op">(</span><span class="va">count_matrix</span><span class="op">)</span> <span class="op">==</span> <span class="va">sample_metadata</span><span class="op">$</span><span class="va">sample</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">se</span> <span class="op">&lt;-</span> <span class="fu">SummarizedExperiment</span><span class="op">(</span>assays <span class="op">=</span> <span class="fu">list</span><span class="op">(</span>counts <span class="op">=</span> <span class="va">count_matrix</span><span class="op">)</span>,</span>
<span>                           colData <span class="op">=</span> <span class="va">sample_metadata</span>,</span>
<span>                           rowData <span class="op">=</span> <span class="va">gene_metadata</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">エラー<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in SummarizedExperiment(assays = list(counts = count_matrix), colData = sample_metadata, : could not find function "SummarizedExperiment"</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">se</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">エラー<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in eval(expr, envir, enclos): object 'se' not found</code></pre>
</div>
</div>
<div class="section level3">
<h3 id="データの保存">データの保存<a class="anchor" aria-label="anchor" href="#%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E4%BF%9D%E5%AD%98"></a>
</h3>
<p>以前のエピソードで行ったように、データをスプレッドシートにエクスポートするには、
、第1章
（小数点以下の区切り文字に<code>,</code>と<code>.</code>を使った場合の不整合の可能性、
変数型の定義の欠如）で説明したようないくつかの制限がある。 さらに、
スプレッドシートへのデータエクスポートは、データフレーム
や行列のような長方形のデータにのみ関係する。</p>
<p>データを保存するより一般的な方法は、Rに特有であり、
どのオペレーティングシステムでも動作することが保証されている
<code>saveRDS</code> 関数を使用することである。
このようにオブジェクトを保存すると、ディスク上にバイナリ
表現が生成されます（ここでは <code>rds</code>
ファイル拡張子を使用します）。 <code>readRDS</code> 関数を使用して R
にロードし直すことができます。</p>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">saveRDS</span><span class="op">(</span><span class="va">se</span>, file <span class="op">=</span> <span class="st">"data_output/se.rds"</span><span class="op">)</span></span>
<span><span class="fu">rm</span><span class="op">(</span><span class="va">se</span><span class="op">)</span></span>
<span><span class="va">se</span> <span class="op">&lt;-</span> <span class="fu">readRDS</span><span class="op">(</span><span class="st">"data_output/se.rds"</span><span class="op">)</span></span>
<span><span class="fu">head</span><span class="op">(</span><span class="va">se</span><span class="op">)</span></span></code></pre>
</div>
<p>結論として、Rからデータを保存し、
Rで再度ロードする場合、<code>saveRDS</code>と<code>readRDS</code>で保存とロードを行うのが
。 表形式のデータを、Rを使用していない誰か（
）と共有する必要がある場合は、テキストベースのスプレッドシートにエクスポートするのが、
良い選択肢である。</p>
<p>このデータ構造を使って、
<code>assay</code>関数で発現行列にアクセスすることができる：</p>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">head</span><span class="op">(</span><span class="fu">assay</span><span class="op">(</span><span class="va">se</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">エラー<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in assay(se): could not find function "assay"</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">dim</span><span class="op">(</span><span class="fu">assay</span><span class="op">(</span><span class="va">se</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">エラー<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in assay(se): could not find function "assay"</code></pre>
</div>
<p>colData`関数を使ってサンプルのメタデータにアクセスすることができる：</p>
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">colData</span><span class="op">(</span><span class="va">se</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">エラー<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in colData(se): could not find function "colData"</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb27">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">dim</span><span class="op">(</span><span class="fu">colData</span><span class="op">(</span><span class="va">se</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">エラー<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in colData(se): could not find function "colData"</code></pre>
</div>
<p>また、<code>rowData</code>関数を使ってフィーチャーのメタデータにアクセスすることもできる：</p>
<div class="codewrapper sourceCode" id="cb29">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">head</span><span class="op">(</span><span class="fu">rowData</span><span class="op">(</span><span class="va">se</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">エラー<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in rowData(se): could not find function "rowData"</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb31">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">dim</span><span class="op">(</span><span class="fu">rowData</span><span class="op">(</span><span class="va">se</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">エラー<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in rowData(se): could not find function "rowData"</code></pre>
</div>
</div>
<div class="section level3">
<h3 id="summarizedexperimentをサブセットする">SummarizedExperimentをサブセットする<a class="anchor" aria-label="anchor" href="#summarizedexperiment%E3%82%92%E3%82%B5%E3%83%96%E3%82%BB%E3%83%83%E3%83%88%E3%81%99%E3%82%8B"></a>
</h3>
<p>SummarizedExperiment は、データフレームと同じように、
数値または論理の文字でサブセットできる。</p>
<p>以下では、
、3つの最初のサンプルの5つの最初の特徴のみを含む、SummarizedExperimentクラスの新しいインスタンスを作成します。</p>
<div class="codewrapper sourceCode" id="cb33">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">se1</span> <span class="op">&lt;-</span> <span class="va">se</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">エラー<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in eval(expr, envir, enclos): object 'se' not found</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb35">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">se1</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">エラー<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in eval(expr, envir, enclos): object 'se1' not found</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb37">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">colData</span><span class="op">(</span><span class="va">se1</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">エラー<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in colData(se1): could not find function "colData"</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb39">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">rowData</span><span class="op">(</span><span class="va">se1</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">エラー<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in rowData(se1): could not find function "rowData"</code></pre>
</div>
<p>また、<code>colData()</code> 関数を使用して、
サンプルメタデータから何かをサブセットしたり、<code>rowData()</code>
関数を使用して、
フィーチャーメタデータから何かをサブセットすることもできます。
例えば、ここではmiRNAと に感染していないサンプルだけを残している：</p>
<div class="codewrapper sourceCode" id="cb41">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">se1</span> <span class="op">&lt;-</span> <span class="va">se</span><span class="op">[</span><span class="fu">rowData</span><span class="op">(</span><span class="va">se</span><span class="op">)</span><span class="op">$</span><span class="va">gene_biotype</span> <span class="op">==</span> <span class="st">"miRNA"</span>,</span>
<span>          <span class="fu">colData</span><span class="op">(</span><span class="va">se</span><span class="op">)</span><span class="op">$</span><span class="va">infection</span> <span class="op">==</span> <span class="st">"NonInfected"</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">エラー<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in eval(expr, envir, enclos): object 'se' not found</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb43">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">se1</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">エラー<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in eval(expr, envir, enclos): object 'se1' not found</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb45">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">assay</span><span class="op">(</span><span class="va">se1</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">エラー<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in assay(se1): could not find function "assay"</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb47">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">colData</span><span class="op">(</span><span class="va">se1</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">エラー<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in colData(se1): could not find function "colData"</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb49">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">rowData</span><span class="op">(</span><span class="va">se1</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">エラー<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in rowData(se1): could not find function "rowData"</code></pre>
</div>
<!--For the following exercise, you should download the SE.rda object
(that contains the `se` object), and open the file using the 'load()'
function.-->
<!-- ```{r, eval = FALSE, echo = FALSE} -->
<!-- download.file(url = "https://raw.githubusercontent.com/UCLouvain-CBIO/bioinfo-training-01-intro-r/master/data/SE.rda", -->
<!--               destfile = "data/SE.rda") -->
<!-- load("data/SE.rda") -->
<!-- ``` -->
<div id="チャレンジ" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ" class="callout-inner">
<h3 class="callout-title">チャレンジ<a class="anchor" aria-label="アンカー" href="#%E3%83%81%E3%83%A3%E3%83%AC%E3%83%B3%E3%82%B8"></a>
</h3>
<div class="callout-content">
<p>時刻0と時刻8のサンプル
、最初の3遺伝子の遺伝子発現レベルを抽出する。</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">
  ソリューション
  </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb51">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">assay</span><span class="op">(</span><span class="va">se</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="fu">colData</span><span class="op">(</span><span class="va">se</span><span class="op">)</span><span class="op">$</span><span class="va">time</span> <span class="op">!=</span> <span class="fl">4</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">エラー<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in assay(se): could not find function "assay"</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb53">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Equivalent to</span></span>
<span><span class="fu">assay</span><span class="op">(</span><span class="va">se</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="fu">colData</span><span class="op">(</span><span class="va">se</span><span class="op">)</span><span class="op">$</span><span class="va">time</span> <span class="op">==</span> <span class="fl">0</span> <span class="op">|</span> <span class="fu">colData</span><span class="op">(</span><span class="va">se</span><span class="op">)</span><span class="op">$</span><span class="va">time</span> <span class="op">==</span> <span class="fl">8</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">エラー<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in assay(se): could not find function "assay"</code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="チャレンジ-1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="チャレンジ-1" class="callout-inner">
<h3 class="callout-title">チャレンジ<a class="anchor" aria-label="アンカー" href="#%E3%83%81%E3%83%A3%E3%83%AC%E3%83%B3%E3%82%B8-1"></a>
</h3>
<div class="callout-content">
<p>長い<code>rna</code>テーブルを使用して同じ値が得られることを確認する。</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2">
  ソリューション
  </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb55">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rna</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">filter</span><span class="op">(</span><span class="va">gene</span> <span class="op">%in%</span> <span class="fu">c</span><span class="op">(</span><span class="st">"Asl"</span>, <span class="st">"Apod"</span>, <span class="st">"Cyd2d22"</span><span class="op">)</span><span class="op">)</span><span class="op">|&gt;</span></span>
<span>    <span class="fu">filter</span><span class="op">(</span><span class="va">time</span> <span class="op">!=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">select</span><span class="op">(</span><span class="va">expression</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">出力<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 28 × 1
   expression
        &lt;dbl&gt;
 1       1170
 2      36194
 3        361
 4      10347
 5        400
 6       9173
 7        988
 8      29594
 9        836
10      24959
# ℹ 18 more rows</code></pre>
</div>
</div>
</div>
</div>
</div>
<p>長いテーブルと<code>SummarizedExperiment</code>は同じ
情報を含むが、単に構造が異なるだけである。 各アプローチにはそれぞれ
独自の利点がある。前者は <code>tidyverse</code> パッケージに適しており、
一方、後者は多くのバイオインフォマティクスと
統計処理ステップに適した構造である。 例えば、
<code>DESeq2</code>パッケージを使用した典型的なRNA-Seq分析である。</p>
<div class="section level4">
<h4 id="メタデータに変数を追加する">メタデータに変数を追加する<a class="anchor" aria-label="anchor" href="#%E3%83%A1%E3%82%BF%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AB%E5%A4%89%E6%95%B0%E3%82%92%E8%BF%BD%E5%8A%A0%E3%81%99%E3%82%8B"></a>
</h4>
<p>メタデータに情報を追加することもできる。
サンプルが採取されたセンターを追加したいとします…</p>
<div class="codewrapper sourceCode" id="cb57">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">colData</span><span class="op">(</span><span class="va">se</span><span class="op">)</span><span class="op">$</span><span class="va">center</span> <span class="op">&lt;-</span> <span class="fu">rep</span><span class="op">(</span><span class="st">"University of Illinois"</span>, <span class="fu">nrow</span><span class="op">(</span><span class="fu">colData</span><span class="op">(</span><span class="va">se</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">エラー<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in colData(se): could not find function "colData"</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb59">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">colData</span><span class="op">(</span><span class="va">se</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">エラー<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in colData(se): could not find function "colData"</code></pre>
</div>
<p>これは、メタデータ・スロットが、
、他の構造に影響を与えることなく、無限に成長できることを示している！</p>
</div>
</div>
<div class="section level3">
<h3 id="tidysummarizedexperiment">tidySummarizedExperiment<a class="anchor" aria-label="anchor" href="#tidysummarizedexperiment"></a>
</h3>
<p><code>SummarizedExperiment</code> オブジェクトを操作するために
tidyverse コマンドを使うことはできるのだろうか？
<code>tidySummarizedExperiment</code> パッケージを使えば可能です。</p>
<p>SummarizedExperimentオブジェクトがどのようなものか思い出してください：</p>
<div class="codewrapper sourceCode" id="cb61">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">シー</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">エラー<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in eval(expr, envir, enclos): object 'シー' not found</code></pre>
</div>
<p>tidySummarizedExperiment`をロードし、seオブジェクト 。</p>
<div class="codewrapper sourceCode" id="cb63">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#BiocManager::install("tidySummarizedExperiment")</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="st">"tidySummarizedExperiment"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">エラー<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in library("tidySummarizedExperiment"): there is no package called 'tidySummarizedExperiment'</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb65">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">se</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">エラー<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in eval(expr, envir, enclos): object 'se' not found</code></pre>
</div>
<p>これはまだ<code>SummarizedExperiment</code>オブジェクトなので、効率的な
構造を維持しているが、これでティブルとして見ることができる。
の最初の行に注目してほしい。出力にはこう書いてあるが、これは
<code>SummarizedExperiment</code>-<code>tibble</code> の抽象化である。
また、出力の2行目には、
のトランスクリプトとサンプルの数を見ることができる。</p>
<p>標準の<code>SummarizedExperiment</code>ビューに戻したい場合は、
。</p>
<div class="codewrapper sourceCode" id="cb67">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">options</span><span class="op">(</span><span class="st">"restore_SummarizedExperiment_show"</span> <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">se</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">エラー<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in eval(expr, envir, enclos): object 'se' not found</code></pre>
</div>
<p>しかし、ここではティブル・ビューを使う。</p>
<div class="codewrapper sourceCode" id="cb69">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">options</span><span class="op">(</span><span class="st">"restore_SummarizedExperiment_show"</span> <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">se</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">エラー<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in eval(expr, envir, enclos): object 'se' not found</code></pre>
</div>
<p><code>SummarizedExperiment</code>
オブジェクトと対話するために、tidyverse
コマンドを使用できるようになりました。</p>
<p>filter`を使用すると、条件を使って行をフィルタリングすることができる。例えば、
、あるサンプルのすべての行を表示することができる。</p>
<div class="codewrapper sourceCode" id="cb71">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">se</span> <span class="op">%&gt;%</span> <span class="fu">filter</span><span class="op">(</span><span class="va">.sample</span> <span class="op">==</span> <span class="st">"GSM2545336"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">エラー<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in eval(expr, envir, enclos): object 'se' not found</code></pre>
</div>
<p>select`を使って表示したいカラムを指定することができる。</p>
<div class="codewrapper sourceCode" id="cb73">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">se</span> <span class="op">%&gt;%</span> <span class="fu">select</span><span class="op">(</span><span class="va">.sample</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">エラー<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in eval(expr, envir, enclos): object 'se' not found</code></pre>
</div>
<p>mutate`を使ってメタデータ情報を追加することができる。</p>
<div class="codewrapper sourceCode" id="cb75">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">se</span> <span class="op">%&gt;%</span> <span class="fu">mutate</span><span class="op">(</span>center <span class="op">=</span> <span class="st">"ハイデルベルク大学"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">エラー<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in eval(expr, envir, enclos): object 'se' not found</code></pre>
</div>
<p>tidyverseパイプ <code>%&gt;%</code>
を使ってコマンドを組み合わせることもできます。
の例では、<code>group_by</code> と <code>summarise</code>
を組み合わせて、各サンプルの カウントの合計を得ることができる。</p>
<div class="codewrapper sourceCode" id="cb77">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">se</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">group_by</span><span class="op">(</span><span class="va">.sample</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">summarise</span><span class="op">(</span>total_counts<span class="op">=</span><span class="fu">sum</span><span class="op">(</span><span class="va">counts</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">エラー<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in eval(expr, envir, enclos): object 'se' not found</code></pre>
</div>
<p>整頓されたSummarizedExperimentオブジェクトを、プロット用の通常のtibble
として扱うことができる。</p>
<p>ここでは、サンプルごとのカウント数分布をプロットしている。</p>
<div class="codewrapper sourceCode" id="cb79">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">se</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">counts</span> <span class="op">+</span> <span class="fl">1</span>, group<span class="op">=</span><span class="va">.sample</span>, color<span class="op">=</span><span class="va">infection</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu">geom_density</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">scale_x_log10</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">エラー<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in eval(expr, envir, enclos): object 'se' not found</code></pre>
</div>
<p>tidySummarizedExperimentの詳細については、パッケージ ウェブサイト <a href="https://stemangiola.github.io/tidySummarizedExperiment/" class="external-link">こちら</a>を参照してください。</p>
<p>**テイクホーム・メッセージ</p>
<ul>
<li><p>SummarizedExperiment`は、オミックスデータを効率的に保存し、
。</p></li>
<li><p>これらは多くのBioconductorパッケージで使用されている。</p></li>
</ul>
<p>RNAシーケンス解析に焦点を当てた次のトレーニング、 、Bioconductor
<code>DESeq2</code>パッケージを使って、 差分発現解析を行う方法を学ぶ。
DESeq2<code>パッケージの全解析は</code>SummarizedExperiment`
で処理される。</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">まとめ<a class="anchor" aria-label="アンカー" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>Bioconductorは、ハイスループットな生物学データの理解（
）のためのサポートとパッケージを提供するプロジェクトである。</li>
<li>SummarizedExperiment`は、ハイスループットのオミックスデータを保存し、
管理するのに便利なオブジェクトの一種である。</li>
</ul>
</div>
</div>
</div>
</div>
</section></section>
</div>
    </main>
</div>
<!-- END  : inst/pkgdown/templates/content-extra.html -->

      </div>
<!--/div.row-->
      		<footer class="row footer mx-md-3"><hr>
<div class="col-md-6">
        <p>このレッスンは<a href="CODE_OF_CONDUCT.html">行動規範</a>の対象となっている</p>
        <p>

        <a href="https://github.com/carpentries-incubator/bioc-intro/edit/main/README.md" class="external-link">GitHubで編集</a>

	
        | <a href="https://github.com/carpentries-incubator/bioc-intro/blob/main/CONTRIBUTING.md" class="external-link">貢献</a>
        | <a href="https://github.com/carpentries-incubator/bioc-intro/" class="external-link">ソース</a></p>
				<p><a href="https://github.com/carpentries-incubator/bioc-intro/blob/main/CITATION" class="external-link">引用</a> | <a href="mailto:laurent.gatto@uclouvain.be">お問い合わせ</a> | <a href="https://carpentries.org/about/" class="external-link">概要</a></p>
			</div>
			<div class="col-md-6">

        <p>材料は著者によって<a href="LICENSE.html">CC-BY 4.0</a>のもとに掲載を許諾されている</p>

        <p>テンプレートは<a href="https://carpentries.org/" class="external-link">The Carpentries</a>によって<a href="https://creativecommons.org/licenses/by-sa/4.0/" class="external-link">CC-BY 4.0</a>のもとに掲載を許諾されている</p>
        <p>このレッスンは<a href="https://github.com/carpentries/sandpaper/tree/0.16.5" class="external-link">sandpaper (0.16.5)</a>、<a href="https://github.com/carpentries/pegboard/tree/0.7.6" class="external-link">pegboard (0.7.6)</a>、および<a href="https://github.com/carpentries/varnish/tree/1.0.3" class="external-link">varnish (1.0.3)</a>によって作られた</p>
			</div>
		</footer>
</div> <!-- / div.container -->
	<div id="to-top">
		<a href="#top">
      <i class="search-icon" data-feather="arrow-up" role="img" aria-label="上へ戻る"></i><br><!-- <span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top -->
      上へ<span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">戻る</span>
		</a>
	</div>
  <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "TrainingMaterial",
  "@id": "https://carpentries-incubator.github.io/bioc-intro/aio.html",
  "inLanguage": "ja",
  "dct:conformsTo": "https://bioschemas.org/profiles/TrainingMaterial/1.0-RELEASE",
  "description": "A Carpentries Lesson teaching foundational data and coding skills to researchers worldwide",
  "keywords": "software, data, lesson, The Carpentries",
  "name": "一つにまとまったページ",
  "creativeWorkStatus": "active",
  "url": "https://carpentries-incubator.github.io/bioc-intro/aio.html",
  "identifier": "https://carpentries-incubator.github.io/bioc-intro/aio.html",
  "dateCreated": "2020-09-14",
  "dateModified": "2024-09-08",
  "datePublished": "2024-09-08"
}

  </script><script>
		feather.replace();
	</script>
</body>
</html><!-- END:   inst/pkgdown/templates/layout.html-->

